<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OMCompilerDoxygen: 3rdParty/Cdaskr/fortran/solver/ddaskr.f Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OMCompilerDoxygen
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_ac1e9fede566aac571d9ed097263eea9.html">3rdParty</a></li><li class="navelem"><a class="el" href="../../dir_a067d01d86860db8999f3eeb64fc6ab9.html">Cdaskr</a></li><li class="navelem"><a class="el" href="../../dir_2322b3fa7b7b05e61e8b464cb1ac0412.html">fortran</a></li><li class="navelem"><a class="el" href="../../dir_6e2c1f7cf44375e6de9b77b84097d5df.html">solver</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ddaskr.f</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d2/dd0/ddaskr_8f.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a25f46ebdca7779b4d378ecfe457426a0">ddaskr</a> (RES, NEQ, T, Y, YPRIME, TOUT, INFO, RTOL, ATOL,</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;     *   IDID, RWORK, LRW, IWORK, LIW, RPAR, IPAR, JAC, PSOL,</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;     *   RT, NRT, JROOT)</div><div class="line"><a name="l00004"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a25f46ebdca7779b4d378ecfe457426a0">    4</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DDASKR</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">C***REVISION HISTORY  (YYMMDD)</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">C   020815  DATE WRITTEN   </span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">C   021105  Changed yprime argument in DRCHEK calls to YPRIME.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">C   021217  Modified error return for zeros found too close together.</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">C   021217  Added root direction output in JROOT.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">C   040518  Changed adjustment to X2 in Subr. DROOTS.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">C   050511  Revised stopping tests in statements 530 - 580; reordered</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">C           to test for tn at tstop before testing for tn past tout.</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">C   060712  In DMATD, changed minimum D.Q. increment to 1/EWT(j).</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">C   071003  In DRCHEK, fixed bug in TEMP2 (HMINR) below 110.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">C   110608  In DRCHEK, fixed bug in setting of T1 at 300.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">C***CATEGORY NO.  I1A2</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">C***KEYWORDS  DIFFERENTIAL/ALGEBRAIC, BACKWARD DIFFERENTIATION FORMULAS,</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">C             IMPLICIT DIFFERENTIAL SYSTEMS, KRYLOV ITERATION</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">C***AUTHORS   Linda R. Petzold, Peter N. Brown, Alan C. Hindmarsh, and</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">C                  Clement W. Ulrich</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">C             Center for Computational Sciences &amp; Engineering, L-316</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">C             Lawrence Livermore National Laboratory</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">C             P.O. Box 808,</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">C             Livermore, CA 94551</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">C***PURPOSE  This code solves a system of differential/algebraic </span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">C            equations of the form </span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">C               G(t,y,y&#39;) = 0 , </span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">C            using a combination of Backward Differentiation Formula </span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">C            (BDF) methods and a choice of two linear system solution </span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">C            methods: direct (dense or band) or Krylov (iterative).</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">C            This version is in double precision.</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">C *Usage:</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">C      IMPLICIT DOUBLE PRECISION(A-H,O-Z)</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">C      INTEGER NEQ, INFO(N), IDID, LRW, LIW, IWORK(LIW), IPAR(*)</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">C      DOUBLE PRECISION T, Y(*), YPRIME(*), TOUT, RTOL(*), ATOL(*),</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">C         RWORK(LRW), RPAR(*)</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">C      EXTERNAL RES, JAC, PSOL, RT</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">C      CALL DDASKR (RES, NEQ, T, Y, YPRIME, TOUT, INFO, RTOL, ATOL,</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">C     *             IDID, RWORK, LRW, IWORK, LIW, RPAR, IPAR, JAC, PSOL,</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">C     *             RT, NRT, JROOT)</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">C  Quantities which may be altered by the code are:</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">C     T, Y(*), YPRIME(*), INFO(1), RTOL, ATOL, IDID, RWORK(*), IWORK(*)</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">C *Arguments:</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">C  RES:EXT          This is the name of a subroutine which you</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">C                   provide to define the residual function G(t,y,y&#39;)</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">C                   of the differential/algebraic system.</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">C  NEQ:IN           This is the number of equations in the system.</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">C  T:INOUT          This is the current value of the independent </span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">C                   variable.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">C  Y(*):INOUT       This array contains the solution components at T.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">C  YPRIME(*):INOUT  This array contains the derivatives of the solution</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">C                   components at T.</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">C  TOUT:IN          This is a point at which a solution is desired.</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">C  INFO(N):IN       This is an integer array used to communicate details</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">C                   of how the solution is to be carried out, such as</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">C                   tolerance type, matrix structure, step size and</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">C                   order limits, and choice of nonlinear system method.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">C                   N must be at least 20.</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">C  RTOL,ATOL:INOUT  These quantities represent absolute and relative</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">C                   error tolerances (on local error) which you provide</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">C                   to indicate how accurately you wish the solution to</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">C                   be computed.  You may choose them to be both scalars</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">C                   or else both arrays of length NEQ.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">C  IDID:OUT         This integer scalar is an indicator reporting what</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">C                   the code did.  You must monitor this variable to</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">C                   decide what action to take next.</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">C  RWORK:WORK       A real work array of length LRW which provides the</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">C                   code with needed storage space.</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">C  LRW:IN           The length of RWORK.</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">C  IWORK:WORK       An integer work array of length LIW which provides</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">C                   the code with needed storage space.</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">C  LIW:IN           The length of IWORK.</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">C  RPAR,IPAR:IN     These are real and integer parameter arrays which</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">C                   you can use for communication between your calling</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">C                   program and the RES, JAC, and PSOL subroutines.</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">C  JAC:EXT          This is the name of a subroutine which you may</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">C                   provide (optionally) for calculating Jacobian </span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">C                   (partial derivative) data involved in solving linear</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">C                   systems within DDASKR.</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">C  PSOL:EXT         This is the name of a subroutine which you must</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">C                   provide for solving linear systems if you selected</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">C                   a Krylov method.  The purpose of PSOL is to solve</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">C                   linear systems involving a left preconditioner P.</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">C  RT:EXT           This is the name of the subroutine for defining</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">C                   constraint functions Ri(T,Y,Y&#39;)) whose roots are</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">C                   desired during the integration.  This name must be</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">C                   declared external in the calling program.</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">C  NRT:IN           This is the number of constraint functions</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">C                   Ri(T,Y,Y&#39;).  If there are no constraints, set</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">C                   NRT = 0, and pass a dummy name for RT.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">C  JROOT:OUT        This is an integer array of length NRT for output</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">C                   of root information.</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">C *Overview</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">C  The DDASKR solver uses the backward differentiation formulas of</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">C  orders one through five to solve a system of the form G(t,y,y&#39;) = 0</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">C  for y = Y and y&#39; = YPRIME.  Values for Y and YPRIME at the initial </span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">C  time must be given as input.  These values should be consistent, </span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">C  that is, if T, Y, YPRIME are the given initial values, they should </span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">C  satisfy G(T,Y,YPRIME) = 0.  However, if consistent values are not</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">C  known, in many cases you can have DDASKR solve for them -- see</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">C  INFO(11). (This and other options are described in detail below.)</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">C  Normally, DDASKR solves the system from T to TOUT.  It is easy to</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">C  continue the solution to get results at additional TOUT.  This is</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">C  the interval mode of operation.  Intermediate results can also be</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">C  obtained easily by specifying INFO(3).</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">C  On each step taken by DDASKR, a sequence of nonlinear algebraic  </span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">C  systems arises.  These are solved by one of two types of</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">C  methods:</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">C    * a Newton iteration with a direct method for the linear</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">C      systems involved (INFO(12) = 0), or</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">C    * a Newton iteration with a preconditioned Krylov iterative </span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">C      method for the linear systems involved (INFO(12) = 1).</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">C  The direct method choices are dense and band matrix solvers, </span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">C  with either a user-supplied or an internal difference quotient </span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">C  Jacobian matrix, as specified by INFO(5) and INFO(6).</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">C  In the band case, INFO(6) = 1, you must supply half-bandwidths</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">C  in IWORK(1) and IWORK(2).</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">C  The Krylov method is the Generalized Minimum Residual (GMRES) </span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">C  method, in either complete or incomplete form, and with </span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">C  scaling and preconditioning.  The method is implemented</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">C  in an algorithm called SPIGMR.  Certain options in the Krylov </span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">C  method case are specified by INFO(13) and INFO(15).</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">C  If the Krylov method is chosen, you may supply a pair of routines,</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">C  JAC and PSOL, to apply preconditioning to the linear system.</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">C  If the system is A*x = b, the matrix is A = dG/dY + CJ*dG/dYPRIME</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">C  (of order NEQ).  This system can then be preconditioned in the form</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">C  (P-inverse)*A*x = (P-inverse)*b, with left preconditioner P.</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">C  (DDASKR does not allow right preconditioning.)</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">C  Then the Krylov method is applied to this altered, but equivalent,</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">C  linear system, hopefully with much better performance than without</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">C  preconditioning.  (In addition, a diagonal scaling matrix based on</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">C  the tolerances is also introduced into the altered system.)</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">C  The JAC routine evaluates any data needed for solving systems</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">C  with coefficient matrix P, and PSOL carries out that solution.</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">C  In any case, in order to improve convergence, you should try to</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">C  make P approximate the matrix A as much as possible, while keeping</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">C  the system P*x = b reasonably easy and inexpensive to solve for x,</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">C  given a vector b.</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">C  While integrating the given DAE system, DDASKR also searches for</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">C  roots of the given constraint functions Ri(T,Y,Y&#39;) given by RT.</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">C  If DDASKR detects a sign change in any Ri(T,Y,Y&#39;), it will return</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="comment">C  the intermediate value of T and Y for which Ri(T,Y,Y&#39;) = 0.</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="comment">C  Caution: If some Ri has a root at or very near the initial time,</span></div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;<span class="comment">C  DDASKR may fail to find it, or may find extraneous roots there,</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">C  because it does not yet have a sufficient history of the solution.</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">C *Description</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">C------INPUT - WHAT TO DO ON THE FIRST CALL TO DDASKR-------------------</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">C  The first call of the code is defined to be the start of each new</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">C  problem.  Read through the descriptions of all the following items,</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">C  provide sufficient storage space for designated arrays, set</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">C  appropriate variables for the initialization of the problem, and</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">C  give information about how you want the problem to be solved.</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment">C  RES -- Provide a subroutine of the form</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">C             SUBROUTINE RES (T, Y, YPRIME, CJ, DELTA, IRES, RPAR, IPAR)</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">C         to define the system of differential/algebraic</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">C         equations which is to be solved. For the given values</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">C         of T, Y and YPRIME, the subroutine should return</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">C         the residual of the differential/algebraic system</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">C             DELTA = G(T,Y,YPRIME)</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">C         DELTA is a vector of length NEQ which is output from RES.</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">C         Subroutine RES must not alter T, Y, YPRIME, or CJ.</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">C         You must declare the name RES in an EXTERNAL</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">C         statement in your program that calls DDASKR.</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">C         You must dimension Y, YPRIME, and DELTA in RES.</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="comment">C         The input argument CJ can be ignored, or used to rescale</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">C         constraint equations in the system (see Ref. 2, p. 145).</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="comment">C         Note: In this respect, DDASKR is not downward-compatible</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">C         with DDASSL, which does not have the RES argument CJ.</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">C         IRES is an integer flag which is always equal to zero</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">C         on input.  Subroutine RES should alter IRES only if it</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment">C         encounters an illegal value of Y or a stop condition.</span></div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">C         Set IRES = -1 if an input value is illegal, and DDASKR</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">C         will try to solve the problem without getting IRES = -1.</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">C         If IRES = -2, DDASKR will return control to the calling</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment">C         program with IDID = -11.</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">C         RPAR and IPAR are real and integer parameter arrays which</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">C         you can use for communication between your calling program</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">C         and subroutine RES. They are not altered by DDASKR. If you</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">C         do not need RPAR or IPAR, ignore these parameters by treat-</span></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">C         ing them as dummy arguments. If you do choose to use them,</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">C         dimension them in your calling program and in RES as arrays</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">C         of appropriate length.</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">C  NEQ -- Set it to the number of equations in the system (NEQ .GE. 1).</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="comment">C  T -- Set it to the initial point of the integration. (T must be</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="comment">C       a variable.)</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">C  Y(*) -- Set this array to the initial values of the NEQ solution</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="comment">C          components at the initial point.  You must dimension Y of</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">C          length at least NEQ in your calling program.</span></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="comment">C  YPRIME(*) -- Set this array to the initial values of the NEQ first</span></div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">C               derivatives of the solution components at the initial</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="comment">C               point.  You must dimension YPRIME at least NEQ in your</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="comment">C               calling program. </span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">C  TOUT - Set it to the first point at which a solution is desired.</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">C         You cannot take TOUT = T.  Integration either forward in T</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">C         (TOUT .GT. T) or backward in T (TOUT .LT. T) is permitted.</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">C         The code advances the solution from T to TOUT using step</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">C         sizes which are automatically selected so as to achieve the</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">C         desired accuracy.  If you wish, the code will return with the</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="comment">C         solution and its derivative at intermediate steps (the</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment">C         intermediate-output mode) so that you can monitor them,</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">C         but you still must provide TOUT in accord with the basic</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="comment">C         aim of the code.</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">C         The first step taken by the code is a critical one because</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">C         it must reflect how fast the solution changes near the</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">C         initial point.  The code automatically selects an initial</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">C         step size which is practically always suitable for the</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="comment">C         problem.  By using the fact that the code will not step past</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">C         TOUT in the first step, you could, if necessary, restrict the</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">C         length of the initial step.</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">C         For some problems it may not be permissible to integrate</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">C         past a point TSTOP, because a discontinuity occurs there</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">C         or the solution or its derivative is not defined beyond</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">C         TSTOP.  When you have declared a TSTOP point (see INFO(4)</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">C         and RWORK(1)), you have told the code not to integrate past</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">C         TSTOP.  In this case any tout beyond TSTOP is invalid input.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">C  INFO(*) - Use the INFO array to give the code more details about</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">C            how you want your problem solved.  This array should be</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">C            dimensioned of length 20, though DDASKR uses only the </span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">C            first 15 entries.  You must respond to all of the following</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">C            items, which are arranged as questions.  The simplest use</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">C            of DDASKR corresponds to setting all entries of INFO to 0.</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">C       INFO(1) - This parameter enables the code to initialize itself.</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">C              You must set it to indicate the start of every new </span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">C              problem.</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">C          **** Is this the first call for this problem ...</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">C                yes - set INFO(1) = 0</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">C                 no - not applicable here.</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">C                      See below for continuation calls.  ****</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">C       INFO(2) - How much accuracy you want of your solution</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">C              is specified by the error tolerances RTOL and ATOL.</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">C              The simplest use is to take them both to be scalars.</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">C              To obtain more flexibility, they can both be arrays.</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">C              The code must be told your choice.</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">C          **** Are both error tolerances RTOL, ATOL scalars ...</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">C                yes - set INFO(2) = 0</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">C                      and input scalars for both RTOL and ATOL</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">C                 no - set INFO(2) = 1</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">C                      and input arrays for both RTOL and ATOL ****</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">C       INFO(3) - The code integrates from T in the direction of TOUT</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">C              by steps.  If you wish, it will return the computed</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">C              solution and derivative at the next intermediate step</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">C              (the intermediate-output mode) or TOUT, whichever comes</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">C              first.  This is a good way to proceed if you want to</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">C              see the behavior of the solution.  If you must have</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">C              solutions at a great many specific TOUT points, this</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">C              code will compute them efficiently.</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">C          **** Do you want the solution only at</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">C               TOUT (and not at the next intermediate step) ...</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">C                yes - set INFO(3) = 0 (interval-output mode)</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">C                 no - set INFO(3) = 1 (intermediate-output mode) ****</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">C       INFO(4) - To handle solutions at a great many specific</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">C              values TOUT efficiently, this code may integrate past</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">C              TOUT and interpolate to obtain the result at TOUT.</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">C              Sometimes it is not possible to integrate beyond some</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">C              point TSTOP because the equation changes there or it is</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">C              not defined past TSTOP.  Then you must tell the code</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">C              this stop condition.</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">C           **** Can the integration be carried out without any</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">C                restrictions on the independent variable T ...</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">C                 yes - set INFO(4) = 0</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">C                  no - set INFO(4) = 1</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">C                       and define the stopping point TSTOP by</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">C                       setting RWORK(1) = TSTOP ****</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">C       INFO(5) - used only when INFO(12) = 0 (direct methods).</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">C              To solve differential/algebraic systems you may wish</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">C              to use a matrix of partial derivatives of the</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">C              system of differential equations.  If you do not</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">C              provide a subroutine to evaluate it analytically (see</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">C              description of the item JAC in the call list), it will</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">C              be approximated by numerical differencing in this code.</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">C              Although it is less trouble for you to have the code</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">C              compute partial derivatives by numerical differencing,</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">C              the solution will be more reliable if you provide the</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">C              derivatives via JAC.  Usually numerical differencing is</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">C              more costly than evaluating derivatives in JAC, but</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">C              sometimes it is not - this depends on your problem.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">C           **** Do you want the code to evaluate the partial deriv-</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">C                atives automatically by numerical differences ...</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">C                 yes - set INFO(5) = 0</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">C                  no - set INFO(5) = 1</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">C                       and provide subroutine JAC for evaluating the</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">C                       matrix of partial derivatives ****</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">C       INFO(6) - used only when INFO(12) = 0 (direct methods).</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">C              DDASKR will perform much better if the matrix of</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">C              partial derivatives, dG/dY + CJ*dG/dYPRIME (here CJ is</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">C              a scalar determined by DDASKR), is banded and the code</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">C              is told this.  In this case, the storage needed will be</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">C              greatly reduced, numerical differencing will be performed</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">C              much cheaper, and a number of important algorithms will</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">C              execute much faster.  The differential equation is said </span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">C              to have half-bandwidths ML (lower) and MU (upper) if </span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">C              equation i involves only unknowns Y(j) with</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">C                             i-ML .le. j .le. i+MU .</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">C              For all i=1,2,...,NEQ.  Thus, ML and MU are the widths</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">C              of the lower and upper parts of the band, respectively,</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">C              with the main diagonal being excluded.  If you do not</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">C              indicate that the equation has a banded matrix of partial</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">C              derivatives the code works with a full matrix of NEQ**2</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">C              elements (stored in the conventional way).  Computations</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">C              with banded matrices cost less time and storage than with</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">C              full matrices if  2*ML+MU .lt. NEQ.  If you tell the</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">C              code that the matrix of partial derivatives has a banded</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">C              structure and you want to provide subroutine JAC to</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="comment">C              compute the partial derivatives, then you must be careful</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="comment">C              to store the elements of the matrix in the special form</span></div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">C              indicated in the description of JAC.</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">C          **** Do you want to solve the problem using a full (dense)</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment">C               matrix (and not a special banded structure) ...</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">C                yes - set INFO(6) = 0</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">C                 no - set INFO(6) = 1</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">C                       and provide the lower (ML) and upper (MU)</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">C                       bandwidths by setting</span></div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">C                       IWORK(1)=ML</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">C                       IWORK(2)=MU ****</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">C       INFO(7) - You can specify a maximum (absolute value of)</span></div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">C              stepsize, so that the code will avoid passing over very</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">C              large regions.</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="comment">C          ****  Do you want the code to decide on its own the maximum</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">C                stepsize ...</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="comment">C                 yes - set INFO(7) = 0</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">C                  no - set INFO(7) = 1</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="comment">C                       and define HMAX by setting</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">C                       RWORK(2) = HMAX ****</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">C       INFO(8) -  Differential/algebraic problems may occasionally</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">C              suffer from severe scaling difficulties on the first</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">C              step.  If you know a great deal about the scaling of </span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="comment">C              your problem, you can help to alleviate this problem </span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">C              by specifying an initial stepsize H0.</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;<span class="comment">C          ****  Do you want the code to define its own initial</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="comment">C                stepsize ...</span></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="comment">C                 yes - set INFO(8) = 0</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="comment">C                  no - set INFO(8) = 1</span></div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="comment">C                       and define H0 by setting</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="comment">C                       RWORK(3) = H0 ****</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">C       INFO(9) -  If storage is a severe problem, you can save some</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">C              storage by restricting the maximum method order MAXORD.</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="comment">C              The default value is 5.  For each order decrease below 5,</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="comment">C              the code requires NEQ fewer locations, but it is likely </span></div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="comment">C              to be slower.  In any case, you must have </span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="comment">C              1 .le. MAXORD .le. 5.</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="comment">C          ****  Do you want the maximum order to default to 5 ...</span></div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="comment">C                 yes - set INFO(9) = 0</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment">C                  no - set INFO(9) = 1</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="comment">C                       and define MAXORD by setting</span></div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="comment">C                       IWORK(3) = MAXORD ****</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="comment">C       INFO(10) - If you know that certain components of the</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="comment">C              solutions to your equations are always nonnegative</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="comment">C              (or nonpositive), it may help to set this</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="comment">C              parameter.  There are three options that are</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="comment">C              available:</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="comment">C              1.  To have constraint checking only in the initial</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="comment">C                  condition calculation.</span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="comment">C              2.  To enforce nonnegativity in Y during the integration.</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="comment">C              3.  To enforce both options 1 and 2.</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="comment">C              When selecting option 2 or 3, it is probably best to try</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="comment">C              the code without using this option first, and only use</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="comment">C              this option if that does not work very well.</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;<span class="comment">C          ****  Do you want the code to solve the problem without</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="comment">C                invoking any special inequality constraints ...</span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;<span class="comment">C                 yes - set INFO(10) = 0</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="comment">C                  no - set INFO(10) = 1 to have option 1 enforced </span></div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="comment">C                  no - set INFO(10) = 2 to have option 2 enforced</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="comment">C                  no - set INFO(10) = 3 to have option 3 enforced ****</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="comment">C                  If you have specified INFO(10) = 1 or 3, then you</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="comment">C                  will also need to identify how each component of Y</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="comment">C                  in the initial condition calculation is constrained.</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="comment">C                  You must set:</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="comment">C                  IWORK(40+I) = +1 if Y(I) must be .GE. 0,</span></div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">C                  IWORK(40+I) = +2 if Y(I) must be .GT. 0,</span></div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">C                  IWORK(40+I) = -1 if Y(I) must be .LE. 0, while</span></div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment">C                  IWORK(40+I) = -2 if Y(I) must be .LT. 0, while</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="comment">C                  IWORK(40+I) =  0 if Y(I) is not constrained.</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="comment">C       INFO(11) - DDASKR normally requires the initial T, Y, and</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;<span class="comment">C              YPRIME to be consistent.  That is, you must have</span></div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="comment">C              G(T,Y,YPRIME) = 0 at the initial T.  If you do not know</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;<span class="comment">C              the initial conditions precisely, in some cases</span></div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">C              DDASKR may be able to compute it.</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="comment">C              Denoting the differential variables in Y by Y_d</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;<span class="comment">C              and the algebraic variables by Y_a, DDASKR can solve</span></div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="comment">C              one of two initialization problems:</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="comment">C              1.  Given Y_d, calculate Y_a and Y&#39;_d, or</span></div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="comment">C              2.  Given Y&#39;, calculate Y.</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;<span class="comment">C              In either case, initial values for the given</span></div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="comment">C              components are input, and initial guesses for</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;<span class="comment">C              the unknown components must also be provided as input.</span></div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="comment">C          ****  Are the initial T, Y, YPRIME consistent ...</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">C                 yes - set INFO(11) = 0</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="comment">C                  no - set INFO(11) = 1 to calculate option 1 above,</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">C                    or set INFO(11) = 2 to calculate option 2 ****</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">C                  If you have specified INFO(11) = 1, then you</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="comment">C                  will also need to identify  which are the</span></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">C                  differential and which are the algebraic</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="comment">C                  components (algebraic components are components</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;<span class="comment">C                  whose derivatives do not appear explicitly</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">C                  in the function G(T,Y,YPRIME)).  You must set:</span></div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">C                  IWORK(LID+I) = +1 if Y(I) is a differential variable</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">C                  IWORK(LID+I) = -1 if Y(I) is an algebraic variable,</span></div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">C                  where LID = 40 if INFO(10) = 0 or 2 and LID = 40+NEQ</span></div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">C                  if INFO(10) = 1 or 3.</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">C       INFO(12) - Except for the addition of the RES argument CJ,</span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">C              DDASKR by default is downward-compatible with DDASSL,</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">C              which uses only direct (dense or band) methods to solve </span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">C              the linear systems involved.  You must set INFO(12) to</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="comment">C              indicate whether you want the direct methods or the</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="comment">C              Krylov iterative method.</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="comment">C          ****   Do you want DDASKR to use standard direct methods</span></div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">C                 (dense or band) or the Krylov (iterative) method ...</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="comment">C                   direct methods - set INFO(12) = 0.</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">C                   Krylov method  - set INFO(12) = 1,</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;<span class="comment">C                       and check the settings of INFO(13) and INFO(15).</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">C       INFO(13) - used when INFO(12) = 1 (Krylov methods).  </span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">C              DDASKR uses scalars MAXL, KMP, NRMAX, and EPLI for the</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;<span class="comment">C              iterative solution of linear systems.  INFO(13) allows </span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;<span class="comment">C              you to override the default values of these parameters.  </span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;<span class="comment">C              These parameters and their defaults are as follows:</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">C              MAXL = maximum number of iterations in the SPIGMR </span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">C                 algorithm (MAXL .le. NEQ).  The default is </span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">C                 MAXL = MIN(5,NEQ).</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">C              KMP = number of vectors on which orthogonalization is </span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">C                 done in the SPIGMR algorithm.  The default is </span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">C                 KMP = MAXL, which corresponds to complete GMRES </span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">C                 iteration, as opposed to the incomplete form.  </span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">C              NRMAX = maximum number of restarts of the SPIGMR </span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">C                 algorithm per nonlinear iteration.  The default is</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">C                 NRMAX = 5.</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">C              EPLI = convergence test constant in SPIGMR algorithm.</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">C                 The default is EPLI = 0.05.</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">C              Note that the length of RWORK depends on both MAXL </span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">C              and KMP.  See the definition of LRW below.</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">C          ****   Are MAXL, KMP, and EPLI to be given their</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">C                 default values ...</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">C                  yes - set INFO(13) = 0</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">C                   no - set INFO(13) = 1,</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">C                        and set all of the following:</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">C                        IWORK(24) = MAXL (1 .le. MAXL .le. NEQ)</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">C                        IWORK(25) = KMP  (1 .le. KMP .le. MAXL)</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">C                        IWORK(26) = NRMAX  (NRMAX .ge. 0)</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">C                        RWORK(10) = EPLI (0 .lt. EPLI .lt. 1.0) ****</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">C        INFO(14) - used with INFO(11) &gt; 0 (initial condition </span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">C               calculation is requested).  In this case, you may</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">C               request control to be returned to the calling program</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">C               immediately after the initial condition calculation,</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">C               before proceeding to the integration of the system</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">C               (e.g. to examine the computed Y and YPRIME).</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">C               If this is done, and if the initialization succeeded</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">C               (IDID = 4), you should reset INFO(11) to 0 for the</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">C               next call, to prevent the solver from repeating the </span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">C               initialization (and to avoid an infinite loop). </span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">C          ****   Do you want to proceed to the integration after</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">C                 the initial condition calculation is done ...</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">C                 yes - set INFO(14) = 0</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">C                  no - set INFO(14) = 1                        ****</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">C        INFO(15) - used when INFO(12) = 1 (Krylov methods).</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">C               When using preconditioning in the Krylov method,</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">C               you must supply a subroutine, PSOL, which solves the</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">C               associated linear systems using P.</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">C               The usage of DDASKR is simpler if PSOL can carry out</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">C               the solution without any prior calculation of data.</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">C               However, if some partial derivative data is to be</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">C               calculated in advance and used repeatedly in PSOL,</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">C               then you must supply a JAC routine to do this,</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">C               and set INFO(15) to indicate that JAC is to be called</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">C               for this purpose.  For example, P might be an</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">C               approximation to a part of the matrix A which can be</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">C               calculated and LU-factored for repeated solutions of</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">C               the preconditioner system.  The arrays WP and IWP</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">C               (described under JAC and PSOL) can be used to</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">C               communicate data between JAC and PSOL.</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">C          ****   Does PSOL operate with no prior preparation ...</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">C                 yes - set INFO(15) = 0 (no JAC routine)</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">C                  no - set INFO(15) = 1</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">C                       and supply a JAC routine to evaluate and</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="comment">C                       preprocess any required Jacobian data.  ****</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="comment">C         INFO(16) - option to exclude algebraic variables from</span></div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="comment">C               the error test.  </span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="comment">C          ****   Do you wish to control errors locally on</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;<span class="comment">C                 all the variables...</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="comment">C                 yes - set INFO(16) = 0</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">C                  no - set INFO(16) = 1</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="comment">C                       If you have specified INFO(16) = 1, then you</span></div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="comment">C                       will also need to identify  which are the</span></div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">C                       differential and which are the algebraic</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">C                       components (algebraic components are components</span></div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">C                       whose derivatives do not appear explicitly</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">C                       in the function G(T,Y,YPRIME)).  You must set:</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="comment">C                       IWORK(LID+I) = +1 if Y(I) is a differential </span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="comment">C                                      variable, and</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="comment">C                       IWORK(LID+I) = -1 if Y(I) is an algebraic</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">C                                      variable,</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">C                       where LID = 40 if INFO(10) = 0 or 2 and </span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">C                       LID = 40 + NEQ if INFO(10) = 1 or 3.</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">C       INFO(17) - used when INFO(11) &gt; 0 (DDASKR is to do an </span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="comment">C              initial condition calculation).</span></div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="comment">C              DDASKR uses several heuristic control quantities in the</span></div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="comment">C              initial condition calculation.  They have default values,</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;<span class="comment">C              but can  also be set by the user using INFO(17).</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="comment">C              These parameters and their defaults are as follows:</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">C              MXNIT  = maximum number of Newton iterations</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">C                 per Jacobian or preconditioner evaluation.</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">C                 The default is:</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="comment">C                 MXNIT =  5 in the direct case (INFO(12) = 0), and</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="comment">C                 MXNIT = 15 in the Krylov case (INFO(12) = 1).</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="comment">C              MXNJ   = maximum number of Jacobian or preconditioner</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="comment">C                 evaluations.  The default is:</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="comment">C                 MXNJ = 6 in the direct case (INFO(12) = 0), and</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="comment">C                 MXNJ = 2 in the Krylov case (INFO(12) = 1).</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">C              MXNH   = maximum number of values of the artificial</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">C                 stepsize parameter H to be tried if INFO(11) = 1.</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">C                 The default is MXNH = 5.</span></div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">C                 NOTE: the maximum number of Newton iterations</span></div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="comment">C                 allowed in all is MXNIT*MXNJ*MXNH if INFO(11) = 1,</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="comment">C                 and MXNIT*MXNJ if INFO(11) = 2.</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="comment">C              LSOFF  = flag to turn off the linesearch algorithm</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">C                 (LSOFF = 0 means linesearch is on, LSOFF = 1 means</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="comment">C                 it is turned off).  The default is LSOFF = 0.</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">C              STPTOL = minimum scaled step in linesearch algorithm.</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">C                 The default is STPTOL = (unit roundoff)**(2/3).</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="comment">C              EPINIT = swing factor in the Newton iteration convergence</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="comment">C                 test.  The test is applied to the residual vector,</span></div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="comment">C                 premultiplied by the approximate Jacobian (in the</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">C                 direct case) or the preconditioner (in the Krylov</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;<span class="comment">C                 case).  For convergence, the weighted RMS norm of</span></div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;<span class="comment">C                 this vector (scaled by the error weights) must be</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="comment">C                 less than EPINIT*EPCON, where EPCON = .33 is the</span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;<span class="comment">C                 analogous test constant used in the time steps.</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="comment">C                 The default is EPINIT = .01.</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;<span class="comment">C          ****   Are the initial condition heuristic controls to be </span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;<span class="comment">C                 given their default values...</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;<span class="comment">C                  yes - set INFO(17) = 0</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;<span class="comment">C                   no - set INFO(17) = 1,</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="comment">C                        and set all of the following:</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;<span class="comment">C                        IWORK(32) = MXNIT (.GT. 0)</span></div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment">C                        IWORK(33) = MXNJ (.GT. 0)</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">C                        IWORK(34) = MXNH (.GT. 0)</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">C                        IWORK(35) = LSOFF ( = 0 or 1)</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">C                        RWORK(14) = STPTOL (.GT. 0.0)</span></div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">C                        RWORK(15) = EPINIT (.GT. 0.0)  ****</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;<span class="comment">C         INFO(18) - option to get extra printing in initial condition </span></div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="comment">C                calculation.</span></div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="comment">C          ****   Do you wish to have extra printing...</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;<span class="comment">C                 no  - set INFO(18) = 0</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;<span class="comment">C                 yes - set INFO(18) = 1 for minimal printing, or</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">C                       set INFO(18) = 2 for full printing.</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;<span class="comment">C                       If you have specified INFO(18) .ge. 1, data</span></div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;<span class="comment">C                       will be printed with the error handler routines.</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;<span class="comment">C                       To print to a non-default unit number L, include</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="comment">C                       the line  CALL XSETUN(L)  in your program.  ****</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;<span class="comment">C   RTOL, ATOL -- You must assign relative (RTOL) and absolute (ATOL)</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;<span class="comment">C               error tolerances to tell the code how accurately you</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">C               want the solution to be computed.  They must be defined</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;<span class="comment">C               as variables because the code may change them.</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;<span class="comment">C               you have two choices --</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="comment">C                     Both RTOL and ATOL are scalars (INFO(2) = 0), or</span></div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;<span class="comment">C                     both RTOL and ATOL are vectors (INFO(2) = 1).</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;<span class="comment">C               In either case all components must be non-negative.</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="comment">C               The tolerances are used by the code in a local error</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="comment">C               test at each step which requires roughly that</span></div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;<span class="comment">C                        abs(local error in Y(i)) .le. EWT(i) ,</span></div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="comment">C               where EWT(i) = RTOL*abs(Y(i)) + ATOL is an error weight </span></div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;<span class="comment">C               quantity, for each vector component.</span></div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;<span class="comment">C               (More specifically, a root-mean-square norm is used to</span></div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">C               measure the size of vectors, and the error test uses the</span></div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">C               magnitude of the solution at the beginning of the step.)</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">C               The true (global) error is the difference between the</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;<span class="comment">C               true solution of the initial value problem and the</span></div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">C               computed approximation.  Practically all present day</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">C               codes, including this one, control the local error at</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">C               each step and do not even attempt to control the global</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment">C               error directly.</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="comment">C               Usually, but not always, the true accuracy of</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">C               the computed Y is comparable to the error tolerances.</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="comment">C               This code will usually, but not always, deliver a more</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;<span class="comment">C               accurate solution if you reduce the tolerances and</span></div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;<span class="comment">C               integrate again.  By comparing two such solutions you </span></div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;<span class="comment">C               can get a fairly reliable idea of the true error in the</span></div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;<span class="comment">C               solution at the larger tolerances.</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;<span class="comment">C               Setting ATOL = 0. results in a pure relative error test</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;<span class="comment">C               on that component.  Setting RTOL = 0. results in a pure</span></div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;<span class="comment">C               absolute error test on that component.  A mixed test</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment">C               with non-zero RTOL and ATOL corresponds roughly to a</span></div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment">C               relative error test when the solution component is</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="comment">C               much bigger than ATOL and to an absolute error test</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="comment">C               when the solution component is smaller than the</span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="comment">C               threshold ATOL.</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;<span class="comment">C               The code will not attempt to compute a solution at an</span></div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;<span class="comment">C               accuracy unreasonable for the machine being used.  It</span></div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment">C               will advise you if you ask for too much accuracy and</span></div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="comment">C               inform you as to the maximum accuracy it believes</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="comment">C               possible.</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="comment">C  RWORK(*) -- a real work array, which should be dimensioned in your</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="comment">C               calling program with a length equal to the value of</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="comment">C               LRW (or greater).</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="comment">C  LRW -- Set it to the declared length of the RWORK array.  The</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="comment">C               minimum length depends on the options you have selected,</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="comment">C               given by a base value plus additional storage as</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="comment">C               described below.</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;<span class="comment">C               If INFO(12) = 0 (standard direct method), the base value</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;<span class="comment">C               is BASE = 60 + max(MAXORD+4,7)*NEQ + 3*NRT.</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;<span class="comment">C               The default value is MAXORD = 5 (see INFO(9)).  With the</span></div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;<span class="comment">C               default MAXORD, BASE = 60 + 9*NEQ + 3*NRT.</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;<span class="comment">C               Additional storage must be added to the base value for</span></div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">C               any or all of the following options:</span></div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">C                 If INFO(6) = 0 (dense matrix), add NEQ**2.</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;<span class="comment">C                 If INFO(6) = 1 (banded matrix), then:</span></div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="comment">C                    if INFO(5) = 0, add (2*ML+MU+1)*NEQ</span></div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;<span class="comment">C                                           + 2*[NEQ/(ML+MU+1) + 1], and</span></div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;<span class="comment">C                    if INFO(5) = 1, add (2*ML+MU+1)*NEQ.</span></div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="comment">C                 If INFO(16) = 1, add NEQ.</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="comment">C               If INFO(12) = 1 (Krylov method), the base value is</span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="comment">C               BASE = 60 + (MAXORD+5)*NEQ + 3*NRT</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="comment">C                         + [MAXL + 3 + min(1,MAXL-KMP)]*NEQ</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;<span class="comment">C                         + (MAXL+3)*MAXL + 1 + LENWP.</span></div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;<span class="comment">C               See PSOL for description of LENWP.  The default values</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;<span class="comment">C               are: MAXORD = 5 (see INFO(9)), MAXL = min(5,NEQ) and</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;<span class="comment">C               KMP = MAXL  (see INFO(13)).  With these default values,</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;<span class="comment">C               BASE = 101 + 18*NEQ + 3*NRT + LENWP.</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="comment">C               Additional storage must be added to the base value for</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;<span class="comment">C               the following option:</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;<span class="comment">C                 If INFO(16) = 1, add NEQ.</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="comment">C  IWORK(*) -- an integer work array, which should be dimensioned in</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;<span class="comment">C              your calling program with a length equal to the value</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;<span class="comment">C              of LIW (or greater).</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;<span class="comment">C  LIW -- Set it to the declared length of the IWORK array.  The</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="comment">C             minimum length depends on the options you have selected,</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="comment">C             given by a base value plus additions as described below.</span></div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;<span class="comment">C             If INFO(12) = 0 (standard direct method), the base value</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment">C             is BASE = 40 + NEQ.</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;<span class="comment">C             IF INFO(10) = 1 or 3, add NEQ to the base value.</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;<span class="comment">C             If INFO(11) = 1 or INFO(16) =1, add NEQ to the base value.</span></div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;<span class="comment">C             If INFO(12) = 1 (Krylov method), the base value is</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;<span class="comment">C             BASE = 40 + LENIWP.  See PSOL for description of LENIWP.</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;<span class="comment">C             If INFO(10) = 1 or 3, add NEQ to the base value.</span></div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;<span class="comment">C             If INFO(11) = 1 or INFO(16) =1, add NEQ to the base value.</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment">C  RPAR, IPAR -- These are arrays of double precision and integer type,</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">C             respectively, which are available for you to use</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment">C             for communication between your program that calls</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">C             DDASKR and the RES subroutine (and the JAC and PSOL</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">C             subroutines).  They are not altered by DDASKR.</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">C             If you do not need RPAR or IPAR, ignore these</span></div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">C             parameters by treating them as dummy arguments.</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;<span class="comment">C             If you do choose to use them, dimension them in</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;<span class="comment">C             your calling program and in RES (and in JAC and PSOL)</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;<span class="comment">C             as arrays of appropriate length.</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="comment">C  JAC -- This is the name of a routine that you may supply</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="comment">C         (optionally) that relates to the Jacobian matrix of the</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="comment">C         nonlinear system that the code must solve at each T step.</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="comment">C         The role of JAC (and its call sequence) depends on whether</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="comment">C         a direct (INFO(12) = 0) or Krylov (INFO(12) = 1) method </span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="comment">C         is selected.</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="comment">C         **** INFO(12) = 0 (direct methods):</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="comment">C           If you are letting the code generate partial derivatives</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="comment">C           numerically (INFO(5) = 0), then JAC can be absent</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="comment">C           (or perhaps a dummy routine to satisfy the loader).</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="comment">C           Otherwise you must supply a JAC routine to compute</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="comment">C           the matrix A = dG/dY + CJ*dG/dYPRIME.  It must have</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="comment">C           the form</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="comment">C           SUBROUTINE JAC (T, Y, YPRIME, PD, CJ, RPAR, IPAR)</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment">C           The JAC routine must dimension Y, YPRIME, and PD (and RPAR</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">C           and IPAR if used).  CJ is a scalar which is input to JAC.</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">C           For the given values of T, Y, and YPRIME, the JAC routine</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">C           must evaluate the nonzero elements of the matrix A, and </span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">C           store these values in the array PD.  The elements of PD are </span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="comment">C           set to zero before each call to JAC, so that only nonzero</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="comment">C           elements need to be defined.</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="comment">C           The way you store the elements into the PD array depends</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;<span class="comment">C           on the structure of the matrix indicated by INFO(6).</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;<span class="comment">C           *** INFO(6) = 0 (full or dense matrix) ***</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;<span class="comment">C               Give PD a first dimension of NEQ.  When you evaluate the</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="comment">C               nonzero partial derivatives of equation i (i.e. of G(i))</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;<span class="comment">C               with respect to component j (of Y and YPRIME), you must</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;<span class="comment">C               store the element in PD according to</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;<span class="comment">C                  PD(i,j) = dG(i)/dY(j) + CJ*dG(i)/dYPRIME(j).</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;<span class="comment">C           *** INFO(6) = 1 (banded matrix with half-bandwidths ML, MU</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;<span class="comment">C                            as described under INFO(6)) ***</span></div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;<span class="comment">C               Give PD a first dimension of 2*ML+MU+1.  When you </span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;<span class="comment">C               evaluate the nonzero partial derivatives of equation i </span></div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;<span class="comment">C               (i.e. of G(i)) with respect to component j (of Y and </span></div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">C               YPRIME), you must store the element in PD according to </span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">C                  IROW = i - j + ML + MU + 1</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">C                  PD(IROW,j) = dG(i)/dY(j) + CJ*dG(i)/dYPRIME(j).</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;<span class="comment">C          **** INFO(12) = 1 (Krylov method):</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;<span class="comment">C            If you are not calculating Jacobian data in advance for use</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="comment">C            in PSOL (INFO(15) = 0), JAC can be absent (or perhaps a</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;<span class="comment">C            dummy routine to satisfy the loader).  Otherwise, you may</span></div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;<span class="comment">C            supply a JAC routine to compute and preprocess any parts of</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;<span class="comment">C            of the Jacobian matrix  A = dG/dY + CJ*dG/dYPRIME that are</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="comment">C            involved in the preconditioner matrix P.</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">C            It is to have the form</span></div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="comment">C            SUBROUTINE JAC (RES, IRES, NEQ, T, Y, YPRIME, REWT, SAVR,</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;<span class="comment">C                            WK, H, CJ, WP, IWP, IER, RPAR, IPAR)</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;<span class="comment">C           The JAC routine must dimension Y, YPRIME, REWT, SAVR, WK,</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">C           and (if used) WP, IWP, RPAR, and IPAR.</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment">C           The Y, YPRIME, and SAVR arrays contain the current values</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">C           of Y, YPRIME, and the residual G, respectively.  </span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;<span class="comment">C           The array WK is work space of length NEQ.  </span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;<span class="comment">C           H is the step size.  CJ is a scalar, input to JAC, that is</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;<span class="comment">C           normally proportional to 1/H.  REWT is an array of </span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;<span class="comment">C           reciprocal error weights, 1/EWT(i), where EWT(i) is</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="comment">C           RTOL*abs(Y(i)) + ATOL (unless you supplied routine DDAWTS</span></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;<span class="comment">C           instead), for use in JAC if needed.  For example, if JAC</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;<span class="comment">C           computes difference quotient approximations to partial</span></div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="comment">C           derivatives, the REWT array may be useful in setting the</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;<span class="comment">C           increments used.  The JAC routine should do any</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">C           factorization operations called for, in preparation for</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;<span class="comment">C           solving linear systems in PSOL.  The matrix P should</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;<span class="comment">C           be an approximation to the Jacobian,</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment">C           A = dG/dY + CJ*dG/dYPRIME.</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment">C           WP and IWP are real and integer work arrays which you may</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;<span class="comment">C           use for communication between your JAC routine and your</span></div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;<span class="comment">C           PSOL routine.  These may be used to store elements of the </span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;<span class="comment">C           preconditioner P, or related matrix data (such as factored</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">C           forms).  They are not altered by DDASKR.</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment">C           If you do not need WP or IWP, ignore these parameters by</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment">C           treating them as dummy arguments.  If you do use them,</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">C           dimension them appropriately in your JAC and PSOL routines.</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">C           See the PSOL description for instructions on setting </span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment">C           the lengths of WP and IWP.</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">C           On return, JAC should set the error flag IER as follows..</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">C             IER = 0    if JAC was successful,</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">C             IER .ne. 0 if JAC was unsuccessful (e.g. if Y or YPRIME</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">C                        was illegal, or a singular matrix is found).</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">C           (If IER .ne. 0, a smaller stepsize will be tried.)</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">C           IER = 0 on entry to JAC, so need be reset only on a failure.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">C           If RES is used within JAC, then a nonzero value of IRES will</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">C           override any nonzero value of IER (see the RES description).</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">C         Regardless of the method type, subroutine JAC must not</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">C         alter T, Y(*), YPRIME(*), H, CJ, or REWT(*).</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">C         You must declare the name JAC in an EXTERNAL statement in</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">C         your program that calls DDASKR.</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">C PSOL --  This is the name of a routine you must supply if you have</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">C         selected a Krylov method (INFO(12) = 1) with preconditioning.</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">C         In the direct case (INFO(12) = 0), PSOL can be absent </span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">C         (a dummy routine may have to be supplied to satisfy the </span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">C         loader).  Otherwise, you must provide a PSOL routine to </span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">C         solve linear systems arising from preconditioning.</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">C         When supplied with INFO(12) = 1, the PSOL routine is to </span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">C         have the form</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">C         SUBROUTINE PSOL (NEQ, T, Y, YPRIME, SAVR, WK, CJ, WGHT,</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">C                          WP, IWP, B, EPLIN, IER, RPAR, IPAR)</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">C         The PSOL routine must solve linear systems of the form </span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">C         P*x = b where P is the left preconditioner matrix.</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">C         The right-hand side vector b is in the B array on input, and</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">C         PSOL must return the solution vector x in B.</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">C         The Y, YPRIME, and SAVR arrays contain the current values</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="comment">C         of Y, YPRIME, and the residual G, respectively.  </span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">C         Work space required by JAC and/or PSOL, and space for data to</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">C         be communicated from JAC to PSOL is made available in the form</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">C         of arrays WP and IWP, which are parts of the RWORK and IWORK</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">C         arrays, respectively.  The lengths of these real and integer</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">C         work spaces WP and IWP must be supplied in LENWP and LENIWP,</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">C         respectively, as follows..</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment">C           IWORK(27) = LENWP = length of real work space WP</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">C           IWORK(28) = LENIWP = length of integer work space IWP.</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment">C         WK is a work array of length NEQ for use by PSOL.</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">C         CJ is a scalar, input to PSOL, that is normally proportional</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">C         to 1/H (H = stepsize).  If the old value of CJ</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">C         (at the time of the last JAC call) is needed, it must have</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">C         been saved by JAC in WP.</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">C         WGHT is an array of weights, to be used if PSOL uses an</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">C         iterative method and performs a convergence test.  (In terms</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">C         of the argument REWT to JAC, WGHT is REWT/sqrt(NEQ).)</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">C         If PSOL uses an iterative method, it should use EPLIN</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">C         (a heuristic parameter) as the bound on the weighted norm of</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">C         the residual for the computed solution.  Specifically, the</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">C         residual vector R should satisfy</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">C              SQRT (SUM ( (R(i)*WGHT(i))**2 ) ) .le. EPLIN</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">C         PSOL must not alter NEQ, T, Y, YPRIME, SAVR, CJ, WGHT, EPLIN.</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">C         On return, PSOL should set the error flag IER as follows..</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">C           IER = 0 if PSOL was successful,</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">C           IER .lt. 0 if an unrecoverable error occurred, meaning</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">C                 control will be passed to the calling routine,</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">C           IER .gt. 0 if a recoverable error occurred, meaning that</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">C                 the step will be retried with the same step size</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">C                 but with a call to JAC to update necessary data,</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">C                 unless the Jacobian data is current, in which case</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">C                 the step will be retried with a smaller step size.</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment">C           IER = 0 on entry to PSOL so need be reset only on a failure.</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">C         You must declare the name PSOL in an EXTERNAL statement in</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">C         your program that calls DDASKR.</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">C RT --   This is the name of the subroutine for defining the vector</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">C         R(T,Y,Y&#39;) of constraint functions Ri(T,Y,Y&#39;), whose roots</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">C         are desired during the integration.  It is to have the form</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">C             SUBROUTINE RT(NEQ, T, Y, YP, NRT, RVAL, RPAR, IPAR)</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">C             DIMENSION Y(NEQ), YP(NEQ), RVAL(NRT),</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">C         where NEQ, T, Y and NRT are INPUT, and the array RVAL is</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">C         output.  NEQ, T, Y, and YP have the same meaning as in the</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment">C         RES routine, and RVAL is an array of length NRT.</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment">C         For i = 1,...,NRT, this routine is to load into RVAL(i) the</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">C         value at (T,Y,Y&#39;) of the i-th constraint function Ri(T,Y,Y&#39;).</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment">C         DDASKR will find roots of the Ri of odd multiplicity</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">C         (that is, sign changes) as they occur during the integration.</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">C         RT must be declared EXTERNAL in the calling program.</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">C         CAUTION.. Because of numerical errors in the functions Ri</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">C         due to roundoff and integration error, DDASKR may return</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">C         false roots, or return the same root at two or more nearly</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">C         equal values of T.  If such false roots are suspected,</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">C         the user should consider smaller error tolerances and/or</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">C         higher precision in the evaluation of the Ri.</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">C         If a root of some Ri defines the end of the problem,</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">C         the input to DDASKR should nevertheless allow</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment">C         integration to a point slightly past that root, so</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">C         that DDASKR can locate the root by interpolation.</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">C NRT --  The number of constraint functions Ri(T,Y,Y&#39;).  If there are</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">C         no constraints, set NRT = 0 and pass a dummy name for RT.</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">C JROOT -- This is an integer array of length NRT, used only for output.</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">C         On a return where one or more roots were found (IDID = 5),</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">C         JROOT(i) = 1 or -1 if Ri(T,Y,Y&#39;) has a root at T, and</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">C         JROOT(i) = 0 if not.  If nonzero, JROOT(i) shows the direction</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">C         of the sign change in Ri in the direction of integration: </span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">C         JROOT(i) = 1  means Ri changed from negative to positive.</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">C         JROOT(i) = -1 means Ri changed from positive to negative.</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">C  OPTIONALLY REPLACEABLE SUBROUTINE:</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">C  DDASKR uses a weighted root-mean-square norm to measure the </span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">C  size of various error vectors.  The weights used in this norm</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">C  are set in the following subroutine:</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">C    SUBROUTINE DDAWTS (NEQ, IWT, RTOL, ATOL, Y, EWT, RPAR, IPAR)</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">C    DIMENSION RTOL(*), ATOL(*), Y(*), EWT(*), RPAR(*), IPAR(*)</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">C  A DDAWTS routine has been included with DDASKR which sets the</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">C  weights according to</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">C    EWT(I) = RTOL*ABS(Y(I)) + ATOL</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">C  in the case of scalar tolerances (IWT = 0) or</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">C    EWT(I) = RTOL(I)*ABS(Y(I)) + ATOL(I)</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">C  in the case of array tolerances (IWT = 1).  (IWT is INFO(2).)</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">C  In some special cases, it may be appropriate for you to define</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment">C  your own error weights by writing a subroutine DDAWTS to be </span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">C  called instead of the version supplied.  However, this should </span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment">C  be attempted only after careful thought and consideration. </span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">C  If you supply this routine, you may use the tolerances and Y </span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">C  as appropriate, but do not overwrite these variables.  You</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">C  may also use RPAR and IPAR to communicate data as appropriate.</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">C  ***Note: Aside from the values of the weights, the choice of </span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">C  norm used in DDASKR (weighted root-mean-square) is not subject</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">C  to replacement by the user.  In this respect, DDASKR is not</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">C  downward-compatible with the original DDASSL solver (in which</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">C  the norm routine was optionally user-replaceable).</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">C------OUTPUT - AFTER ANY RETURN FROM DDASKR----------------------------</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">C  The principal aim of the code is to return a computed solution at</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">C  T = TOUT, although it is also possible to obtain intermediate</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">C  results along the way.  To find out whether the code achieved its</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">C  goal or if the integration process was interrupted before the task</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">C  was completed, you must check the IDID parameter.</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">C   T -- The output value of T is the point to which the solution</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">C        was successfully advanced.</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">C   Y(*) -- contains the computed solution approximation at T.</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">C   YPRIME(*) -- contains the computed derivative approximation at T.</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">C   IDID -- reports what the code did, described as follows:</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment">C                     *** TASK COMPLETED ***</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">C                Reported by positive values of IDID</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">C           IDID = 1 -- A step was successfully taken in the</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">C                   interval-output mode.  The code has not</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">C                   yet reached TOUT.</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">C           IDID = 2 -- The integration to TSTOP was successfully</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment">C                   completed (T = TSTOP) by stepping exactly to TSTOP.</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">C           IDID = 3 -- The integration to TOUT was successfully</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">C                   completed (T = TOUT) by stepping past TOUT.</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">C                   Y(*) and YPRIME(*) are obtained by interpolation.</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">C           IDID = 4 -- The initial condition calculation, with</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">C                   INFO(11) &gt; 0, was successful, and INFO(14) = 1.</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">C                   No integration steps were taken, and the solution</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">C                   is not considered to have been started.</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">C           IDID = 5 -- The integration was successfully completed</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">C                   by finding one or more roots of R(T,Y,Y&#39;) at T.</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">C                    *** TASK INTERRUPTED ***</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">C                Reported by negative values of IDID</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">C           IDID = -1 -- A large amount of work has been expended</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">C                     (about 500 steps).</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">C           IDID = -2 -- The error tolerances are too stringent.</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">C           IDID = -3 -- The local error test cannot be satisfied</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">C                     because you specified a zero component in ATOL</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">C                     and the corresponding computed solution component</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">C                     is zero.  Thus, a pure relative error test is</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">C                     impossible for this component.</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">C           IDID = -5 -- There were repeated failures in the evaluation</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">C                     or processing of the preconditioner (in JAC).</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">C           IDID = -6 -- DDASKR had repeated error test failures on the</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">C                     last attempted step.</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">C           IDID = -7 -- The nonlinear system solver in the time</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">C                     integration could not converge.</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">C           IDID = -8 -- The matrix of partial derivatives appears</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">C                     to be singular (direct method).</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">C           IDID = -9 -- The nonlinear system solver in the integration</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">C                     failed to achieve convergence, and there were</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">C                     repeated  error test failures in this step.</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">C           IDID =-10 -- The nonlinear system solver in the integration </span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">C                     failed to achieve convergence because IRES was</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">C                     equal  to -1.</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">C           IDID =-11 -- IRES = -2 was encountered and control is</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">C                     being returned to the calling program.</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">C           IDID =-12 -- DDASKR failed to compute the initial Y, YPRIME.</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">C           IDID =-13 -- An unrecoverable error was encountered inside</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">C                     the user&#39;s PSOL routine, and control is being</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">C                     returned to the calling program.</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">C           IDID =-14 -- The Krylov linear system solver could not </span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">C                     achieve convergence.</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">C           IDID =-15,..,-32 -- Not applicable for this code.</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">C                    *** TASK TERMINATED ***</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">C                reported by the value of IDID=-33</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">C           IDID = -33 -- The code has encountered trouble from which</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">C                   it cannot recover.  A message is printed</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">C                   explaining the trouble and control is returned</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">C                   to the calling program.  For example, this occurs</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">C                   when invalid input is detected.</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">C   RTOL, ATOL -- these quantities remain unchanged except when</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">C               IDID = -2.  In this case, the error tolerances have been</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">C               increased by the code to values which are estimated to</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">C               be appropriate for continuing the integration.  However,</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">C               the reported solution at T was obtained using the input</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">C               values of RTOL and ATOL.</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">C   RWORK, IWORK -- contain information which is usually of no interest</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">C               to the user but necessary for subsequent calls. </span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">C               However, you may be interested in the performance data</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">C               listed below.  These quantities are accessed in RWORK </span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">C               and IWORK but have internal mnemonic names, as follows..</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">C               RWORK(3)--contains H, the step size h to be attempted</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">C                        on the next step.</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">C               RWORK(4)--contains TN, the current value of the</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment">C                        independent variable, i.e. the farthest point</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">C                        integration has reached.  This will differ </span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">C                        from T if interpolation has been performed </span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">C                        (IDID = 3).</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">C               RWORK(7)--contains HOLD, the stepsize used on the last</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">C                        successful step.  If INFO(11) = INFO(14) = 1,</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment">C                        this contains the value of H used in the</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="comment">C                        initial condition calculation.</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">C               IWORK(7)--contains K, the order of the method to be </span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">C                        attempted on the next step.</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">C               IWORK(8)--contains KOLD, the order of the method used</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">C                        on the last step.</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment">C               IWORK(11)--contains NST, the number of steps (in T) </span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">C                        taken so far.</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">C               IWORK(12)--contains NRE, the number of calls to RES </span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">C                        so far.</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment">C               IWORK(13)--contains NJE, the number of calls to JAC so</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;<span class="comment">C                        far (Jacobian or preconditioner evaluations).</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;<span class="comment">C               IWORK(14)--contains NETF, the total number of error test</span></div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;<span class="comment">C                        failures so far.</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="comment">C               IWORK(15)--contains NCFN, the total number of nonlinear</span></div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;<span class="comment">C                        convergence failures so far (includes counts</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">C                        of singular iteration matrix or singular</span></div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment">C                        preconditioners).</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">C               IWORK(16)--contains NCFL, the number of convergence</span></div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">C                        failures of the linear iteration so far.</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">C               IWORK(17)--contains LENIW, the length of IWORK actually</span></div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">C                        required.  This is defined on normal returns </span></div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">C                        and on an illegal input return for</span></div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">C                        insufficient storage.</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;<span class="comment">C               IWORK(18)--contains LENRW, the length of RWORK actually</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment">C                        required.  This is defined on normal returns </span></div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">C                        and on an illegal input return for</span></div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">C                        insufficient storage.</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">C               IWORK(19)--contains NNI, the total number of nonlinear</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">C                        iterations so far (each of which calls a</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">C                        linear solver).</span></div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="comment">C               IWORK(20)--contains NLI, the total number of linear</span></div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="comment">C                        (Krylov) iterations so far.</span></div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="comment">C               IWORK(21)--contains NPS, the number of PSOL calls so</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="comment">C                        far, for preconditioning solve operations or</span></div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="comment">C                        for solutions with the user-supplied method.</span></div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;<span class="comment">C               IWORK(36)--contains the total number of calls to the</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="comment">C                        constraint function routine RT so far.</span></div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">C               Note: The various counters in IWORK do not include </span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">C               counts during a prior call made with INFO(11) &gt; 0 and</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">C               INFO(14) = 1.</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment">C------INPUT - WHAT TO DO TO CONTINUE THE INTEGRATION  -----------------</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;<span class="comment">C              (CALLS AFTER THE FIRST)</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;<span class="comment">C     This code is organized so that subsequent calls to continue the</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="comment">C     integration involve little (if any) additional effort on your</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="comment">C     part.  You must monitor the IDID parameter in order to determine</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="comment">C     what to do next.</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">C     Recalling that the principal task of the code is to integrate</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">C     from T to TOUT (the interval mode), usually all you will need</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">C     to do is specify a new TOUT upon reaching the current TOUT.</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="comment">C     Do not alter any quantity not specifically permitted below.  In</span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="comment">C     particular do not alter NEQ, T, Y(*), YPRIME(*), RWORK(*), </span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="comment">C     IWORK(*), or the differential equation in subroutine RES.  Any </span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="comment">C     such alteration constitutes a new problem and must be treated </span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="comment">C     as such, i.e. you must start afresh.</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="comment">C     You cannot change from array to scalar error control or vice</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="comment">C     versa (INFO(2)), but you can change the size of the entries of</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">C     RTOL or ATOL.  Increasing a tolerance makes the equation easier</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment">C     to integrate.  Decreasing a tolerance will make the equation</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="comment">C     harder to integrate and should generally be avoided.</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="comment">C     You can switch from the intermediate-output mode to the</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="comment">C     interval mode (INFO(3)) or vice versa at any time.</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">C     If it has been necessary to prevent the integration from going</span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="comment">C     past a point TSTOP (INFO(4), RWORK(1)), keep in mind that the</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="comment">C     code will not integrate to any TOUT beyond the currently</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="comment">C     specified TSTOP.  Once TSTOP has been reached, you must change</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="comment">C     the value of TSTOP or set INFO(4) = 0.  You may change INFO(4)</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="comment">C     or TSTOP at any time but you must supply the value of TSTOP in</span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment">C     RWORK(1) whenever you set INFO(4) = 1.</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment">C     Do not change INFO(5), INFO(6), INFO(12-17) or their associated</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment">C     IWORK/RWORK locations unless you are going to restart the code.</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="comment">C                    *** FOLLOWING A COMPLETED TASK ***</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="comment">C     If..</span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment">C     IDID = 1, call the code again to continue the integration</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="comment">C                  another step in the direction of TOUT.</span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment">C     IDID = 2 or 3, define a new TOUT and call the code again.</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="comment">C                  TOUT must be different from T.  You cannot change</span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="comment">C                  the direction of integration without restarting.</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="comment">C     IDID = 4, reset INFO(11) = 0 and call the code again to begin</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment">C                  the integration.  (If you leave INFO(11) &gt; 0 and</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment">C                  INFO(14) = 1, you may generate an infinite loop.)</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment">C                  In this situation, the next call to DDASKR is </span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment">C                  considered to be the first call for the problem,</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">C                  in that all initializations are done.</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">C     IDID = 5, call the code again to continue the integration in the</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment">C                  direction of TOUT.  You may change the functions</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment">C                  Ri defined by RT after a return with IDID = 5, but</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="comment">C                  the number of constraint functions NRT must remain</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;<span class="comment">C                  the same.  If you wish to change the functions in</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment">C                  RES or in RT, then you must restart the code.</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment">C                    *** FOLLOWING AN INTERRUPTED TASK ***</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;<span class="comment">C     To show the code that you realize the task was interrupted and</span></div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;<span class="comment">C     that you want to continue, you must take appropriate action and</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;<span class="comment">C     set INFO(1) = 1.</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;<span class="comment">C     If..</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">C     IDID = -1, the code has taken about 500 steps.  If you want to</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">C                  continue, set INFO(1) = 1 and call the code again.</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">C                  An additional 500 steps will be allowed.</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;<span class="comment">C     IDID = -2, the error tolerances RTOL, ATOL have been increased</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;<span class="comment">C                  to values the code estimates appropriate for</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;<span class="comment">C                  continuing.  You may want to change them yourself.</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;<span class="comment">C                  If you are sure you want to continue with relaxed</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;<span class="comment">C                  error tolerances, set INFO(1) = 1 and call the code</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;<span class="comment">C                  again.</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="comment">C     IDID = -3, a solution component is zero and you set the</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="comment">C                  corresponding component of ATOL to zero.  If you</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;<span class="comment">C                  are sure you want to continue, you must first alter</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;<span class="comment">C                  the error criterion to use positive values of ATOL </span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;<span class="comment">C                  for those components corresponding to zero solution</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;<span class="comment">C                  components, then set INFO(1) = 1 and call the code</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;<span class="comment">C                  again.</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;<span class="comment">C     IDID = -4  --- cannot occur with this code.</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="comment">C     IDID = -5, your JAC routine failed with the Krylov method.  Check</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="comment">C                  for errors in JAC and restart the integration.</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="comment">C     IDID = -6, repeated error test failures occurred on the last</span></div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;<span class="comment">C                  attempted step in DDASKR.  A singularity in the</span></div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">C                  solution may be present.  If you are absolutely</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">C                  certain you want to continue, you should restart</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">C                  the integration.  (Provide initial values of Y and</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">C                  YPRIME which are consistent.)</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">C     IDID = -7, repeated convergence test failures occurred on the last</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">C                  attempted step in DDASKR.  An inaccurate or ill-</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment">C                  conditioned Jacobian or preconditioner may be the</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">C                  problem.  If you are absolutely certain you want</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">C                  to continue, you should restart the integration.</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">C     IDID = -8, the matrix of partial derivatives is singular, with</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">C                  the use of direct methods.  Some of your equations</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;<span class="comment">C                  may be redundant.  DDASKR cannot solve the problem</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">C                  as stated.  It is possible that the redundant</span></div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;<span class="comment">C                  equations could be removed, and then DDASKR could</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">C                  solve the problem.  It is also possible that a</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="comment">C                  solution to your problem either does not exist</span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="comment">C                  or is not unique.</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="comment">C     IDID = -9, DDASKR had multiple convergence test failures, preceded</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="comment">C                  by multiple error test failures, on the last</span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="comment">C                  attempted step.  It is possible that your problem is</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="comment">C                  ill-posed and cannot be solved using this code.  Or,</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="comment">C                  there may be a discontinuity or a singularity in the</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">C                  solution.  If you are absolutely certain you want to</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">C                  continue, you should restart the integration.</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="comment">C     IDID = -10, DDASKR had multiple convergence test failures</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment">C                  because IRES was equal to -1.  If you are</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment">C                  absolutely certain you want to continue, you</span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="comment">C                  should restart the integration.</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment">C     IDID = -11, there was an unrecoverable error (IRES = -2) from RES</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">C                  inside the nonlinear system solver.  Determine the</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">C                  cause before trying again.</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment">C     IDID = -12, DDASKR failed to compute the initial Y and YPRIME</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">C                  vectors.  This could happen because the initial </span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="comment">C                  approximation to Y or YPRIME was not very good, or</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment">C                  because no consistent values of these vectors exist.</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;<span class="comment">C                  The problem could also be caused by an inaccurate or</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;<span class="comment">C                  singular iteration matrix, or a poor preconditioner.</span></div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">C     IDID = -13, there was an unrecoverable error encountered inside </span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment">C                  your PSOL routine.  Determine the cause before </span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="comment">C                  trying again.</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;<span class="comment">C     IDID = -14, the Krylov linear system solver failed to achieve</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="comment">C                  convergence.  This may be due to ill-conditioning</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;<span class="comment">C                  in the iteration matrix, or a singularity in the</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;<span class="comment">C                  preconditioner (if one is being used).</span></div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">C                  Another possibility is that there is a better</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">C                  choice of Krylov parameters (see INFO(13)).</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;<span class="comment">C                  Possibly the failure is caused by redundant equations</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="comment">C                  in the system, or by inconsistent equations.</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;<span class="comment">C                  In that case, reformulate the system to make it</span></div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;<span class="comment">C                  consistent and non-redundant.</span></div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="comment">C     IDID = -15,..,-32 --- Cannot occur with this code.</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;<span class="comment">C                       *** FOLLOWING A TERMINATED TASK ***</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="comment">C     If IDID = -33, you cannot continue the solution of this problem.</span></div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="comment">C                  An attempt to do so will result in your run being</span></div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="comment">C                  terminated.</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="comment">C  ---------------------------------------------------------------------</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="comment">C***REFERENCES</span></div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">C  1.  L. R. Petzold, A Description of DASSL: A Differential/Algebraic</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;<span class="comment">C      System Solver, in Scientific Computing, R. S. Stepleman et al.</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="comment">C      (Eds.), North-Holland, Amsterdam, 1983, pp. 65-68.</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;<span class="comment">C  2.  K. E. Brenan, S. L. Campbell, and L. R. Petzold, Numerical </span></div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="comment">C      Solution of Initial-Value Problems in Differential-Algebraic</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="comment">C      Equations, Elsevier, New York, 1989.</span></div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="comment">C  3.  P. N. Brown and A. C. Hindmarsh, Reduced Storage Matrix Methods</span></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;<span class="comment">C      in Stiff ODE Systems, J. Applied Mathematics and Computation,</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;<span class="comment">C      31 (1989), pp. 40-91.</span></div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="comment">C  4.  P. N. Brown, A. C. Hindmarsh, and L. R. Petzold, Using Krylov</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">C      Methods in the Solution of Large-Scale Differential-Algebraic</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment">C      Systems, SIAM J. Sci. Comp., 15 (1994), pp. 1467-1488.</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment">C  5.  P. N. Brown, A. C. Hindmarsh, and L. R. Petzold, Consistent</span></div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">C      Initial Condition Calculation for Differential-Algebraic</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment">C      Systems, SIAM J. Sci. Comp. 19 (1998), pp. 1495-1512.</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">C   The following are all the subordinate routines used by DDASKR.</span></div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">C   DRCHEK does preliminary checking for roots, and serves as an</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">C          interface between Subroutine DDASKR and Subroutine DROOTS.</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">C   DROOTS finds the leftmost root of a set of functions.</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">C   DDASIC computes consistent initial conditions.</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">C   DYYPNW updates Y and YPRIME in linesearch for initial condition</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">C          calculation.</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">C   DDSTP  carries out one step of the integration.</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment">C   DCNSTR/DCNST0 check the current solution for constraint violations.</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment">C   DDAWTS sets error weight quantities.</span></div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;<span class="comment">C   DINVWT tests and inverts the error weights.</span></div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="comment">C   DDATRP performs interpolation to get an output solution.</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">C   DDWNRM computes the weighted root-mean-square norm of a vector.</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">C   D1MACH provides the unit roundoff of the computer.</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">C   XERRWD/XSETF/XSETUN/IXSAV is a package to handle error messages. </span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">C   DDASID nonlinear equation driver to initialize Y and YPRIME using</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment">C          direct linear system solver methods.  Interfaces to Newton</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">C          solver (direct case).</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">C   DNSID  solves the nonlinear system for unknown initial values by</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">C          modified Newton iteration and direct linear system methods.</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment">C   DLINSD carries out linesearch algorithm for initial condition</span></div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;<span class="comment">C          calculation (direct case).</span></div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;<span class="comment">C   DFNRMD calculates weighted norm of preconditioned residual in</span></div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;<span class="comment">C          initial condition calculation (direct case).</span></div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">C   DNEDD  nonlinear equation driver for direct linear system solver</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">C          methods.  Interfaces to Newton solver (direct case).</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="comment">C   DMATD  assembles the iteration matrix (direct case).</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment">C   DNSD   solves the associated nonlinear system by modified</span></div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment">C          Newton iteration and direct linear system methods.</span></div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment">C   DSLVD  interfaces to linear system solver (direct case).</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">C   DDASIK nonlinear equation driver to initialize Y and YPRIME using</span></div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment">C          Krylov iterative linear system methods.  Interfaces to</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment">C          Newton solver (Krylov case).</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="comment">C   DNSIK  solves the nonlinear system for unknown initial values by</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment">C          Newton iteration and Krylov iterative linear system methods.</span></div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">C   DLINSK carries out linesearch algorithm for initial condition</span></div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">C          calculation (Krylov case).</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">C   DFNRMK calculates weighted norm of preconditioned residual in</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="comment">C          initial condition calculation (Krylov case).</span></div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment">C   DNEDK  nonlinear equation driver for iterative linear system solver</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">C          methods.  Interfaces to Newton solver (Krylov case).</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">C   DNSK   solves the associated nonlinear system by Inexact Newton</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">C          iteration and (linear) Krylov iteration.</span></div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">C   DSLVK  interfaces to linear system solver (Krylov case).</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment">C   DSPIGM solves a linear system by SPIGMR algorithm.</span></div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">C   DATV   computes matrix-vector product in Krylov algorithm.</span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">C   DORTH  performs orthogonalization of Krylov basis vectors.</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">C   DHEQR  performs QR factorization of Hessenberg matrix.</span></div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">C   DHELS  finds least-squares solution of Hessenberg linear system.</span></div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">C   DGEFA, DGESL, DGBFA, DGBSL are LINPACK routines for solving </span></div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">C          linear systems (dense or band direct methods).</span></div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment">C   DAXPY, DCOPY, DDOT, DNRM2, DSCAL are Basic Linear Algebra (BLAS)</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">C          routines.</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">C The routines called directly by DDASKR are:</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">C   DCNST0, DDAWTS, DINVWT, D1MACH, DDWNRM, DDASIC, DDATRP, DDSTP,</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="comment">C   DRCHEK, XERRWD</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="comment">C***END PROLOGUE DDASKR</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;      <span class="keywordtype">LOGICAL</span> DONE, LAVL, LCFN, LCFL, LWARN</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*)</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;      dimension <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(20)</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      dimension rwork(lrw),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(liw)</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;      dimension rtol(*),atol(*)</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;      dimension rpar(*),ipar(*)</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;      <span class="keywordtype">CHARACTER</span> MSG*80</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, jac, psol, rt, <a class="code" href="../../d2/dd0/ddaskr_8f.html#ab02b6e2207645c9bc72492d45e3a4f0b">ddasid</a>, <a class="code" href="../../d2/dd0/ddaskr_8f.html#adfcd029d0eaeb0052be0007163ce1989">ddasik</a>, <a class="code" href="../../d2/dd0/ddaskr_8f.html#a98c2f20040ea3d5b63ce4e3e7d0e8aba">dnedd</a>, <a class="code" href="../../d2/dd0/ddaskr_8f.html#a85856bdb5c050759a3609e2ec8ebe7b0">dnedk</a></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">C     Set pointers into IWORK.</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      parameter(lml=1, lmu=2, lmtype=4, </div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;     *   liwm=1, lmxord=3, ljcalc=5, lphase=6, lk=7, lkold=8,</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;     *   lns=9, lnstl=10, lnst=11, lnre=12, lnje=13, letf=14, lncfn=15,</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;     *   lncfl=16, lniw=17, lnrw=18, lnni=19, lnli=20, lnps=21,</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;     *   lnpd=22, lmiter=23, lmaxl=24, lkmp=25, lnrmax=26, llnwp=27,</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;     *   llniwp=28, llocwp=29, llciwp=30, lkprin=31, lmxnit=32,</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;     *   lmxnj=33, lmxnh=34, llsoff=35, lnrte=36, lirfnd=37, licns=41)</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;<span class="comment">C     Set pointers into RWORK.</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;      parameter(ltstop=1, lhmax=2, lh=3, ltn=4, lcj=5, lcjold=6,</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;     *   lhold=7, ls=8, lround=9, lepli=10, lsqrn=11, lrsqrn=12,</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;     *   lepcon=13, lstol=14, lepin=15, lalpha=21, lbeta=27,</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;     *   lgamma=33, lpsi=39, lsigma=45, lt0=51, ltlast=52, ldelta=61)</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;      <span class="keywordtype">SAVE</span> lid, lenid, nonneg, ncphi</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="comment">C***FIRST EXECUTABLE STATEMENT  DDASKR</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(1).NE.0) <span class="keywordflow">GO TO</span> 100</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;<span class="comment">C     This block is executed for the initial call only.</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;<span class="comment">C     It contains checking of inputs and initializations.</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;<span class="comment">C     First check INFO array to make sure all elements of INFO</span></div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;<span class="comment">C     Are within the proper range.  (INFO(1) is checked later, because</span></div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment">C     it must be tested on every call.) ITEMP holds the location</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment">C     within INFO which may be out of range.</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      <span class="keywordflow">DO</span> 10 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=2,9</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;         itemp = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .NE. 0 .AND. <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .NE. 1) <span class="keywordflow">GO TO</span> 701</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160; 10      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;      itemp = 10</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(10).LT.0 .OR. <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(10).GT.3) <span class="keywordflow">GO TO</span> 701</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;      itemp = 11</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(11).LT.0 .OR. <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(11).GT.2) <span class="keywordflow">GO TO</span> 701</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;      <span class="keywordflow">DO</span> 15 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=12,17</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;         itemp = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .NE. 0 .AND. <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .NE. 1) <span class="keywordflow">GO TO</span> 701</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160; 15      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      itemp = 18</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(18).LT.0 .OR. <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(18).GT.2) <span class="keywordflow">GO TO</span> 701</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;<span class="comment">C     Check NEQ to see if it is positive.</span></div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;      <span class="keywordflow">IF</span> (neq .LE. 0) <span class="keywordflow">GO TO</span> 702</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="comment">C     Check and compute maximum order.</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;      mxord=5</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(9) .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;         mxord=<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmxord)</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;         <span class="keywordflow">IF</span> (mxord .LT. 1 .OR. mxord .GT. 5) <span class="keywordflow">GO TO</span> 703</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmxord)=mxord</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="comment">C     Set and/or check inputs for constraint checking (INFO(10) .NE. 0).</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="comment">C     Set values for ICNFLG, NONNEG, and pointer LID.</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      icnflg = 0</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      nonneg = 0</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      lid = licns</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(10) .EQ. 0) <span class="keywordflow">GO TO</span> 20</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(10) .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;         icnflg = 1</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;         nonneg = 0</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;         lid = licns + neq</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;      <span class="keywordflow">ELSEIF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(10) .EQ. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;         icnflg = 0</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;         nonneg = 1</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;         icnflg = 1</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;         nonneg = 1</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;         lid = licns + neq</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160; 20   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;<span class="comment">C     Set and/or check inputs for Krylov solver (INFO(12) .NE. 0).</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="comment">C     If indicated, set default values for MAXL, KMP, NRMAX, and EPLI.</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="comment">C     Otherwise, verify inputs required for iterative solver.</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .EQ. 0) <span class="keywordflow">GO TO</span> 25</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmiter) = <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12)</div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(13) .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;         <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmaxl) = min(5,neq)</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;         <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkmp) = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmaxl)</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;         <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnrmax) = 5</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;         rwork(lepli) = 0.05d0</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;         <span class="keywordflow">IF</span>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmaxl) .LT. 1 .OR. <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmaxl) .GT. neq) <span class="keywordflow">GO TO</span> 720</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;         <span class="keywordflow">IF</span>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkmp) .LT. 1 .OR. <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkmp) .GT. <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmaxl))</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;     1      <span class="keywordflow">GO TO</span> 721</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;         <span class="keywordflow">IF</span>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnrmax) .LT. 0) <span class="keywordflow">GO TO</span> 722</div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;         <span class="keywordflow">IF</span>(rwork(lepli).LE.0.0d0 .OR. rwork(lepli).GE.1.0d0)<span class="keywordflow">GO TO</span> 723</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160; 25   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">C     Set and/or check controls for the initial condition calculation</span></div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment">C     (INFO(11) .GT. 0).  If indicated, set default values.</span></div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">C     Otherwise, verify inputs required for iterative solver.</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(11) .EQ. 0) <span class="keywordflow">GO TO</span> 30</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(17) .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmxnit) = 5</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .GT. 0) <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmxnit) = 15</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmxnj) = 6</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .GT. 0) <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmxnj) = 2</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;        <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmxnh) = 5</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(llsoff) = 0</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        rwork(lepin) = 0.01d0</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmxnit) .LE. 0) <span class="keywordflow">GO TO</span> 725</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmxnj) .LE. 0) <span class="keywordflow">GO TO</span> 725</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmxnh) .LE. 0) <span class="keywordflow">GO TO</span> 725</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        lsoff = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(llsoff)</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;        <span class="keywordflow">IF</span> (lsoff .LT. 0 .OR. lsoff .GT. 1) <span class="keywordflow">GO TO</span> 725</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;        <span class="keywordflow">IF</span> (rwork(lepin) .LE. 0.0d0) <span class="keywordflow">GO TO</span> 725</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160; 30   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;<span class="comment">C     Below is the computation and checking of the work array lengths</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment">C     LENIW and LENRW, using direct methods (INFO(12) = 0) or</span></div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="comment">C     the Krylov methods (INFO(12) = 1).</span></div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;      lenic = 0</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(10) .EQ. 1 .OR. <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(10) .EQ. 3) lenic = neq</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;      lenid = 0</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(11) .EQ. 1 .OR. <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(16) .EQ. 1) lenid = neq</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;<span class="comment">C        Compute MTYPE, etc.  Check ML and MU.</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;         ncphi = <a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(mxord + 1, 4)</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;         <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(6).EQ.0) <span class="keywordflow">THEN</span> </div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            lenpd = neq**2</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;            lenrw = 60 + 3*nrt + (ncphi+3)*neq + lenpd</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(5).EQ.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;               <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmtype)=2</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;               <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmtype)=1</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;         <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lml).LT.0.OR.<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lml).GE.neq)<span class="keywordflow">GO TO</span> 717</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmu).LT.0.OR.<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmu).GE.neq)<span class="keywordflow">GO TO</span> 718</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;            lenpd=(2*<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lml)+<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmu)+1)*neq</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(5).EQ.0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;               <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmtype)=5</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;               mband=<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lml)+<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmu)+1</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;               msave=(neq/mband)+1</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;               lenrw = 60 + 3*nrt + (ncphi+3)*neq + lenpd + 2*msave</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;               <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmtype)=4</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;               lenrw = 60 + 3*nrt + (ncphi+3)*neq + lenpd</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">C        Compute LENIW, LENWP, LENIWP.</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;         leniw = 40 + lenic + lenid + neq</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;         lenwp = 0</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;         leniwp = 0</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;      <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .EQ. 1)  <span class="keywordflow">THEN</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;         ncphi = mxord + 1</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;         maxl = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmaxl)</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;         lenwp = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(llnwp)</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;         leniwp = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(llniwp)</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;         lenpd = (maxl+3+min0(1,maxl-<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkmp)))*neq</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;     1         + (maxl+3)*maxl + 1 + lenwp</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;         lenrw = 60 + 3*nrt + (mxord+5)*neq + lenpd</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;         leniw = 40 + lenic + lenid + leniwp</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(16) .NE. 0) lenrw = lenrw + neq</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;<span class="comment">C     Check lengths of RWORK and IWORK.</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lniw)=leniw</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnrw)=lenrw</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnpd)=lenpd</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(llocwp) = lenpd-lenwp+1</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      <span class="keywordflow">IF</span>(lrw.LT.lenrw)<span class="keywordflow">GO TO</span> 704</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keywordflow">IF</span>(liw.LT.leniw)<span class="keywordflow">GO TO</span> 705</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="comment">C     Check ICNSTR for legality.</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      <span class="keywordflow">IF</span> (lenic .GT. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        <span class="keywordflow">DO</span> 40 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;          ici = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(licns-1+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;          <span class="keywordflow">IF</span> (ici .LT. -2 .OR. ici .GT. 2) <span class="keywordflow">GO TO</span> 726</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160; 40       <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;<span class="comment">C     Check Y for consistency with constraints.</span></div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      <span class="keywordflow">IF</span> (lenic .GT. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aecac7c4590bc02e577bdce5e6a4b5e01">dcnst0</a>(neq,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(licns),iret)</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        <span class="keywordflow">IF</span> (iret .NE. 0) <span class="keywordflow">GO TO</span> 727</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="comment">C     Check ID for legality and set INDEX = 0 or 1.</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;      <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a1499949ec4dbbc5290ece2ac210bba35">index</a> = 1</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;      <span class="keywordflow">IF</span> (lenid .GT. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a1499949ec4dbbc5290ece2ac210bba35">index</a> = 0</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        <span class="keywordflow">DO</span> 50 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;          idi = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lid-1+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;          <span class="keywordflow">IF</span> (idi .NE. 1 .AND. idi .NE. -1) <span class="keywordflow">GO TO</span> 724</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;          <span class="keywordflow">IF</span> (idi .EQ. -1) <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a1499949ec4dbbc5290ece2ac210bba35">index</a> = 1</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160; 50       <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="comment">C     Check to see that TOUT is different from T, and NRT .ge. 0.</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;      <span class="keywordflow">IF</span>(tout .EQ. t)<span class="keywordflow">GO TO</span> 719</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;      <span class="keywordflow">IF</span>(nrt .LT. 0) <span class="keywordflow">GO TO</span> 730</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">C     Check HMAX.</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(7) .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;         hmax = rwork(lhmax)</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;         <span class="keywordflow">IF</span> (hmax .LE. 0.0d0) <span class="keywordflow">GO TO</span> 710</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment">C     Initialize counters and other flags.</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnst)=0</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnre)=0</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnje)=0</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(letf)=0</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lncfn)=0</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnni)=0</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnli)=0</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnps)=0</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lncfl)=0</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnrte)=0</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkprin)=<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(18)</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;      idid=1</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;      <span class="keywordflow">GO TO</span> 200</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="comment">C     This block is for continuation calls only.</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="comment">C     Here we check INFO(1), and if the last step was interrupted,</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;<span class="comment">C     we check whether appropriate action was taken.</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;100   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(1).EQ.1)<span class="keywordflow">GO TO</span> 110</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;      itemp = 1</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(1).NE.-1)<span class="keywordflow">GO TO</span> 701</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">C     If we are here, the last step was interrupted by an error</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">C     condition from DDSTP, and appropriate action was not taken.</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment">C     This is a fatal error.</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  THE LAST STEP TERMINATED WITH A NEGATIVE&#39;</span></div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,49,201,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  VALUE (=I1) OF IDID AND NO APPROPRIATE&#39;</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,47,202,0,1,idid,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  ACTION WAS TAKEN. RUN TERMINATED&#39;</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,41,203,1,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;110   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="comment">C     This block is executed on all calls.</span></div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="comment">C     Counters are saved for later checks of performance.</span></div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="comment">C     Then the error tolerance parameters are checked, and the</span></div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="comment">C     work array pointers are set.</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;200   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;<span class="comment">C     Save counters for use later.</span></div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnstl)=<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnst)</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;      nli0 = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnli)</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;      nni0 = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnni)</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      ncfn0 = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lncfn)</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;      ncfl0 = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lncfl)</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;      nwarn = 0</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">C     Check RTOL and ATOL.</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      nzflg = 0</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      rtoli = rtol(1)</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;      atoli = atol(1)</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;      <span class="keywordflow">DO</span> 210 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(2) .EQ. 1) rtoli = rtol(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(2) .EQ. 1) atoli = atol(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;         <span class="keywordflow">IF</span> (rtoli .GT. 0.0d0 .OR. atoli .GT. 0.0d0) nzflg = 1</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;         <span class="keywordflow">IF</span> (rtoli .LT. 0.0d0) <span class="keywordflow">GO TO</span> 706</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;         <span class="keywordflow">IF</span> (atoli .LT. 0.0d0) <span class="keywordflow">GO TO</span> 707</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;210      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      <span class="keywordflow">IF</span> (nzflg .EQ. 0) <span class="keywordflow">GO TO</span> 708</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;<span class="comment">C     Set pointers to RWORK and IWORK segments.</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;<span class="comment">C     For direct methods, SAVR is not used.</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(llciwp) = lid + lenid</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      lsavr = ldelta</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .NE. 0) lsavr = ldelta + neq</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <a class="code" href="../../de/d45/structle.html">le</a> = lsavr + neq</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      lwt = <a class="code" href="../../de/d45/structle.html">le</a> + neq</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      lvt = lwt</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(16) .NE. 0) lvt = lwt + neq</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      lphi = lvt + neq</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;      lr0 = lphi + ncphi*neq</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;      lr1 = lr0 + nrt</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;      lrx = lr1 + nrt</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;      lwm = lrx + nrt</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(1) .EQ. 1) <span class="keywordflow">GO TO</span> 400</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">C     This block is executed on the initial call only.</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;<span class="comment">C     Set the initial step size, the error weight vector, and PHI.</span></div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;<span class="comment">C     Compute unknown initial components of Y and YPRIME, if requested.</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;300   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;      <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>=t</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;      idid=1</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;<span class="comment">C     Set error weight array WT and altered weight array VT.</span></div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ad9040cc861842aba0f0355141036751a">ddawts</a>(neq,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(2),rtol,atol,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,rwork(lwt),rpar,ipar)</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a4b3830d1e4be0d1908b1fef21358fea0">dinvwt</a>(neq,rwork(lwt),ier)</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      <span class="keywordflow">IF</span> (ier .NE. 0) <span class="keywordflow">GO TO</span> 713</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(16) .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        <span class="keywordflow">DO</span> 305 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1, neq</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160; 305      rwork(lvt+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1) = <a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lid+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1),0)*rwork(lwt+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="comment">C     Compute unit roundoff and HMIN.</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      uround = <a class="code" href="../../d1/d98/daux_8f.html#abae2eceb4fee72a1f198f1c08c56d9b7">d1mach</a>(4)</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      rwork(lround) = uround</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;      hmin = 4.0d0*uround*<a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(abs(t),abs(tout))</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="comment">C     Set/check STPTOL control for initial condition calculation.</span></div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="comment">C     </span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(11) .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        <span class="keywordflow">IF</span>( <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(17) .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;          rwork(lstol) = uround**.6667d0</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        <span class="keywordflow">ELSE</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;          <span class="keywordflow">IF</span> (rwork(lstol) .LE. 0.0d0) <span class="keywordflow">GO TO</span> 725</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;<span class="keywordflow">          ENDIF</span></div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">C     Compute EPCON and square root of NEQ and its reciprocal, used</span></div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;<span class="comment">C     inside iterative solver.</span></div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;      rwork(lepcon) = 0.33d0</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;      floatn = neq</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;      rwork(lsqrn) = sqrt(floatn)</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;      rwork(lrsqrn) = 1.d0/rwork(lsqrn)</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;<span class="comment">C     Check initial interval to see that it is long enough.</span></div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;      tdist = abs(tout - t)</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;      <span class="keywordflow">IF</span>(tdist .LT. hmin) <span class="keywordflow">GO TO</span> 714</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;<span class="comment">C     Check H0, if this was input.</span></div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(8) .EQ. 0) <span class="keywordflow">GO TO</span> 310</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;         h0 = rwork(lh)</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;         <span class="keywordflow">IF</span> ((tout - t)*h0 .LT. 0.0d0) <span class="keywordflow">GO TO</span> 711</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;         <span class="keywordflow">IF</span> (h0 .EQ. 0.0d0) <span class="keywordflow">GO TO</span> 712</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;         <span class="keywordflow">GO TO</span> 320</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;310    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment">C     Compute initial stepsize, to be used by either</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment">C     DDSTP or DDASIC, depending on INFO(11).</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;      h0 = 0.001d0*tdist</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;      ypnorm = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,yprime,rwork(lvt),rpar,ipar)</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;      <span class="keywordflow">IF</span> (ypnorm .GT. 0.5d0/h0) h0 = 0.5d0/ypnorm</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;      h0 = sign(h0,tout-t)</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;<span class="comment">C     Adjust H0 if necessary to meet HMAX bound.</span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;320   <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(7) .EQ. 0) <span class="keywordflow">GO TO</span> 330</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;         <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a> = abs(h0)/rwork(lhmax)</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a> .GT. 1.0d0) h0 = h0/<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a></div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="comment">C     Check against TSTOP, if applicable.</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;330   <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(4) .EQ. 0) <span class="keywordflow">GO TO</span> 340</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;         tstop = rwork(ltstop)</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;         <span class="keywordflow">IF</span> ((tstop - t)*h0 .LT. 0.0d0) <span class="keywordflow">GO TO</span> 715</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;         <span class="keywordflow">IF</span> ((t + h0 - tstop)*h0 .GT. 0.0d0) h0 = tstop - t</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;         <span class="keywordflow">IF</span> ((tstop - tout)*h0 .LT. 0.0d0) <span class="keywordflow">GO TO</span> 709</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;340   <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(11) .EQ. 0) <span class="keywordflow">GO TO</span> 370</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="comment">C     Compute unknown components of initial Y and YPRIME, depending</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;<span class="comment">C     on INFO(11) and INFO(12).  INFO(12) represents the nonlinear</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="comment">C     solver type (direct/Krylov).  Pass the name of the specific </span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;<span class="comment">C     nonlinear solver, depending on INFO(12).  The location of the work</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="comment">C     arrays SAVR, YIC, YPIC, PWK also differ in the two cases.</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;<span class="comment">C     For use in stopping tests, pass TSCALE = TDIST if INDEX = 0.</span></div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      nwt = 1</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;      epconi = rwork(lepin)*rwork(lepcon)</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;      tscale = 0.0d0</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a1499949ec4dbbc5290ece2ac210bba35">index</a> .EQ. 0) tscale = tdist</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;350   <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;         lyic = lphi + 2*neq</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;         lypic = lyic + neq</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;         lpwk = lypic</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a53eb4de7fba5741a189673be61dbde02">ddasic</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(11),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lid),</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;     *     res,jac,psol,h0,tscale,rwork(lwt),nwt,idid,rpar,ipar,</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;     *     rwork(lphi),rwork(lsavr),rwork(ldelta),rwork(<a class="code" href="../../de/d45/structle.html">le</a>),</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;     *     rwork(lyic),rwork(lypic),rwork(lpwk),rwork(lwm),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(liwm),</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;     *     rwork(lround),rwork(lepli),rwork(lsqrn),rwork(lrsqrn),</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;     *     epconi,rwork(lstol),<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(15),icnflg,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(licns),<a class="code" href="../../d2/dd0/ddaskr_8f.html#ab02b6e2207645c9bc72492d45e3a4f0b">ddasid</a>)</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;      <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;         lyic = lwm</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;         lypic = lyic + neq</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;         lpwk = lypic + neq</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a53eb4de7fba5741a189673be61dbde02">ddasic</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(11),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lid),</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;     *     res,jac,psol,h0,tscale,rwork(lwt),nwt,idid,rpar,ipar,</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;     *     rwork(lphi),rwork(lsavr),rwork(ldelta),rwork(<a class="code" href="../../de/d45/structle.html">le</a>),</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;     *     rwork(lyic),rwork(lypic),rwork(lpwk),rwork(lwm),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(liwm),</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;     *     rwork(lround),rwork(lepli),rwork(lsqrn),rwork(lrsqrn),</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;     *     epconi,rwork(lstol),<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(15),icnflg,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(licns),<a class="code" href="../../d2/dd0/ddaskr_8f.html#adfcd029d0eaeb0052be0007163ce1989">ddasik</a>)</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;      <span class="keywordflow">IF</span> (idid .LT. 0) <span class="keywordflow">GO TO</span> 600</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;<span class="comment">C     DDASIC was successful.  If this was the first call to DDASIC,</span></div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;<span class="comment">C     update the WT array (with the current Y) and call it again.</span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      <span class="keywordflow">IF</span> (nwt .EQ. 2) <span class="keywordflow">GO TO</span> 355</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;      nwt = 2</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ad9040cc861842aba0f0355141036751a">ddawts</a>(neq,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(2),rtol,atol,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,rwork(lwt),rpar,ipar)</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a4b3830d1e4be0d1908b1fef21358fea0">dinvwt</a>(neq,rwork(lwt),ier)</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;      <span class="keywordflow">IF</span> (ier .NE. 0) <span class="keywordflow">GO TO</span> 713</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;      <span class="keywordflow">GO TO</span> 350</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="comment">C     If INFO(14) = 1, return now with IDID = 4.</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;355   <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(14) .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        idid = 4</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;        h = h0</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(11) .EQ. 1) rwork(lhold) = h0</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;        <span class="keywordflow">GO TO</span> 590</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;<span class="comment">C     Update the WT and VT arrays one more time, with the new Y.</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ad9040cc861842aba0f0355141036751a">ddawts</a>(neq,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(2),rtol,atol,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,rwork(lwt),rpar,ipar)</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a4b3830d1e4be0d1908b1fef21358fea0">dinvwt</a>(neq,rwork(lwt),ier)</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;      <span class="keywordflow">IF</span> (ier .NE. 0) <span class="keywordflow">GO TO</span> 713</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(16) .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="keywordflow">DO</span> 357 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1, neq</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160; 357      rwork(lvt+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1) = <a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lid+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1),0)*rwork(lwt+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;<span class="comment">C     Reset the initial stepsize to be used by DDSTP.</span></div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;<span class="comment">C     Use H0, if this was input.  Otherwise, recompute H0,</span></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;<span class="comment">C     and adjust it if necessary to meet HMAX bound.</span></div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(8) .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;         h0 = rwork(lh)</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;         <span class="keywordflow">GO TO</span> 360</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      h0 = 0.001d0*tdist</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      ypnorm = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,yprime,rwork(lvt),rpar,ipar)</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;      <span class="keywordflow">IF</span> (ypnorm .GT. 0.5d0/h0) h0 = 0.5d0/ypnorm</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;      h0 = sign(h0,tout-t)</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;360   <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(7) .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;         <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a> = abs(h0)/rwork(lhmax)</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a> .GT. 1.0d0) h0 = h0/<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a></div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;<span class="comment">C     Check against TSTOP, if applicable.</span></div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(4) .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;         tstop = rwork(ltstop)</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;         <span class="keywordflow">IF</span> ((t + h0 - tstop)*h0 .GT. 0.0d0) h0 = tstop - t</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;<span class="comment">C     Load H and RWORK(LH) with H0.</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;370   h = h0</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;      rwork(lh) = h</div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment">C     Load Y and H*YPRIME into PHI(*,1) and PHI(*,2).</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;      itemp = lphi + neq</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;      <span class="keywordflow">DO</span> 380 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;         rwork(lphi + <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1) = <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;380      rwork(itemp + <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> - 1) = h*yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;<span class="comment">C     Initialize T0 in RWORK; check for a zero of R near initial T.</span></div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;      rwork(lt0) = t</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lirfnd) = 0</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;      rwork(lpsi)=h</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      rwork(lpsi+1)=2.0d0*h</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold)=1</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;      <span class="keywordflow">IF</span> (nrt .EQ. 0) <span class="keywordflow">GO TO</span> 390</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aaead83d5896fc4b6b7d26450a2c3c557">drchek</a>(1,rt,nrt,neq,t,tout,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,rwork(lphi),</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;     *   rwork(lpsi),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),rwork(lr0),rwork(lr1),</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;     *   rwork(lrx),jroot,irt,rwork(lround),<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(3),</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;     *   rwork,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>,rpar,ipar)</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      <span class="keywordflow">IF</span> (irt .LT. 0) <span class="keywordflow">GO TO</span> 731</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160; 390  <span class="keywordflow">GO TO</span> 500</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;<span class="comment">C     This block is for continuation calls only.</span></div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="comment">C     Its purpose is to check stop conditions before taking a step.</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="comment">C     Adjust H if necessary to meet HMAX bound.</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;400   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      uround=rwork(lround)</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      done = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;      <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>=rwork(ltn)</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      h=rwork(lh)</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="keywordflow">IF</span>(nrt .EQ. 0) <span class="keywordflow">GO TO</span> 405</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;<span class="comment">C     Check for a zero of R near TN.</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aaead83d5896fc4b6b7d26450a2c3c557">drchek</a>(2,rt,nrt,neq,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tout,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,rwork(lphi),</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;     *   rwork(lpsi),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),rwork(lr0),rwork(lr1),</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;     *   rwork(lrx),jroot,irt,rwork(lround),<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(3),</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;     *   rwork,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>,rpar,ipar)</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      <span class="keywordflow">IF</span> (irt .LT. 0) <span class="keywordflow">GO TO</span> 731</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;      <span class="keywordflow">IF</span> (irt .NE. 1) <span class="keywordflow">GO TO</span> 405</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lirfnd) = 1</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;      idid = 5</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      t = rwork(lt0)</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;      done = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;      <span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;405   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(7) .EQ. 0) <span class="keywordflow">GO TO</span> 410</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;         <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a> = abs(h)/rwork(lhmax)</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;         <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a> .GT. 1.0d0) h = h/<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;410   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      <span class="keywordflow">IF</span>(t .EQ. tout) <span class="keywordflow">GO TO</span> 719</div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;      <span class="keywordflow">IF</span>((t - tout)*h .GT. 0.0d0) <span class="keywordflow">GO TO</span> 711</div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(4) .EQ. 1) <span class="keywordflow">GO TO</span> 430</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(3) .EQ. 1) <span class="keywordflow">GO TO</span> 420</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;      <span class="keywordflow">IF</span>((<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-tout)*h.LT.0.0d0)<span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tout,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;     *  rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      t=tout</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;      idid = 3</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      done = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;      <span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;420   <span class="keywordflow">IF</span>((<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-t)*h .LE. 0.0d0) <span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      <span class="keywordflow">IF</span>((<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a> - tout)*h .GE. 0.0d0) <span class="keywordflow">GO TO</span> 425</div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;     *  rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;      t = <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      idid = 1</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;      done = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;      <span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;425   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tout,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;     *  rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;      t = tout</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;      idid = 3</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      done = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      <span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;430   <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(3) .EQ. 1) <span class="keywordflow">GO TO</span> 440</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;      tstop=rwork(ltstop)</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      <span class="keywordflow">IF</span>((<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-tstop)*h.GT.0.0d0) <span class="keywordflow">GO TO</span> 715</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;      <span class="keywordflow">IF</span>((tstop-tout)*h.LT.0.0d0)<span class="keywordflow">GO TO</span> 709</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;      <span class="keywordflow">IF</span>((<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-tout)*h.LT.0.0d0)<span class="keywordflow">GO TO</span> 450</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tout,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;     *   rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      t=tout</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;      idid = 3</div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      done = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      <span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;440   tstop = rwork(ltstop)</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;      <span class="keywordflow">IF</span>((<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-tstop)*h .GT. 0.0d0) <span class="keywordflow">GO TO</span> 715</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;      <span class="keywordflow">IF</span>((tstop-tout)*h .LT. 0.0d0) <span class="keywordflow">GO TO</span> 709</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      <span class="keywordflow">IF</span>((<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-t)*h .LE. 0.0d0) <span class="keywordflow">GO TO</span> 450</div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;      <span class="keywordflow">IF</span>((<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a> - tout)*h .GE. 0.0d0) <span class="keywordflow">GO TO</span> 445</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;     *  rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      t = <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;      idid = 1</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;      done = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;      <span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;445   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tout,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;     *  rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      t = tout</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;      idid = 3</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;      done = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;      <span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;450   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment">C     Check whether we are within roundoff of TSTOP.</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      <span class="keywordflow">IF</span>(abs(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-tstop).GT.100.0d0*uround*</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;     *   (abs(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>)+abs(h)))<span class="keywordflow">GO TO</span> 460</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tstop,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;     *  rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;      idid=2</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;      t=tstop</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;      done = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      <span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;460   tnext=<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>+h</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;      <span class="keywordflow">IF</span>((tnext-tstop)*h.LE.0.0d0)<span class="keywordflow">GO TO</span> 490</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;      h=tstop-<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;      rwork(lh)=h</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;490   <span class="keywordflow">IF</span> (done) <span class="keywordflow">GO TO</span> 590</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="comment">C     The next block contains the call to the one-step integrator DDSTP.</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="comment">C     This is a looping point for the integration steps.</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;<span class="comment">C     Check for too many steps.</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="comment">C     Check for poor Newton/Krylov performance.</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">C     Update WT.  Check for too much accuracy requested.</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">C     Compute minimum stepsize.</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;500   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">C     Check for too many steps.</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;      <span class="keywordflow">IF</span>((<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnst)-<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnstl)).LT.500) <span class="keywordflow">GO TO</span> 505</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;           idid=-1</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;           <span class="keywordflow">GO TO</span> 527</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="comment">C Check for poor Newton/Krylov performance.</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;505   <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .EQ. 0) <span class="keywordflow">GO TO</span> 510</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;      nstd = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnst) - <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnstl)</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;      nnid = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnni) - nni0</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;      <span class="keywordflow">IF</span> (nstd .LT. 10 .OR. nnid .EQ. 0) <span class="keywordflow">GO TO</span> 510</div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;      avlin = <span class="keywordtype">REAL(IWORK(LNLI)</span> - NLI0)/<span class="keywordtype">REAL</span>(NNID)</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;      rcfn = <span class="keywordtype">REAL(IWORK(LNCFN)</span> - NCFN0)/<span class="keywordtype">REAL</span>(NSTD)</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;      rcfl = <span class="keywordtype">REAL(IWORK(LNCFL)</span> - NCFL0)/<span class="keywordtype">REAL</span>(NNID)</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;      fmaxl = <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmaxl)</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;      lavl = avlin .GT. fmaxl</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      lcfn = rcfn .GT. 0.9d0</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;      lcfl = rcfl .GT. 0.9d0</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;      lwarn = lavl .OR. lcfn .OR. lcfl</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;      <span class="keywordflow">IF</span> (.NOT.lwarn) <span class="keywordflow">GO TO</span> 510</div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;      nwarn = nwarn + 1</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;      <span class="keywordflow">IF</span> (nwarn .GT. 10) <span class="keywordflow">GO TO</span> 510</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;      <span class="keywordflow">IF</span> (lavl) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        msg = <span class="stringliteral">&#39;DASKR-- Warning. Poor iterative algorithm performance   &#39;</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a> (msg, 56, 501, 0, 0, 0, 0, 0, 0.0d0, 0.0d0)</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;        msg = <span class="stringliteral">&#39;      at T = R1. Average no. of linear iterations = R2  &#39;</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a> (msg, 56, 501, 0, 0, 0, 0, 2, <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>, avlin)</div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;      <span class="keywordflow">IF</span> (lcfn) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        msg = <span class="stringliteral">&#39;DASKR-- Warning. Poor iterative algorithm performance   &#39;</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a> (msg, 56, 502, 0, 0, 0, 0, 0, 0.0d0, 0.0d0)</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        msg = <span class="stringliteral">&#39;      at T = R1. Nonlinear convergence failure rate = R2&#39;</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a> (msg, 56, 502, 0, 0, 0, 0, 2, <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>, rcfn)</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;      <span class="keywordflow">IF</span> (lcfl) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        msg = <span class="stringliteral">&#39;DASKR-- Warning. Poor iterative algorithm performance   &#39;</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a> (msg, 56, 503, 0, 0, 0, 0, 0, 0.0d0, 0.0d0)</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        msg = <span class="stringliteral">&#39;      at T = R1. Linear convergence failure rate = R2   &#39;</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a> (msg, 56, 503, 0, 0, 0, 0, 2, <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>, rcfl)</div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment">C     Update WT and VT, if this is not the first call.</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;510   <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ad9040cc861842aba0f0355141036751a">ddawts</a>(neq,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(2),rtol,atol,rwork(lphi),rwork(lwt),</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;     *            rpar,ipar)</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a4b3830d1e4be0d1908b1fef21358fea0">dinvwt</a>(neq,rwork(lwt),ier)</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;      <span class="keywordflow">IF</span> (ier .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;        idid = -3</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        <span class="keywordflow">GO TO</span> 527</div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(16) .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;        <span class="keywordflow">DO</span> 515 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1, neq</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160; 515      rwork(lvt+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1) = <a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lid+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1),0)*rwork(lwt+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="comment">C     Test for too much accuracy requested.</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;      r = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,rwork(lphi),rwork(lwt),rpar,ipar)*100.0d0*uround</div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;      <span class="keywordflow">IF</span> (r .LE. 1.0d0) <span class="keywordflow">GO TO</span> 525</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="comment">C     Multiply RTOL and ATOL by R and return.</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(2).EQ.1)<span class="keywordflow">GO TO</span> 523</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;           rtol(1)=r*rtol(1)</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;           atol(1)=r*atol(1)</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;           idid=-2</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;           <span class="keywordflow">GO TO</span> 527</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;523   <span class="keywordflow">DO</span> 524 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;           rtol(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=r*rtol(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;524        atol(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=r*atol(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;      idid=-2</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;      <span class="keywordflow">GO TO</span> 527</div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;525   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;<span class="comment">C     Compute minimum stepsize.</span></div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;      hmin=4.0d0*uround*<a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(abs(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>),abs(tout))</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;<span class="comment">C     Test H vs. HMAX</span></div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(7) .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;         <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a> = abs(h)/rwork(lhmax)</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a> .GT. 1.0d0) h = h/<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a></div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;<span class="comment">C     Call the one-step integrator.</span></div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;<span class="comment">C     Note that INFO(12) represents the nonlinear solver type.</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;<span class="comment">C     Pass the required nonlinear solver, depending upon INFO(12).</span></div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a4dcdd9a7ce2b4ea61f28f5ca27374266">ddstp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;     *      res,jac,psol,h,rwork(lwt),rwork(lvt),<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(1),idid,rpar,ipar,</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;     *      rwork(lphi),rwork(lsavr),rwork(ldelta),rwork(<a class="code" href="../../de/d45/structle.html">le</a>),</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;     *      rwork(lwm),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(liwm),</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;     *      rwork(lalpha),rwork(lbeta),rwork(lgamma),</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;     *      rwork(lpsi),rwork(lsigma),</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;     *      rwork(lcj),rwork(lcjold),rwork(lhold),rwork(ls),hmin,</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;     *      rwork(lround), rwork(lepli),rwork(lsqrn),rwork(lrsqrn),</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;     *      rwork(lepcon), <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lphase),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(ljcalc),<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(15),</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;     *      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lk), <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lns),nonneg,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12),</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;     *      <a class="code" href="../../d2/dd0/ddaskr_8f.html#a98c2f20040ea3d5b63ce4e3e7d0e8aba">dnedd</a>)</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;      <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12) .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a4dcdd9a7ce2b4ea61f28f5ca27374266">ddstp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,</div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;     *      res,jac,psol,h,rwork(lwt),rwork(lvt),<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(1),idid,rpar,ipar,</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;     *      rwork(lphi),rwork(lsavr),rwork(ldelta),rwork(<a class="code" href="../../de/d45/structle.html">le</a>),</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;     *      rwork(lwm),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(liwm),</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;     *      rwork(lalpha),rwork(lbeta),rwork(lgamma),</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;     *      rwork(lpsi),rwork(lsigma),</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;     *      rwork(lcj),rwork(lcjold),rwork(lhold),rwork(ls),hmin,</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;     *      rwork(lround), rwork(lepli),rwork(lsqrn),rwork(lrsqrn),</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;     *      rwork(lepcon), <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lphase),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(ljcalc),<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(15),</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;     *      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lk), <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lns),nonneg,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(12),</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;     *      <a class="code" href="../../d2/dd0/ddaskr_8f.html#a85856bdb5c050759a3609e2ec8ebe7b0">dnedk</a>)</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;527   <span class="keywordflow">IF</span>(idid.LT.0)<span class="keywordflow">GO TO</span> 600</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;<span class="comment">C     This block handles the case of a successful return from DDSTP</span></div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;<span class="comment">C     (IDID=1).  Test for stop conditions.</span></div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      <span class="keywordflow">IF</span>(nrt .EQ. 0) <span class="keywordflow">GO TO</span> 530</div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;<span class="comment">C     Check for a zero of R near TN.</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aaead83d5896fc4b6b7d26450a2c3c557">drchek</a>(3,rt,nrt,neq,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tout,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,rwork(lphi),</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;     *   rwork(lpsi),<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),rwork(lr0),rwork(lr1),</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;     *   rwork(lrx),jroot,irt,rwork(lround),<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(3),</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;     *   rwork,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>,rpar,ipar)</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      <span class="keywordflow">IF</span>(irt .NE. 1) <span class="keywordflow">GO TO</span> 530</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;      <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lirfnd) = 1</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;      idid = 5</div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      t = rwork(lt0)</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;      <span class="keywordflow">GO TO</span> 580</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;530   <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(4) .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;<span class="comment">C        Stopping tests for the case of no TSTOP. ----------------------</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;         <span class="keywordflow">IF</span> ( (<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-tout)*h .GE. 0.0d0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;            <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tout,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;     *                  rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;            t = tout</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;            idid = 3</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;            <span class="keywordflow">GO TO</span> 580</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(3) .EQ. 0) <span class="keywordflow">GO TO</span> 500</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;         t = <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a></div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;         idid = 1</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;         <span class="keywordflow">GO TO</span> 580</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;540   <span class="keywordflow">IF</span> (<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(3) .NE. 0) <span class="keywordflow">GO TO</span> 550</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;<span class="comment">C     Stopping tests for the TSTOP case, interval-output mode. ---------</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      <span class="keywordflow">IF</span> (abs(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-tstop) .LE. 100.0d0*uround*(abs(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>)+abs(h))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tstop,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;     *               rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;         t = tstop</div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;         idid = 2</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;         <span class="keywordflow">GO TO</span> 580</div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      <span class="keywordflow">IF</span> ( (<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-tout)*h .GE. 0.0d0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tout,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;     *               rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;         t = tout</div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;         idid = 3</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;         <span class="keywordflow">GO TO</span> 580</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      tnext = <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a> + h</div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      <span class="keywordflow">IF</span> ((tnext-tstop)*h .LE. 0.0d0) <span class="keywordflow">GO TO</span> 500</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;      h = tstop - <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      <span class="keywordflow">GO TO</span> 500</div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;550   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;<span class="comment">C     Stopping tests for the TSTOP case, intermediate-output mode. -----</span></div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      <span class="keywordflow">IF</span> (abs(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-tstop) .LE. 100.0d0*uround*(abs(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>)+abs(h))) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tstop,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;     *               rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;         t = tstop</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;         idid = 2</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;         <span class="keywordflow">GO TO</span> 580</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <span class="keywordflow">IF</span> ( (<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>-tout)*h .GE. 0.0d0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,tout,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkold),</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;     *               rwork(lphi),rwork(lpsi))</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;         t = tout</div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;         idid = 3</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;         <span class="keywordflow">GO TO</span> 580</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;      t = <a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a></div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;      idid = 1</div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;580   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;<span class="comment">C     All successful returns from DDASKR are made from this block.</span></div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;590   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;      rwork(ltn)=<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;      rwork(ltlast)=t</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      rwork(lh)=h</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;<span class="comment">C     This block handles all unsuccessful returns other than for</span></div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;<span class="comment">C     illegal input.</span></div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;600   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;      itemp = -idid</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;      <span class="keywordflow">GO TO</span> (610,620,630,700,655,640,650,660,670,675,</div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;     *  680,685,690,695), itemp</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;<span class="comment">C     The maximum number of steps was taken before</span></div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="comment">C     reaching tout.</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;610   msg = <span class="stringliteral">&#39;DASKR--  AT CURRENT T (=R1)  500 STEPS&#39;</span></div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,38,610,0,0,0,0,1,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,0.0d0)</div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  TAKEN ON THIS CALL BEFORE REACHING TOUT&#39;</span></div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,48,611,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;<span class="comment">C     Too much accuracy for machine precision.</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;620   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) TOO MUCH ACCURACY REQUESTED&#39;</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,47,620,0,0,0,0,1,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,0.0d0)</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  FOR PRECISION OF MACHINE. RTOL AND ATOL&#39;</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,48,621,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  WERE INCREASED BY A FACTOR R (=R1)&#39;</span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,43,622,0,0,0,0,1,r,0.0d0)</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;<span class="comment">C     WT(I) .LE. 0.0D0 for some I (not at start of problem).</span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;630   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) SOME ELEMENT OF WT&#39;</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,38,630,0,0,0,0,1,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,0.0d0)</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      msg = .LE.<span class="stringliteral">&#39;DASKR--  HAS BECOME  0.0&#39;</span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,28,631,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="comment">C     Error test failed repeatedly or with H=HMIN.</span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;640   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) AND STEPSIZE H (=R2) THE&#39;</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,44,640,0,0,0,0,2,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,h)</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;      msg=<span class="stringliteral">&#39;DASKR--  ERROR TEST FAILED REPEATEDLY OR WITH ABS(H)=HMIN&#39;</span></div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,57,641,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="comment">C     Nonlinear solver failed to converge repeatedly or with H=HMIN.</span></div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;650   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) AND STEPSIZE H (=R2) THE&#39;</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,44,650,0,0,0,0,2,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,h)</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  NONLINEAR SOLVER FAILED TO CONVERGE&#39;</span></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,44,651,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  REPEATEDLY OR WITH ABS(H)=HMIN&#39;</span></div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,40,652,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;<span class="comment">C     The preconditioner had repeated failures.</span></div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;655   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) AND STEPSIZE H (=R2) THE&#39;</span></div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,44,655,0,0,0,0,2,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,h)</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  PRECONDITIONER HAD REPEATED FAILURES.&#39;</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,46,656,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;<span class="comment">C     The iteration matrix is singular.</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;660   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) AND STEPSIZE H (=R2) THE&#39;</span></div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,44,660,0,0,0,0,2,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,h)</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  ITERATION MATRIX IS SINGULAR.&#39;</span></div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,38,661,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;<span class="comment">C     Nonlinear system failure preceded by error test failures.</span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;670   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) AND STEPSIZE H (=R2) THE&#39;</span></div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,44,670,0,0,0,0,2,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,h)</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  NONLINEAR SOLVER COULD NOT CONVERGE.&#39;</span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,45,671,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  ALSO, THE ERROR TEST FAILED REPEATEDLY.&#39;</span></div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,49,672,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;<span class="comment">C     Nonlinear system failure because IRES = -1.</span></div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;675   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) AND STEPSIZE H (=R2) THE&#39;</span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,44,675,0,0,0,0,2,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,h)</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  NONLINEAR SYSTEM SOLVER COULD NOT CONVERGE&#39;</span></div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,51,676,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  BECAUSE IRES WAS EQUAL TO MINUS ONE&#39;</span></div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,44,677,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;<span class="comment">C     Failure because IRES = -2.</span></div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;680   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) AND STEPSIZE H (=R2)&#39;</span></div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,40,680,0,0,0,0,2,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,h)</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  IRES WAS EQUAL TO MINUS TWO&#39;</span></div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,36,681,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;<span class="comment">C     Failed to compute initial YPRIME.</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;685   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) AND STEPSIZE H (=R2) THE&#39;</span></div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,44,685,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  INITIAL (Y,YPRIME) COULD NOT BE COMPUTED&#39;</span></div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,49,686,0,0,0,0,2,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,h0)</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;<span class="comment">C     Failure because IER was negative from PSOL.</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;690   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) AND STEPSIZE H (=R2)&#39;</span></div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,40,690,0,0,0,0,2,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,h)</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  IER WAS NEGATIVE FROM PSOL&#39;</span></div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,35,691,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;<span class="comment">C     Failure because the linear system solver could not converge.</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;695   msg = <span class="stringliteral">&#39;DASKR--  AT T (=R1) AND STEPSIZE H (=R2) THE&#39;</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,44,695,0,0,0,0,2,<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a>,h)</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      msg = <span class="stringliteral">&#39;DASKR--  LINEAR SYSTEM SOLVER COULD NOT CONVERGE.&#39;</span></div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,50,696,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;      <span class="keywordflow">GO TO</span> 700</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;700   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;      <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(1)=-1</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;      t=<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;      rwork(ltn)=<a class="code" href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;      rwork(lh)=h</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;<span class="comment">C     This block handles all error returns due to illegal input,</span></div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;<span class="comment">C     as detected before calling DDSTP.</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;<span class="comment">C     First the error message routine is called.  If this happens</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;<span class="comment">C     twice in succession, execution is terminated.</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;701   msg = <span class="stringliteral">&#39;DASKR--  ELEMENT (=I1) OF INFO VECTOR IS NOT VALID&#39;</span></div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,50,1,0,1,itemp,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;702   msg = .LE.<span class="stringliteral">&#39;DASKR--  NEQ (=I1)  0&#39;</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,25,2,0,1,neq,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;703   msg = <span class="stringliteral">&#39;DASKR--  MAXORD (=I1) NOT IN RANGE&#39;</span></div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,34,3,0,1,mxord,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;704   msg=<span class="stringliteral">&#39;DASKR--  RWORK LENGTH NEEDED, LENRW (=I1), EXCEEDS LRW (=I2)&#39;</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,60,4,0,2,lenrw,lrw,0,0.0d0,0.0d0)</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;705   msg=<span class="stringliteral">&#39;DASKR--  IWORK LENGTH NEEDED, LENIW (=I1), EXCEEDS LIW (=I2)&#39;</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,60,5,0,2,leniw,liw,0,0.0d0,0.0d0)</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;706   msg = .LT.<span class="stringliteral">&#39;DASKR--  SOME ELEMENT OF RTOL IS  0&#39;</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,39,6,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;707   msg = .LT.<span class="stringliteral">&#39;DASKR--  SOME ELEMENT OF ATOL IS  0&#39;</span></div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,39,7,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;708   msg = <span class="stringliteral">&#39;DASKR--  ALL ELEMENTS OF RTOL AND ATOL ARE ZERO&#39;</span></div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,47,8,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;709   msg=<span class="stringliteral">&#39;DASKR--  INFO(4) = 1 AND TSTOP (=R1) BEHIND TOUT (=R2)&#39;</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,54,9,0,0,0,0,2,tstop,tout)</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;710   msg = .LT.<span class="stringliteral">&#39;DASKR--  HMAX (=R1)  0.0&#39;</span></div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,28,10,0,0,0,0,1,hmax,0.0d0)</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;711   msg = <span class="stringliteral">&#39;DASKR--  TOUT (=R1) BEHIND T (=R2)&#39;</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,34,11,0,0,0,0,2,tout,t)</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;712   msg = <span class="stringliteral">&#39;DASKR--  INFO(8)=1 AND H0=0.0&#39;</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,29,12,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;713   msg = .LE.<span class="stringliteral">&#39;DASKR--  SOME ELEMENT OF WT IS  0.0&#39;</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,39,13,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;714   msg=<span class="stringliteral">&#39;DASKR-- TOUT (=R1) TOO CLOSE TO T (=R2) TO START INTEGRATION&#39;</span></div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,60,14,0,0,0,0,2,tout,t)</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;715   msg = <span class="stringliteral">&#39;DASKR--  INFO(4)=1 AND TSTOP (=R1) BEHIND T (=R2)&#39;</span></div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,49,15,0,0,0,0,2,tstop,t)</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;717   msg = .LT..GT.<span class="stringliteral">&#39;DASKR--  ML (=I1) ILLEGAL. EITHER  0 OR  NEQ&#39;</span></div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,52,17,0,1,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lml),0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;718   msg = .LT..GT.<span class="stringliteral">&#39;DASKR--  MU (=I1) ILLEGAL. EITHER  0 OR  NEQ&#39;</span></div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,52,18,0,1,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmu),0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;719   msg = <span class="stringliteral">&#39;DASKR--  TOUT (=R1) IS EQUAL TO T (=R2)&#39;</span></div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,39,19,0,0,0,0,2,tout,t)</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;720   msg = .LT..GT.<span class="stringliteral">&#39;DASKR--  MAXL (=I1) ILLEGAL. EITHER  1 OR  NEQ&#39;</span></div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,54,20,0,1,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lmaxl),0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;721   msg = .LT..GT.<span class="stringliteral">&#39;DASKR--  KMP (=I1) ILLEGAL. EITHER  1 OR  MAXL&#39;</span></div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,54,21,0,1,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lkmp),0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;722   msg = .LT.<span class="stringliteral">&#39;DASKR--  NRMAX (=I1) ILLEGAL.  0&#39;</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,36,22,0,1,<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a>(lnrmax),0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;723   msg = .LE..GE.<span class="stringliteral">&#39;DASKR--  EPLI (=R1) ILLEGAL. EITHER  0.D0 OR  1.D0&#39;</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,58,23,0,0,0,0,1,rwork(lepli),0.0d0)</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;724   msg = .NE.<span class="stringliteral">&#39;DASKR--  ILLEGAL IWORK VALUE FOR INFO(11)  0&#39;</span></div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,48,24,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;725   msg = <span class="stringliteral">&#39;DASKR--  ONE OF THE INPUTS FOR INFO(17) = 1 IS ILLEGAL&#39;</span></div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,54,25,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;726   msg = .NE.<span class="stringliteral">&#39;DASKR--  ILLEGAL IWORK VALUE FOR INFO(10)  0&#39;</span></div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,48,26,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;727   msg = <span class="stringliteral">&#39;DASKR--  Y(I) AND IWORK(40+I) (I=I1) INCONSISTENT&#39;</span></div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,49,27,0,1,iret,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;730   msg = .LT.<span class="stringliteral">&#39;DASKR--  NRT (=I1)  0&#39;</span></div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,25,30,1,1,nrt,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;      <span class="keywordflow">GO TO</span> 750</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;731   msg = <span class="stringliteral">&#39;DASKR--  R IS ILL-DEFINED.  ZERO VALUES WERE FOUND AT TWO&#39;</span></div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,57,31,1,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      msg = <span class="stringliteral">&#39;         VERY CLOSE T VALUES, AT T = R1&#39;</span></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,39,31,1,0,0,0,1,rwork(lt0),0.0d0)</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;750   <span class="keywordflow">IF</span>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(1).EQ.-1) <span class="keywordflow">GO TO</span> 760</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;      <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a>(1)=-1</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;      idid=-33</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;760   msg = <span class="stringliteral">&#39;DASKR--  REPEATED OCCURRENCES OF ILLEGAL INPUT&#39;</span></div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,46,701,0,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;770   msg = <span class="stringliteral">&#39;DASKR--  RUN TERMINATED. APPARENT INFINITE LOOP&#39;</span></div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg,47,702,1,0,0,0,0,0.0d0,0.0d0)</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;<span class="comment">C------END OF SUBROUTINE DDASKR-----------------------------------------</span></div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aaead83d5896fc4b6b7d26450a2c3c557">drchek</a> (JOB, RT, NRT, NEQ, TN, TOUT, Y, YP, PHI, PSI,</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;     *   KOLD, R0, R1, RX, JROOT, IRT, UROUND, INFO3, RWORK, IWORK,</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;     *   RPAR, IPAR)</div><div class="line"><a name="l02497"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#aaead83d5896fc4b6b7d26450a2c3c557"> 2497</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DRCHEK</span></div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;<span class="comment">C***REFER TO DDASKR</span></div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;<span class="comment">C***ROUTINES CALLED  DDATRP, DROOTS, DCOPY, RT</span></div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;<span class="comment">C***REVISION HISTORY  (YYMMDD)</span></div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;<span class="comment">C   020815  DATE WRITTEN   </span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;<span class="comment">C   021217  Added test for roots close when JOB = 2.</span></div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;<span class="comment">C   050510  Changed T increment after 110 so that TEMP1/H .ge. 0.1.</span></div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;<span class="comment">C   071003  Fixed bug in TEMP2 (HMINR) below 110.</span></div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;<span class="comment">C   110608  Fixed bug in setting of T1 at 300.</span></div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;<span class="comment">C***END PROLOGUE  DRCHEK</span></div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;<span class="comment">C Pointers into IWORK:</span></div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;      parameter(lnrte=36, lirfnd=37)</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;<span class="comment">C Pointers into RWORK:</span></div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;      parameter(lt0=51, ltlast=52)</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;      <span class="keywordtype">EXTERNAL</span> rt</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;      <span class="keywordtype">INTEGER</span> JOB, NRT, NEQ, KOLD, JROOT, IRT, INFO3, IWORK, IPAR</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> TN, TOUT, Y, YP, PHI, PSI, R0, R1, RX, UROUND,</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;     *  rwork, rpar</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;      dimension y(*), yp(*), phi(neq,*), psi(*),</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;     *          r0(*), r1(*), rx(*), jroot(*), rwork(*), iwork(*)</div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;      <span class="keywordtype">INTEGER</span> I, JFLAG</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> H</div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> HMINR, T1, TEMP1, TEMP2, X, ZERO</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;      <span class="keywordtype">LOGICAL</span> ZROOT</div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;      <span class="keyword">DATA</span> zero/0.0d0/</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;<span class="comment">C This routine checks for the presence of a root of R(T,Y,Y&#39;) in the</span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;<span class="comment">C vicinity of the current T, in a manner depending on the</span></div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;<span class="comment">C input flag JOB.  It calls subroutine DROOTS to locate the root</span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;<span class="comment">C as precisely as possible.</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;<span class="comment">C In addition to variables described previously, DRCHEK</span></div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;<span class="comment">C uses the following for communication..</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;<span class="comment">C JOB    = integer flag indicating type of call..</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;<span class="comment">C          JOB = 1 means the problem is being initialized, and DRCHEK</span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;<span class="comment">C                  is to look for a root at or very near the initial T.</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;<span class="comment">C          JOB = 2 means a continuation call to the solver was just</span></div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;<span class="comment">C                  made, and DRCHEK is to check for a root in the</span></div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;<span class="comment">C                  relevant part of the step last taken.</span></div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;<span class="comment">C          JOB = 3 means a successful step was just taken, and DRCHEK</span></div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;<span class="comment">C                  is to look for a root in the interval of the step.</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;<span class="comment">C R0     = array of length NRT, containing the value of R at T = T0.</span></div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;<span class="comment">C          R0 is input for JOB .ge. 2 and on output in all cases.</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;<span class="comment">C R1,RX  = arrays of length NRT for work space.</span></div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;<span class="comment">C IRT    = completion flag..</span></div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;<span class="comment">C          IRT = 0  means no root was found.</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;<span class="comment">C          IRT = -1 means JOB = 1 and a zero was found both at T0 and</span></div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;<span class="comment">C                   and very close to T0.</span></div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;<span class="comment">C          IRT = -2 means JOB = 2 and some Ri was found to have a zero</span></div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;<span class="comment">C                   both at T0 and very close to T0.</span></div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;<span class="comment">C          IRT = 1  means a legitimate root was found (JOB = 2 or 3).</span></div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;<span class="comment">C                   On return, T0 is the root location, and Y is the</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;<span class="comment">C                   corresponding solution vector.</span></div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;<span class="comment">C T0     = value of T at one endpoint of interval of interest.  Only</span></div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;<span class="comment">C          roots beyond T0 in the direction of integration are sought.</span></div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;<span class="comment">C          T0 is input if JOB .ge. 2, and output in all cases.</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;<span class="comment">C          T0 is updated by DRCHEK, whether a root is found or not.</span></div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;<span class="comment">C          Stored in the global array RWORK.</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;<span class="comment">C TLAST  = last value of T returned by the solver (input only).</span></div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;<span class="comment">C          Stored in the global array RWORK.</span></div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="comment">C TOUT   = final output time for the solver.</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;<span class="comment">C IRFND  = input flag showing whether the last step taken had a root.</span></div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;<span class="comment">C          IRFND = 1 if it did, = 0 if not.</span></div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;<span class="comment">C          Stored in the global array IWORK.</span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;<span class="comment">C INFO3  = copy of INFO(3) (input only).</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;<span class="comment">C     </span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;      h = psi(1)</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;      irt = 0</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      <span class="keywordflow">DO</span> 10 i = 1,nrt</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160; 10     jroot(i) = 0</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;      hminr = (abs(tn) + abs(h))*uround*100.0d0</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;      <span class="keywordflow">GO TO</span> (100, 200, 300), job</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;<span class="comment">C Evaluate R at initial T (= RWORK(LT0)); check for zero values.--------</span></div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160; 100  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(tn,rwork(lt0),y,yp,neq,kold,phi,psi)</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;      <span class="keyword">CALL </span>rt (neq, rwork(lt0), y, yp, nrt, r0, rpar, ipar)</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;      iwork(lnrte) = 1</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;      zroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;      <span class="keywordflow">DO</span> 110 i = 1,nrt</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160; 110    <span class="keywordflow">IF</span> (abs(r0(i)) .EQ. zero) zroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;      <span class="keywordflow">IF</span> (.NOT. zroot) <span class="keywordflow">GO TO</span> 190</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;<span class="comment">C R has a zero at T.  Look at R at T + (small increment). --------------</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;      temp2 = <a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(hminr/abs(h), 0.1d0)</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;      temp1 = temp2*h</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;      rwork(lt0) = rwork(lt0) + temp1</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;      <span class="keywordflow">DO</span> 120 i = 1,neq</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160; 120    y(i) = y(i) + temp2*phi(i,2)</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;      <span class="keyword">CALL </span>rt (neq, rwork(lt0), y, yp, nrt, r0, rpar, ipar)</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;      iwork(lnrte) = iwork(lnrte) + 1</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;      zroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;      <span class="keywordflow">DO</span> 130 i = 1,nrt</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160; 130    <span class="keywordflow">IF</span> (abs(r0(i)) .EQ. zero) zroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;      <span class="keywordflow">IF</span> (.NOT. zroot) <span class="keywordflow">GO TO</span> 190</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;<span class="comment">C R has a zero at T and also close to T.  Take error return. -----------</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;      irt = -1</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160; 190  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160; 200  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;      <span class="keywordflow">IF</span> (iwork(lirfnd) .EQ. 0) <span class="keywordflow">GO TO</span> 260</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;<span class="comment">C If a root was found on the previous step, evaluate R0 = R(T0). -------</span></div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a> (tn, rwork(lt0), y, yp, neq, kold, phi, psi)</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;      <span class="keyword">CALL </span>rt (neq, rwork(lt0), y, yp, nrt, r0, rpar, ipar)</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;      iwork(lnrte) = iwork(lnrte) + 1</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;      zroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;      <span class="keywordflow">DO</span> 210 i = 1,nrt</div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;        <span class="keywordflow">IF</span> (abs(r0(i)) .EQ. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;          zroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;          jroot(i) = 1</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160; 210    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;      <span class="keywordflow">IF</span> (.NOT. zroot) <span class="keywordflow">GO TO</span> 260</div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;<span class="comment">C R has a zero at T0.  Look at R at T0+ = T0 + (small increment). ------</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;      temp1 = sign(hminr,h)</div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;      rwork(lt0) = rwork(lt0) + temp1</div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;      <span class="keywordflow">IF</span> ((rwork(lt0) - tn)*h .LT. zero) <span class="keywordflow">GO TO</span> 230</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;      temp2 = temp1/h</div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;      <span class="keywordflow">DO</span> 220 i = 1,neq</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160; 220    y(i) = y(i) + temp2*phi(i,2)</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;      <span class="keywordflow">GO TO</span> 240</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160; 230  <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a> (tn, rwork(lt0), y, yp, neq, kold, phi, psi)</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160; 240  <span class="keyword">CALL </span>rt (neq, rwork(lt0), y, yp, nrt, r0, rpar, ipar)</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;      iwork(lnrte) = iwork(lnrte) + 1</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;      <span class="keywordflow">DO</span> 250 i = 1,nrt</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;        <span class="keywordflow">IF</span> (abs(r0(i)) .GT. zero) <span class="keywordflow">GO TO</span> 250</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;<span class="comment">C If Ri has a zero at both T0+ and T0, return an error flag. -----------</span></div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;        <span class="keywordflow">IF</span> (jroot(i) .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;          irt = -2</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;          <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <span class="keywordflow">ELSE</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;<span class="comment">C If Ri has a zero at T0+, but not at T0, return valid root. -----------</span></div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;          jroot(i) = -sign(1.0d0,r0(i))</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;          irt = 1</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160; 250    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;      <span class="keywordflow">IF</span> (irt .EQ. 1) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;<span class="comment">C R0 has no zero components.  Proceed to check relevant interval. ------</span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160; 260  <span class="keywordflow">IF</span> (tn .EQ. rwork(ltlast)) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160; 300  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;<span class="comment">C Set T1 to TN or TOUT, whichever comes first, and get R at T1. --------</span></div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;      <span class="keywordflow">IF</span> ((tout - tn)*h .GE. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;         t1 = tn</div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;         <span class="keywordflow">GO TO</span> 330</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;      t1 = tout</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;      <span class="keywordflow">IF</span> ((t1 - rwork(lt0))*h .LE. zero) <span class="keywordflow">GO TO</span> 390</div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160; 330  <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a> (tn, t1, y, yp, neq, kold, phi, psi)</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;      <span class="keyword">CALL </span>rt (neq, t1, y, yp, nrt, r1, rpar, ipar)</div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;      iwork(lnrte) = iwork(lnrte) + 1</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;<span class="comment">C Call DROOTS to search for root in interval from T0 to T1. ------------</span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;      jflag = 0</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160; 350  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a513832cd8f21174b668fe46521948305">droots</a> (nrt, hminr, jflag, rwork(lt0),t1, r0,r1,rx, x, jroot)</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;      <span class="keywordflow">IF</span> (jflag .GT. 1) <span class="keywordflow">GO TO</span> 360</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a> (tn, x, y, yp, neq, kold, phi, psi)</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;      <span class="keyword">CALL </span>rt (neq, x, y, yp, nrt, rx, rpar, ipar)</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;      iwork(lnrte) = iwork(lnrte) + 1</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;      <span class="keywordflow">GO TO</span> 350</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160; 360  rwork(lt0) = x</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (nrt, rx, 1, r0, 1)</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;      <span class="keywordflow">IF</span> (jflag .EQ. 4) <span class="keywordflow">GO TO</span> 390</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;<span class="comment">C Found a root.  Interpolate to X and return. --------------------------</span></div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a> (tn, x, y, yp, neq, kold, phi, psi)</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;      irt = 1</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160; 390  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;<span class="comment">C---------------------- END OF SUBROUTINE DRCHEK -----------------------</span></div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a513832cd8f21174b668fe46521948305">droots</a> (NRT, HMIN, JFLAG, X0, X1, R0, R1, RX, X, JROOT)</div><div class="line"><a name="l02677"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a513832cd8f21174b668fe46521948305"> 2677</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DROOTS</span></div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;<span class="comment">C***REFER TO DRCHEK</span></div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;<span class="comment">C***ROUTINES CALLED DCOPY</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;<span class="comment">C***REVISION HISTORY  (YYMMDD)</span></div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;<span class="comment">C   020815  DATE WRITTEN   </span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;<span class="comment">C   021217  Added root direction information in JROOT.</span></div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;<span class="comment">C   040518  Changed adjustment to X2 at 180 to avoid infinite loop.</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="comment">C***END PROLOGUE  DROOTS</span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;      <span class="keywordtype">INTEGER</span> NRT, JFLAG, JROOT</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> HMIN, X0, X1, R0, R1, RX, X</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;      dimension r0(nrt), r1(nrt), rx(nrt), jroot(nrt)</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;<span class="comment">C This subroutine finds the leftmost root of a set of arbitrary</span></div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;<span class="comment">C functions Ri(x) (i = 1,...,NRT) in an interval (X0,X1).  Only roots</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;<span class="comment">C of odd multiplicity (i.e. changes of sign of the Ri) are found.</span></div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;<span class="comment">C Here the sign of X1 - X0 is arbitrary, but is constant for a given</span></div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;<span class="comment">C problem, and -leftmost- means nearest to X0.</span></div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;<span class="comment">C The values of the vector-valued function R(x) = (Ri, i=1...NRT)</span></div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;<span class="comment">C are communicated through the call sequence of DROOTS.</span></div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;<span class="comment">C The method used is the Illinois algorithm.</span></div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;<span class="comment">C Reference:</span></div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;<span class="comment">C Kathie L. Hiebert and Lawrence F. Shampine, Implicitly Defined</span></div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;<span class="comment">C Output Points for Solutions of ODEs, Sandia Report SAND80-0180,</span></div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;<span class="comment">C February 1980.</span></div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;<span class="comment">C Description of parameters.</span></div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="comment">C NRT    = number of functions Ri, or the number of components of</span></div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;<span class="comment">C          the vector valued function R(x).  Input only.</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;<span class="comment">C HMIN   = resolution parameter in X.  Input only.  When a root is</span></div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;<span class="comment">C          found, it is located only to within an error of HMIN in X.</span></div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;<span class="comment">C          Typically, HMIN should be set to something on the order of</span></div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;<span class="comment">C               100 * UROUND * MAX(ABS(X0),ABS(X1)),</span></div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;<span class="comment">C          where UROUND is the unit roundoff of the machine.</span></div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;<span class="comment">C JFLAG  = integer flag for input and output communication.</span></div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;<span class="comment">C          On input, set JFLAG = 0 on the first call for the problem,</span></div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;<span class="comment">C          and leave it unchanged until the problem is completed.</span></div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;<span class="comment">C          (The problem is completed when JFLAG .ge. 2 on return.)</span></div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;<span class="comment">C          On output, JFLAG has the following values and meanings:</span></div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;<span class="comment">C          JFLAG = 1 means DROOTS needs a value of R(x).  Set RX = R(X)</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;<span class="comment">C                    and call DROOTS again.</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;<span class="comment">C          JFLAG = 2 means a root has been found.  The root is</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;<span class="comment">C                    at X, and RX contains R(X).  (Actually, X is the</span></div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;<span class="comment">C                    rightmost approximation to the root on an interval</span></div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;<span class="comment">C                    (X0,X1) of size HMIN or less.)</span></div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;<span class="comment">C          JFLAG = 3 means X = X1 is a root, with one or more of the Ri</span></div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;<span class="comment">C                    being zero at X1 and no sign changes in (X0,X1).</span></div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;<span class="comment">C                    RX contains R(X) on output.</span></div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;<span class="comment">C          JFLAG = 4 means no roots (of odd multiplicity) were</span></div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;<span class="comment">C                    found in (X0,X1) (no sign changes).</span></div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;<span class="comment">C X0,X1  = endpoints of the interval where roots are sought.</span></div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;<span class="comment">C          X1 and X0 are input when JFLAG = 0 (first call), and</span></div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;<span class="comment">C          must be left unchanged between calls until the problem is</span></div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;<span class="comment">C          completed.  X0 and X1 must be distinct, but X1 - X0 may be</span></div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;<span class="comment">C          of either sign.  However, the notion of -left- and -right-</span></div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;<span class="comment">C          will be used to mean nearer to X0 or X1, respectively.</span></div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;<span class="comment">C          When JFLAG .ge. 2 on return, X0 and X1 are output, and</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;<span class="comment">C          are the endpoints of the relevant interval.</span></div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;<span class="comment">C R0,R1  = arrays of length NRT containing the vectors R(X0) and R(X1),</span></div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;<span class="comment">C          respectively.  When JFLAG = 0, R0 and R1 are input and</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;<span class="comment">C          none of the R0(i) should be zero.</span></div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;<span class="comment">C          When JFLAG .ge. 2 on return, R0 and R1 are output.</span></div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;<span class="comment">C RX     = array of length NRT containing R(X).  RX is input</span></div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;<span class="comment">C          when JFLAG = 1, and output when JFLAG .ge. 2.</span></div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;<span class="comment">C X      = independent variable value.  Output only.</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;<span class="comment">C          When JFLAG = 1 on output, X is the point at which R(x)</span></div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;<span class="comment">C          is to be evaluated and loaded into RX.</span></div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;<span class="comment">C          When JFLAG = 2 or 3, X is the root.</span></div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;<span class="comment">C          When JFLAG = 4, X is the right endpoint of the interval, X1.</span></div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;<span class="comment">C JROOT  = integer array of length NRT.  Output only.</span></div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;<span class="comment">C          When JFLAG = 2 or 3, JROOT indicates which components</span></div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;<span class="comment">C          of R(x) have a root at X, and the direction of the sign</span></div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;<span class="comment">C          change across the root in the direction of integration.</span></div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;<span class="comment">C          JROOT(i) =  1 if Ri has a root and changes from - to +.</span></div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;<span class="comment">C          JROOT(i) = -1 if Ri has a root and changes from + to -.</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;<span class="comment">C          Otherwise JROOT(i) = 0.</span></div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;      <span class="keywordtype">INTEGER</span> I, IMAX, IMXOLD, LAST, NXLAST</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> ALPHA, T2, TMAX, X2, FRACINT, FRACSUB,</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;     1                 zero, tenth, half, five</div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;      <span class="keywordtype">LOGICAL</span> ZROOT, SGNCHG, XROOT</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;      <span class="keywordtype">SAVE</span> alpha, x2, imax, last</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;      <span class="keyword">DATA</span> zero/0.0d0/, tenth/0.1d0/, half/0.5d0/, five/5.0d0/</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;      <span class="keywordflow">IF</span> (jflag .EQ. 1) <span class="keywordflow">GO TO</span> 200</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;<span class="comment">C JFLAG .ne. 1.  Check for change in sign of R or zero at X1. ----------</span></div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;      imax = 0</div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;      tmax = zero</div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;      zroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;      <span class="keywordflow">DO</span> 120 i = 1,nrt</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;        <span class="keywordflow">IF</span> (abs(r1(i)) .GT. zero) <span class="keywordflow">GO TO</span> 110</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        zroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;        <span class="keywordflow">GO TO</span> 120</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;<span class="comment">C At this point, R0(i) has been checked and cannot be zero. ------------</span></div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160; 110    <span class="keywordflow">IF</span> (sign(1.0d0,r0(i)) .EQ. sign(1.0d0,r1(i))) <span class="keywordflow">GO TO</span> 120</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;          t2 = abs(r1(i)/(r1(i)-r0(i)))</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;          <span class="keywordflow">IF</span> (t2 .LE. tmax) <span class="keywordflow">GO TO</span> 120</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;            tmax = t2</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;            imax = i</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160; 120    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;      <span class="keywordflow">IF</span> (imax .GT. 0) <span class="keywordflow">GO TO</span> 130</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;      sgnchg = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;      <span class="keywordflow">GO TO</span> 140</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160; 130  sgnchg = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160; 140  <span class="keywordflow">IF</span> (.NOT. sgnchg) <span class="keywordflow">GO TO</span> 400</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;<span class="comment">C There is a sign change.  Find the first root in the interval. --------</span></div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;      xroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;      nxlast = 0</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;      last = 1</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="comment">C Repeat until the first root in the interval is found.  Loop point. ---</span></div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160; 150  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;      <span class="keywordflow">IF</span> (xroot) <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;      <span class="keywordflow">IF</span> (nxlast .EQ. last) <span class="keywordflow">GO TO</span> 160</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;      alpha = 1.0d0</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;      <span class="keywordflow">GO TO</span> 180</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160; 160  <span class="keywordflow">IF</span> (last .EQ. 0) <span class="keywordflow">GO TO</span> 170</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;      alpha = 0.5d0*alpha</div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;      <span class="keywordflow">GO TO</span> 180</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160; 170  alpha = 2.0d0*alpha</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160; 180  x2 = x1 - (x1-x0)*r1(imax)/(r1(imax) - alpha*r0(imax))</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;      <span class="keywordflow">IF</span> (abs(x2 - x0) &lt; half*hmin) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;        fracint = abs(x1 - x0)/hmin</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;        <span class="keywordflow">IF</span> (fracint .GT. five) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;          fracsub = tenth</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;        <span class="keywordflow">ELSE</span></div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;          fracsub = half/fracint</div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;        x2 = x0 + fracsub*(x1 - x0)</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;      <span class="keywordflow">IF</span> (abs(x1 - x2) &lt; half*hmin) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;        fracint = abs(x1 - x0)/hmin</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;        <span class="keywordflow">IF</span> (fracint .GT. five) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;          fracsub = tenth</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;        <span class="keywordflow">ELSE</span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;          fracsub = half/fracint</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;        x2 = x1 - fracsub*(x1 - x0)</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;      jflag = 1</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;      x = x2</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;<span class="comment">C Return to the calling routine to get a value of RX = R(X). -----------</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;<span class="comment">C Check to see in which interval R changes sign. -----------------------</span></div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160; 200  imxold = imax</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;      imax = 0</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;      tmax = zero</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;      zroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;      <span class="keywordflow">DO</span> 220 i = 1,nrt</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;        <span class="keywordflow">IF</span> (abs(rx(i)) .GT. zero) <span class="keywordflow">GO TO</span> 210</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;        zroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;        <span class="keywordflow">GO TO</span> 220</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;<span class="comment">C Neither R0(i) nor RX(i) can be zero at this point. -------------------</span></div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160; 210    <span class="keywordflow">IF</span> (sign(1.0d0,r0(i)) .EQ. sign(1.0d0,rx(i))) <span class="keywordflow">GO TO</span> 220</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;          t2 = abs(rx(i)/(rx(i) - r0(i)))</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;          <span class="keywordflow">IF</span> (t2 .LE. tmax) <span class="keywordflow">GO TO</span> 220</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;            tmax = t2</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;            imax = i</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160; 220    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;      <span class="keywordflow">IF</span> (imax .GT. 0) <span class="keywordflow">GO TO</span> 230</div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;      sgnchg = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;      imax = imxold</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;      <span class="keywordflow">GO TO</span> 240</div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160; 230  sgnchg = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160; 240  nxlast = last</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;      <span class="keywordflow">IF</span> (.NOT. sgnchg) <span class="keywordflow">GO TO</span> 250</div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;<span class="comment">C Sign change between X0 and X2, so replace X1 with X2. ----------------</span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;      x1 = x2</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (nrt, rx, 1, r1, 1)</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;      last = 1</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;      xroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;      <span class="keywordflow">GO TO</span> 270</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160; 250  <span class="keywordflow">IF</span> (.NOT. zroot) <span class="keywordflow">GO TO</span> 260</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;<span class="comment">C Zero value at X2 and no sign change in (X0,X2), so X2 is a root. -----</span></div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;      x1 = x2</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (nrt, rx, 1, r1, 1)</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;      xroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;      <span class="keywordflow">GO TO</span> 270</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;<span class="comment">C No sign change between X0 and X2.  Replace X0 with X2. ---------------</span></div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160; 260  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (nrt, rx, 1, r0, 1)</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;      x0 = x2</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;      last = 0</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;      xroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a>.</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160; 270  <span class="keywordflow">IF</span> (abs(x1-x0) .LE. hmin) xroot = .<a class="code" href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a>.</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;      <span class="keywordflow">GO TO</span> 150</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;<span class="comment">C Return with X1 as the root.  Set JROOT.  Set X = X1 and RX = R1. -----</span></div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160; 300  jflag = 2</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;      x = x1</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (nrt, r1, 1, rx, 1)</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;      <span class="keywordflow">DO</span> 320 i = 1,nrt</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;        jroot(i) = 0</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;        <span class="keywordflow">IF</span> (abs(r1(i)) .EQ. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;          jroot(i) = -sign(1.0d0,r0(i))</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;          <span class="keywordflow">GO TO</span> 320</div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;<span class="keywordflow">          ENDIF</span></div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;        <span class="keywordflow">IF</span> (sign(1.0d0,r0(i)) .NE. sign(1.0d0,r1(i)))</div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;     1     jroot(i) = sign(1.0d0,r1(i) - r0(i))</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160; 320    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;<span class="comment">C No sign change in the interval.  Check for zero at right endpoint. ---</span></div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160; 400  <span class="keywordflow">IF</span> (.NOT. zroot) <span class="keywordflow">GO TO</span> 420</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;<span class="comment">C Zero value at X1 and no sign change in (X0,X1).  Return JFLAG = 3. ---</span></div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;      x = x1</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (nrt, r1, 1, rx, 1)</div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;      <span class="keywordflow">DO</span> 410 i = 1,nrt</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;        jroot(i) = 0</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;        <span class="keywordflow">IF</span> (abs(r1(i)) .EQ. zero) jroot(i) = -sign(1.0d0,r0(i))</div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160; 410  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;      jflag = 3</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;<span class="comment">C No sign changes in this interval.  Set X = X1, return JFLAG = 4. -----</span></div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160; 420  <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (nrt, r1, 1, rx, 1)</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;      x = x1</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;      jflag = 4</div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;<span class="comment">C----------------------- END OF SUBROUTINE DROOTS ----------------------</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a53eb4de7fba5741a189673be61dbde02">ddasic</a> (X, Y, YPRIME, NEQ, ICOPT, ID, RES, JAC, PSOL,</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;     *   H, TSCALE, WT, NIC, IDID, RPAR, IPAR, PHI, SAVR, DELTA, E,</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;     *   YIC, YPIC, PWK, WM, IWM, UROUND, EPLI, SQRTN, RSQRTN,</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;     *   EPCONI, STPTOL, JFLG, ICNFLG, ICNSTR, NLSIC)</div><div class="line"><a name="l02915"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a53eb4de7fba5741a189673be61dbde02"> 2915</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DDASIC</span></div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;<span class="comment">C***DATE WRITTEN   940628   (YYMMDD)</span></div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;<span class="comment">C***REVISION DATE  941206   (YYMMDD)</span></div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;<span class="comment">C***REVISION DATE  950714   (YYMMDD)</span></div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;<span class="comment">C***REVISION DATE  000628   TSCALE argument added.</span></div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;<span class="comment">C     DDASIC is a driver routine to compute consistent initial values</span></div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;<span class="comment">C     for Y and YPRIME.  There are two different options:  </span></div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;<span class="comment">C     Denoting the differential variables in Y by Y_d, and</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;<span class="comment">C     the algebraic variables by Y_a, the problem solved is either:</span></div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;<span class="comment">C     1.  Given Y_d, calculate Y_a and Y_d&#39;, or</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;<span class="comment">C     2.  Given Y&#39;, calculate Y.</span></div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;<span class="comment">C     In either case, initial values for the given components</span></div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;<span class="comment">C     are input, and initial guesses for the unknown components</span></div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;<span class="comment">C     must also be provided as input.</span></div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;<span class="comment">C     The external routine NLSIC solves the resulting nonlinear system.</span></div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;<span class="comment">C     The parameters represent</span></div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;<span class="comment">C     X  --        Independent variable.</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;<span class="comment">C     Y  --        Solution vector at X.</span></div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;<span class="comment">C     YPRIME --    Derivative of solution vector.</span></div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;<span class="comment">C     NEQ --       Number of equations to be integrated.</span></div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;<span class="comment">C     ICOPT     -- Flag indicating initial condition option chosen.</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;<span class="comment">C                    ICOPT = 1 for option 1 above.</span></div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;<span class="comment">C                    ICOPT = 2 for option 2.</span></div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;<span class="comment">C     ID        -- Array of dimension NEQ, which must be initialized</span></div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;<span class="comment">C                  if option 1 is chosen.</span></div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;<span class="comment">C                    ID(i) = +1 if Y_i is a differential variable,</span></div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;<span class="comment">C                    ID(i) = -1 if Y_i is an algebraic variable. </span></div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;<span class="comment">C     RES --       External user-supplied subroutine to evaluate the</span></div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;<span class="comment">C                  residual.  See RES description in DDASPK prologue.</span></div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;<span class="comment">C     JAC --       External user-supplied routine to update Jacobian</span></div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;<span class="comment">C                  or preconditioner information in the nonlinear solver</span></div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;<span class="comment">C                  (optional).  See JAC description in DDASPK prologue.</span></div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;<span class="comment">C     PSOL --      External user-supplied routine to solve</span></div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;<span class="comment">C                  a linear system using preconditioning. </span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;<span class="comment">C                  See PSOL in DDASPK prologue.</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;<span class="comment">C     H --         Scaling factor in iteration matrix.  DDASIC may </span></div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;<span class="comment">C                  reduce H to achieve convergence.</span></div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;<span class="comment">C     TSCALE --    Scale factor in T, used for stopping tests if nonzero.</span></div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;<span class="comment">C     WT --        Vector of weights for error criterion.</span></div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;<span class="comment">C     NIC --       Input number of initial condition calculation call </span></div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;<span class="comment">C                  (= 1 or 2).</span></div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;<span class="comment">C     IDID --      Completion code.  See IDID in DDASPK prologue.</span></div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;<span class="comment">C     RPAR,IPAR -- Real and integer parameter arrays that</span></div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;<span class="comment">C                  are used for communication between the</span></div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;<span class="comment">C                  calling program and external user routines.</span></div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;<span class="comment">C                  They are not altered by DNSK</span></div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;<span class="comment">C     PHI --       Work space for DDASIC of length at least 2*NEQ.</span></div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;<span class="comment">C     SAVR --      Work vector for DDASIC of length NEQ.</span></div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;<span class="comment">C     DELTA --     Work vector for DDASIC of length NEQ.</span></div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;<span class="comment">C     E --         Work vector for DDASIC of length NEQ.</span></div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;<span class="comment">C     YIC,YPIC --  Work vectors for DDASIC, each of length NEQ.</span></div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;<span class="comment">C     PWK --       Work vector for DDASIC of length NEQ.</span></div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;<span class="comment">C     WM,IWM --    Real and integer arrays storing</span></div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;<span class="comment">C                  information required by the linear solver.</span></div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;<span class="comment">C     EPCONI --    Test constant for Newton iteration convergence.</span></div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;<span class="comment">C     ICNFLG --    Flag showing whether constraints on Y are to apply.</span></div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;<span class="comment">C     ICNSTR --    Integer array of length NEQ with constraint types.</span></div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;<span class="comment">C     The other parameters are for use internally by DDASIC.</span></div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;<span class="comment">C   DCOPY, NLSIC</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;<span class="comment">C***END PROLOGUE  DDASIC</span></div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),id(*),wt(*),phi(neq,*)</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;      dimension savr(*),delta(*),<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(*),yic(*),ypic(*),pwk(*)</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;      dimension wm(*),iwm(*), rpar(*),ipar(*), icnstr(*)</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;      <span class="keywordtype">EXTERNAL</span> res, jac, psol, nlsic</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;      parameter(lcfn=15)</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      parameter(lmxnh=34)</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;<span class="comment">C The following parameters are data-loaded here:</span></div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;<span class="comment">C     RHCUT  = factor by which H is reduced on retry of Newton solve.</span></div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;<span class="comment">C     RATEMX = maximum convergence rate for which Newton iteration</span></div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;<span class="comment">C              is considered converging.</span></div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;      <span class="keywordtype">SAVE</span> rhcut, ratemx</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;      <span class="keyword">DATA</span> rhcut/0.1d0/, ratemx/0.8d0/</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;<span class="comment">C     BLOCK 1.</span></div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;<span class="comment">C     Initializations.</span></div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;<span class="comment">C     JSKIP is a flag set to 1 when NIC = 2 and NH = 1, to signal that</span></div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;<span class="comment">C     the initial call to the JAC routine is to be skipped then.</span></div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;<span class="comment">C     Save Y and YPRIME in PHI.  Initialize IDID, NH, and CJ.</span></div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;      mxnh = iwm(lmxnh)</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      idid = 1</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;      nh = 1</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;      jskip = 0</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;      <span class="keywordflow">IF</span> (nic .EQ. 2) jskip = 1</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, 1, phi(1,1), 1)</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, yprime, 1, phi(1,2), 1)</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;      <span class="keywordflow">IF</span> (icopt .EQ. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;        cj = 0.0d0 </div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;        cj = 1.0d0/h</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;<span class="comment">C     BLOCK 2</span></div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;<span class="comment">C     Call the nonlinear system solver to obtain</span></div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;<span class="comment">C     consistent initial values for Y and YPRIME.</span></div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160; 200  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;      <span class="keyword">CALL </span>nlsic(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,icopt,id,res,jac,psol,h,tscale,wt,</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;     *   jskip,rpar,ipar,savr,delta,<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>,yic,ypic,pwk,wm,iwm,cj,uround,</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;     *   epli,sqrtn,rsqrtn,epconi,ratemx,stptol,jflg,icnflg,icnstr,</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;     *   iernls)</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;      <span class="keywordflow">IF</span> (iernls .EQ. 0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;<span class="comment">C     BLOCK 3</span></div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;<span class="comment">C     The nonlinear solver was unsuccessful.  Increment NCFN.</span></div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;<span class="comment">C     Return with IDID = -12 if either</span></div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;<span class="comment">C       IERNLS = -1: error is considered unrecoverable,</span></div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;<span class="comment">C       ICOPT = 2: we are doing initialization problem type 2, or</span></div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;<span class="comment">C       NH = MXNH: the maximum number of H values has been tried.</span></div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;<span class="comment">C     Otherwise (problem 1 with IERNLS .GE. 1), reduce H and try again.</span></div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;<span class="comment">C     If IERNLS &gt; 1, restore Y and YPRIME to their original values.</span></div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;      iwm(lcfn) = iwm(lcfn) + 1</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;      jskip = 0</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;      <span class="keywordflow">IF</span> (iernls .EQ. -1) <span class="keywordflow">GO TO</span> 350</div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;      <span class="keywordflow">IF</span> (icopt .EQ. 2) <span class="keywordflow">GO TO</span> 350</div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;      <span class="keywordflow">IF</span> (nh .EQ. mxnh) <span class="keywordflow">GO TO</span> 350</div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;      nh = nh + 1</div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;      h = h*rhcut</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;      cj = 1.0d0/h</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;      <span class="keywordflow">IF</span> (iernls .EQ. 1) <span class="keywordflow">GO TO</span> 200</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, phi(1,1), 1, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, 1)</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, phi(1,2), 1, yprime, 1)</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;      <span class="keywordflow">GO TO</span> 200</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160; 350  idid = -12</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;<span class="comment">C------END OF SUBROUTINE DDASIC-----------------------------------------</span></div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a187e8c4e1cbbc063d8ba76ccef7bb89a">dyypnw</a> (NEQ, Y, YPRIME, CJ, RL, P, ICOPT, ID, </div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;     *                   YNEW, YPNEW)</div><div class="line"><a name="l03080"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a187e8c4e1cbbc063d8ba76ccef7bb89a"> 3080</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DYYPNW</span></div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;<span class="comment">C***REFER TO  DLINSK</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;<span class="comment">C***DATE WRITTEN   940830   (YYMMDD)</span></div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;<span class="comment">C     DYYPNW calculates the new (Y,YPRIME) pair needed in the</span></div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;<span class="comment">C     linesearch algorithm based on the current lambda value.  It is</span></div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;<span class="comment">C     called by DLINSK and DLINSD.  Based on the ICOPT and ID values,</span></div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;<span class="comment">C     the corresponding entry in Y or YPRIME is updated.</span></div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;<span class="comment">C     In addition to the parameters described in the calling programs,</span></div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;<span class="comment">C     the parameters represent</span></div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;<span class="comment">C     P      -- Array of length NEQ that contains the current</span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;<span class="comment">C               approximate Newton step.</span></div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;<span class="comment">C     RL     -- Scalar containing the current lambda value.</span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;<span class="comment">C     YNEW   -- Array of length NEQ containing the updated Y vector.</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;<span class="comment">C     YPNEW  -- Array of length NEQ containing the updated YPRIME</span></div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;<span class="comment">C               vector.</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;<span class="comment">C***ROUTINES CALLED (NONE)</span></div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;<span class="comment">C***END PROLOGUE  DYYPNW</span></div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span> (<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*), yprime(*), ynew(*), ypnew(*), id(*), <a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>(*)</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;      <span class="keywordflow">IF</span> (icopt .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;         <span class="keywordflow">DO</span> 10 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;            <span class="keywordflow">IF</span>(id(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .LT. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;               ynew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) - rl*<a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;               ypnew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;            <span class="keywordflow">ELSE</span></div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;               ynew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;               ypnew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) - rl*cj*<a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160; 10      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;         <span class="keywordflow">DO</span> 20 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;            ynew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) - rl*<a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;            ypnew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160; 20      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;<span class="comment">C----------------------- END OF SUBROUTINE DYYPNW ----------------------</span></div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a4dcdd9a7ce2b4ea61f28f5ca27374266">ddstp</a>(X,Y,YPRIME,NEQ,RES,JAC,PSOL,H,WT,VT,</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;     *  JSTART,IDID,RPAR,IPAR,PHI,SAVR,DELTA,E,WM,IWM,</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;     *  ALPHA,BETA,GAMMA,PSI,SIGMA,CJ,CJOLD,HOLD,S,HMIN,UROUND,</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;     *  EPLI,SQRTN,RSQRTN,EPCON,IPHASE,JCALC,JFLG,K,KOLD,NS,NONNEG,</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;     *  NTYPE,NLS)</div><div class="line"><a name="l03137"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a4dcdd9a7ce2b4ea61f28f5ca27374266"> 3137</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DDSTP</span></div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;<span class="comment">C***REVISION DATE  940909   (YYMMDD) (Reset PSI(1), PHI(*,2) at 690)</span></div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;<span class="comment">C     DDSTP solves a system of differential/algebraic equations of </span></div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;<span class="comment">C     the form G(X,Y,YPRIME) = 0, for one step (normally from X to X+H).</span></div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;<span class="comment">C     The methods used are modified divided difference, fixed leading </span></div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;<span class="comment">C     coefficient forms of backward differentiation formulas.  </span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;<span class="comment">C     The code adjusts the stepsize and order to control the local error</span></div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;<span class="comment">C     per step.</span></div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;<span class="comment">C     The parameters represent</span></div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;<span class="comment">C     X  --        Independent variable.</span></div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;<span class="comment">C     Y  --        Solution vector at X.</span></div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;<span class="comment">C     YPRIME --    Derivative of solution vector</span></div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;<span class="comment">C                  after successful step.</span></div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;<span class="comment">C     NEQ --       Number of equations to be integrated.</span></div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;<span class="comment">C     RES --       External user-supplied subroutine</span></div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;<span class="comment">C                  to evaluate the residual.  See RES description</span></div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;<span class="comment">C                  in DDASPK prologue.</span></div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;<span class="comment">C     JAC --       External user-supplied routine to update</span></div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;<span class="comment">C                  Jacobian or preconditioner information in the</span></div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;<span class="comment">C                  nonlinear solver.  See JAC description in DDASPK</span></div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;<span class="comment">C                  prologue.</span></div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;<span class="comment">C     PSOL --      External user-supplied routine to solve</span></div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;<span class="comment">C                  a linear system using preconditioning. </span></div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;<span class="comment">C                  (This is optional).  See PSOL in DDASPK prologue.</span></div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;<span class="comment">C     H --         Appropriate step size for next step.</span></div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;<span class="comment">C                  Normally determined by the code.</span></div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;<span class="comment">C     WT --        Vector of weights for error criterion used in Newton test.</span></div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;<span class="comment">C     VT --        Masked vector of weights used in error test.</span></div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;<span class="comment">C     JSTART --    Integer variable set 0 for</span></div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;<span class="comment">C                  first step, 1 otherwise.</span></div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;<span class="comment">C     IDID --      Completion code returned from the nonlinear solver.</span></div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;<span class="comment">C                  See IDID description in DDASPK prologue.</span></div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;<span class="comment">C     RPAR,IPAR -- Real and integer parameter arrays that</span></div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;<span class="comment">C                  are used for communication between the</span></div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;<span class="comment">C                  calling program and external user routines.</span></div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;<span class="comment">C                  They are not altered by DNSK</span></div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;<span class="comment">C     PHI --       Array of divided differences used by</span></div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;<span class="comment">C                  DDSTP. The length is NEQ*(K+1), where</span></div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;<span class="comment">C                  K is the maximum order.</span></div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;<span class="comment">C     SAVR --      Work vector for DDSTP of length NEQ.</span></div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;<span class="comment">C     DELTA,E --   Work vectors for DDSTP of length NEQ.</span></div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;<span class="comment">C     WM,IWM --    Real and integer arrays storing</span></div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;<span class="comment">C                  information required by the linear solver.</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;<span class="comment">C     The other parameters are information</span></div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;<span class="comment">C     which is needed internally by DDSTP to</span></div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;<span class="comment">C     continue from step to step.</span></div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;<span class="comment">C   NLS, DDWNRM, DDATRP</span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;<span class="comment">C***END PROLOGUE  DDSTP</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),wt(*),vt(*)</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;      dimension phi(neq,*),savr(*),delta(*),<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(*)</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;      dimension wm(*),iwm(*)</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      dimension psi(*),<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>(*),<a class="code" href="../../df/d24/dweb_8c.html#a81689d6e457169ce846aa4f4d2e3f335">beta</a>(*),gamma(*),sigma(*)</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      dimension rpar(*),ipar(*)</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, jac, psol, nls</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;      parameter(lmxord=3)</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      parameter(lnst=11, letf=14, lcfn=15)</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;<span class="comment">C     BLOCK 1.</span></div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;<span class="comment">C     Initialize.  On the first call, set</span></div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;<span class="comment">C     the order to 1 and initialize</span></div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;<span class="comment">C     other variables.</span></div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;<span class="comment">C     Initializations for all calls</span></div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;      xold=<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a></div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;      ncf=0</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;      nef=0</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;      <span class="keywordflow">IF</span>(jstart .NE. 0) <span class="keywordflow">GO TO</span> 120</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;<span class="comment">C     If this is the first step, perform</span></div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;<span class="comment">C     other initializations</span></div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;      <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>=1</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      kold=0</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;      hold=0.0d0</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      psi(1)=h</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;      cj = 1.d0/h</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;      iphase = 0</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;      <a class="code" href="../../df/d24/dweb_8c.html#a22f866797c0b4e7d4cb3546b06fb4d2a">ns</a>=0</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;120   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;<span class="comment">C     BLOCK 2</span></div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;<span class="comment">C     Compute coefficients of formulas for</span></div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;<span class="comment">C     this step.</span></div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;200   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;      kp1=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>+1</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;      kp2=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>+2</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;      km1=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>-1</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;      <span class="keywordflow">IF</span>(h.NE.hold.OR.<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a> .NE. kold) <a class="code" href="../../df/d24/dweb_8c.html#a22f866797c0b4e7d4cb3546b06fb4d2a">ns</a> = 0</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;      <a class="code" href="../../df/d24/dweb_8c.html#a22f866797c0b4e7d4cb3546b06fb4d2a">ns</a>=min0(<a class="code" href="../../df/d24/dweb_8c.html#a22f866797c0b4e7d4cb3546b06fb4d2a">ns</a>+1,kold+2)</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;      nsp1=<a class="code" href="../../df/d24/dweb_8c.html#a22f866797c0b4e7d4cb3546b06fb4d2a">ns</a>+1</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;      <span class="keywordflow">IF</span>(kp1 .LT. <a class="code" href="../../df/d24/dweb_8c.html#a22f866797c0b4e7d4cb3546b06fb4d2a">ns</a>)<span class="keywordflow">GO TO</span> 230</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;      <a class="code" href="../../df/d24/dweb_8c.html#a81689d6e457169ce846aa4f4d2e3f335">beta</a>(1)=1.0d0</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;      <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>(1)=1.0d0</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;      temp1=h</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;      gamma(1)=0.0d0</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;      sigma(1)=1.0d0</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;      <span class="keywordflow">DO</span> 210 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=2,kp1</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;         temp2=psi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;         psi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)=temp1</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;         <a class="code" href="../../df/d24/dweb_8c.html#a81689d6e457169ce846aa4f4d2e3f335">beta</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=<a class="code" href="../../df/d24/dweb_8c.html#a81689d6e457169ce846aa4f4d2e3f335">beta</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)*psi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)/temp2</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;         temp1=temp2+h</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;         <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=h/temp1</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;         sigma(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)*sigma(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)*<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;         gamma(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=gamma(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)+<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)/h</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;210      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;      psi(kp1)=temp1</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;230   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;<span class="comment">C     Compute ALPHAS, ALPHA0</span></div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;      alphas = 0.0d0</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;      alpha0 = 0.0d0</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;      <span class="keywordflow">DO</span> 240 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a></div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;        alphas = alphas - 1.0d0/<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;        alpha0 = alpha0 - <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;240     <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;<span class="comment">C     Compute leading coefficient CJ</span></div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;      cjlast = cj</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;      cj = -alphas/h</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;<span class="comment">C     Compute variable stepsize error coefficient CK</span></div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;      ck = abs(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>(kp1) + alphas - alpha0)</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;      ck = <a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(ck,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>(kp1))</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;<span class="comment">C     Change PHI to PHI STAR</span></div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;      <span class="keywordflow">IF</span>(kp1 .LT. nsp1) <span class="keywordflow">GO TO</span> 280</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;      <span class="keywordflow">DO</span> 270 <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>=nsp1,kp1</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;         <span class="keywordflow">DO</span> 260 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;260         phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)=<a class="code" href="../../df/d24/dweb_8c.html#a81689d6e457169ce846aa4f4d2e3f335">beta</a>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)*phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;270      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;280   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;<span class="comment">C     Update time</span></div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;      <a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>=<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>+h</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;<span class="comment">C     Initialize IDID to 1</span></div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;      idid = 1</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;<span class="comment">C     BLOCK 3</span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;<span class="comment">C     Call the nonlinear system solver to obtain the solution and</span></div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;<span class="comment">C     derivative.</span></div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;      <span class="keyword">CALL </span>nls(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;     *   res,jac,psol,h,wt,jstart,idid,rpar,ipar,phi,gamma,</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;     *   savr,delta,<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>,wm,iwm,cj,cjold,cjlast,<a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a>,</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;     *   uround,epli,sqrtn,rsqrtn,epcon,jcalc,jflg,kp1,</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;     *   nonneg,ntype,iernls)</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;      <span class="keywordflow">IF</span>(iernls .NE. 0)<span class="keywordflow">GO TO</span> 600</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;<span class="comment">C     BLOCK 4</span></div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;<span class="comment">C     Estimate the errors at orders K,K-1,K-2</span></div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;<span class="comment">C     as if constant stepsize was used. Estimate</span></div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;<span class="comment">C     the local error at order K and test</span></div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;<span class="comment">C     whether the current step is successful.</span></div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;<span class="comment">C     Estimate errors at orders K,K-1,K-2</span></div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;      <a class="code" href="../../d2/de0/3rd_party_2_c_minpack_2cminpack_8h.html#af0f4a5d2ead0ea85020f82295079d579">enorm</a> = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>,vt,rpar,ipar)</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;      erk = sigma(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>+1)*<a class="code" href="../../d2/de0/3rd_party_2_c_minpack_2cminpack_8h.html#af0f4a5d2ead0ea85020f82295079d579">enorm</a></div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;      terk = (<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>+1)*erk</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;      est = erk</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;      knew=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a></div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a> .EQ. 1)<span class="keywordflow">GO TO</span> 430</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;      <span class="keywordflow">DO</span> 405 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;405     delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,kp1) + <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      erkm1=sigma(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>)*<a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,delta,vt,rpar,ipar)</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;      terkm1 = <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>*erkm1</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a> .GT. 2)<span class="keywordflow">GO TO</span> 410</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;      <span class="keywordflow">IF</span>(terkm1 .LE. 0.5*terk)<span class="keywordflow">GO TO</span> 420</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;      <span class="keywordflow">GO TO</span> 430</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;410   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;      <span class="keywordflow">DO</span> 415 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;415     delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>) + delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;      erkm2=sigma(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>-1)*<a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,delta,vt,rpar,ipar)</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;      terkm2 = (<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>-1)*erkm2</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(terkm1,terkm2).GT.terk)<span class="keywordflow">GO TO</span> 430</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;<span class="comment">C     Lower the order</span></div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;420   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;      knew=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>-1</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;      est = erkm1</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;<span class="comment">C     Calculate the local error for the current step</span></div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;<span class="comment">C     to see if the step was successful</span></div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;430   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;      err = ck * <a class="code" href="../../d2/de0/3rd_party_2_c_minpack_2cminpack_8h.html#af0f4a5d2ead0ea85020f82295079d579">enorm</a></div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;      <span class="keywordflow">IF</span>(err .GT. 1.0d0)<span class="keywordflow">GO TO</span> 600</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;<span class="comment">C     BLOCK 5</span></div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;<span class="comment">C     The step is successful. Determine</span></div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;<span class="comment">C     the best order and stepsize for</span></div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;<span class="comment">C     the next step. Update the differences</span></div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;<span class="comment">C     for the next step.</span></div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;      idid=1</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;      iwm(lnst)=iwm(lnst)+1</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;      kdiff=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>-kold</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;      kold=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a></div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;      hold=h</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;<span class="comment">C     Estimate the error at order K+1 unless</span></div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;<span class="comment">C        already decided to lower order, or</span></div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;<span class="comment">C        already using maximum order, or</span></div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;<span class="comment">C        stepsize not constant, or</span></div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;<span class="comment">C        order raised in previous step</span></div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;      <span class="keywordflow">IF</span>(knew.EQ.km1.OR.<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>.EQ.iwm(lmxord))iphase=1</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;      <span class="keywordflow">IF</span>(iphase .EQ. 0)<span class="keywordflow">GO TO</span> 545</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;      <span class="keywordflow">IF</span>(knew.EQ.km1)<span class="keywordflow">GO TO</span> 540</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>.EQ.iwm(lmxord)) <span class="keywordflow">GO TO</span> 550</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;      <span class="keywordflow">IF</span>(kp1.GE.<a class="code" href="../../df/d24/dweb_8c.html#a22f866797c0b4e7d4cb3546b06fb4d2a">ns</a>.OR.kdiff.EQ.1)<span class="keywordflow">GO TO</span> 550</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;      <span class="keywordflow">DO</span> 510 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;510      delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)-phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,kp2)</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;      erkp1 = (1.0d0/(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>+2))*<a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,delta,vt,rpar,ipar)</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;      terkp1 = (<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>+2)*erkp1</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>.GT.1)<span class="keywordflow">GO TO</span> 520</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;      <span class="keywordflow">IF</span>(terkp1.GE.0.5d0*terk)<span class="keywordflow">GO TO</span> 550</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;      <span class="keywordflow">GO TO</span> 530</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;520   <span class="keywordflow">IF</span>(terkm1.LE.min(terk,terkp1))<span class="keywordflow">GO TO</span> 540</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;      <span class="keywordflow">IF</span>(terkp1.GE.terk.OR.<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>.EQ.iwm(lmxord))<span class="keywordflow">GO TO</span> 550</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;<span class="comment">C     Raise order</span></div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;530   <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>=kp1</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;      est = erkp1</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;      <span class="keywordflow">GO TO</span> 550</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;<span class="comment">C     Lower order</span></div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;540   <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>=km1</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;      est = erkm1</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;      <span class="keywordflow">GO TO</span> 550</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;<span class="comment">C     If IPHASE = 0, increase order by one and multiply stepsize by</span></div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;<span class="comment">C     factor two</span></div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;545   <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a> = kp1</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;      hnew = h*2.0d0</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;      h = hnew</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;      <span class="keywordflow">GO TO</span> 575</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;<span class="comment">C     Determine the appropriate stepsize for</span></div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;<span class="comment">C     the next step.</span></div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;550   hnew=h</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;      temp2=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>+1</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;      r=(2.0d0*est+0.0001d0)**(-1.0d0/temp2)</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;      <span class="keywordflow">IF</span>(r .LT. 2.0d0) <span class="keywordflow">GO TO</span> 555</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;      hnew = 2.0d0*h</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;      <span class="keywordflow">GO TO</span> 560</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;555   <span class="keywordflow">IF</span>(r .GT. 1.0d0) <span class="keywordflow">GO TO</span> 560</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;      r = <a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(0.5d0,min(0.9d0,r))</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;      hnew = h*r</div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;560   h=hnew</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;<span class="comment">C     Update differences for next step</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;575   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;      <span class="keywordflow">IF</span>(kold.EQ.iwm(lmxord))<span class="keywordflow">GO TO</span> 585</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;      <span class="keywordflow">DO</span> 580 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;580      phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,kp2)=<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;585   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;      <span class="keywordflow">DO</span> 590 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;590      phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,kp1)=phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,kp1)+<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;      <span class="keywordflow">DO</span> 595 j1=2,kp1</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;         <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>=kp1-j1+1</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;         <span class="keywordflow">DO</span> 595 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;595      phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)=phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)+phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>+1)</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;      jstart = 1</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;<span class="comment">C     BLOCK 6</span></div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;<span class="comment">C     The step is unsuccessful. Restore X,PSI,PHI</span></div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;<span class="comment">C     Determine appropriate stepsize for</span></div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;<span class="comment">C     continuing the integration, or exit with</span></div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;<span class="comment">C     an error flag if there have been many</span></div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;<span class="comment">C     failures.</span></div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;600   iphase = 1</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;<span class="comment">C     Restore X,PHI,PSI</span></div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;      <a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>=xold</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;      <span class="keywordflow">IF</span>(kp1.LT.nsp1)<span class="keywordflow">GO TO</span> 630</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;      <span class="keywordflow">DO</span> 620 <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>=nsp1,kp1</div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;         temp1=1.0d0/<a class="code" href="../../df/d24/dweb_8c.html#a81689d6e457169ce846aa4f4d2e3f335">beta</a>(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)</div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;         <span class="keywordflow">DO</span> 610 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;610         phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)=temp1*phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)</div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;620      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;630   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;      <span class="keywordflow">DO</span> 640 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=2,kp1</div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;640      psi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1)=psi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)-h</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;<span class="comment">C     Test whether failure is due to nonlinear solver</span></div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;<span class="comment">C     or error test</span></div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;      <span class="keywordflow">IF</span>(iernls .EQ. 0)<span class="keywordflow">GO TO</span> 660</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;      iwm(lcfn)=iwm(lcfn)+1</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;<span class="comment">C     The nonlinear solver failed to converge.</span></div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;<span class="comment">C     Determine the cause of the failure and take appropriate action.</span></div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;<span class="comment">C     If IERNLS .LT. 0, then return.  Otherwise, reduce the stepsize</span></div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;<span class="comment">C     and try again, unless too many failures have occurred.</span></div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;      <span class="keywordflow">IF</span> (iernls .LT. 0) <span class="keywordflow">GO TO</span> 675</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;      ncf = ncf + 1</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;      r = 0.25d0</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;      h = h*r</div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;      <span class="keywordflow">IF</span> (ncf .LT. 10 .AND. abs(h) .GE. hmin) <span class="keywordflow">GO TO</span> 690</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;      <span class="keywordflow">IF</span> (idid .EQ. 1) idid = -7</div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;      <span class="keywordflow">IF</span> (nef .GE. 3) idid = -9</div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      <span class="keywordflow">GO TO</span> 675</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;<span class="comment">C     The nonlinear solver converged, and the cause</span></div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;<span class="comment">C     of the failure was the error estimate</span></div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;<span class="comment">C     exceeding the tolerance.</span></div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;660   nef=nef+1</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;      iwm(letf)=iwm(letf)+1</div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;      <span class="keywordflow">IF</span> (nef .GT. 1) <span class="keywordflow">GO TO</span> 665</div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;<span class="comment">C     On first error test failure, keep current order or lower</span></div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;<span class="comment">C     order by one.  Compute new stepsize based on differences</span></div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;<span class="comment">C     of the solution.</span></div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;      <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a> = knew</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;      temp2 = <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a> + 1</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;      r = 0.90d0*(2.0d0*est+0.0001d0)**(-1.0d0/temp2)</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;      r = <a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(0.25d0,min(0.9d0,r))</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;      h = h*r</div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;      <span class="keywordflow">IF</span> (abs(h) .GE. hmin) <span class="keywordflow">GO TO</span> 690</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;      idid = -6</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;      <span class="keywordflow">GO TO</span> 675</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;<span class="comment">C     On second error test failure, use the current order or</span></div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;<span class="comment">C     decrease order by one.  Reduce the stepsize by a factor of</span></div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;<span class="comment">C     one quarter.</span></div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;665   <span class="keywordflow">IF</span> (nef .GT. 2) <span class="keywordflow">GO TO</span> 670</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;      <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a> = knew</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;      r = 0.25d0</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;      h = r*h</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;      <span class="keywordflow">IF</span> (abs(h) .GE. hmin) <span class="keywordflow">GO TO</span> 690</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;      idid = -6</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;      <span class="keywordflow">GO TO</span> 675</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;<span class="comment">C     On third and subsequent error test failures, set the order to</span></div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;<span class="comment">C     one, and reduce the stepsize by a factor of one quarter.</span></div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;670   <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a> = 1</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;      r = 0.25d0</div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;      h = r*h</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;      <span class="keywordflow">IF</span> (abs(h) .GE. hmin) <span class="keywordflow">GO TO</span> 690</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;      idid = -6</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;      <span class="keywordflow">GO TO</span> 675</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;<span class="comment">C     For all crashes, restore Y to its last value,</span></div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;<span class="comment">C     interpolate to find YPRIME at last X, and return.</span></div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;<span class="comment">C     Before returning, verify that the user has not set</span></div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;<span class="comment">C     IDID to a nonnegative value.  If the user has set IDID</span></div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;<span class="comment">C     to a nonnegative value, then reset IDID to be -7, indicating</span></div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;<span class="comment">C     a failure in the nonlinear system solver.</span></div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;675   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>,phi,psi)</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;      jstart = 1</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;      <span class="keywordflow">IF</span> (idid .GE. 0) idid = -7</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;<span class="comment">C     Go back and try this step again.  </span></div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;<span class="comment">C     If this is the first step, reset PSI(1) and rescale PHI(*,2).</span></div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;690   <span class="keywordflow">IF</span> (kold .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;        psi(1) = h</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;        <span class="keywordflow">DO</span> 695 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;695       phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,2) = r*phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,2)</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;      <span class="keywordflow">GO TO</span> 200</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;<span class="comment">C------END OF SUBROUTINE DDSTP------------------------------------------</span></div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aae25a5609da387e4f1d6b45800ad6a36">dcnstr</a> (NEQ, Y, YNEW, ICNSTR, TAU, RLX, IRET, IVAR)</div><div class="line"><a name="l03594"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#aae25a5609da387e4f1d6b45800ad6a36"> 3594</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DCNSTR</span></div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;<span class="comment">C***DATE WRITTEN   950808   (YYMMDD)</span></div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;<span class="comment">C***REVISION DATE  950814   (YYMMDD)</span></div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;<span class="comment">C This subroutine checks for constraint violations in the proposed </span></div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;<span class="comment">C new approximate solution YNEW.</span></div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;<span class="comment">C If a constraint violation occurs, then a new step length, TAU,</span></div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;<span class="comment">C is calculated, and this value is to be given to the linesearch routine</span></div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;<span class="comment">C to calculate a new approximate solution YNEW.</span></div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;<span class="comment">C On entry:</span></div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;<span class="comment">C   NEQ    -- size of the nonlinear system, and the length of arrays</span></div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;<span class="comment">C             Y, YNEW and ICNSTR.</span></div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;<span class="comment">C   Y      -- real array containing the current approximate y.</span></div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;<span class="comment">C   YNEW   -- real array containing the new approximate y.</span></div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;<span class="comment">C   ICNSTR -- INTEGER array of length NEQ containing flags indicating</span></div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;<span class="comment">C             which entries in YNEW are to be constrained.</span></div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;<span class="comment">C             if ICNSTR(I) =  2, then YNEW(I) must be .GT. 0,</span></div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;<span class="comment">C             if ICNSTR(I) =  1, then YNEW(I) must be .GE. 0,</span></div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;<span class="comment">C             if ICNSTR(I) = -1, then YNEW(I) must be .LE. 0, while</span></div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;<span class="comment">C             if ICNSTR(I) = -2, then YNEW(I) must be .LT. 0, while</span></div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;<span class="comment">C             if ICNSTR(I) =  0, then YNEW(I) is not constrained.</span></div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;<span class="comment">C   RLX    -- real scalar restricting update, if ICNSTR(I) = 2 or -2,</span></div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;<span class="comment">C             to ABS( (YNEW-Y)/Y ) &lt; FAC2*RLX in component I.</span></div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;<span class="comment">C   TAU    -- the current size of the step length for the linesearch.</span></div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;<span class="comment">C On return</span></div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;<span class="comment">C   TAU    -- the adjusted size of the step length if a constraint</span></div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;<span class="comment">C             violation occurred (otherwise, it is unchanged).  it is</span></div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;<span class="comment">C             the step length to give to the linesearch routine.</span></div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;<span class="comment">C   IRET   -- output flag.</span></div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;<span class="comment">C             IRET=0 means that YNEW satisfied all constraints.</span></div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;<span class="comment">C             IRET=1 means that YNEW failed to satisfy all the</span></div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;<span class="comment">C                    constraints, and a new linesearch step</span></div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;<span class="comment">C                    must be computed.</span></div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;<span class="comment">C   IVAR   -- index of variable causing constraint to be violated.</span></div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(neq), ynew(neq), icnstr(neq)</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;      <span class="keywordtype">SAVE</span> fac, fac2, zero</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;      <span class="keyword">DATA</span> fac /0.6d0/, fac2 /0.9d0/, zero/0.0d0/</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;<span class="comment">C Check constraints for proposed new step YNEW.  If a constraint has</span></div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;<span class="comment">C been violated, then calculate a new step length, TAU, to be</span></div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;<span class="comment">C used in the linesearch routine.</span></div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;      iret = 0</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;      rdymx = zero</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;      ivar = 0</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;      <span class="keywordflow">DO</span> 100 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;         <span class="keywordflow">IF</span> (icnstr(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .EQ. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;            rdy = abs( (ynew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)-<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>))/<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) )</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;            <span class="keywordflow">IF</span> (rdy .GT. rdymx) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;               rdymx = rdy</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;               ivar = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;            <span class="keywordflow">IF</span> (ynew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .LE. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;               tau = fac*tau</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;               ivar = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;               iret = 1</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;               <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;         <span class="keywordflow">ELSEIF</span> (icnstr(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;            <span class="keywordflow">IF</span> (ynew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .LT. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;               tau = fac*tau</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;               ivar = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;               iret = 1</div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;               <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;         <span class="keywordflow">ELSEIF</span> (icnstr(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .EQ. -1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;            <span class="keywordflow">IF</span> (ynew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .GT. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;               tau = fac*tau</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;               ivar = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;               iret = 1</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;               <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;         <span class="keywordflow">ELSEIF</span> (icnstr(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .EQ. -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;            rdy = abs( (ynew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)-<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>))/<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) )</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;            <span class="keywordflow">IF</span> (rdy .GT. rdymx) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;               rdymx = rdy</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;               ivar = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;            <span class="keywordflow">IF</span> (ynew(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .GE. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;               tau = fac*tau</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;               ivar = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;               iret = 1</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;               <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160; 100  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;      <span class="keywordflow">IF</span>(rdymx .GE. rlx) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;         tau = fac2*tau*rlx/rdymx</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;         iret = 1</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;<span class="comment">C----------------------- END OF SUBROUTINE DCNSTR ----------------------</span></div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aecac7c4590bc02e577bdce5e6a4b5e01">dcnst0</a> (NEQ, Y, ICNSTR, IRET)</div><div class="line"><a name="l03714"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#aecac7c4590bc02e577bdce5e6a4b5e01"> 3714</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DCNST0</span></div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;<span class="comment">C***DATE WRITTEN   950808   (YYMMDD)</span></div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;<span class="comment">C***REVISION DATE  950808   (YYMMDD)</span></div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;<span class="comment">C This subroutine checks for constraint violations in the initial </span></div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;<span class="comment">C approximate solution u.</span></div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;<span class="comment">C On entry</span></div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;<span class="comment">C   NEQ    -- size of the nonlinear system, and the length of arrays</span></div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;<span class="comment">C             Y and ICNSTR.</span></div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;<span class="comment">C   Y      -- real array containing the initial approximate root.</span></div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;<span class="comment">C   ICNSTR -- INTEGER array of length NEQ containing flags indicating</span></div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;<span class="comment">C             which entries in Y are to be constrained.</span></div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;<span class="comment">C             if ICNSTR(I) =  2, then Y(I) must be .GT. 0,</span></div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;<span class="comment">C             if ICNSTR(I) =  1, then Y(I) must be .GE. 0,</span></div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;<span class="comment">C             if ICNSTR(I) = -1, then Y(I) must be .LE. 0, while</span></div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;<span class="comment">C             if ICNSTR(I) = -2, then Y(I) must be .LT. 0, while</span></div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;<span class="comment">C             if ICNSTR(I) =  0, then Y(I) is not constrained.</span></div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;<span class="comment">C On return</span></div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;<span class="comment">C   IRET   -- output flag.</span></div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;<span class="comment">C             IRET=0    means that u satisfied all constraints.</span></div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;<span class="comment">C             IRET.NE.0 means that Y(IRET) failed to satisfy its</span></div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;<span class="comment">C                       constraint.</span></div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(neq), icnstr(neq)</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;      <span class="keywordtype">SAVE</span> zero</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;      <span class="keyword">DATA</span> zero/0.d0/</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;<span class="comment">C Check constraints for initial Y.  If a constraint has been violated,</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;<span class="comment">C set IRET = I to signal an error return to calling routine.</span></div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;      iret = 0</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;      <span class="keywordflow">DO</span> 100 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;         <span class="keywordflow">IF</span> (icnstr(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .EQ. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .LE. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;               iret = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;               <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;         <span class="keywordflow">ELSEIF</span> (icnstr(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .LT. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;               iret = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;               <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;<span class="keywordflow">            ENDIF</span> </div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;         <span class="keywordflow">ELSEIF</span> (icnstr(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .EQ. -1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .GT. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;               iret = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;               <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;<span class="keywordflow">            ENDIF</span> </div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;         <span class="keywordflow">ELSEIF</span> (icnstr(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .EQ. -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .GE. zero) <span class="keywordflow">THEN</span></div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;               iret = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;               <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;<span class="keywordflow">            ENDIF</span> </div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160; 100  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;<span class="comment">C----------------------- END OF SUBROUTINE DCNST0 ----------------------</span></div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ad9040cc861842aba0f0355141036751a">ddawts</a>(NEQ,IWT,RTOL,ATOL,Y,WT,RPAR,IPAR)</div><div class="line"><a name="l03785"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#ad9040cc861842aba0f0355141036751a"> 3785</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DDAWTS</span></div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;<span class="comment">C***ROUTINES CALLED  (NONE)</span></div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;<span class="comment">C***END PROLOGUE  DDAWTS</span></div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;<span class="comment">C     This subroutine sets the error weight vector,</span></div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;<span class="comment">C     WT, according to WT(I)=RTOL(I)*ABS(Y(I))+ATOL(I),</span></div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;<span class="comment">C     I = 1 to NEQ.</span></div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;<span class="comment">C     RTOL and ATOL are scalars if IWT = 0,</span></div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;<span class="comment">C     and vectors if IWT = 1.</span></div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;      dimension rtol(*),atol(*),<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),wt(*)</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;      dimension rpar(*),ipar(*)</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;      rtoli=rtol(1)</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;      atoli=atol(1)</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;      <span class="keywordflow">DO</span> 20 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;         <span class="keywordflow">IF</span> (iwt .EQ.0) <span class="keywordflow">GO TO</span> 10</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;           rtoli=rtol(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;           atoli=atol(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;10         wt(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=rtoli*abs(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>))+atoli</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;20         <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;<span class="comment">C------END OF SUBROUTINE DDAWTS-----------------------------------------</span></div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a4b3830d1e4be0d1908b1fef21358fea0">dinvwt</a>(NEQ,WT,IER)</div><div class="line"><a name="l03816"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a4b3830d1e4be0d1908b1fef21358fea0"> 3816</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DINVWT</span></div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;<span class="comment">C***ROUTINES CALLED  (NONE)</span></div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;<span class="comment">C***DATE WRITTEN   950125   (YYMMDD)</span></div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;<span class="comment">C***END PROLOGUE  DINVWT</span></div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;<span class="comment">C     This subroutine checks the error weight vector WT, of length NEQ,</span></div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;<span class="comment">C     for components that are .le. 0, and if none are found, it</span></div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;<span class="comment">C     inverts the WT(I) in place.  This replaces division operations</span></div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;<span class="comment">C     with multiplications in all norm evaluations.</span></div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;<span class="comment">C     IER is returned as 0 if all WT(I) were found positive,</span></div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;<span class="comment">C     and the first I with WT(I) .le. 0.0 otherwise.</span></div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;      dimension wt(*)</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;      <span class="keywordflow">DO</span> 10 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;        <span class="keywordflow">IF</span> (wt(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) .LE. 0.0d0) <span class="keywordflow">GO TO</span> 30</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160; 10     <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;      <span class="keywordflow">DO</span> 20 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160; 20     wt(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = 1.0d0/wt(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;      ier = 0</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160; 30   ier = <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;<span class="comment">C------END OF SUBROUTINE DINVWT-----------------------------------------</span></div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a>(X,XOUT,YOUT,YPOUT,NEQ,KOLD,PHI,PSI)</div><div class="line"><a name="l03848"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1"> 3848</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DDATRP</span></div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;<span class="comment">C***ROUTINES CALLED  (NONE)</span></div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;<span class="comment">C***END PROLOGUE  DDATRP</span></div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;<span class="comment">C     The methods in subroutine DDSTP use polynomials</span></div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;<span class="comment">C     to approximate the solution.  DDATRP approximates the</span></div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;<span class="comment">C     solution and its derivative at time XOUT by evaluating</span></div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;<span class="comment">C     one of these polynomials, and its derivative, there.</span></div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;<span class="comment">C     Information defining this polynomial is passed from</span></div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;<span class="comment">C     DDSTP, so DDATRP cannot be used alone.</span></div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;<span class="comment">C     The parameters are</span></div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;<span class="comment">C     X     The current time in the integration.</span></div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;<span class="comment">C     XOUT  The time at which the solution is desired.</span></div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;<span class="comment">C     YOUT  The interpolated approximation to Y at XOUT.</span></div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;<span class="comment">C           (This is output.)</span></div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;<span class="comment">C     YPOUT The interpolated approximation to YPRIME at XOUT.</span></div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;<span class="comment">C           (This is output.)</span></div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;<span class="comment">C     NEQ   Number of equations.</span></div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;<span class="comment">C     KOLD  Order used on last successful step.</span></div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;<span class="comment">C     PHI   Array of scaled divided differences of Y.</span></div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;<span class="comment">C     PSI   Array of past stepsize history.</span></div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;      dimension yout(*),ypout(*)</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;      dimension phi(neq,*),psi(*)</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;      koldp1=kold+1</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;      temp1=xout-<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a></div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;      <span class="keywordflow">DO</span> 10 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;         yout(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,1)</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;10       ypout(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=0.0d0</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;      <a class="code" href="../../da/d6c/group__jm__vector.html#ga176bdff3633e513abe39f23d6539eb9a">c</a>=1.0d0</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;      <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a>=0.0d0</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;      gamma=temp1/psi(1)</div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;      <span class="keywordflow">DO</span> 30 <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>=2,koldp1</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;         <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a>=<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a>*gamma+<a class="code" href="../../da/d6c/group__jm__vector.html#ga176bdff3633e513abe39f23d6539eb9a">c</a>/psi(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>-1)</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;         <a class="code" href="../../da/d6c/group__jm__vector.html#ga176bdff3633e513abe39f23d6539eb9a">c</a>=<a class="code" href="../../da/d6c/group__jm__vector.html#ga176bdff3633e513abe39f23d6539eb9a">c</a>*gamma</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;         gamma=(temp1+psi(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>-1))/psi(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;         <span class="keywordflow">DO</span> 20 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;            yout(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=yout(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)+<a class="code" href="../../da/d6c/group__jm__vector.html#ga176bdff3633e513abe39f23d6539eb9a">c</a>*phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;20          ypout(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=ypout(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a>*phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;30       <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;<span class="comment">C------END OF SUBROUTINE DDATRP-----------------------------------------</span></div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;<span class="keyword">      DOUBLE PRECISION </span><span class="keyword">FUNCTION </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(NEQ,V,RWT,RPAR,IPAR)</div><div class="line"><a name="l03902"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff"> 3902</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DDWNRM</span></div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;<span class="comment">C***ROUTINES CALLED  (NONE)</span></div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;<span class="comment">C***END PROLOGUE  DDWNRM</span></div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;<span class="comment">C     This function routine computes the weighted</span></div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;<span class="comment">C     root-mean-square norm of the vector of length</span></div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;<span class="comment">C     NEQ contained in the array V, with reciprocal weights</span></div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;<span class="comment">C     contained in the array RWT of length NEQ.</span></div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;<span class="comment">C        DDWNRM=SQRT((1/NEQ)*SUM(V(I)*RWT(I))**2)</span></div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;      dimension <a class="code" href="../../da/d6c/group__jm__vector.html#ga8603782009ff58be0587ea58013b3e52">v</a>(*),rwt(*)</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;      dimension rpar(*),ipar(*)</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;      <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a> = 0.0d0</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;      vmax = 0.0d0</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;      <span class="keywordflow">DO</span> 10 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;        <span class="keywordflow">IF</span>(abs(<a class="code" href="../../da/d6c/group__jm__vector.html#ga8603782009ff58be0587ea58013b3e52">v</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)*rwt(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)) .GT. vmax) vmax = abs(<a class="code" href="../../da/d6c/group__jm__vector.html#ga8603782009ff58be0587ea58013b3e52">v</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)*rwt(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;10    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;      <span class="keywordflow">IF</span>(vmax .LE. 0.0d0) <span class="keywordflow">GO TO</span> 30</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;      sum = 0.0d0</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;      <span class="keywordflow">DO</span> 20 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;20      sum = sum + ((<a class="code" href="../../da/d6c/group__jm__vector.html#ga8603782009ff58be0587ea58013b3e52">v</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)*rwt(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>))/vmax)**2</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;      <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a> = vmax*sqrt(sum/neq)</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;30    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;<span class="comment">C------END OF FUNCTION DDWNRM-------------------------------------------</span></div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ab02b6e2207645c9bc72492d45e3a4f0b">ddasid</a>(X,Y,YPRIME,NEQ,ICOPT,ID,RES,JACD,PDUM,H,TSCALE,</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;     *  WT,JSDUM,RPAR,IPAR,DUMSVR,DELTA,R,YIC,YPIC,DUMPWK,WM,IWM,CJ,</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;     *  UROUND,DUME,DUMS,DUMR,EPCON,RATEMX,STPTOL,JFDUM,</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;     *  ICNFLG,ICNSTR,IERNLS)</div><div class="line"><a name="l03938"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#ab02b6e2207645c9bc72492d45e3a4f0b"> 3938</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DDASID</span></div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;<span class="comment">C***DATE WRITTEN   940701   (YYMMDD)</span></div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;<span class="comment">C***REVISION DATE  950808   (YYMMDD)</span></div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;<span class="comment">C***REVISION DATE  951110   Removed unreachable block 390.</span></div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;<span class="comment">C***REVISION DATE  000628   TSCALE argument added.</span></div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;<span class="comment">C     DDASID solves a nonlinear system of algebraic equations of the</span></div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;<span class="comment">C     form G(X,Y,YPRIME) = 0 for the unknown parts of Y and YPRIME in</span></div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;<span class="comment">C     the initial conditions.</span></div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;<span class="comment">C     The method used is a modified Newton scheme.</span></div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;<span class="comment">C     The parameters represent</span></div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;<span class="comment">C     X         -- Independent variable.</span></div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;<span class="comment">C     Y         -- Solution vector.</span></div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;<span class="comment">C     YPRIME    -- Derivative of solution vector.</span></div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;<span class="comment">C     NEQ       -- Number of unknowns.</span></div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;<span class="comment">C     ICOPT     -- Initial condition option chosen (1 or 2).</span></div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;<span class="comment">C     ID        -- Array of dimension NEQ, which must be initialized</span></div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;<span class="comment">C                  if ICOPT = 1.  See DDASIC.</span></div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;<span class="comment">C     RES       -- External user-supplied subroutine to evaluate the</span></div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;<span class="comment">C                  residual.  See RES description in DDASPK prologue.</span></div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;<span class="comment">C     JACD      -- External user-supplied routine to evaluate the</span></div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;<span class="comment">C                  Jacobian.  See JAC description for the case</span></div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;<span class="comment">C                  INFO(12) = 0 in the DDASPK prologue.</span></div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;<span class="comment">C     PDUM      -- Dummy argument.</span></div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;<span class="comment">C     H         -- Scaling factor for this initial condition calc.</span></div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;<span class="comment">C     TSCALE    -- Scale factor in T, used for stopping tests if nonzero.</span></div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;<span class="comment">C     WT        -- Vector of weights for error criterion.</span></div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;<span class="comment">C     JSDUM     -- Dummy argument.</span></div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;<span class="comment">C     RPAR,IPAR -- Real and integer arrays used for communication</span></div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;<span class="comment">C                  between the calling program and external user</span></div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;<span class="comment">C                  routines.  They are not altered within DASPK.</span></div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;<span class="comment">C     DUMSVR    -- Dummy argument.</span></div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;<span class="comment">C     DELTA     -- Work vector for NLS of length NEQ.</span></div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;<span class="comment">C     R         -- Work vector for NLS of length NEQ.</span></div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;<span class="comment">C     YIC,YPIC  -- Work vectors for NLS, each of length NEQ.</span></div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;<span class="comment">C     DUMPWK    -- Dummy argument.</span></div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;<span class="comment">C     WM,IWM    -- Real and integer arrays storing matrix information</span></div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;<span class="comment">C                  such as the matrix of partial derivatives,</span></div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;<span class="comment">C                  permutation vector, and various other information.</span></div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;<span class="comment">C     CJ        -- Matrix parameter = 1/H (ICOPT = 1) or 0 (ICOPT = 2).</span></div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;<span class="comment">C     UROUND    -- Unit roundoff.</span></div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;<span class="comment">C     DUME      -- Dummy argument.</span></div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;<span class="comment">C     DUMS      -- Dummy argument.</span></div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;<span class="comment">C     DUMR      -- Dummy argument.</span></div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;<span class="comment">C     EPCON     -- Tolerance to test for convergence of the Newton</span></div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;<span class="comment">C                  iteration.</span></div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;<span class="comment">C     RATEMX    -- Maximum convergence rate for which Newton iteration</span></div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;<span class="comment">C                  is considered converging.</span></div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;<span class="comment">C     JFDUM     -- Dummy argument.</span></div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;<span class="comment">C     STPTOL    -- Tolerance used in calculating the minimum lambda</span></div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;<span class="comment">C                  value allowed.</span></div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;<span class="comment">C     ICNFLG    -- Integer scalar.  If nonzero, then constraint</span></div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;<span class="comment">C                  violations in the proposed new approximate solution</span></div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;<span class="comment">C                  will be checked for, and the maximum step length </span></div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;<span class="comment">C                  will be adjusted accordingly.</span></div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;<span class="comment">C     ICNSTR    -- Integer array of length NEQ containing flags for</span></div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;<span class="comment">C                  checking constraints.</span></div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;<span class="comment">C     IERNLS    -- Error flag for nonlinear solver.</span></div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;<span class="comment">C                   0   ==&gt; nonlinear solver converged.</span></div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;<span class="comment">C                   1,2 ==&gt; recoverable error inside nonlinear solver.</span></div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;<span class="comment">C                           1 =&gt; retry with current Y, YPRIME</span></div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;<span class="comment">C                           2 =&gt; retry with original Y, YPRIME</span></div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;<span class="comment">C                  -1   ==&gt; unrecoverable error in nonlinear solver.</span></div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;<span class="comment">C     All variables with &quot;DUM&quot; in their names are dummy variables</span></div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;<span class="comment">C     which are not used in this routine.</span></div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;<span class="comment">C   RES, DMATD, DNSID</span></div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;<span class="comment">C***END PROLOGUE  DDASID</span></div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),id(*),wt(*),icnstr(*)</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;      dimension delta(*),r(*),yic(*),ypic(*)</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;      dimension wm(*),iwm(*), rpar(*),ipar(*)</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, jacd</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;      parameter(lnre=12, lnje=13, lmxnit=32, lmxnj=33)</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;<span class="comment">C     Perform initializations.</span></div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;      mxnit = iwm(lmxnit)</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;      mxnj = iwm(lmxnj)</div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;      iernls = 0</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;      nj = 0</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;<span class="comment">C     Call RES to initialize DELTA.</span></div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;      ires = 0</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;      iwm(lnre) = iwm(lnre) + 1</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;      <span class="keyword">CALL </span>res(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,delta,ires,rpar,ipar)</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;      <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">GO TO</span> 370</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;<span class="comment">C     Looping point for updating the Jacobian.</span></div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;300   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;<span class="comment">C     Initialize all error flags to zero.</span></div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;      ierj = 0</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;      ires = 0</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;      iernew = 0</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;<span class="comment">C     Reevaluate the iteration matrix, J = dG/dY + CJ*dG/dYPRIME,</span></div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;<span class="comment">C     where G(X,Y,YPRIME) = 0.</span></div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;      nj = nj + 1</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;      iwm(lnje)=iwm(lnje)+1</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a5886c909d03a151adbd71cd4ad2b6acc">dmatd</a>(neq,<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,delta,cj,h,ierj,wt,r,</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;     *              wm,iwm,res,ires,uround,jacd,rpar,ipar)</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;      <span class="keywordflow">IF</span> (ires .LT. 0 .OR. ierj .NE. 0) <span class="keywordflow">GO TO</span> 370</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;<span class="comment">C     Call the nonlinear Newton solver for up to MXNIT iterations.</span></div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a01211e37451eb96acbc775a4f8050656">dnsid</a>(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,icopt,id,res,wt,rpar,ipar,delta,r,</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;     *     yic,ypic,wm,iwm,cj,tscale,epcon,ratemx,mxnit,stptol,</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;     *     icnflg,icnstr,iernew)</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;      <span class="keywordflow">IF</span> (iernew .EQ. 1 .AND. nj .LT. mxnj) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;<span class="comment">C        MXNIT iterations were done, the convergence rate is &lt; 1,</span></div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;<span class="comment">C        and the number of Jacobian evaluations is less than MXNJ.</span></div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;<span class="comment">C        Call RES, reevaluate the Jacobian, and try again.</span></div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;         iwm(lnre)=iwm(lnre)+1</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;         <span class="keyword">CALL </span>res(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,delta,ires,rpar,ipar)</div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;         <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">GO TO</span> 370</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;         <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;      <span class="keywordflow">IF</span> (iernew .NE. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;<span class="comment">C     Unsuccessful exits from nonlinear solver.</span></div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;<span class="comment">C     Compute IERNLS accordingly.</span></div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;370   iernls = 2</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;      <span class="keywordflow">IF</span> (ires .LE. -2) iernls = -1</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;380   iernls = min(iernew,2)</div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;<span class="comment">C------END OF SUBROUTINE DDASID-----------------------------------------</span></div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a01211e37451eb96acbc775a4f8050656">dnsid</a>(X,Y,YPRIME,NEQ,ICOPT,ID,RES,WT,RPAR,IPAR,</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;     *   DELTA,R,YIC,YPIC,WM,IWM,CJ,TSCALE,EPCON,RATEMX,MAXIT,STPTOL,</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;     *   ICNFLG,ICNSTR,IERNEW)</div><div class="line"><a name="l04103"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a01211e37451eb96acbc775a4f8050656"> 4103</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DNSID</span></div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;<span class="comment">C***DATE WRITTEN   940701   (YYMMDD)</span></div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;<span class="comment">C***REVISION DATE  950713   (YYMMDD)</span></div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;<span class="comment">C***REVISION DATE  000628   TSCALE argument added.</span></div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;<span class="comment">C     DNSID solves a nonlinear system of algebraic equations of the</span></div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;<span class="comment">C     form G(X,Y,YPRIME) = 0 for the unknown parts of Y and YPRIME</span></div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;<span class="comment">C     in the initial conditions.</span></div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;<span class="comment">C     The method used is a modified Newton scheme.</span></div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;<span class="comment">C     The parameters represent</span></div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;<span class="comment">C     X         -- Independent variable.</span></div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;<span class="comment">C     Y         -- Solution vector.</span></div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;<span class="comment">C     YPRIME    -- Derivative of solution vector.</span></div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;<span class="comment">C     NEQ       -- Number of unknowns.</span></div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;<span class="comment">C     ICOPT     -- Initial condition option chosen (1 or 2).</span></div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;<span class="comment">C     ID        -- Array of dimension NEQ, which must be initialized</span></div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;<span class="comment">C                  if ICOPT = 1.  See DDASIC.</span></div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;<span class="comment">C     RES       -- External user-supplied subroutine to evaluate the</span></div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;<span class="comment">C                  residual.  See RES description in DDASPK prologue.</span></div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;<span class="comment">C     WT        -- Vector of weights for error criterion.</span></div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;<span class="comment">C     RPAR,IPAR -- Real and integer arrays used for communication</span></div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;<span class="comment">C                  between the calling program and external user</span></div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;<span class="comment">C                  routines.  They are not altered within DASPK.</span></div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;<span class="comment">C     DELTA     -- Residual vector on entry, and work vector of</span></div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;<span class="comment">C                  length NEQ for DNSID.</span></div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;<span class="comment">C     WM,IWM    -- Real and integer arrays storing matrix information</span></div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;<span class="comment">C                  such as the matrix of partial derivatives,</span></div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;<span class="comment">C                  permutation vector, and various other information.</span></div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;<span class="comment">C     CJ        -- Matrix parameter = 1/H (ICOPT = 1) or 0 (ICOPT = 2).</span></div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;<span class="comment">C     TSCALE    -- Scale factor in T, used for stopping tests if nonzero.</span></div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;<span class="comment">C     R         -- Array of length NEQ used as workspace by the </span></div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;<span class="comment">C                  linesearch routine DLINSD.</span></div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;<span class="comment">C     YIC,YPIC  -- Work vectors for DLINSD, each of length NEQ.</span></div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;<span class="comment">C     EPCON     -- Tolerance to test for convergence of the Newton</span></div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;<span class="comment">C                  iteration.</span></div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;<span class="comment">C     RATEMX    -- Maximum convergence rate for which Newton iteration</span></div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;<span class="comment">C                  is considered converging.</span></div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;<span class="comment">C     MAXIT     -- Maximum allowed number of Newton iterations.</span></div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;<span class="comment">C     STPTOL    -- Tolerance used in calculating the minimum lambda</span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;<span class="comment">C                  value allowed.</span></div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;<span class="comment">C     ICNFLG    -- Integer scalar.  If nonzero, then constraint</span></div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;<span class="comment">C                  violations in the proposed new approximate solution</span></div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;<span class="comment">C                  will be checked for, and the maximum step length </span></div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;<span class="comment">C                  will be adjusted accordingly.</span></div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;<span class="comment">C     ICNSTR    -- Integer array of length NEQ containing flags for</span></div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;<span class="comment">C                  checking constraints.</span></div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;<span class="comment">C     IERNEW    -- Error flag for Newton iteration.</span></div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;<span class="comment">C                   0  ==&gt; Newton iteration converged.</span></div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;<span class="comment">C                   1  ==&gt; failed to converge, but RATE .le. RATEMX.</span></div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;<span class="comment">C                   2  ==&gt; failed to converge, RATE .gt. RATEMX.</span></div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;<span class="comment">C                   3  ==&gt; other recoverable error (IRES = -1, or</span></div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;<span class="comment">C                          linesearch failed).</span></div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;<span class="comment">C                  -1  ==&gt; unrecoverable error (IRES = -2).</span></div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;<span class="comment">C   DSLVD, DDWNRM, DLINSD, DCOPY</span></div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;<span class="comment">C***END PROLOGUE  DNSID</span></div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),wt(*),r(*)</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;      dimension id(*),delta(*), yic(*), ypic(*)</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;      dimension wm(*),iwm(*), rpar(*),ipar(*)</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;      dimension icnstr(*)</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;      parameter(lnni=19, llsoff=35)</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;<span class="comment">C     Initializations.  M is the Newton iteration counter.</span></div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;      lsoff = iwm(llsoff)</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;      <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> = 0</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;      rate = 1.0d0</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;      rlx = 0.4d0</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;<span class="comment">C     Compute a new step vector DELTA by back-substitution.</span></div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a38468e6725b8b823437ef7bd24f68562">dslvd</a> (neq, delta, wm, iwm)</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;<span class="comment">C     Get norm of DELTA.  Return now if norm(DELTA) .le. EPCON.</span></div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;      delnrm = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,delta,wt,rpar,ipar)</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;      fnrm = delnrm</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;      <span class="keywordflow">IF</span> (tscale .GT. 0.0d0) fnrm = fnrm*tscale*abs(cj)</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;      <span class="keywordflow">IF</span> (fnrm .LE. epcon) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;<span class="comment">C     Newton iteration loop.</span></div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160; 300  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;      iwm(lnni) = iwm(lnni) + 1</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;<span class="comment">C     Call linesearch routine for global strategy and set RATE</span></div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;      oldfnm = fnrm</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ad184a6189ad51773ff6944b1ac015d06">dlinsd</a> (neq, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, <a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>, yprime, cj, tscale, delta, delnrm, wt,</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;     *             lsoff, stptol, iret, res, ires, wm, iwm, fnrm, icopt,</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;     *             id, r, yic, ypic, icnflg, icnstr, rlx, rpar, ipar)</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;      rate = fnrm/oldfnm</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;<span class="comment">C     Check for error condition from linesearch.</span></div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;      <span class="keywordflow">IF</span> (iret .NE. 0) <span class="keywordflow">GO TO</span> 390</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;<span class="comment">C     Test for convergence of the iteration, and return or loop.</span></div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;      <span class="keywordflow">IF</span> (fnrm .LE. epcon) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;<span class="comment">C     The iteration has not yet converged.  Update M.</span></div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;<span class="comment">C     Test whether the maximum number of iterations have been tried.</span></div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;      <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> = <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> + 1</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> .GE. maxit) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;<span class="comment">C     Copy the residual to DELTA and its norm to DELNRM, and loop for</span></div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;<span class="comment">C     another iteration.</span></div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, r, 1, delta, 1)</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;      delnrm = fnrm      </div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;      <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;<span class="comment">C     The maximum number of iterations was done.  Set IERNEW and return.</span></div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160; 380  <span class="keywordflow">IF</span> (rate .LE. ratemx) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;         iernew = 1</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;         iernew = 2</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160; 390  <span class="keywordflow">IF</span> (ires .LE. -2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;         iernew = -1</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;         iernew = 3</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;<span class="comment">C------END OF SUBROUTINE DNSID------------------------------------------</span></div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ad184a6189ad51773ff6944b1ac015d06">dlinsd</a> (NEQ, Y, T, YPRIME, CJ, TSCALE, P, PNRM, WT,</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;     *                   LSOFF, STPTOL, IRET, RES, IRES, WM, IWM,</div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;     *                   FNRM, ICOPT, ID, R, YNEW, YPNEW, ICNFLG,</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;     *                   ICNSTR, RLX, RPAR, IPAR)</div><div class="line"><a name="l04260"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#ad184a6189ad51773ff6944b1ac015d06"> 4260</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DLINSD</span></div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;<span class="comment">C***REFER TO  DNSID</span></div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;<span class="comment">C***DATE WRITTEN   941025   (YYMMDD)</span></div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;<span class="comment">C***REVISION DATE  941215   (YYMMDD)</span></div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;<span class="comment">C***REVISION DATE  960129   Moved line RL = ONE to top block.</span></div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;<span class="comment">C***REVISION DATE  000628   TSCALE argument added.</span></div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;<span class="comment">C     DLINSD uses a linesearch algorithm to calculate a new (Y,YPRIME)</span></div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;<span class="comment">C     pair (YNEW,YPNEW) such that </span></div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;<span class="comment">C     f(YNEW,YPNEW) .le. (1 - 2*ALPHA*RL)*f(Y,YPRIME) ,</span></div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;<span class="comment">C     where 0 &lt; RL &lt;= 1.  Here, f(y,y&#39;) is defined as</span></div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;<span class="comment">C      f(y,y&#39;) = (1/2)*norm( (J-inverse)*G(t,y,y&#39;) )**2 ,</span></div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;<span class="comment">C     where norm() is the weighted RMS vector norm, G is the DAE</span></div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;<span class="comment">C     system residual function, and J is the system iteration matrix</span></div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;<span class="comment">C     (Jacobian).</span></div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;<span class="comment">C     In addition to the parameters defined elsewhere, we have</span></div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;<span class="comment">C     TSCALE  --  Scale factor in T, used for stopping tests if nonzero.</span></div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;<span class="comment">C     P       -- Approximate Newton step used in backtracking.</span></div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;<span class="comment">C     PNRM    -- Weighted RMS norm of P.</span></div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;<span class="comment">C     LSOFF   -- Flag showing whether the linesearch algorithm is</span></div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;<span class="comment">C                to be invoked.  0 means do the linesearch, and</span></div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;<span class="comment">C                1 means turn off linesearch.</span></div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;<span class="comment">C     STPTOL  -- Tolerance used in calculating the minimum lambda</span></div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;<span class="comment">C                value allowed.</span></div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;<span class="comment">C     ICNFLG  -- Integer scalar.  If nonzero, then constraint violations</span></div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;<span class="comment">C                in the proposed new approximate solution will be</span></div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;<span class="comment">C                checked for, and the maximum step length will be</span></div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;<span class="comment">C                adjusted accordingly.</span></div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;<span class="comment">C     ICNSTR  -- Integer array of length NEQ containing flags for</span></div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;<span class="comment">C                checking constraints.</span></div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;<span class="comment">C     RLX     -- Real scalar restricting update size in DCNSTR.</span></div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;<span class="comment">C     YNEW    -- Array of length NEQ used to hold the new Y in</span></div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;<span class="comment">C                performing the linesearch.</span></div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;<span class="comment">C     YPNEW   -- Array of length NEQ used to hold the new YPRIME in</span></div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;<span class="comment">C                performing the linesearch.</span></div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;<span class="comment">C     Y       -- Array of length NEQ containing the new Y (i.e.,=YNEW).</span></div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;<span class="comment">C     YPRIME  -- Array of length NEQ containing the new YPRIME </span></div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;<span class="comment">C                (i.e.,=YPNEW).</span></div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;<span class="comment">C     FNRM    -- Real scalar containing SQRT(2*f(Y,YPRIME)) for the</span></div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;<span class="comment">C                current (Y,YPRIME) on input and output.</span></div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;<span class="comment">C     R       -- Work array of length NEQ, containing the scaled </span></div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;<span class="comment">C                residual (J-inverse)*G(t,y,y&#39;) on return.</span></div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;<span class="comment">C     IRET    -- Return flag.</span></div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;<span class="comment">C                IRET=0 means that a satisfactory (Y,YPRIME) was found.</span></div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;<span class="comment">C                IRET=1 means that the routine failed to find a new</span></div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;<span class="comment">C                       (Y,YPRIME) that was sufficiently distinct from</span></div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;<span class="comment">C                       the current (Y,YPRIME) pair.</span></div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;<span class="comment">C                IRET=2 means IRES .ne. 0 from RES.</span></div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;<span class="comment">C   DFNRMD, DYYPNW, DCNSTR, DCOPY, XERRWD</span></div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;<span class="comment">C***END PROLOGUE  DLINSD</span></div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*), yprime(*), wt(*), r(*), id(*)</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;      dimension wm(*), iwm(*)</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;      dimension ynew(*), ypnew(*), <a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>(*), icnstr(*)</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;      dimension rpar(*), ipar(*)</div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;      <span class="keywordtype">CHARACTER</span> MSG*80</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;      parameter(lnre=12, lkprin=31)</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;      <span class="keywordtype">SAVE</span> <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>, one, two</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;      <span class="keyword">DATA</span> <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>/1.0<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a>-4/, one/1.0d0/, two/2.0d0/</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;      kprin=iwm(lkprin)</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;      f1nrm = (fnrm*fnrm)/two</div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;      ratio = one</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;      <span class="keywordflow">IF</span> (kprin .GE. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;        msg = <span class="stringliteral">&#39;------ IN ROUTINE DLINSD-- PNRM = (R1)&#39;</span></div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 38, 901, 0, 0, 0, 0, 1, pnrm, 0.0d0)</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;      tau = pnrm</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;      rl = one</div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;<span class="comment">C Check for violations of the constraints, if any are imposed.</span></div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;<span class="comment">C If any violations are found, the step vector P is rescaled, and the </span></div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;<span class="comment">C constraint check is repeated, until no violations are found.</span></div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;      <span class="keywordflow">IF</span> (icnflg .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160; 10      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a187e8c4e1cbbc063d8ba76ccef7bb89a">dyypnw</a> (neq,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,rl,<a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>,icopt,id,ynew,ypnew)</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aae25a5609da387e4f1d6b45800ad6a36">dcnstr</a> (neq, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, ynew, icnstr, tau, rlx, iret, ivar)</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;         <span class="keywordflow">IF</span> (iret .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;            ratio1 = tau/pnrm</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;            ratio = ratio*ratio1</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;            <span class="keywordflow">DO</span> 20 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160; 20           <a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)*ratio1</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;            pnrm = tau</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;            <span class="keywordflow">IF</span> (kprin .GE. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;              msg = <span class="stringliteral">&#39;------ CONSTRAINT VIOL., PNRM = (R1), INDEX = (I1)&#39;</span></div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;              <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 50, 902, 0, 1, ivar, 0, 1, pnrm, 0.0d0)</div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;<span class="keywordflow">              ENDIF</span></div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;            <span class="keywordflow">IF</span> (pnrm .LE. stptol) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;              iret = 1</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;              <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;<span class="keywordflow">              ENDIF</span></div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;            <span class="keywordflow">GO TO</span> 10</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;      slpi = (-two*f1nrm)*ratio</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;      rlmin = stptol/pnrm</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;      <span class="keywordflow">IF</span> (lsoff .EQ. 0 .AND. kprin .GE. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;        msg = <span class="stringliteral">&#39;------ MIN. LAMBDA = (R1)&#39;</span></div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 25, 903, 0, 0, 0, 0, 1, rlmin, 0.0d0)</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;<span class="comment">C Begin iteration to find RL value satisfying alpha-condition.</span></div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;<span class="comment">C If RL becomes less than RLMIN, then terminate with IRET = 1.</span></div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160; 100  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a187e8c4e1cbbc063d8ba76ccef7bb89a">dyypnw</a> (neq,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,rl,<a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>,icopt,id,ynew,ypnew)</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a7e4bd991dc7c86fd462dc77472174b56">dfnrmd</a> (neq, ynew, t, ypnew, r, cj, tscale, wt, res, ires,</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;     *              fnrmp, wm, iwm, rpar, ipar)</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;      iwm(lnre) = iwm(lnre) + 1</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;      <span class="keywordflow">IF</span> (ires .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;        iret = 2</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;        <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;      <span class="keywordflow">IF</span> (lsoff .EQ. 1) <span class="keywordflow">GO TO</span> 150</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;      f1nrmp = fnrmp*fnrmp/two</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;      <span class="keywordflow">IF</span> (kprin .GE. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;        msg = <span class="stringliteral">&#39;------ LAMBDA = (R1)&#39;</span></div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 20, 904, 0, 0, 0, 0, 1, rl, 0.0d0)</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;        msg = <span class="stringliteral">&#39;------ NORM(F1) = (R1),  NORM(F1NEW) = (R2)&#39;</span></div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 43, 905, 0, 0, 0, 0, 2, f1nrm, f1nrmp)</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;      <span class="keywordflow">IF</span> (f1nrmp .GT. f1nrm + <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>*slpi*rl) <span class="keywordflow">GO TO</span> 200</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;<span class="comment">C Alpha-condition is satisfied, or linesearch is turned off.</span></div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;<span class="comment">C Copy YNEW,YPNEW to Y,YPRIME and return.</span></div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160; 150  iret = 0</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, ynew, 1, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, 1)</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, ypnew, 1, yprime, 1)</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;      fnrm = fnrmp</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;      <span class="keywordflow">IF</span> (kprin .GE. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;        msg = <span class="stringliteral">&#39;------ LEAVING ROUTINE DLINSD, FNRM = (R1)&#39;</span></div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 42, 906, 0, 0, 0, 0, 1, fnrm, 0.0d0)</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;<span class="comment">C Alpha-condition not satisfied.  Perform backtrack to compute new RL</span></div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;<span class="comment">C value.  If no satisfactory YNEW,YPNEW can be found sufficiently </span></div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;<span class="comment">C distinct from Y,YPRIME, then return IRET = 1.</span></div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160; 200  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;      <span class="keywordflow">IF</span> (rl .LT. rlmin) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;        iret = 1</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;        <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;      rl = rl/two</div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;      <span class="keywordflow">GO TO</span> 100</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;<span class="comment">C----------------------- END OF SUBROUTINE DLINSD ----------------------</span></div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a7e4bd991dc7c86fd462dc77472174b56">dfnrmd</a> (NEQ, Y, T, YPRIME, R, CJ, TSCALE, WT,</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;     *                   RES, IRES, FNORM, WM, IWM, RPAR, IPAR)</div><div class="line"><a name="l04436"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a7e4bd991dc7c86fd462dc77472174b56"> 4436</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DFNRMD</span></div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;<span class="comment">C***REFER TO  DLINSD</span></div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;<span class="comment">C***DATE WRITTEN   941025   (YYMMDD)</span></div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;<span class="comment">C***REVISION DATE  000628   TSCALE argument added.</span></div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;<span class="comment">C     DFNRMD calculates the scaled preconditioned norm of the nonlinear</span></div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;<span class="comment">C     function used in the nonlinear iteration for obtaining consistent</span></div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;<span class="comment">C     initial conditions.  Specifically, DFNRMD calculates the weighted</span></div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;<span class="comment">C     root-mean-square norm of the vector (J-inverse)*G(T,Y,YPRIME),</span></div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;<span class="comment">C     where J is the Jacobian matrix.</span></div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;<span class="comment">C     In addition to the parameters described in the calling program</span></div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;<span class="comment">C     DLINSD, the parameters represent</span></div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;<span class="comment">C     R      -- Array of length NEQ that contains</span></div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;<span class="comment">C               (J-inverse)*G(T,Y,YPRIME) on return.</span></div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;<span class="comment">C     TSCALE -- Scale factor in T, used for stopping tests if nonzero.</span></div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;<span class="comment">C     FNORM  -- Scalar containing the weighted norm of R on return.</span></div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;<span class="comment">C   RES, DSLVD, DDWNRM</span></div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;<span class="comment">C***END PROLOGUE  DFNRMD</span></div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span> (<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;      <span class="keywordtype">EXTERNAL</span> res</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*), yprime(*), wt(*), r(*)</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;      dimension wm(*),iwm(*), rpar(*),ipar(*)</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;<span class="comment">C     Call RES routine.</span></div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;      ires = 0</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;      <span class="keyword">CALL </span>res(t,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,r,ires,rpar,ipar)</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;      <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;<span class="comment">C     Apply inverse of Jacobian to vector R.</span></div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a38468e6725b8b823437ef7bd24f68562">dslvd</a>(neq,r,wm,iwm)</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;<span class="comment">C     Calculate norm of R.</span></div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;      fnorm = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,r,wt,rpar,ipar)</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;      <span class="keywordflow">IF</span> (tscale .GT. 0.0d0) fnorm = fnorm*tscale*abs(cj)</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;<span class="comment">C----------------------- END OF SUBROUTINE DFNRMD ----------------------</span></div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a98c2f20040ea3d5b63ce4e3e7d0e8aba">dnedd</a>(X,Y,YPRIME,NEQ,RES,JACD,PDUM,H,WT,</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;     *   JSTART,IDID,RPAR,IPAR,PHI,GAMMA,DUMSVR,DELTA,E,</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;     *   WM,IWM,CJ,CJOLD,CJLAST,S,UROUND,DUME,DUMS,DUMR,</div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;     *   EPCON,JCALC,JFDUM,KP1,NONNEG,NTYPE,IERNLS)</div><div class="line"><a name="l04494"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a98c2f20040ea3d5b63ce4e3e7d0e8aba"> 4494</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DNEDD</span></div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;<span class="comment">C***DATE WRITTEN   891219   (YYMMDD)</span></div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;<span class="comment">C     DNEDD solves a nonlinear system of</span></div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;<span class="comment">C     algebraic equations of the form</span></div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;<span class="comment">C     G(X,Y,YPRIME) = 0 for the unknown Y.</span></div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;<span class="comment">C     The method used is a modified Newton scheme.</span></div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;<span class="comment">C     The parameters represent</span></div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;<span class="comment">C     X         -- Independent variable.</span></div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;<span class="comment">C     Y         -- Solution vector.</span></div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;<span class="comment">C     YPRIME    -- Derivative of solution vector.</span></div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;<span class="comment">C     NEQ       -- Number of unknowns.</span></div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;<span class="comment">C     RES       -- External user-supplied subroutine</span></div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;<span class="comment">C                  to evaluate the residual.  See RES description</span></div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;<span class="comment">C                  in DDASPK prologue.</span></div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;<span class="comment">C     JACD      -- External user-supplied routine to evaluate the</span></div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;<span class="comment">C                  Jacobian.  See JAC description for the case</span></div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;<span class="comment">C                  INFO(12) = 0 in the DDASPK prologue.</span></div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;<span class="comment">C     PDUM      -- Dummy argument.</span></div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;<span class="comment">C     H         -- Appropriate step size for next step.</span></div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;<span class="comment">C     WT        -- Vector of weights for error criterion.</span></div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;<span class="comment">C     JSTART    -- Indicates first call to this routine.</span></div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;<span class="comment">C                  If JSTART = 0, then this is the first call,</span></div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;<span class="comment">C                  otherwise it is not.</span></div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;<span class="comment">C     IDID      -- Completion flag, output by DNEDD.</span></div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;<span class="comment">C                  See IDID description in DDASPK prologue.</span></div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;<span class="comment">C     RPAR,IPAR -- Real and integer arrays used for communication</span></div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;<span class="comment">C                  between the calling program and external user</span></div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;<span class="comment">C                  routines.  They are not altered within DASPK.</span></div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;<span class="comment">C     PHI       -- Array of divided differences used by</span></div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;<span class="comment">C                  DNEDD.  The length is NEQ*(K+1),where</span></div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;<span class="comment">C                  K is the maximum order.</span></div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;<span class="comment">C     GAMMA     -- Array used to predict Y and YPRIME.  The length</span></div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;<span class="comment">C                  is MAXORD+1 where MAXORD is the maximum order.</span></div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;<span class="comment">C     DUMSVR    -- Dummy argument.</span></div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;<span class="comment">C     DELTA     -- Work vector for NLS of length NEQ.</span></div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;<span class="comment">C     E         -- Error accumulation vector for NLS of length NEQ.</span></div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;<span class="comment">C     WM,IWM    -- Real and integer arrays storing</span></div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;<span class="comment">C                  matrix information such as the matrix</span></div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;<span class="comment">C                  of partial derivatives, permutation</span></div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;<span class="comment">C                  vector, and various other information.</span></div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;<span class="comment">C     CJ        -- Parameter always proportional to 1/H.</span></div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;<span class="comment">C     CJOLD     -- Saves the value of CJ as of the last call to DMATD.</span></div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;<span class="comment">C                  Accounts for changes in CJ needed to</span></div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;<span class="comment">C                  decide whether to call DMATD.</span></div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;<span class="comment">C     CJLAST    -- Previous value of CJ.</span></div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;<span class="comment">C     S         -- A scalar determined by the approximate rate</span></div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;<span class="comment">C                  of convergence of the Newton iteration and used</span></div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;<span class="comment">C                  in the convergence test for the Newton iteration.</span></div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;<span class="comment">C                  If RATE is defined to be an estimate of the</span></div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;<span class="comment">C                  rate of convergence of the Newton iteration,</span></div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;<span class="comment">C                  then S = RATE/(1.D0-RATE).</span></div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;<span class="comment">C                  The closer RATE is to 0., the faster the Newton</span></div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;<span class="comment">C                  iteration is converging; the closer RATE is to 1.,</span></div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;<span class="comment">C                  the slower the Newton iteration is converging.</span></div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;<span class="comment">C                  On the first Newton iteration with an up-dated</span></div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;<span class="comment">C                  preconditioner S = 100.D0, Thus the initial</span></div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;<span class="comment">C                  RATE of convergence is approximately 1.</span></div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;<span class="comment">C                  S is preserved from call to call so that the rate</span></div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;<span class="comment">C                  estimate from a previous step can be applied to</span></div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;<span class="comment">C                  the current step.</span></div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;<span class="comment">C     UROUND    -- Unit roundoff.</span></div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;<span class="comment">C     DUME      -- Dummy argument.</span></div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;<span class="comment">C     DUMS      -- Dummy argument.</span></div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;<span class="comment">C     DUMR      -- Dummy argument.</span></div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;<span class="comment">C     EPCON     -- Tolerance to test for convergence of the Newton</span></div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;<span class="comment">C                  iteration.</span></div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;<span class="comment">C     JCALC     -- Flag used to determine when to update</span></div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;<span class="comment">C                  the Jacobian matrix.  In general:</span></div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;<span class="comment">C                  JCALC = -1 ==&gt; Call the DMATD routine to update</span></div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;<span class="comment">C                                 the Jacobian matrix.</span></div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;<span class="comment">C                  JCALC =  0 ==&gt; Jacobian matrix is up-to-date.</span></div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;<span class="comment">C                  JCALC =  1 ==&gt; Jacobian matrix is out-dated,</span></div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;<span class="comment">C                                 but DMATD will not be called unless</span></div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;<span class="comment">C                                 JCALC is set to -1.</span></div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;<span class="comment">C     JFDUM     -- Dummy argument.</span></div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;<span class="comment">C     KP1       -- The current order(K) + 1;  updated across calls.</span></div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;<span class="comment">C     NONNEG    -- Flag to determine nonnegativity constraints.</span></div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;<span class="comment">C     NTYPE     -- Identification code for the NLS routine.</span></div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;<span class="comment">C                   0  ==&gt; modified Newton; direct solver.</span></div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;<span class="comment">C     IERNLS    -- Error flag for nonlinear solver.</span></div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;<span class="comment">C                   0  ==&gt; nonlinear solver converged.</span></div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;<span class="comment">C                   1  ==&gt; recoverable error inside nonlinear solver.</span></div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;<span class="comment">C                  -1  ==&gt; unrecoverable error inside nonlinear solver.</span></div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;<span class="comment">C     All variables with &quot;DUM&quot; in their names are dummy variables</span></div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;<span class="comment">C     which are not used in this routine.</span></div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;<span class="comment">C     Following is a list and description of local variables which</span></div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;<span class="comment">C     may not have an obvious usage.  They are listed in roughly the</span></div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;<span class="comment">C     order they occur in this subroutine.</span></div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;<span class="comment">C     The following group of variables are passed as arguments to</span></div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;<span class="comment">C     the Newton iteration solver.  They are explained in greater detail</span></div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;<span class="comment">C     in DNSD:</span></div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;<span class="comment">C        TOLNEW, MULDEL, MAXIT, IERNEW</span></div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;<span class="comment">C     IERTYP -- Flag which tells whether this subroutine is correct.</span></div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;<span class="comment">C               0 ==&gt; correct subroutine.</span></div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;<span class="comment">C               1 ==&gt; incorrect subroutine.</span></div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;<span class="comment">C </span></div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;<span class="comment">C   DDWNRM, RES, DMATD, DNSD</span></div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;<span class="comment">C***END PROLOGUE  DNEDD</span></div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),wt(*)</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;      dimension delta(*),<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(*)</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;      dimension wm(*),iwm(*), rpar(*),ipar(*)</div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;      dimension phi(neq,*),gamma(*)</div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, jacd</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;      parameter(lnre=12, lnje=13)</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;      <span class="keywordtype">SAVE</span> muldel, maxit, xrate</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;      <span class="keyword">DATA</span> muldel/1/, maxit/4/, xrate/0.25d0/</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;<span class="comment">C     Verify that this is the correct subroutine.</span></div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;      iertyp = 0</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;      <span class="keywordflow">IF</span> (ntype .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;         iertyp = 1</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;         <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;<span class="comment">C     If this is the first step, perform initializations.</span></div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;      <span class="keywordflow">IF</span> (jstart .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;         cjold = cj</div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;         jcalc = -1</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;<span class="comment">C     Perform all other initializations.</span></div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;      iernls = 0</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;<span class="comment">C     Decide whether new Jacobian is needed.</span></div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;      temp1 = (1.0d0 - xrate)/(1.0d0 + xrate)</div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;      temp2 = 1.0d0/temp1</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;      <span class="keywordflow">IF</span> (cj/cjold .LT. temp1 .OR. cj/cjold .GT. temp2) jcalc = -1</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;      <span class="keywordflow">IF</span> (cj .NE. cjlast) <a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = 100.d0</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;<span class="comment">C     Entry point for updating the Jacobian with current</span></div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;<span class="comment">C     stepsize.</span></div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;300   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;<span class="comment">C     Initialize all error flags to zero.</span></div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;      ierj = 0</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;      ires = 0</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;      iernew = 0</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;<span class="comment">C     Predict the solution and derivative and compute the tolerance</span></div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;<span class="comment">C     for the Newton iteration.</span></div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;      <span class="keywordflow">DO</span> 310 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;         <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,1)</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;310      yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=0.0d0</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;      <span class="keywordflow">DO</span> 330 <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>=2,kp1</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;         <span class="keywordflow">DO</span> 320 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;            <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)+phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;320         yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)+gamma(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)*phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;330   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;      pnorm = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,wt,rpar,ipar)</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;      tolnew = 100.d0*uround*pnorm</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;<span class="comment">C     </span></div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;<span class="comment">C     Call RES to initialize DELTA.</span></div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;      iwm(lnre)=iwm(lnre)+1</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;      <span class="keyword">CALL </span>res(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,delta,ires,rpar,ipar)</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;      <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;<span class="comment">C     If indicated, reevaluate the iteration matrix </span></div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;<span class="comment">C     J = dG/dY + CJ*dG/dYPRIME (where G(X,Y,YPRIME)=0).</span></div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;<span class="comment">C     Set JCALC to 0 as an indicator that this has been done.</span></div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;      <span class="keywordflow">IF</span>(jcalc .EQ. -1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;         iwm(lnje)=iwm(lnje)+1</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;         jcalc=0</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a5886c909d03a151adbd71cd4ad2b6acc">dmatd</a>(neq,<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,delta,cj,h,ierj,wt,<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>,wm,iwm,</div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;     *              res,ires,uround,jacd,rpar,ipar)</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;         cjold=cj</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;         <a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = 100.d0</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;         <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;         <span class="keywordflow">IF</span>(ierj .NE. 0)<span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;<span class="comment">C     Call the nonlinear Newton solver.</span></div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;      temp1 = 2.0d0/(1.0d0 + cj/cjold)</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aefa344c4f35de4a557c969a6700d4846">dnsd</a>(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,res,pdum,wt,rpar,ipar,dumsvr,</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;     *          delta,<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>,wm,iwm,cj,dums,dumr,dume,epcon,<a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a>,temp1,</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;     *          tolnew,muldel,maxit,ires,idum,iernew)</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;      <span class="keywordflow">IF</span> (iernew .GT. 0 .AND. jcalc .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;<span class="comment">C        The Newton iteration had a recoverable failure with an old</span></div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;<span class="comment">C        iteration matrix.  Retry the step with a new iteration matrix.</span></div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;         jcalc = -1</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;         <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;      <span class="keywordflow">IF</span> (iernew .NE. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;<span class="comment">C     The Newton iteration has converged.  If nonnegativity of</span></div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;<span class="comment">C     solution is required, set the solution nonnegative, if the</span></div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;<span class="comment">C     perturbation to do it is small enough.  If the change is too</span></div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;<span class="comment">C     large, then consider the corrector iteration to have failed.</span></div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;375   <span class="keywordflow">IF</span>(nonneg .EQ. 0) <span class="keywordflow">GO TO</span> 390</div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;      <span class="keywordflow">DO</span> 377 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;377      delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = min(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>),0.0d0)</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;      delnrm = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,delta,wt,rpar,ipar)</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;      <span class="keywordflow">IF</span>(delnrm .GT. epcon) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;      <span class="keywordflow">DO</span> 378 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;378      <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) - delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;      <span class="keywordflow">GO TO</span> 390</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;<span class="comment">C     Exits from nonlinear solver.</span></div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;<span class="comment">C     No convergence with current iteration</span></div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;<span class="comment">C     matrix, or singular iteration matrix.</span></div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;<span class="comment">C     Compute IERNLS and IDID accordingly.</span></div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;380   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;      <span class="keywordflow">IF</span> (ires .LE. -2 .OR. iertyp .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;         iernls = -1</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;         <span class="keywordflow">IF</span> (ires .LE. -2) idid = -11</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;         <span class="keywordflow">IF</span> (iertyp .NE. 0) idid = -15</div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;         iernls = 1</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;         <span class="keywordflow">IF</span> (ires .LT. 0) idid = -10</div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;         <span class="keywordflow">IF</span> (ierj .NE. 0) idid = -8</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;390   jcalc = 1</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;<span class="comment">C------END OF SUBROUTINE DNEDD------------------------------------------</span></div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aefa344c4f35de4a557c969a6700d4846">dnsd</a>(X,Y,YPRIME,NEQ,RES,PDUM,WT,RPAR,IPAR,</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;     *   DUMSVR,DELTA,E,WM,IWM,CJ,DUMS,DUMR,DUME,EPCON,</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;     *   S,CONFAC,TOLNEW,MULDEL,MAXIT,IRES,IDUM,IERNEW)</div><div class="line"><a name="l04759"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#aefa344c4f35de4a557c969a6700d4846"> 4759</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DNSD</span></div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;<span class="comment">C***DATE WRITTEN   891219   (YYMMDD)</span></div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;<span class="comment">C***REVISION DATE  950126   (YYMMDD)</span></div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;<span class="comment">C***REVISION DATE  000711   (YYMMDD)</span></div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;<span class="comment">C     DNSD solves a nonlinear system of</span></div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;<span class="comment">C     algebraic equations of the form</span></div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;<span class="comment">C     G(X,Y,YPRIME) = 0 for the unknown Y.</span></div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;<span class="comment">C     The method used is a modified Newton scheme.</span></div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;<span class="comment">C     The parameters represent</span></div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;<span class="comment">C     X         -- Independent variable.</span></div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;<span class="comment">C     Y         -- Solution vector.</span></div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;<span class="comment">C     YPRIME    -- Derivative of solution vector.</span></div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;<span class="comment">C     NEQ       -- Number of unknowns.</span></div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;<span class="comment">C     RES       -- External user-supplied subroutine</span></div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;<span class="comment">C                  to evaluate the residual.  See RES description</span></div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;<span class="comment">C                  in DDASPK prologue.</span></div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;<span class="comment">C     PDUM      -- Dummy argument.</span></div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;<span class="comment">C     WT        -- Vector of weights for error criterion.</span></div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;<span class="comment">C     RPAR,IPAR -- Real and integer arrays used for communication</span></div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;<span class="comment">C                  between the calling program and external user</span></div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;<span class="comment">C                  routines.  They are not altered within DASPK.</span></div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;<span class="comment">C     DUMSVR    -- Dummy argument.</span></div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;<span class="comment">C     DELTA     -- Work vector for DNSD of length NEQ.</span></div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;<span class="comment">C     E         -- Error accumulation vector for DNSD of length NEQ.</span></div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;<span class="comment">C     WM,IWM    -- Real and integer arrays storing</span></div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;<span class="comment">C                  matrix information such as the matrix</span></div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;<span class="comment">C                  of partial derivatives, permutation</span></div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;<span class="comment">C                  vector, and various other information.</span></div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;<span class="comment">C     CJ        -- Parameter always proportional to 1/H (step size).</span></div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;<span class="comment">C     DUMS      -- Dummy argument.</span></div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;<span class="comment">C     DUMR      -- Dummy argument.</span></div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;<span class="comment">C     DUME      -- Dummy argument.</span></div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;<span class="comment">C     EPCON     -- Tolerance to test for convergence of the Newton</span></div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;<span class="comment">C                  iteration.</span></div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;<span class="comment">C     S         -- Used for error convergence tests.</span></div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;<span class="comment">C                  In the Newton iteration: S = RATE/(1 - RATE),</span></div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;<span class="comment">C                  where RATE is the estimated rate of convergence</span></div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;<span class="comment">C                  of the Newton iteration.</span></div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;<span class="comment">C                  The calling routine passes the initial value</span></div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;<span class="comment">C                  of S to the Newton iteration.</span></div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;<span class="comment">C     CONFAC    -- A residual scale factor to improve convergence.</span></div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;<span class="comment">C     TOLNEW    -- Tolerance on the norm of Newton correction in</span></div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;<span class="comment">C                  alternative Newton convergence test.</span></div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;<span class="comment">C     MULDEL    -- A flag indicating whether or not to multiply</span></div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;<span class="comment">C                  DELTA by CONFAC.</span></div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;<span class="comment">C                  0  ==&gt; do not scale DELTA by CONFAC.</span></div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;<span class="comment">C                  1  ==&gt; scale DELTA by CONFAC.</span></div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;<span class="comment">C     MAXIT     -- Maximum allowed number of Newton iterations.</span></div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;<span class="comment">C     IRES      -- Error flag returned from RES.  See RES description</span></div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;<span class="comment">C                  in DDASPK prologue.  If IRES = -1, then IERNEW</span></div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;<span class="comment">C                  will be set to 1.</span></div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;<span class="comment">C                  If IRES &lt; -1, then IERNEW will be set to -1.</span></div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;<span class="comment">C     IDUM      -- Dummy argument.</span></div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;<span class="comment">C     IERNEW    -- Error flag for Newton iteration.</span></div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;<span class="comment">C                   0  ==&gt; Newton iteration converged.</span></div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;<span class="comment">C                   1  ==&gt; recoverable error inside Newton iteration.</span></div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;<span class="comment">C                  -1  ==&gt; unrecoverable error inside Newton iteration.</span></div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;<span class="comment">C     All arguments with &quot;DUM&quot; in their names are dummy arguments</span></div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;<span class="comment">C     which are not used in this routine.</span></div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;<span class="comment">C   DSLVD, DDWNRM, RES</span></div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;<span class="comment">C***END PROLOGUE  DNSD</span></div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),wt(*),delta(*),<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(*)</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;      dimension wm(*),iwm(*), rpar(*),ipar(*)</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;      parameter(lnre=12, lnni=19)</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;<span class="comment">C     Initialize Newton counter M and accumulation vector E. </span></div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;      <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> = 0</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;      <span class="keywordflow">DO</span> 100 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;100     <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=0.0d0</div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;<span class="comment">C     Corrector loop.</span></div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;300   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;      iwm(lnni) = iwm(lnni) + 1</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;<span class="comment">C     If necessary, multiply residual by convergence factor.</span></div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;      <span class="keywordflow">IF</span> (muldel .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;         <span class="keywordflow">DO</span> 320 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;320        delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) * confac</div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;<span class="comment">C     Compute a new iterate (back-substitution).</span></div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;<span class="comment">C     Store the correction in DELTA.</span></div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a38468e6725b8b823437ef7bd24f68562">dslvd</a>(neq,delta,wm,iwm)</div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;<span class="comment">C     Update Y, E, and YPRIME.</span></div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;      <span class="keywordflow">DO</span> 340 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;         <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)-delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;         <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)-delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;340      yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)-cj*delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;<span class="comment">C     Test for convergence of the iteration.</span></div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;      delnrm=<a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,delta,wt,rpar,ipar)</div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;        oldnrm = delnrm</div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;        <span class="keywordflow">IF</span> (delnrm .LE. tolnew) <span class="keywordflow">GO TO</span> 370</div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;        rate = (delnrm/oldnrm)**(1.0d0/<a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a>)</div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;        <span class="keywordflow">IF</span> (rate .GT. 0.9d0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;        <a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = rate/(1.0d0 - rate)</div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a>*delnrm .LE. epcon) <span class="keywordflow">GO TO</span> 370</div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;<span class="comment">C     The corrector has not yet converged.</span></div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;<span class="comment">C     Update M and test whether the</span></div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;<span class="comment">C     maximum number of iterations have</span></div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;<span class="comment">C     been tried.</span></div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;      <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a>=<a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a>+1</div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a>.GE.maxit) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;<span class="comment">C     Evaluate the residual,</span></div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;<span class="comment">C     and go back to do another iteration.</span></div><div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;      iwm(lnre)=iwm(lnre)+1</div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;      <span class="keyword">CALL </span>res(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,delta,ires,rpar,ipar)</div><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;      <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;      <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;<span class="comment">C     The iteration has converged.</span></div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;370   <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;<span class="comment">C     The iteration has not converged.  Set IERNEW appropriately.</span></div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;380   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;      <span class="keywordflow">IF</span> (ires .LE. -2 ) <span class="keywordflow">THEN</span></div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;         iernew = -1</div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;         iernew = 1</div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;<span class="comment">C------END OF SUBROUTINE DNSD-------------------------------------------</span></div><div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a5886c909d03a151adbd71cd4ad2b6acc">dmatd</a>(NEQ,X,Y,YPRIME,DELTA,CJ,H,IER,EWT,E,</div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;     *                 WM,IWM,RES,IRES,UROUND,JACD,RPAR,IPAR)</div><div class="line"><a name="l04923"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a5886c909d03a151adbd71cd4ad2b6acc"> 4923</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DMATD</span></div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;<span class="comment">C***REVISION DATE  940701   (new LIPVT)</span></div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;<span class="comment">C***REVISION DATE  060712   (Changed minimum D.Q. increment to 1/EWT(j))</span></div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;<span class="comment">C     This routine computes the iteration matrix</span></div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;<span class="comment">C     J = dG/dY+CJ*dG/dYPRIME (where G(X,Y,YPRIME)=0).</span></div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;<span class="comment">C     Here J is computed by:</span></div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;<span class="comment">C       the user-supplied routine JACD if IWM(MTYPE) is 1 or 4, or</span></div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;<span class="comment">C       by numerical difference quotients if IWM(MTYPE) is 2 or 5.</span></div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;<span class="comment">C     The parameters have the following meanings.</span></div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;<span class="comment">C     X        = Independent variable.</span></div><div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;<span class="comment">C     Y        = Array containing predicted values.</span></div><div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;<span class="comment">C     YPRIME   = Array containing predicted derivatives.</span></div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;<span class="comment">C     DELTA    = Residual evaluated at (X,Y,YPRIME).</span></div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;<span class="comment">C                (Used only if IWM(MTYPE)=2 or 5).</span></div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;<span class="comment">C     CJ       = Scalar parameter defining iteration matrix.</span></div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;<span class="comment">C     H        = Current stepsize in integration.</span></div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;<span class="comment">C     IER      = Variable which is .NE. 0 if iteration matrix</span></div><div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;<span class="comment">C                is singular, and 0 otherwise.</span></div><div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;<span class="comment">C     EWT      = Vector of error weights for computing norms.</span></div><div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;<span class="comment">C     E        = Work space (temporary) of length NEQ.</span></div><div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;<span class="comment">C     WM       = Real work space for matrices.  On output</span></div><div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;<span class="comment">C                it contains the LU decomposition</span></div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;<span class="comment">C                of the iteration matrix.</span></div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;<span class="comment">C     IWM      = Integer work space containing</span></div><div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;<span class="comment">C                matrix information.</span></div><div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;<span class="comment">C     RES      = External user-supplied subroutine</span></div><div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;<span class="comment">C                to evaluate the residual.  See RES description</span></div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;<span class="comment">C                in DDASPK prologue.</span></div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;<span class="comment">C     IRES     = Flag which is equal to zero if no illegal values</span></div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;<span class="comment">C                in RES, and less than zero otherwise.  (If IRES</span></div><div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;<span class="comment">C                is less than zero, the matrix was not completed).</span></div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;<span class="comment">C                In this case (if IRES .LT. 0), then IER = 0.</span></div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;<span class="comment">C     UROUND   = The unit roundoff error of the machine being used.</span></div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;<span class="comment">C     JACD     = Name of the external user-supplied routine</span></div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;<span class="comment">C                to evaluate the iteration matrix.  (This routine</span></div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;<span class="comment">C                is only used if IWM(MTYPE) is 1 or 4)</span></div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;<span class="comment">C                See JAC description for the case INFO(12) = 0</span></div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;<span class="comment">C                in DDASPK prologue.</span></div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;<span class="comment">C     RPAR,IPAR= Real and integer parameter arrays that</span></div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;<span class="comment">C                are used for communication between the</span></div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;<span class="comment">C                calling program and external user routines.</span></div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;<span class="comment">C                They are not altered by DMATD.</span></div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;<span class="comment">C   JACD, RES, DGEFA, DGBFA</span></div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;<span class="comment">C***END PROLOGUE  DMATD</span></div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),delta(*),ewt(*),<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(*)</div><div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;      dimension wm(*),iwm(*), rpar(*),ipar(*)</div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, jacd</div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;      parameter(lml=1, lmu=2, lmtype=4, lnre=12, lnpd=22, llciwp=30)</div><div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;      lipvt = iwm(llciwp)</div><div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;      ier = 0</div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;      mtype=iwm(lmtype)</div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;      <span class="keywordflow">GO TO</span> (100,200,300,400,500),mtype</div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;<span class="comment">C     Dense user-supplied matrix.</span></div><div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;100   lenpd=iwm(lnpd)</div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;      <span class="keywordflow">DO</span> 110 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,lenpd</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;110      wm(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=0.0d0</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;      <span class="keyword">CALL </span>jacd(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,wm,cj,rpar,ipar)</div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;      <span class="keywordflow">GO TO</span> 230</div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;<span class="comment">C     Dense finite-difference-generated matrix.</span></div><div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;200   ires=0</div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;      nrow=0</div><div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;      squr = sqrt(uround)</div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;      <span class="keywordflow">DO</span> 210 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;         del=<a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(squr*<a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(abs(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)),abs(h*yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>))), 1.0d0/ewt(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;         del=sign(del,h*yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>))</div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;         del=(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)+del)-<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;         ysave=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;         ypsave=yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;         <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)+del</div><div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;         yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)+cj*del</div><div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;         iwm(lnre)=iwm(lnre)+1</div><div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;         <span class="keyword">CALL </span>res(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>,ires,rpar,ipar)</div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;         <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;         delinv=1.0d0/del</div><div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;         <span class="keywordflow">DO</span> 220 l=1,neq</div><div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;220        wm(nrow+l)=(<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(l)-delta(l))*delinv</div><div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;      nrow=nrow+neq</div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;      <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=ysave</div><div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;      yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=ypsave</div><div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;210   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;<span class="comment">C     Do dense-matrix LU decomposition on J.</span></div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;230      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#ac2065ce90ead2dc7b03cd7e641f93ef0">dgefa</a>(wm,neq,neq,iwm(lipvt),ier)</div><div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;<span class="comment">C     Dummy section for IWM(MTYPE)=3.</span></div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;300   <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;<span class="comment">C     Banded user-supplied matrix.</span></div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;400   lenpd=iwm(lnpd)</div><div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;      <span class="keywordflow">DO</span> 410 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,lenpd</div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;410      wm(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=0.0d0</div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;      <span class="keyword">CALL </span>jacd(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,wm,cj,rpar,ipar)</div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;      meband=2*iwm(lml)+iwm(lmu)+1</div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;      <span class="keywordflow">GO TO</span> 550</div><div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;<span class="comment">C     Banded finite-difference-generated matrix.</span></div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;500   mband=iwm(lml)+iwm(lmu)+1</div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;      mba=min0(mband,neq)</div><div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;      meband=mband+iwm(lml)</div><div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;      meb1=meband-1</div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;      msave=(neq/mband)+1</div><div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;      isave=iwm(lnpd)</div><div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;      ipsave=isave+msave</div><div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;      ires=0</div><div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;      squr=sqrt(uround)</div><div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;      <span class="keywordflow">DO</span> 540 <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>=1,mba</div><div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;        <span class="keywordflow">DO</span> 510 <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>=<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>,neq,mband</div><div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;          <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>= (<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>-<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)/mband + 1</div><div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;          wm(isave+<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>)=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)</div><div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;          wm(ipsave+<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>)=yprime(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)</div><div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;          del=<a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(squr*<a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(abs(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)),abs(h*yprime(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>))), 1.0d0/ewt(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>))</div><div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;          del=sign(del,h*yprime(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>))</div><div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;          del=(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)+del)-<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)</div><div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;          <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)+del</div><div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;510       yprime(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)=yprime(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)+cj*del</div><div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;        iwm(lnre)=iwm(lnre)+1</div><div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;        <span class="keyword">CALL </span>res(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>,ires,rpar,ipar)</div><div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;        <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;        <span class="keywordflow">DO</span> 530 <a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>=<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>,neq,mband</div><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;          <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>= (<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>-<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)/mband + 1</div><div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;          <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)=wm(isave+<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>)</div><div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;          yprime(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)=wm(ipsave+<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a>)</div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;          del=<a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(squr*<a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(abs(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)),abs(h*yprime(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>))), 1.0d0/ewt(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>))</div><div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;          del=sign(del,h*yprime(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>))</div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;          del=(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)+del)-<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>)</div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;          delinv=1.0d0/del</div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;          i1=max0(1,(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>-iwm(lmu)))</div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;          i2=min0(neq,(<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>+iwm(lml)))</div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;          ii=<a class="code" href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a>*meb1-iwm(lml)</div><div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;          <span class="keywordflow">DO</span> 520 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=i1,i2</div><div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;520         wm(ii+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=(<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)-delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>))*delinv</div><div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;530     <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;540   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;<span class="comment">C     Do LU decomposition of banded J.</span></div><div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;550   <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#ab8d049e06a29c4a273874f5780fe95bc">dgbfa</a> (wm,meband,neq,iwm(lml),iwm(lmu),iwm(lipvt),ier)</div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;<span class="comment">C------END OF SUBROUTINE DMATD------------------------------------------</span></div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a38468e6725b8b823437ef7bd24f68562">dslvd</a>(NEQ,DELTA,WM,IWM)</div><div class="line"><a name="l05098"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a38468e6725b8b823437ef7bd24f68562"> 5098</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DSLVD</span></div><div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;<span class="comment">C***REVISION DATE  940701   (YYMMDD) (new LIPVT)</span></div><div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;<span class="comment">C     This routine manages the solution of the linear</span></div><div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;<span class="comment">C     system arising in the Newton iteration.</span></div><div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;<span class="comment">C     Real matrix information and real temporary storage</span></div><div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;<span class="comment">C     is stored in the array WM.</span></div><div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;<span class="comment">C     Integer matrix information is stored in the array IWM.</span></div><div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;<span class="comment">C     For a dense matrix, the LINPACK routine DGESL is called.</span></div><div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;<span class="comment">C     For a banded matrix, the LINPACK routine DGBSL is called.</span></div><div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;<span class="comment">C   DGESL, DGBSL</span></div><div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;<span class="comment">C***END PROLOGUE  DSLVD</span></div><div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;      dimension delta(*),wm(*),iwm(*)</div><div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;      parameter(lml=1, lmu=2, lmtype=4, llciwp=30)</div><div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;      lipvt = iwm(llciwp)</div><div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;      mtype=iwm(lmtype)</div><div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;      <span class="keywordflow">GO TO</span>(100,100,300,400,400),mtype</div><div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;<span class="comment">C     Dense matrix.</span></div><div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;100   <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a9449fc686f17b88af5f5472b4880c3d3">dgesl</a>(wm,neq,neq,iwm(lipvt),delta,0)</div><div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;<span class="comment">C     Dummy section for MTYPE=3.</span></div><div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;300   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;<span class="comment">C     Banded matrix.</span></div><div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;400   meband=2*iwm(lml)+iwm(lmu)+1</div><div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a5beaa6edffd752720aa1f5282016a5aa">dgbsl</a>(wm,meband,neq,iwm(lml),</div><div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;     *  iwm(lmu),iwm(lipvt),delta,0)</div><div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;<span class="comment">C------END OF SUBROUTINE DSLVD------------------------------------------</span></div><div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#adfcd029d0eaeb0052be0007163ce1989">ddasik</a>(X,Y,YPRIME,NEQ,ICOPT,ID,RES,JACK,PSOL,H,TSCALE,</div><div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;     *   WT,JSKIP,RPAR,IPAR,SAVR,DELTA,R,YIC,YPIC,PWK,WM,IWM,CJ,UROUND,</div><div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;     *   EPLI,SQRTN,RSQRTN,EPCON,RATEMX,STPTOL,JFLG,</div><div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;     *   ICNFLG,ICNSTR,IERNLS)</div><div class="line"><a name="l05154"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#adfcd029d0eaeb0052be0007163ce1989"> 5154</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DDASIK</span></div><div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;<span class="comment">C***DATE WRITTEN   941026   (YYMMDD)</span></div><div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;<span class="comment">C***REVISION DATE  950808   (YYMMDD)</span></div><div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;<span class="comment">C***REVISION DATE  951110   Removed unreachable block 390.</span></div><div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;<span class="comment">C***REVISION DATE  000628   TSCALE argument added.</span></div><div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;<span class="comment">C     DDASIK solves a nonlinear system of algebraic equations of the</span></div><div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;<span class="comment">C     form G(X,Y,YPRIME) = 0 for the unknown parts of Y and YPRIME in</span></div><div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;<span class="comment">C     the initial conditions.</span></div><div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;<span class="comment">C     An initial value for Y and initial guess for YPRIME are input.</span></div><div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;<span class="comment">C     The method used is a Newton scheme with Krylov iteration and a</span></div><div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;<span class="comment">C     linesearch algorithm.</span></div><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;<span class="comment">C     The parameters represent</span></div><div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;<span class="comment">C     X         -- Independent variable.</span></div><div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;<span class="comment">C     Y         -- Solution vector at x.</span></div><div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;<span class="comment">C     YPRIME    -- Derivative of solution vector.</span></div><div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;<span class="comment">C     NEQ       -- Number of equations to be integrated.</span></div><div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;<span class="comment">C     ICOPT     -- Initial condition option chosen (1 or 2).</span></div><div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;<span class="comment">C     ID        -- Array of dimension NEQ, which must be initialized</span></div><div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;<span class="comment">C                  if ICOPT = 1.  See DDASIC.</span></div><div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;<span class="comment">C     RES       -- External user-supplied subroutine</span></div><div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;<span class="comment">C                  to evaluate the residual.  See RES description</span></div><div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;<span class="comment">C                  in DDASPK prologue.</span></div><div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;<span class="comment">C     JACK     --  External user-supplied routine to update</span></div><div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;<span class="comment">C                  the preconditioner.  (This is optional).</span></div><div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;<span class="comment">C                  See JAC description for the case</span></div><div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;<span class="comment">C                  INFO(12) = 1 in the DDASPK prologue.</span></div><div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;<span class="comment">C     PSOL      -- External user-supplied routine to solve</span></div><div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;<span class="comment">C                  a linear system using preconditioning.</span></div><div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;<span class="comment">C                  (This is optional).  See explanation inside DDASPK.</span></div><div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;<span class="comment">C     H         -- Scaling factor for this initial condition calc.</span></div><div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;<span class="comment">C     TSCALE    -- Scale factor in T, used for stopping tests if nonzero.</span></div><div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;<span class="comment">C     WT        -- Vector of weights for error criterion.</span></div><div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;<span class="comment">C     JSKIP     -- input flag to signal if initial JAC call is to be</span></div><div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;<span class="comment">C                  skipped.  1 =&gt; skip the call, 0 =&gt; do not skip call.</span></div><div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;<span class="comment">C     RPAR,IPAR -- Real and integer arrays used for communication</span></div><div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;<span class="comment">C                  between the calling program and external user</span></div><div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;<span class="comment">C                  routines.  They are not altered within DASPK.</span></div><div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;<span class="comment">C     SAVR      -- Work vector for DDASIK of length NEQ.</span></div><div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;<span class="comment">C     DELTA     -- Work vector for DDASIK of length NEQ.</span></div><div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;<span class="comment">C     R         -- Work vector for DDASIK of length NEQ.</span></div><div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;<span class="comment">C     YIC,YPIC  -- Work vectors for DDASIK, each of length NEQ.</span></div><div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;<span class="comment">C     PWK       -- Work vector for DDASIK of length NEQ.</span></div><div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;<span class="comment">C     WM,IWM    -- Real and integer arrays storing</span></div><div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;<span class="comment">C                  matrix information for linear system</span></div><div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;<span class="comment">C                  solvers, and various other information.</span></div><div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;<span class="comment">C     CJ        -- Matrix parameter = 1/H (ICOPT = 1) or 0 (ICOPT = 2).</span></div><div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;<span class="comment">C     UROUND    -- Unit roundoff.  Not used here.</span></div><div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;<span class="comment">C     EPLI      -- convergence test constant.</span></div><div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;<span class="comment">C                  See DDASPK prologue for more details.</span></div><div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;<span class="comment">C     SQRTN     -- Square root of NEQ.</span></div><div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;<span class="comment">C     RSQRTN    -- reciprical of square root of NEQ.</span></div><div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;<span class="comment">C     EPCON     -- Tolerance to test for convergence of the Newton</span></div><div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;<span class="comment">C                  iteration.</span></div><div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;<span class="comment">C     RATEMX    -- Maximum convergence rate for which Newton iteration</span></div><div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;<span class="comment">C                  is considered converging.</span></div><div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;<span class="comment">C     JFLG      -- Flag showing whether a Jacobian routine is supplied.</span></div><div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;<span class="comment">C     ICNFLG    -- Integer scalar.  If nonzero, then constraint</span></div><div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;<span class="comment">C                  violations in the proposed new approximate solution</span></div><div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;<span class="comment">C                  will be checked for, and the maximum step length </span></div><div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;<span class="comment">C                  will be adjusted accordingly.</span></div><div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;<span class="comment">C     ICNSTR    -- Integer array of length NEQ containing flags for</span></div><div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;<span class="comment">C                  checking constraints.</span></div><div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;<span class="comment">C     IERNLS    -- Error flag for nonlinear solver.</span></div><div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;<span class="comment">C                   0   ==&gt; nonlinear solver converged.</span></div><div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;<span class="comment">C                   1,2 ==&gt; recoverable error inside nonlinear solver.</span></div><div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;<span class="comment">C                           1 =&gt; retry with current Y, YPRIME</span></div><div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;<span class="comment">C                           2 =&gt; retry with original Y, YPRIME</span></div><div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;<span class="comment">C                  -1   ==&gt; unrecoverable error in nonlinear solver.</span></div><div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;<span class="comment">C   RES, JACK, DNSIK, DCOPY</span></div><div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;<span class="comment">C***END PROLOGUE  DDASIK</span></div><div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),id(*),wt(*),icnstr(*)</div><div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;      dimension savr(*),delta(*),r(*),yic(*),ypic(*),pwk(*)</div><div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;      dimension wm(*),iwm(*), rpar(*),ipar(*)</div><div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;      <span class="keywordtype">EXTERNAL</span> res, jack, psol</div><div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;      parameter(lnre=12, lnje=13, llocwp=29, llciwp=30)</div><div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;      parameter(lmxnit=32, lmxnj=33)</div><div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;<span class="comment">C     Perform initializations.</span></div><div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;      lwp = iwm(llocwp)</div><div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;      liwp = iwm(llciwp)</div><div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;      mxnit = iwm(lmxnit)</div><div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;      mxnj = iwm(lmxnj)</div><div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;      iernls = 0</div><div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;      nj = 0</div><div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;      eplin = epli*epcon</div><div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;<span class="comment">C     Call RES to initialize DELTA.</span></div><div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;      ires = 0</div><div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;      iwm(lnre) = iwm(lnre) + 1</div><div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;      <span class="keyword">CALL </span>res(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,delta,ires,rpar,ipar)</div><div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;      <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">GO TO</span> 370</div><div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;<span class="comment">C     Looping point for updating the preconditioner.</span></div><div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160; 300  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;<span class="comment">C     Initialize all error flags to zero.</span></div><div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;      ierpj = 0</div><div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;      ires = 0</div><div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;      iernew = 0</div><div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;<span class="comment">C     If a Jacobian routine was supplied, call it.</span></div><div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;      <span class="keywordflow">IF</span> (jflg .EQ. 1 .AND. jskip .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;        nj = nj + 1</div><div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;        iwm(lnje)=iwm(lnje)+1</div><div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;        <span class="keyword">CALL </span>jack (res, ires, neq, <a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, yprime, wt, delta, r, h, cj,</div><div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;     *     wm(lwp), iwm(liwp), ierpj, rpar, ipar)</div><div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;        <span class="keywordflow">IF</span> (ires .LT. 0 .OR. ierpj .NE. 0) <span class="keywordflow">GO TO</span> 370</div><div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;      jskip = 0</div><div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;<span class="comment">C     Call the nonlinear Newton solver for up to MXNIT iterations.</span></div><div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a15273861b3a047737c5033b7e78607ba">dnsik</a>(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,icopt,id,res,psol,wt,rpar,ipar,</div><div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;     *   savr,delta,r,yic,ypic,pwk,wm,iwm,cj,tscale,sqrtn,rsqrtn,</div><div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;     *   eplin,epcon,ratemx,mxnit,stptol,icnflg,icnstr,iernew)</div><div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;      <span class="keywordflow">IF</span> (iernew .EQ. 1 .AND. nj .LT. mxnj .AND. jflg .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;<span class="comment">C       Up to MXNIT iterations were done, the convergence rate is &lt; 1,</span></div><div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;<span class="comment">C       a Jacobian routine is supplied, and the number of JACK calls</span></div><div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;<span class="comment">C       is less than MXNJ.  </span></div><div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;<span class="comment">C       Copy the residual SAVR to DELTA, call JACK, and try again.</span></div><div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq,  savr, 1, delta, 1)</div><div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;        <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;      <span class="keywordflow">IF</span> (iernew .NE. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;<span class="comment">C     Unsuccessful exits from nonlinear solver.</span></div><div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;<span class="comment">C     Set IERNLS accordingly.</span></div><div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160; 370  iernls = 2</div><div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;      <span class="keywordflow">IF</span> (ires .LE. -2) iernls = -1</div><div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160; 380  iernls = min(iernew,2)</div><div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;<span class="comment">C----------------------- END OF SUBROUTINE DDASIK-----------------------</span></div><div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a15273861b3a047737c5033b7e78607ba">dnsik</a>(X,Y,YPRIME,NEQ,ICOPT,ID,RES,PSOL,WT,RPAR,IPAR,</div><div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;     *   SAVR,DELTA,R,YIC,YPIC,PWK,WM,IWM,CJ,TSCALE,SQRTN,RSQRTN,EPLIN,</div><div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;     *   EPCON,RATEMX,MAXIT,STPTOL,ICNFLG,ICNSTR,IERNEW)</div><div class="line"><a name="l05327"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a15273861b3a047737c5033b7e78607ba"> 5327</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DNSIK</span></div><div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;<span class="comment">C***DATE WRITTEN   940701   (YYMMDD)</span></div><div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;<span class="comment">C***REVISION DATE  950714   (YYMMDD)</span></div><div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;<span class="comment">C***REVISION DATE  000628   TSCALE argument added.</span></div><div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;<span class="comment">C***REVISION DATE  000628   Added criterion for IERNEW = 1 return.</span></div><div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;<span class="comment">C     DNSIK solves a nonlinear system of algebraic equations of the</span></div><div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;<span class="comment">C     form G(X,Y,YPRIME) = 0 for the unknown parts of Y and YPRIME in</span></div><div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;<span class="comment">C     the initial conditions.</span></div><div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;<span class="comment">C     The method used is a Newton scheme combined with a linesearch</span></div><div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;<span class="comment">C     algorithm, using Krylov iterative linear system methods.</span></div><div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;<span class="comment">C     The parameters represent</span></div><div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;<span class="comment">C     X         -- Independent variable.</span></div><div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;<span class="comment">C     Y         -- Solution vector.</span></div><div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;<span class="comment">C     YPRIME    -- Derivative of solution vector.</span></div><div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;<span class="comment">C     NEQ       -- Number of unknowns.</span></div><div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;<span class="comment">C     ICOPT     -- Initial condition option chosen (1 or 2).</span></div><div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;<span class="comment">C     ID        -- Array of dimension NEQ, which must be initialized</span></div><div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;<span class="comment">C                  if ICOPT = 1.  See DDASIC.</span></div><div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;<span class="comment">C     RES       -- External user-supplied subroutine</span></div><div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;<span class="comment">C                  to evaluate the residual.  See RES description</span></div><div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;<span class="comment">C                  in DDASPK prologue.</span></div><div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;<span class="comment">C     PSOL      -- External user-supplied routine to solve</span></div><div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;<span class="comment">C                  a linear system using preconditioning. </span></div><div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;<span class="comment">C                  See explanation inside DDASPK.</span></div><div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;<span class="comment">C     WT        -- Vector of weights for error criterion.</span></div><div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;<span class="comment">C     RPAR,IPAR -- Real and integer arrays used for communication</span></div><div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;<span class="comment">C                  between the calling program and external user</span></div><div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;<span class="comment">C                  routines.  They are not altered within DASPK.</span></div><div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;<span class="comment">C     SAVR      -- Work vector for DNSIK of length NEQ.</span></div><div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;<span class="comment">C     DELTA     -- Residual vector on entry, and work vector of</span></div><div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;<span class="comment">C                  length NEQ for DNSIK.</span></div><div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;<span class="comment">C     R         -- Work vector for DNSIK of length NEQ.</span></div><div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;<span class="comment">C     YIC,YPIC  -- Work vectors for DNSIK, each of length NEQ.</span></div><div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;<span class="comment">C     PWK       -- Work vector for DNSIK of length NEQ.</span></div><div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;<span class="comment">C     WM,IWM    -- Real and integer arrays storing</span></div><div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;<span class="comment">C                  matrix information such as the matrix</span></div><div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;<span class="comment">C                  of partial derivatives, permutation</span></div><div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;<span class="comment">C                  vector, and various other information.</span></div><div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;<span class="comment">C     CJ        -- Matrix parameter = 1/H (ICOPT = 1) or 0 (ICOPT = 2).</span></div><div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;<span class="comment">C     TSCALE    -- Scale factor in T, used for stopping tests if nonzero.</span></div><div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;<span class="comment">C     SQRTN     -- Square root of NEQ.</span></div><div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;<span class="comment">C     RSQRTN    -- reciprical of square root of NEQ.</span></div><div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;<span class="comment">C     EPLIN     -- Tolerance for linear system solver.</span></div><div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;<span class="comment">C     EPCON     -- Tolerance to test for convergence of the Newton</span></div><div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;<span class="comment">C                  iteration.</span></div><div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;<span class="comment">C     RATEMX    -- Maximum convergence rate for which Newton iteration</span></div><div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;<span class="comment">C                  is considered converging.</span></div><div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;<span class="comment">C     MAXIT     -- Maximum allowed number of Newton iterations.</span></div><div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;<span class="comment">C     STPTOL    -- Tolerance used in calculating the minimum lambda</span></div><div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;<span class="comment">C                  value allowed.</span></div><div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;<span class="comment">C     ICNFLG    -- Integer scalar.  If nonzero, then constraint</span></div><div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;<span class="comment">C                  violations in the proposed new approximate solution</span></div><div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;<span class="comment">C                  will be checked for, and the maximum step length</span></div><div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;<span class="comment">C                  will be adjusted accordingly.</span></div><div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;<span class="comment">C     ICNSTR    -- Integer array of length NEQ containing flags for</span></div><div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;<span class="comment">C                  checking constraints.</span></div><div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;<span class="comment">C     IERNEW    -- Error flag for Newton iteration.</span></div><div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;<span class="comment">C                   0  ==&gt; Newton iteration converged.</span></div><div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;<span class="comment">C                   1  ==&gt; failed to converge, but RATE .lt. 1, or the</span></div><div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;<span class="comment">C                          residual norm was reduced by a factor of .1.</span></div><div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;<span class="comment">C                   2  ==&gt; failed to converge, RATE .gt. RATEMX.</span></div><div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;<span class="comment">C                   3  ==&gt; other recoverable error.</span></div><div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;<span class="comment">C                  -1  ==&gt; unrecoverable error inside Newton iteration.</span></div><div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;<span class="comment">C   DFNRMK, DSLVK, DDWNRM, DLINSK, DCOPY</span></div><div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;<span class="comment">C***END PROLOGUE  DNSIK</span></div><div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),wt(*),id(*),delta(*),r(*),savr(*)</div><div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;      dimension yic(*),ypic(*),pwk(*),wm(*),iwm(*), rpar(*),ipar(*)</div><div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;      dimension icnstr(*)</div><div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;      <span class="keywordtype">EXTERNAL</span> res, psol</div><div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;      parameter(lnni=19, lnps=21, llocwp=29, llciwp=30)</div><div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;      parameter(llsoff=35, lstol=14)</div><div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;<span class="comment">C     Initializations.  M is the Newton iteration counter.</span></div><div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;      lsoff = iwm(llsoff)</div><div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;      <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> = 0</div><div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;      rate = 1.0d0</div><div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;      lwp = iwm(llocwp)</div><div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;      liwp = iwm(llciwp)</div><div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;      rlx = 0.4d0</div><div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;<span class="comment">C     Save residual in SAVR.</span></div><div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, delta, 1, savr, 1)</div><div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;<span class="comment">C     Compute norm of (P-inverse)*(residual).</span></div><div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#adc50f97b82ff1c8ce2a6a9e1ec1d1987">dfnrmk</a> (neq, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, <a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>, yprime, savr, r, cj, tscale, wt,</div><div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;     *   sqrtn, rsqrtn, res, ires, psol, 1, ier, fnrm, eplin,</div><div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;     *   wm(lwp), iwm(liwp), pwk, rpar, ipar)</div><div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;      iwm(lnps) = iwm(lnps) + 1</div><div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;      <span class="keywordflow">IF</span> (ier .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;        iernew = 3</div><div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;        <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;<span class="comment">C     Return now if residual norm is .le. EPCON.</span></div><div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;      <span class="keywordflow">IF</span> (fnrm .LE. epcon) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;<span class="comment">C     Newton iteration loop.</span></div><div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;      fnrm0 = fnrm</div><div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;300   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;      iwm(lnni) = iwm(lnni) + 1</div><div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;<span class="comment">C     Compute a new step vector DELTA.</span></div><div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a802f3562fe48073d5b35370a79347a6c">dslvk</a> (neq, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, <a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>, yprime, savr, delta, wt, wm, iwm,</div><div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;     *   res, ires, psol, iersl, cj, eplin, sqrtn, rsqrtn, rhok,</div><div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;     *   rpar, ipar)</div><div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;      <span class="keywordflow">IF</span> (ires .NE. 0 .OR. iersl .NE. 0) <span class="keywordflow">GO TO</span> 390</div><div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;<span class="comment">C     Get norm of DELTA.  Return now if DELTA is zero.</span></div><div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;      delnrm = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,delta,wt,rpar,ipar)</div><div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;      <span class="keywordflow">IF</span> (delnrm .EQ. 0.0d0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;<span class="comment">C     Call linesearch routine for global strategy and set RATE.</span></div><div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;      oldfnm = fnrm</div><div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#af28f4b41dfa398d7f73b1b5a6e68519c">dlinsk</a> (neq, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, <a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>, yprime, savr, cj, tscale, delta, delnrm,</div><div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;     *   wt, sqrtn, rsqrtn, lsoff, stptol, iret, res, ires, psol,</div><div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;     *   wm, iwm, rhok, fnrm, icopt, id, wm(lwp), iwm(liwp), r, eplin,</div><div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;     *   yic, ypic, pwk, icnflg, icnstr, rlx, rpar, ipar)</div><div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;      rate = fnrm/oldfnm</div><div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;<span class="comment">C     Check for error condition from linesearch.</span></div><div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;      <span class="keywordflow">IF</span> (iret .NE. 0) <span class="keywordflow">GO TO</span> 390</div><div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;<span class="comment">C     Test for convergence of the iteration, and return or loop.</span></div><div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;      <span class="keywordflow">IF</span> (fnrm .LE. epcon) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;<span class="comment">C     The iteration has not yet converged.  Update M.</span></div><div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;<span class="comment">C     Test whether the maximum number of iterations have been tried.</span></div><div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;      <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> = <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> + 1</div><div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;      <span class="keywordflow">IF</span>(<a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> .GE. maxit) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;<span class="comment">C     Copy the residual SAVR to DELTA and loop for another iteration.</span></div><div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq,  savr, 1, delta, 1)</div><div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;      <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;<span class="comment">C     The maximum number of iterations was done.  Set IERNEW and return.</span></div><div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;380   <span class="keywordflow">IF</span> (rate .LE. ratemx .OR. fnrm .LE. 0.1d0*fnrm0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;         iernew = 1</div><div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;         iernew = 2</div><div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;390   <span class="keywordflow">IF</span> (ires .LE. -2 .OR. iersl .LT. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;         iernew = -1</div><div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;         iernew = 3</div><div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;         <span class="keywordflow">IF</span> (ires .EQ. 0 .AND. iersl .EQ. 1 .AND. <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> .GE. 2 </div><div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;     1       .AND. rate .LT. 1.0d0) iernew = 1</div><div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;<span class="comment">C----------------------- END OF SUBROUTINE DNSIK------------------------</span></div><div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#af28f4b41dfa398d7f73b1b5a6e68519c">dlinsk</a> (NEQ, Y, T, YPRIME, SAVR, CJ, TSCALE, P, PNRM,</div><div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;     *   WT, SQRTN, RSQRTN, LSOFF, STPTOL, IRET, RES, IRES, PSOL,</div><div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;     *   WM, IWM, RHOK, FNRM, ICOPT, ID, WP, IWP, R, EPLIN, YNEW, YPNEW,</div><div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;     *   PWK, ICNFLG, ICNSTR, RLX, RPAR, IPAR)</div><div class="line"><a name="l05518"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#af28f4b41dfa398d7f73b1b5a6e68519c"> 5518</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DLINSK</span></div><div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;<span class="comment">C***REFER TO  DNSIK</span></div><div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;<span class="comment">C***DATE WRITTEN   940830   (YYMMDD)</span></div><div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;<span class="comment">C***REVISION DATE  951006   (Arguments SQRTN, RSQRTN added.)</span></div><div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;<span class="comment">C***REVISION DATE  960129   Moved line RL = ONE to top block.</span></div><div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;<span class="comment">C***REVISION DATE  000628   TSCALE argument added.</span></div><div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;<span class="comment">C***REVISION DATE  000628   RHOK*RHOK term removed in alpha test.</span></div><div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;<span class="comment">C     DLINSK uses a linesearch algorithm to calculate a new (Y,YPRIME)</span></div><div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;<span class="comment">C     pair (YNEW,YPNEW) such that </span></div><div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;<span class="comment">C     f(YNEW,YPNEW) .le. (1 - 2*ALPHA*RL)*f(Y,YPRIME)</span></div><div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;<span class="comment">C     where 0 &lt; RL &lt;= 1, and RHOK is the scaled preconditioned norm of</span></div><div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;<span class="comment">C     the final residual vector in the Krylov iteration.  </span></div><div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;<span class="comment">C     Here, f(y,y&#39;) is defined as</span></div><div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;<span class="comment">C      f(y,y&#39;) = (1/2)*norm( (P-inverse)*G(t,y,y&#39;) )**2 ,</span></div><div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;<span class="comment">C     where norm() is the weighted RMS vector norm, G is the DAE</span></div><div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;<span class="comment">C     system residual function, and P is the preconditioner used</span></div><div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;<span class="comment">C     in the Krylov iteration.</span></div><div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;<span class="comment">C     In addition to the parameters defined elsewhere, we have</span></div><div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;<span class="comment">C     SAVR    -- Work array of length NEQ, containing the residual</span></div><div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;<span class="comment">C                vector G(t,y,y&#39;) on return.</span></div><div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;<span class="comment">C     TSCALE  -- Scale factor in T, used for stopping tests if nonzero.</span></div><div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;<span class="comment">C     P       -- Approximate Newton step used in backtracking.</span></div><div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;<span class="comment">C     PNRM    -- Weighted RMS norm of P.</span></div><div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;<span class="comment">C     LSOFF   -- Flag showing whether the linesearch algorithm is</span></div><div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;<span class="comment">C                to be invoked.  0 means do the linesearch, </span></div><div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;<span class="comment">C                1 means turn off linesearch.</span></div><div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;<span class="comment">C     STPTOL  -- Tolerance used in calculating the minimum lambda</span></div><div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;<span class="comment">C                value allowed.</span></div><div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;<span class="comment">C     ICNFLG  -- Integer scalar.  If nonzero, then constraint violations</span></div><div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;<span class="comment">C                in the proposed new approximate solution will be</span></div><div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;<span class="comment">C                checked for, and the maximum step length will be</span></div><div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;<span class="comment">C                adjusted accordingly.</span></div><div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;<span class="comment">C     ICNSTR  -- Integer array of length NEQ containing flags for</span></div><div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;<span class="comment">C                checking constraints.</span></div><div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;<span class="comment">C     RHOK    -- Weighted norm of preconditioned Krylov residual.</span></div><div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;<span class="comment">C     RLX     -- Real scalar restricting update size in DCNSTR.</span></div><div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;<span class="comment">C     YNEW    -- Array of length NEQ used to hold the new Y in</span></div><div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;<span class="comment">C                performing the linesearch.</span></div><div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;<span class="comment">C     YPNEW   -- Array of length NEQ used to hold the new YPRIME in</span></div><div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;<span class="comment">C                performing the linesearch.</span></div><div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;<span class="comment">C     PWK     -- Work vector of length NEQ for use in PSOL.</span></div><div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;<span class="comment">C     Y       -- Array of length NEQ containing the new Y (i.e.,=YNEW).</span></div><div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;<span class="comment">C     YPRIME  -- Array of length NEQ containing the new YPRIME </span></div><div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;<span class="comment">C                (i.e.,=YPNEW).</span></div><div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;<span class="comment">C     FNRM    -- Real scalar containing SQRT(2*f(Y,YPRIME)) for the</span></div><div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;<span class="comment">C                current (Y,YPRIME) on input and output.</span></div><div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;<span class="comment">C     R       -- Work space length NEQ for residual vector.</span></div><div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;<span class="comment">C     IRET    -- Return flag.</span></div><div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;<span class="comment">C                IRET=0 means that a satisfactory (Y,YPRIME) was found.</span></div><div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;<span class="comment">C                IRET=1 means that the routine failed to find a new</span></div><div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;<span class="comment">C                       (Y,YPRIME) that was sufficiently distinct from</span></div><div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;<span class="comment">C                       the current (Y,YPRIME) pair.</span></div><div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;<span class="comment">C                IRET=2 means a failure in RES or PSOL.</span></div><div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;<span class="comment">C   DFNRMK, DYYPNW, DCNSTR, DCOPY, XERRWD</span></div><div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;<span class="comment">C***END PROLOGUE  DLINSK</span></div><div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, psol</div><div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*), yprime(*), <a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>(*), wt(*), savr(*), r(*), id(*)</div><div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;      dimension wm(*), iwm(*), ynew(*), ypnew(*), pwk(*), icnstr(*)</div><div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;      dimension wp(*), iwp(*), rpar(*), ipar(*)</div><div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;      <span class="keywordtype">CHARACTER</span> MSG*80</div><div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;      parameter(lnre=12, lnps=21, lkprin=31)</div><div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;      <span class="keywordtype">SAVE</span> <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>, one, two</div><div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;      <span class="keyword">DATA</span> <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>/1.0<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a>-4/, one/1.0d0/, two/2.0d0/</div><div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;      kprin=iwm(lkprin)</div><div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;      f1nrm = (fnrm*fnrm)/two</div><div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;      ratio = one</div><div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;      <span class="keywordflow">IF</span> (kprin .GE. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;        msg = <span class="stringliteral">&#39;------ IN ROUTINE DLINSK-- PNRM = (R1)&#39;</span></div><div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 38, 921, 0, 0, 0, 0, 1, pnrm, 0.0d0)</div><div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;      tau = pnrm</div><div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;      rl = one</div><div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;<span class="comment">C Check for violations of the constraints, if any are imposed.</span></div><div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;<span class="comment">C If any violations are found, the step vector P is rescaled, and the </span></div><div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;<span class="comment">C constraint check is repeated, until no violations are found.</span></div><div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;      <span class="keywordflow">IF</span> (icnflg .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160; 10      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a187e8c4e1cbbc063d8ba76ccef7bb89a">dyypnw</a> (neq,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,rl,<a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>,icopt,id,ynew,ypnew)</div><div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aae25a5609da387e4f1d6b45800ad6a36">dcnstr</a> (neq, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, ynew, icnstr, tau, rlx, iret, ivar)</div><div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;         <span class="keywordflow">IF</span> (iret .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;            ratio1 = tau/pnrm</div><div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;            ratio = ratio*ratio1</div><div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;            <span class="keywordflow">DO</span> 20 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160; 20           <a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)*ratio1</div><div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;            pnrm = tau</div><div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;            <span class="keywordflow">IF</span> (kprin .GE. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;              msg = <span class="stringliteral">&#39;------ CONSTRAINT VIOL., PNRM = (R1), INDEX = (I1)&#39;</span></div><div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;              <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 50, 922, 0, 1, ivar, 0, 1, pnrm, 0.0d0)</div><div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;<span class="keywordflow">              ENDIF</span></div><div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;            <span class="keywordflow">IF</span> (pnrm .LE. stptol) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;              iret = 1</div><div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;              <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;<span class="keywordflow">              ENDIF</span></div><div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;            <span class="keywordflow">GO TO</span> 10</div><div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;      slpi = -two*f1nrm*ratio</div><div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;      rlmin = stptol/pnrm</div><div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;      <span class="keywordflow">IF</span> (lsoff .EQ. 0 .AND. kprin .GE. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;        msg = <span class="stringliteral">&#39;------ MIN. LAMBDA = (R1)&#39;</span></div><div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 25, 923, 0, 0, 0, 0, 1, rlmin, 0.0d0)</div><div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;<span class="comment">C Begin iteration to find RL value satisfying alpha-condition.</span></div><div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;<span class="comment">C Update YNEW and YPNEW, then compute norm of new scaled residual and</span></div><div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;<span class="comment">C perform alpha condition test.</span></div><div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160; 100  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a187e8c4e1cbbc063d8ba76ccef7bb89a">dyypnw</a> (neq,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,rl,<a class="code" href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a>,icopt,id,ynew,ypnew)</div><div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#adc50f97b82ff1c8ce2a6a9e1ec1d1987">dfnrmk</a> (neq, ynew, t, ypnew, savr, r, cj, tscale, wt,</div><div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;     *   sqrtn, rsqrtn, res, ires, psol, 0, ier, fnrmp, eplin,</div><div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;     *   wp, iwp, pwk, rpar, ipar)</div><div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;      iwm(lnre) = iwm(lnre) + 1</div><div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;      <span class="keywordflow">IF</span> (ires .GE. 0) iwm(lnps) = iwm(lnps) + 1</div><div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;      <span class="keywordflow">IF</span> (ires .NE. 0 .OR. ier .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;        iret = 2</div><div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;        <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;      <span class="keywordflow">IF</span> (lsoff .EQ. 1) <span class="keywordflow">GO TO</span> 150</div><div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;      f1nrmp = fnrmp*fnrmp/two</div><div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;      <span class="keywordflow">IF</span> (kprin .GE. 2) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;        msg = <span class="stringliteral">&#39;------ LAMBDA = (R1)&#39;</span></div><div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 20, 924, 0, 0, 0, 0, 1, rl, 0.0d0)</div><div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;        msg = <span class="stringliteral">&#39;------ NORM(F1) = (R1),  NORM(F1NEW) = (R2)&#39;</span></div><div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 43, 925, 0, 0, 0, 0, 2, f1nrm, f1nrmp)</div><div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;      <span class="keywordflow">IF</span> (f1nrmp .GT. f1nrm + <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a>*slpi*rl) <span class="keywordflow">GO TO</span> 200</div><div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;<span class="comment">C Alpha-condition is satisfied, or linesearch is turned off.</span></div><div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;<span class="comment">C Copy YNEW,YPNEW to Y,YPRIME and return.</span></div><div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160; 150  iret = 0</div><div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a>(neq, ynew, 1, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, 1)</div><div class="line"><a name="l05677"></a><span class="lineno"> 5677</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a>(neq, ypnew, 1, yprime, 1)</div><div class="line"><a name="l05678"></a><span class="lineno"> 5678</span>&#160;      fnrm = fnrmp</div><div class="line"><a name="l05679"></a><span class="lineno"> 5679</span>&#160;      <span class="keywordflow">IF</span> (kprin .GE. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05680"></a><span class="lineno"> 5680</span>&#160;        msg = <span class="stringliteral">&#39;------ LEAVING ROUTINE DLINSK, FNRM = (R1)&#39;</span></div><div class="line"><a name="l05681"></a><span class="lineno"> 5681</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a>(msg, 42, 926, 0, 0, 0, 0, 1, fnrm, 0.0d0)</div><div class="line"><a name="l05682"></a><span class="lineno"> 5682</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l05683"></a><span class="lineno"> 5683</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05684"></a><span class="lineno"> 5684</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05685"></a><span class="lineno"> 5685</span>&#160;<span class="comment">C Alpha-condition not satisfied.  Perform backtrack to compute new RL</span></div><div class="line"><a name="l05686"></a><span class="lineno"> 5686</span>&#160;<span class="comment">C value.  If RL is less than RLMIN, i.e. no satisfactory YNEW,YPNEW can</span></div><div class="line"><a name="l05687"></a><span class="lineno"> 5687</span>&#160;<span class="comment">C be found sufficiently distinct from Y,YPRIME, then return IRET = 1.</span></div><div class="line"><a name="l05688"></a><span class="lineno"> 5688</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05689"></a><span class="lineno"> 5689</span>&#160; 200  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05690"></a><span class="lineno"> 5690</span>&#160;      <span class="keywordflow">IF</span> (rl .LT. rlmin) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05691"></a><span class="lineno"> 5691</span>&#160;        iret = 1</div><div class="line"><a name="l05692"></a><span class="lineno"> 5692</span>&#160;        <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05693"></a><span class="lineno"> 5693</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l05694"></a><span class="lineno"> 5694</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05695"></a><span class="lineno"> 5695</span>&#160;      rl = rl/two</div><div class="line"><a name="l05696"></a><span class="lineno"> 5696</span>&#160;      <span class="keywordflow">GO TO</span> 100</div><div class="line"><a name="l05697"></a><span class="lineno"> 5697</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05698"></a><span class="lineno"> 5698</span>&#160;<span class="comment">C----------------------- END OF SUBROUTINE DLINSK ----------------------</span></div><div class="line"><a name="l05699"></a><span class="lineno"> 5699</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l05700"></a><span class="lineno"> 5700</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#adc50f97b82ff1c8ce2a6a9e1ec1d1987">dfnrmk</a> (NEQ, Y, T, YPRIME, SAVR, R, CJ, TSCALE, WT,</div><div class="line"><a name="l05701"></a><span class="lineno"> 5701</span>&#160;     *                   SQRTN, RSQRTN, RES, IRES, PSOL, IRIN, IER,</div><div class="line"><a name="l05702"></a><span class="lineno"> 5702</span>&#160;     *                   FNORM, EPLIN, WP, IWP, PWK, RPAR, IPAR)</div><div class="line"><a name="l05703"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#adc50f97b82ff1c8ce2a6a9e1ec1d1987"> 5703</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05704"></a><span class="lineno"> 5704</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DFNRMK</span></div><div class="line"><a name="l05705"></a><span class="lineno"> 5705</span>&#160;<span class="comment">C***REFER TO  DLINSK</span></div><div class="line"><a name="l05706"></a><span class="lineno"> 5706</span>&#160;<span class="comment">C***DATE WRITTEN   940830   (YYMMDD)</span></div><div class="line"><a name="l05707"></a><span class="lineno"> 5707</span>&#160;<span class="comment">C***REVISION DATE  951006   (SQRTN, RSQRTN, and scaling of WT added.)</span></div><div class="line"><a name="l05708"></a><span class="lineno"> 5708</span>&#160;<span class="comment">C***REVISION DATE  000628   TSCALE argument added.</span></div><div class="line"><a name="l05709"></a><span class="lineno"> 5709</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05710"></a><span class="lineno"> 5710</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05711"></a><span class="lineno"> 5711</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05712"></a><span class="lineno"> 5712</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l05713"></a><span class="lineno"> 5713</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05714"></a><span class="lineno"> 5714</span>&#160;<span class="comment">C     DFNRMK calculates the scaled preconditioned norm of the nonlinear</span></div><div class="line"><a name="l05715"></a><span class="lineno"> 5715</span>&#160;<span class="comment">C     function used in the nonlinear iteration for obtaining consistent</span></div><div class="line"><a name="l05716"></a><span class="lineno"> 5716</span>&#160;<span class="comment">C     initial conditions.  Specifically, DFNRMK calculates the weighted</span></div><div class="line"><a name="l05717"></a><span class="lineno"> 5717</span>&#160;<span class="comment">C     root-mean-square norm of the vector (P-inverse)*G(T,Y,YPRIME),</span></div><div class="line"><a name="l05718"></a><span class="lineno"> 5718</span>&#160;<span class="comment">C     where P is the preconditioner matrix.</span></div><div class="line"><a name="l05719"></a><span class="lineno"> 5719</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05720"></a><span class="lineno"> 5720</span>&#160;<span class="comment">C     In addition to the parameters described in the calling program</span></div><div class="line"><a name="l05721"></a><span class="lineno"> 5721</span>&#160;<span class="comment">C     DLINSK, the parameters represent</span></div><div class="line"><a name="l05722"></a><span class="lineno"> 5722</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05723"></a><span class="lineno"> 5723</span>&#160;<span class="comment">C     TSCALE -- Scale factor in T, used for stopping tests if nonzero.</span></div><div class="line"><a name="l05724"></a><span class="lineno"> 5724</span>&#160;<span class="comment">C     IRIN   -- Flag showing whether the current residual vector is</span></div><div class="line"><a name="l05725"></a><span class="lineno"> 5725</span>&#160;<span class="comment">C               input in SAVR.  1 means it is, 0 means it is not.</span></div><div class="line"><a name="l05726"></a><span class="lineno"> 5726</span>&#160;<span class="comment">C     R      -- Array of length NEQ that contains</span></div><div class="line"><a name="l05727"></a><span class="lineno"> 5727</span>&#160;<span class="comment">C               (P-inverse)*G(T,Y,YPRIME) on return.</span></div><div class="line"><a name="l05728"></a><span class="lineno"> 5728</span>&#160;<span class="comment">C     FNORM  -- Scalar containing the weighted norm of R on return.</span></div><div class="line"><a name="l05729"></a><span class="lineno"> 5729</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05730"></a><span class="lineno"> 5730</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05731"></a><span class="lineno"> 5731</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l05732"></a><span class="lineno"> 5732</span>&#160;<span class="comment">C   RES, DCOPY, DSCAL, PSOL, DDWNRM</span></div><div class="line"><a name="l05733"></a><span class="lineno"> 5733</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05734"></a><span class="lineno"> 5734</span>&#160;<span class="comment">C***END PROLOGUE  DFNRMK</span></div><div class="line"><a name="l05735"></a><span class="lineno"> 5735</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05736"></a><span class="lineno"> 5736</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05737"></a><span class="lineno"> 5737</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span> (<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l05738"></a><span class="lineno"> 5738</span>&#160;      <span class="keywordtype">EXTERNAL</span> res, psol</div><div class="line"><a name="l05739"></a><span class="lineno"> 5739</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*), yprime(*), wt(*), savr(*), r(*), pwk(*)</div><div class="line"><a name="l05740"></a><span class="lineno"> 5740</span>&#160;      dimension wp(*), iwp(*), rpar(*), ipar(*)</div><div class="line"><a name="l05741"></a><span class="lineno"> 5741</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05742"></a><span class="lineno"> 5742</span>&#160;<span class="comment">C     Call RES routine if IRIN = 0.</span></div><div class="line"><a name="l05743"></a><span class="lineno"> 5743</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05744"></a><span class="lineno"> 5744</span>&#160;      <span class="keywordflow">IF</span> (irin .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05745"></a><span class="lineno"> 5745</span>&#160;        ires = 0</div><div class="line"><a name="l05746"></a><span class="lineno"> 5746</span>&#160;        <span class="keyword">CALL </span>res (t, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, yprime, cj, savr, ires, rpar, ipar)</div><div class="line"><a name="l05747"></a><span class="lineno"> 5747</span>&#160;        <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05748"></a><span class="lineno"> 5748</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l05749"></a><span class="lineno"> 5749</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05750"></a><span class="lineno"> 5750</span>&#160;<span class="comment">C     Apply inverse of left preconditioner to vector R.</span></div><div class="line"><a name="l05751"></a><span class="lineno"> 5751</span>&#160;<span class="comment">C     First scale WT array by 1/sqrt(N), and undo scaling afterward.</span></div><div class="line"><a name="l05752"></a><span class="lineno"> 5752</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05753"></a><span class="lineno"> 5753</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a>(neq, savr, 1, r, 1)</div><div class="line"><a name="l05754"></a><span class="lineno"> 5754</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a0590f8db475e11dc2c9137bb13887acf">dscal</a> (neq, rsqrtn, wt, 1)</div><div class="line"><a name="l05755"></a><span class="lineno"> 5755</span>&#160;      ier = 0</div><div class="line"><a name="l05756"></a><span class="lineno"> 5756</span>&#160;      <span class="keyword">CALL </span>psol (neq, t, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, yprime, savr, pwk, cj, wt, wp, iwp,</div><div class="line"><a name="l05757"></a><span class="lineno"> 5757</span>&#160;     *           r, eplin, ier, rpar, ipar)</div><div class="line"><a name="l05758"></a><span class="lineno"> 5758</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a0590f8db475e11dc2c9137bb13887acf">dscal</a> (neq, sqrtn, wt, 1)</div><div class="line"><a name="l05759"></a><span class="lineno"> 5759</span>&#160;      <span class="keywordflow">IF</span> (ier .NE. 0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05760"></a><span class="lineno"> 5760</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05761"></a><span class="lineno"> 5761</span>&#160;<span class="comment">C     Calculate norm of R.</span></div><div class="line"><a name="l05762"></a><span class="lineno"> 5762</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05763"></a><span class="lineno"> 5763</span>&#160;      fnorm = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq, r, wt, rpar, ipar)</div><div class="line"><a name="l05764"></a><span class="lineno"> 5764</span>&#160;      <span class="keywordflow">IF</span> (tscale .GT. 0.0d0) fnorm = fnorm*tscale*abs(cj)</div><div class="line"><a name="l05765"></a><span class="lineno"> 5765</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05766"></a><span class="lineno"> 5766</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l05767"></a><span class="lineno"> 5767</span>&#160;<span class="comment">C----------------------- END OF SUBROUTINE DFNRMK ----------------------</span></div><div class="line"><a name="l05768"></a><span class="lineno"> 5768</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l05769"></a><span class="lineno"> 5769</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a85856bdb5c050759a3609e2ec8ebe7b0">dnedk</a>(X,Y,YPRIME,NEQ,RES,JACK,PSOL,</div><div class="line"><a name="l05770"></a><span class="lineno"> 5770</span>&#160;     *   H,WT,JSTART,IDID,RPAR,IPAR,PHI,GAMMA,SAVR,DELTA,E,</div><div class="line"><a name="l05771"></a><span class="lineno"> 5771</span>&#160;     *   WM,IWM,CJ,CJOLD,CJLAST,S,UROUND,EPLI,SQRTN,RSQRTN,</div><div class="line"><a name="l05772"></a><span class="lineno"> 5772</span>&#160;     *   EPCON,JCALC,JFLG,KP1,NONNEG,NTYPE,IERNLS)</div><div class="line"><a name="l05773"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a85856bdb5c050759a3609e2ec8ebe7b0"> 5773</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05774"></a><span class="lineno"> 5774</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DNEDK</span></div><div class="line"><a name="l05775"></a><span class="lineno"> 5775</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l05776"></a><span class="lineno"> 5776</span>&#160;<span class="comment">C***DATE WRITTEN   891219   (YYMMDD)</span></div><div class="line"><a name="l05777"></a><span class="lineno"> 5777</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l05778"></a><span class="lineno"> 5778</span>&#160;<span class="comment">C***REVISION DATE  940701   (YYMMDD)</span></div><div class="line"><a name="l05779"></a><span class="lineno"> 5779</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05780"></a><span class="lineno"> 5780</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05781"></a><span class="lineno"> 5781</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05782"></a><span class="lineno"> 5782</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l05783"></a><span class="lineno"> 5783</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05784"></a><span class="lineno"> 5784</span>&#160;<span class="comment">C     DNEDK solves a nonlinear system of</span></div><div class="line"><a name="l05785"></a><span class="lineno"> 5785</span>&#160;<span class="comment">C     algebraic equations of the form</span></div><div class="line"><a name="l05786"></a><span class="lineno"> 5786</span>&#160;<span class="comment">C     G(X,Y,YPRIME) = 0 for the unknown Y.</span></div><div class="line"><a name="l05787"></a><span class="lineno"> 5787</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05788"></a><span class="lineno"> 5788</span>&#160;<span class="comment">C     The method used is a matrix-free Newton scheme.</span></div><div class="line"><a name="l05789"></a><span class="lineno"> 5789</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05790"></a><span class="lineno"> 5790</span>&#160;<span class="comment">C     The parameters represent</span></div><div class="line"><a name="l05791"></a><span class="lineno"> 5791</span>&#160;<span class="comment">C     X         -- Independent variable.</span></div><div class="line"><a name="l05792"></a><span class="lineno"> 5792</span>&#160;<span class="comment">C     Y         -- Solution vector at x.</span></div><div class="line"><a name="l05793"></a><span class="lineno"> 5793</span>&#160;<span class="comment">C     YPRIME    -- Derivative of solution vector</span></div><div class="line"><a name="l05794"></a><span class="lineno"> 5794</span>&#160;<span class="comment">C                  after successful step.</span></div><div class="line"><a name="l05795"></a><span class="lineno"> 5795</span>&#160;<span class="comment">C     NEQ       -- Number of equations to be integrated.</span></div><div class="line"><a name="l05796"></a><span class="lineno"> 5796</span>&#160;<span class="comment">C     RES       -- External user-supplied subroutine</span></div><div class="line"><a name="l05797"></a><span class="lineno"> 5797</span>&#160;<span class="comment">C                  to evaluate the residual.  See RES description</span></div><div class="line"><a name="l05798"></a><span class="lineno"> 5798</span>&#160;<span class="comment">C                  in DDASPK prologue.</span></div><div class="line"><a name="l05799"></a><span class="lineno"> 5799</span>&#160;<span class="comment">C     JACK     --  External user-supplied routine to update</span></div><div class="line"><a name="l05800"></a><span class="lineno"> 5800</span>&#160;<span class="comment">C                  the preconditioner.  (This is optional).</span></div><div class="line"><a name="l05801"></a><span class="lineno"> 5801</span>&#160;<span class="comment">C                  See JAC description for the case</span></div><div class="line"><a name="l05802"></a><span class="lineno"> 5802</span>&#160;<span class="comment">C                  INFO(12) = 1 in the DDASPK prologue.</span></div><div class="line"><a name="l05803"></a><span class="lineno"> 5803</span>&#160;<span class="comment">C     PSOL      -- External user-supplied routine to solve</span></div><div class="line"><a name="l05804"></a><span class="lineno"> 5804</span>&#160;<span class="comment">C                  a linear system using preconditioning. </span></div><div class="line"><a name="l05805"></a><span class="lineno"> 5805</span>&#160;<span class="comment">C                  (This is optional).  See explanation inside DDASPK.</span></div><div class="line"><a name="l05806"></a><span class="lineno"> 5806</span>&#160;<span class="comment">C     H         -- Appropriate step size for this step.</span></div><div class="line"><a name="l05807"></a><span class="lineno"> 5807</span>&#160;<span class="comment">C     WT        -- Vector of weights for error criterion.</span></div><div class="line"><a name="l05808"></a><span class="lineno"> 5808</span>&#160;<span class="comment">C     JSTART    -- Indicates first call to this routine.</span></div><div class="line"><a name="l05809"></a><span class="lineno"> 5809</span>&#160;<span class="comment">C                  If JSTART = 0, then this is the first call,</span></div><div class="line"><a name="l05810"></a><span class="lineno"> 5810</span>&#160;<span class="comment">C                  otherwise it is not.</span></div><div class="line"><a name="l05811"></a><span class="lineno"> 5811</span>&#160;<span class="comment">C     IDID      -- Completion flag, output by DNEDK.</span></div><div class="line"><a name="l05812"></a><span class="lineno"> 5812</span>&#160;<span class="comment">C                  See IDID description in DDASPK prologue.</span></div><div class="line"><a name="l05813"></a><span class="lineno"> 5813</span>&#160;<span class="comment">C     RPAR,IPAR -- Real and integer arrays used for communication</span></div><div class="line"><a name="l05814"></a><span class="lineno"> 5814</span>&#160;<span class="comment">C                  between the calling program and external user</span></div><div class="line"><a name="l05815"></a><span class="lineno"> 5815</span>&#160;<span class="comment">C                  routines.  They are not altered within DASPK.</span></div><div class="line"><a name="l05816"></a><span class="lineno"> 5816</span>&#160;<span class="comment">C     PHI       -- Array of divided differences used by</span></div><div class="line"><a name="l05817"></a><span class="lineno"> 5817</span>&#160;<span class="comment">C                  DNEDK.  The length is NEQ*(K+1), where</span></div><div class="line"><a name="l05818"></a><span class="lineno"> 5818</span>&#160;<span class="comment">C                  K is the maximum order.</span></div><div class="line"><a name="l05819"></a><span class="lineno"> 5819</span>&#160;<span class="comment">C     GAMMA     -- Array used to predict Y and YPRIME.  The length</span></div><div class="line"><a name="l05820"></a><span class="lineno"> 5820</span>&#160;<span class="comment">C                  is K+1, where K is the maximum order.</span></div><div class="line"><a name="l05821"></a><span class="lineno"> 5821</span>&#160;<span class="comment">C     SAVR      -- Work vector for DNEDK of length NEQ.</span></div><div class="line"><a name="l05822"></a><span class="lineno"> 5822</span>&#160;<span class="comment">C     DELTA     -- Work vector for DNEDK of length NEQ.</span></div><div class="line"><a name="l05823"></a><span class="lineno"> 5823</span>&#160;<span class="comment">C     E         -- Error accumulation vector for DNEDK of length NEQ.</span></div><div class="line"><a name="l05824"></a><span class="lineno"> 5824</span>&#160;<span class="comment">C     WM,IWM    -- Real and integer arrays storing</span></div><div class="line"><a name="l05825"></a><span class="lineno"> 5825</span>&#160;<span class="comment">C                  matrix information for linear system</span></div><div class="line"><a name="l05826"></a><span class="lineno"> 5826</span>&#160;<span class="comment">C                  solvers, and various other information.</span></div><div class="line"><a name="l05827"></a><span class="lineno"> 5827</span>&#160;<span class="comment">C     CJ        -- Parameter always proportional to 1/H.</span></div><div class="line"><a name="l05828"></a><span class="lineno"> 5828</span>&#160;<span class="comment">C     CJOLD     -- Saves the value of CJ as of the last call to DITMD.</span></div><div class="line"><a name="l05829"></a><span class="lineno"> 5829</span>&#160;<span class="comment">C                  Accounts for changes in CJ needed to</span></div><div class="line"><a name="l05830"></a><span class="lineno"> 5830</span>&#160;<span class="comment">C                  decide whether to call DITMD.</span></div><div class="line"><a name="l05831"></a><span class="lineno"> 5831</span>&#160;<span class="comment">C     CJLAST    -- Previous value of CJ.</span></div><div class="line"><a name="l05832"></a><span class="lineno"> 5832</span>&#160;<span class="comment">C     S         -- A scalar determined by the approximate rate</span></div><div class="line"><a name="l05833"></a><span class="lineno"> 5833</span>&#160;<span class="comment">C                  of convergence of the Newton iteration and used</span></div><div class="line"><a name="l05834"></a><span class="lineno"> 5834</span>&#160;<span class="comment">C                  in the convergence test for the Newton iteration.</span></div><div class="line"><a name="l05835"></a><span class="lineno"> 5835</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05836"></a><span class="lineno"> 5836</span>&#160;<span class="comment">C                  If RATE is defined to be an estimate of the</span></div><div class="line"><a name="l05837"></a><span class="lineno"> 5837</span>&#160;<span class="comment">C                  rate of convergence of the Newton iteration,</span></div><div class="line"><a name="l05838"></a><span class="lineno"> 5838</span>&#160;<span class="comment">C                  then S = RATE/(1.D0-RATE).</span></div><div class="line"><a name="l05839"></a><span class="lineno"> 5839</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05840"></a><span class="lineno"> 5840</span>&#160;<span class="comment">C                  The closer RATE is to 0., the faster the Newton</span></div><div class="line"><a name="l05841"></a><span class="lineno"> 5841</span>&#160;<span class="comment">C                  iteration is converging; the closer RATE is to 1.,</span></div><div class="line"><a name="l05842"></a><span class="lineno"> 5842</span>&#160;<span class="comment">C                  the slower the Newton iteration is converging.</span></div><div class="line"><a name="l05843"></a><span class="lineno"> 5843</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05844"></a><span class="lineno"> 5844</span>&#160;<span class="comment">C                  On the first Newton iteration with an up-dated</span></div><div class="line"><a name="l05845"></a><span class="lineno"> 5845</span>&#160;<span class="comment">C                  preconditioner S = 100.D0, Thus the initial</span></div><div class="line"><a name="l05846"></a><span class="lineno"> 5846</span>&#160;<span class="comment">C                  RATE of convergence is approximately 1.</span></div><div class="line"><a name="l05847"></a><span class="lineno"> 5847</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05848"></a><span class="lineno"> 5848</span>&#160;<span class="comment">C                  S is preserved from call to call so that the rate</span></div><div class="line"><a name="l05849"></a><span class="lineno"> 5849</span>&#160;<span class="comment">C                  estimate from a previous step can be applied to</span></div><div class="line"><a name="l05850"></a><span class="lineno"> 5850</span>&#160;<span class="comment">C                  the current step.</span></div><div class="line"><a name="l05851"></a><span class="lineno"> 5851</span>&#160;<span class="comment">C     UROUND    -- Unit roundoff.  Not used here.</span></div><div class="line"><a name="l05852"></a><span class="lineno"> 5852</span>&#160;<span class="comment">C     EPLI      -- convergence test constant.</span></div><div class="line"><a name="l05853"></a><span class="lineno"> 5853</span>&#160;<span class="comment">C                  See DDASPK prologue for more details.</span></div><div class="line"><a name="l05854"></a><span class="lineno"> 5854</span>&#160;<span class="comment">C     SQRTN     -- Square root of NEQ.</span></div><div class="line"><a name="l05855"></a><span class="lineno"> 5855</span>&#160;<span class="comment">C     RSQRTN    -- reciprical of square root of NEQ.</span></div><div class="line"><a name="l05856"></a><span class="lineno"> 5856</span>&#160;<span class="comment">C     EPCON     -- Tolerance to test for convergence of the Newton</span></div><div class="line"><a name="l05857"></a><span class="lineno"> 5857</span>&#160;<span class="comment">C                  iteration.</span></div><div class="line"><a name="l05858"></a><span class="lineno"> 5858</span>&#160;<span class="comment">C     JCALC     -- Flag used to determine when to update</span></div><div class="line"><a name="l05859"></a><span class="lineno"> 5859</span>&#160;<span class="comment">C                  the Jacobian matrix.  In general:</span></div><div class="line"><a name="l05860"></a><span class="lineno"> 5860</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05861"></a><span class="lineno"> 5861</span>&#160;<span class="comment">C                  JCALC = -1 ==&gt; Call the DITMD routine to update</span></div><div class="line"><a name="l05862"></a><span class="lineno"> 5862</span>&#160;<span class="comment">C                                 the Jacobian matrix.</span></div><div class="line"><a name="l05863"></a><span class="lineno"> 5863</span>&#160;<span class="comment">C                  JCALC =  0 ==&gt; Jacobian matrix is up-to-date.</span></div><div class="line"><a name="l05864"></a><span class="lineno"> 5864</span>&#160;<span class="comment">C                  JCALC =  1 ==&gt; Jacobian matrix is out-dated,</span></div><div class="line"><a name="l05865"></a><span class="lineno"> 5865</span>&#160;<span class="comment">C                                 but DITMD will not be called unless</span></div><div class="line"><a name="l05866"></a><span class="lineno"> 5866</span>&#160;<span class="comment">C                                 JCALC is set to -1.</span></div><div class="line"><a name="l05867"></a><span class="lineno"> 5867</span>&#160;<span class="comment">C     JFLG      -- Flag showing whether a Jacobian routine is supplied.</span></div><div class="line"><a name="l05868"></a><span class="lineno"> 5868</span>&#160;<span class="comment">C     KP1       -- The current order + 1;  updated across calls.</span></div><div class="line"><a name="l05869"></a><span class="lineno"> 5869</span>&#160;<span class="comment">C     NONNEG    -- Flag to determine nonnegativity constraints.</span></div><div class="line"><a name="l05870"></a><span class="lineno"> 5870</span>&#160;<span class="comment">C     NTYPE     -- Identification code for the DNEDK routine.</span></div><div class="line"><a name="l05871"></a><span class="lineno"> 5871</span>&#160;<span class="comment">C                   1 ==&gt; modified Newton; iterative linear solver.</span></div><div class="line"><a name="l05872"></a><span class="lineno"> 5872</span>&#160;<span class="comment">C                   2 ==&gt; modified Newton; user-supplied linear solver.</span></div><div class="line"><a name="l05873"></a><span class="lineno"> 5873</span>&#160;<span class="comment">C     IERNLS    -- Error flag for nonlinear solver.</span></div><div class="line"><a name="l05874"></a><span class="lineno"> 5874</span>&#160;<span class="comment">C                   0 ==&gt; nonlinear solver converged.</span></div><div class="line"><a name="l05875"></a><span class="lineno"> 5875</span>&#160;<span class="comment">C                   1 ==&gt; recoverable error inside non-linear solver.</span></div><div class="line"><a name="l05876"></a><span class="lineno"> 5876</span>&#160;<span class="comment">C                  -1 ==&gt; unrecoverable error inside non-linear solver.</span></div><div class="line"><a name="l05877"></a><span class="lineno"> 5877</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05878"></a><span class="lineno"> 5878</span>&#160;<span class="comment">C     The following group of variables are passed as arguments to</span></div><div class="line"><a name="l05879"></a><span class="lineno"> 5879</span>&#160;<span class="comment">C     the Newton iteration solver.  They are explained in greater detail</span></div><div class="line"><a name="l05880"></a><span class="lineno"> 5880</span>&#160;<span class="comment">C     in DNSK:</span></div><div class="line"><a name="l05881"></a><span class="lineno"> 5881</span>&#160;<span class="comment">C        TOLNEW, MULDEL, MAXIT, IERNEW</span></div><div class="line"><a name="l05882"></a><span class="lineno"> 5882</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05883"></a><span class="lineno"> 5883</span>&#160;<span class="comment">C     IERTYP -- Flag which tells whether this subroutine is correct.</span></div><div class="line"><a name="l05884"></a><span class="lineno"> 5884</span>&#160;<span class="comment">C               0 ==&gt; correct subroutine.</span></div><div class="line"><a name="l05885"></a><span class="lineno"> 5885</span>&#160;<span class="comment">C               1 ==&gt; incorrect subroutine.</span></div><div class="line"><a name="l05886"></a><span class="lineno"> 5886</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05887"></a><span class="lineno"> 5887</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l05888"></a><span class="lineno"> 5888</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l05889"></a><span class="lineno"> 5889</span>&#160;<span class="comment">C   RES, JACK, DDWNRM, DNSK</span></div><div class="line"><a name="l05890"></a><span class="lineno"> 5890</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05891"></a><span class="lineno"> 5891</span>&#160;<span class="comment">C***END PROLOGUE  DNEDK</span></div><div class="line"><a name="l05892"></a><span class="lineno"> 5892</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05893"></a><span class="lineno"> 5893</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05894"></a><span class="lineno"> 5894</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l05895"></a><span class="lineno"> 5895</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),wt(*)</div><div class="line"><a name="l05896"></a><span class="lineno"> 5896</span>&#160;      dimension phi(neq,*),savr(*),delta(*),<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(*)</div><div class="line"><a name="l05897"></a><span class="lineno"> 5897</span>&#160;      dimension wm(*),iwm(*)</div><div class="line"><a name="l05898"></a><span class="lineno"> 5898</span>&#160;      dimension gamma(*),rpar(*),ipar(*)</div><div class="line"><a name="l05899"></a><span class="lineno"> 5899</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, jack, psol</div><div class="line"><a name="l05900"></a><span class="lineno"> 5900</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05901"></a><span class="lineno"> 5901</span>&#160;      parameter(lnre=12, lnje=13, llocwp=29, llciwp=30)</div><div class="line"><a name="l05902"></a><span class="lineno"> 5902</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05903"></a><span class="lineno"> 5903</span>&#160;      <span class="keywordtype">SAVE</span> muldel, maxit, xrate</div><div class="line"><a name="l05904"></a><span class="lineno"> 5904</span>&#160;      <span class="keyword">DATA</span> muldel/0/, maxit/4/, xrate/0.25d0/</div><div class="line"><a name="l05905"></a><span class="lineno"> 5905</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05906"></a><span class="lineno"> 5906</span>&#160;<span class="comment">C     Verify that this is the correct subroutine.</span></div><div class="line"><a name="l05907"></a><span class="lineno"> 5907</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05908"></a><span class="lineno"> 5908</span>&#160;      iertyp = 0</div><div class="line"><a name="l05909"></a><span class="lineno"> 5909</span>&#160;      <span class="keywordflow">IF</span> (ntype .NE. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05910"></a><span class="lineno"> 5910</span>&#160;         iertyp = 1</div><div class="line"><a name="l05911"></a><span class="lineno"> 5911</span>&#160;         <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l05912"></a><span class="lineno"> 5912</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l05913"></a><span class="lineno"> 5913</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05914"></a><span class="lineno"> 5914</span>&#160;<span class="comment">C     If this is the first step, perform initializations.</span></div><div class="line"><a name="l05915"></a><span class="lineno"> 5915</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05916"></a><span class="lineno"> 5916</span>&#160;      <span class="keywordflow">IF</span> (jstart .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05917"></a><span class="lineno"> 5917</span>&#160;         cjold = cj</div><div class="line"><a name="l05918"></a><span class="lineno"> 5918</span>&#160;         jcalc = -1</div><div class="line"><a name="l05919"></a><span class="lineno"> 5919</span>&#160;         <a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = 100.d0</div><div class="line"><a name="l05920"></a><span class="lineno"> 5920</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l05921"></a><span class="lineno"> 5921</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05922"></a><span class="lineno"> 5922</span>&#160;<span class="comment">C     Perform all other initializations.</span></div><div class="line"><a name="l05923"></a><span class="lineno"> 5923</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05924"></a><span class="lineno"> 5924</span>&#160;      iernls = 0</div><div class="line"><a name="l05925"></a><span class="lineno"> 5925</span>&#160;      lwp = iwm(llocwp)</div><div class="line"><a name="l05926"></a><span class="lineno"> 5926</span>&#160;      liwp = iwm(llciwp)</div><div class="line"><a name="l05927"></a><span class="lineno"> 5927</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05928"></a><span class="lineno"> 5928</span>&#160;<span class="comment">C     Decide whether to update the preconditioner.</span></div><div class="line"><a name="l05929"></a><span class="lineno"> 5929</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05930"></a><span class="lineno"> 5930</span>&#160;      <span class="keywordflow">IF</span> (jflg .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05931"></a><span class="lineno"> 5931</span>&#160;         temp1 = (1.0d0 - xrate)/(1.0d0 + xrate)</div><div class="line"><a name="l05932"></a><span class="lineno"> 5932</span>&#160;         temp2 = 1.0d0/temp1</div><div class="line"><a name="l05933"></a><span class="lineno"> 5933</span>&#160;         <span class="keywordflow">IF</span> (cj/cjold .LT. temp1 .OR. cj/cjold .GT. temp2) jcalc = -1</div><div class="line"><a name="l05934"></a><span class="lineno"> 5934</span>&#160;         <span class="keywordflow">IF</span> (cj .NE. cjlast) <a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = 100.d0</div><div class="line"><a name="l05935"></a><span class="lineno"> 5935</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l05936"></a><span class="lineno"> 5936</span>&#160;         jcalc = 0</div><div class="line"><a name="l05937"></a><span class="lineno"> 5937</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l05938"></a><span class="lineno"> 5938</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05939"></a><span class="lineno"> 5939</span>&#160;<span class="comment">C     Looping point for updating preconditioner with current stepsize.</span></div><div class="line"><a name="l05940"></a><span class="lineno"> 5940</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05941"></a><span class="lineno"> 5941</span>&#160;300   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05942"></a><span class="lineno"> 5942</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05943"></a><span class="lineno"> 5943</span>&#160;<span class="comment">C     Initialize all error flags to zero.</span></div><div class="line"><a name="l05944"></a><span class="lineno"> 5944</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05945"></a><span class="lineno"> 5945</span>&#160;      ierpj = 0</div><div class="line"><a name="l05946"></a><span class="lineno"> 5946</span>&#160;      ires = 0</div><div class="line"><a name="l05947"></a><span class="lineno"> 5947</span>&#160;      iersl = 0</div><div class="line"><a name="l05948"></a><span class="lineno"> 5948</span>&#160;      iernew = 0</div><div class="line"><a name="l05949"></a><span class="lineno"> 5949</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05950"></a><span class="lineno"> 5950</span>&#160;<span class="comment">C     Predict the solution and derivative and compute the tolerance</span></div><div class="line"><a name="l05951"></a><span class="lineno"> 5951</span>&#160;<span class="comment">C     for the Newton iteration.</span></div><div class="line"><a name="l05952"></a><span class="lineno"> 5952</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05953"></a><span class="lineno"> 5953</span>&#160;      <span class="keywordflow">DO</span> 310 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l05954"></a><span class="lineno"> 5954</span>&#160;         <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,1)</div><div class="line"><a name="l05955"></a><span class="lineno"> 5955</span>&#160;310      yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=0.0d0</div><div class="line"><a name="l05956"></a><span class="lineno"> 5956</span>&#160;      <span class="keywordflow">DO</span> 330 <a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>=2,kp1</div><div class="line"><a name="l05957"></a><span class="lineno"> 5957</span>&#160;         <span class="keywordflow">DO</span> 320 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l05958"></a><span class="lineno"> 5958</span>&#160;            <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)+phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)</div><div class="line"><a name="l05959"></a><span class="lineno"> 5959</span>&#160;320         yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)=yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)+gamma(<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)*phi(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,<a class="code" href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a>)</div><div class="line"><a name="l05960"></a><span class="lineno"> 5960</span>&#160;330   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l05961"></a><span class="lineno"> 5961</span>&#160;      eplin = epli*epcon</div><div class="line"><a name="l05962"></a><span class="lineno"> 5962</span>&#160;      tolnew = eplin</div><div class="line"><a name="l05963"></a><span class="lineno"> 5963</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05964"></a><span class="lineno"> 5964</span>&#160;<span class="comment">C     Call RES to initialize DELTA.</span></div><div class="line"><a name="l05965"></a><span class="lineno"> 5965</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05966"></a><span class="lineno"> 5966</span>&#160;      iwm(lnre)=iwm(lnre)+1</div><div class="line"><a name="l05967"></a><span class="lineno"> 5967</span>&#160;      <span class="keyword">CALL </span>res(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,delta,ires,rpar,ipar)</div><div class="line"><a name="l05968"></a><span class="lineno"> 5968</span>&#160;      <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l05969"></a><span class="lineno"> 5969</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05970"></a><span class="lineno"> 5970</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05971"></a><span class="lineno"> 5971</span>&#160;<span class="comment">C     If indicated, update the preconditioner.</span></div><div class="line"><a name="l05972"></a><span class="lineno"> 5972</span>&#160;<span class="comment">C     Set JCALC to 0 as an indicator that this has been done.</span></div><div class="line"><a name="l05973"></a><span class="lineno"> 5973</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05974"></a><span class="lineno"> 5974</span>&#160;      <span class="keywordflow">IF</span>(jcalc .EQ. -1)<span class="keywordflow">THEN</span></div><div class="line"><a name="l05975"></a><span class="lineno"> 5975</span>&#160;         iwm(lnje) = iwm(lnje) + 1</div><div class="line"><a name="l05976"></a><span class="lineno"> 5976</span>&#160;         jcalc=0</div><div class="line"><a name="l05977"></a><span class="lineno"> 5977</span>&#160;         <span class="keyword">CALL </span>jack (res, ires, neq, <a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, yprime, wt, delta, <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>, h, cj,</div><div class="line"><a name="l05978"></a><span class="lineno"> 5978</span>&#160;     *      wm(lwp), iwm(liwp), ierpj, rpar, ipar)</div><div class="line"><a name="l05979"></a><span class="lineno"> 5979</span>&#160;         cjold=cj</div><div class="line"><a name="l05980"></a><span class="lineno"> 5980</span>&#160;         <a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = 100.d0</div><div class="line"><a name="l05981"></a><span class="lineno"> 5981</span>&#160;         <span class="keywordflow">IF</span> (ires .LT. 0)  <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l05982"></a><span class="lineno"> 5982</span>&#160;         <span class="keywordflow">IF</span> (ierpj .NE. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l05983"></a><span class="lineno"> 5983</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l05984"></a><span class="lineno"> 5984</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05985"></a><span class="lineno"> 5985</span>&#160;<span class="comment">C     Call the nonlinear Newton solver.</span></div><div class="line"><a name="l05986"></a><span class="lineno"> 5986</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05987"></a><span class="lineno"> 5987</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aa301ce2fb688da345656de7ea981695e">dnsk</a>(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,neq,res,psol,wt,rpar,ipar,savr,</div><div class="line"><a name="l05988"></a><span class="lineno"> 5988</span>&#160;     *   delta,<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>,wm,iwm,cj,sqrtn,rsqrtn,eplin,epcon,</div><div class="line"><a name="l05989"></a><span class="lineno"> 5989</span>&#160;     *   <a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a>,temp1,tolnew,muldel,maxit,ires,iersl,iernew)</div><div class="line"><a name="l05990"></a><span class="lineno"> 5990</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05991"></a><span class="lineno"> 5991</span>&#160;      <span class="keywordflow">IF</span> (iernew .GT. 0 .AND. jcalc .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l05992"></a><span class="lineno"> 5992</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05993"></a><span class="lineno"> 5993</span>&#160;<span class="comment">C     The Newton iteration had a recoverable failure with an old</span></div><div class="line"><a name="l05994"></a><span class="lineno"> 5994</span>&#160;<span class="comment">C     preconditioner.  Retry the step with a new preconditioner.</span></div><div class="line"><a name="l05995"></a><span class="lineno"> 5995</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l05996"></a><span class="lineno"> 5996</span>&#160;         jcalc = -1</div><div class="line"><a name="l05997"></a><span class="lineno"> 5997</span>&#160;         <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l05998"></a><span class="lineno"> 5998</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l05999"></a><span class="lineno"> 5999</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06000"></a><span class="lineno"> 6000</span>&#160;      <span class="keywordflow">IF</span> (iernew .NE. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l06001"></a><span class="lineno"> 6001</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06002"></a><span class="lineno"> 6002</span>&#160;<span class="comment">C     The Newton iteration has converged.  If nonnegativity of</span></div><div class="line"><a name="l06003"></a><span class="lineno"> 6003</span>&#160;<span class="comment">C     solution is required, set the solution nonnegative, if the</span></div><div class="line"><a name="l06004"></a><span class="lineno"> 6004</span>&#160;<span class="comment">C     perturbation to do it is small enough.  If the change is too</span></div><div class="line"><a name="l06005"></a><span class="lineno"> 6005</span>&#160;<span class="comment">C     large, then consider the corrector iteration to have failed.</span></div><div class="line"><a name="l06006"></a><span class="lineno"> 6006</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06007"></a><span class="lineno"> 6007</span>&#160;      <span class="keywordflow">IF</span>(nonneg .EQ. 0) <span class="keywordflow">GO TO</span> 390</div><div class="line"><a name="l06008"></a><span class="lineno"> 6008</span>&#160;      <span class="keywordflow">DO</span> 360 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l06009"></a><span class="lineno"> 6009</span>&#160; 360    delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = min(<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>),0.0d0)</div><div class="line"><a name="l06010"></a><span class="lineno"> 6010</span>&#160;      delnrm = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,delta,wt,rpar,ipar)</div><div class="line"><a name="l06011"></a><span class="lineno"> 6011</span>&#160;      <span class="keywordflow">IF</span>(delnrm .GT. epcon) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l06012"></a><span class="lineno"> 6012</span>&#160;      <span class="keywordflow">DO</span> 370 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l06013"></a><span class="lineno"> 6013</span>&#160; 370    <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) - delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l06014"></a><span class="lineno"> 6014</span>&#160;      <span class="keywordflow">GO TO</span> 390</div><div class="line"><a name="l06015"></a><span class="lineno"> 6015</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06016"></a><span class="lineno"> 6016</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06017"></a><span class="lineno"> 6017</span>&#160;<span class="comment">C     Exits from nonlinear solver.</span></div><div class="line"><a name="l06018"></a><span class="lineno"> 6018</span>&#160;<span class="comment">C     No convergence with current preconditioner.</span></div><div class="line"><a name="l06019"></a><span class="lineno"> 6019</span>&#160;<span class="comment">C     Compute IERNLS and IDID accordingly.</span></div><div class="line"><a name="l06020"></a><span class="lineno"> 6020</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06021"></a><span class="lineno"> 6021</span>&#160;380   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06022"></a><span class="lineno"> 6022</span>&#160;      <span class="keywordflow">IF</span> (ires .LE. -2 .OR. iersl .LT. 0 .OR. iertyp .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06023"></a><span class="lineno"> 6023</span>&#160;         iernls = -1</div><div class="line"><a name="l06024"></a><span class="lineno"> 6024</span>&#160;         <span class="keywordflow">IF</span> (ires .LE. -2) idid = -11</div><div class="line"><a name="l06025"></a><span class="lineno"> 6025</span>&#160;         <span class="keywordflow">IF</span> (iersl .LT. 0) idid = -13</div><div class="line"><a name="l06026"></a><span class="lineno"> 6026</span>&#160;         <span class="keywordflow">IF</span> (iertyp .NE. 0) idid = -15</div><div class="line"><a name="l06027"></a><span class="lineno"> 6027</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l06028"></a><span class="lineno"> 6028</span>&#160;         iernls =  1</div><div class="line"><a name="l06029"></a><span class="lineno"> 6029</span>&#160;         <span class="keywordflow">IF</span> (ires .EQ. -1) idid = -10</div><div class="line"><a name="l06030"></a><span class="lineno"> 6030</span>&#160;         <span class="keywordflow">IF</span> (ierpj .NE. 0) idid = -5</div><div class="line"><a name="l06031"></a><span class="lineno"> 6031</span>&#160;         <span class="keywordflow">IF</span> (iersl .GT. 0) idid = -14</div><div class="line"><a name="l06032"></a><span class="lineno"> 6032</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l06033"></a><span class="lineno"> 6033</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06034"></a><span class="lineno"> 6034</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06035"></a><span class="lineno"> 6035</span>&#160;390   jcalc = 1</div><div class="line"><a name="l06036"></a><span class="lineno"> 6036</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06037"></a><span class="lineno"> 6037</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06038"></a><span class="lineno"> 6038</span>&#160;<span class="comment">C------END OF SUBROUTINE DNEDK------------------------------------------</span></div><div class="line"><a name="l06039"></a><span class="lineno"> 6039</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l06040"></a><span class="lineno"> 6040</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#aa301ce2fb688da345656de7ea981695e">dnsk</a>(X,Y,YPRIME,NEQ,RES,PSOL,WT,RPAR,IPAR,</div><div class="line"><a name="l06041"></a><span class="lineno"> 6041</span>&#160;     *   SAVR,DELTA,E,WM,IWM,CJ,SQRTN,RSQRTN,EPLIN,EPCON,</div><div class="line"><a name="l06042"></a><span class="lineno"> 6042</span>&#160;     *   S,CONFAC,TOLNEW,MULDEL,MAXIT,IRES,IERSL,IERNEW)</div><div class="line"><a name="l06043"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#aa301ce2fb688da345656de7ea981695e"> 6043</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06044"></a><span class="lineno"> 6044</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DNSK</span></div><div class="line"><a name="l06045"></a><span class="lineno"> 6045</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l06046"></a><span class="lineno"> 6046</span>&#160;<span class="comment">C***DATE WRITTEN   891219   (YYMMDD)</span></div><div class="line"><a name="l06047"></a><span class="lineno"> 6047</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l06048"></a><span class="lineno"> 6048</span>&#160;<span class="comment">C***REVISION DATE  950126   (YYMMDD)</span></div><div class="line"><a name="l06049"></a><span class="lineno"> 6049</span>&#160;<span class="comment">C***REVISION DATE  000711   (YYMMDD)</span></div><div class="line"><a name="l06050"></a><span class="lineno"> 6050</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06051"></a><span class="lineno"> 6051</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06052"></a><span class="lineno"> 6052</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06053"></a><span class="lineno"> 6053</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l06054"></a><span class="lineno"> 6054</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06055"></a><span class="lineno"> 6055</span>&#160;<span class="comment">C     DNSK solves a nonlinear system of</span></div><div class="line"><a name="l06056"></a><span class="lineno"> 6056</span>&#160;<span class="comment">C     algebraic equations of the form</span></div><div class="line"><a name="l06057"></a><span class="lineno"> 6057</span>&#160;<span class="comment">C     G(X,Y,YPRIME) = 0 for the unknown Y.</span></div><div class="line"><a name="l06058"></a><span class="lineno"> 6058</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06059"></a><span class="lineno"> 6059</span>&#160;<span class="comment">C     The method used is a modified Newton scheme.</span></div><div class="line"><a name="l06060"></a><span class="lineno"> 6060</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06061"></a><span class="lineno"> 6061</span>&#160;<span class="comment">C     The parameters represent</span></div><div class="line"><a name="l06062"></a><span class="lineno"> 6062</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06063"></a><span class="lineno"> 6063</span>&#160;<span class="comment">C     X         -- Independent variable.</span></div><div class="line"><a name="l06064"></a><span class="lineno"> 6064</span>&#160;<span class="comment">C     Y         -- Solution vector.</span></div><div class="line"><a name="l06065"></a><span class="lineno"> 6065</span>&#160;<span class="comment">C     YPRIME    -- Derivative of solution vector.</span></div><div class="line"><a name="l06066"></a><span class="lineno"> 6066</span>&#160;<span class="comment">C     NEQ       -- Number of unknowns.</span></div><div class="line"><a name="l06067"></a><span class="lineno"> 6067</span>&#160;<span class="comment">C     RES       -- External user-supplied subroutine</span></div><div class="line"><a name="l06068"></a><span class="lineno"> 6068</span>&#160;<span class="comment">C                  to evaluate the residual.  See RES description</span></div><div class="line"><a name="l06069"></a><span class="lineno"> 6069</span>&#160;<span class="comment">C                  in DDASPK prologue.</span></div><div class="line"><a name="l06070"></a><span class="lineno"> 6070</span>&#160;<span class="comment">C     PSOL      -- External user-supplied routine to solve</span></div><div class="line"><a name="l06071"></a><span class="lineno"> 6071</span>&#160;<span class="comment">C                  a linear system using preconditioning. </span></div><div class="line"><a name="l06072"></a><span class="lineno"> 6072</span>&#160;<span class="comment">C                  See explanation inside DDASPK.</span></div><div class="line"><a name="l06073"></a><span class="lineno"> 6073</span>&#160;<span class="comment">C     WT        -- Vector of weights for error criterion.</span></div><div class="line"><a name="l06074"></a><span class="lineno"> 6074</span>&#160;<span class="comment">C     RPAR,IPAR -- Real and integer arrays used for communication</span></div><div class="line"><a name="l06075"></a><span class="lineno"> 6075</span>&#160;<span class="comment">C                  between the calling program and external user</span></div><div class="line"><a name="l06076"></a><span class="lineno"> 6076</span>&#160;<span class="comment">C                  routines.  They are not altered within DASPK.</span></div><div class="line"><a name="l06077"></a><span class="lineno"> 6077</span>&#160;<span class="comment">C     SAVR      -- Work vector for DNSK of length NEQ.</span></div><div class="line"><a name="l06078"></a><span class="lineno"> 6078</span>&#160;<span class="comment">C     DELTA     -- Work vector for DNSK of length NEQ.</span></div><div class="line"><a name="l06079"></a><span class="lineno"> 6079</span>&#160;<span class="comment">C     E         -- Error accumulation vector for DNSK of length NEQ.</span></div><div class="line"><a name="l06080"></a><span class="lineno"> 6080</span>&#160;<span class="comment">C     WM,IWM    -- Real and integer arrays storing</span></div><div class="line"><a name="l06081"></a><span class="lineno"> 6081</span>&#160;<span class="comment">C                  matrix information such as the matrix</span></div><div class="line"><a name="l06082"></a><span class="lineno"> 6082</span>&#160;<span class="comment">C                  of partial derivatives, permutation</span></div><div class="line"><a name="l06083"></a><span class="lineno"> 6083</span>&#160;<span class="comment">C                  vector, and various other information.</span></div><div class="line"><a name="l06084"></a><span class="lineno"> 6084</span>&#160;<span class="comment">C     CJ        -- Parameter always proportional to 1/H (step size).</span></div><div class="line"><a name="l06085"></a><span class="lineno"> 6085</span>&#160;<span class="comment">C     SQRTN     -- Square root of NEQ.</span></div><div class="line"><a name="l06086"></a><span class="lineno"> 6086</span>&#160;<span class="comment">C     RSQRTN    -- reciprical of square root of NEQ.</span></div><div class="line"><a name="l06087"></a><span class="lineno"> 6087</span>&#160;<span class="comment">C     EPLIN     -- Tolerance for linear system solver.</span></div><div class="line"><a name="l06088"></a><span class="lineno"> 6088</span>&#160;<span class="comment">C     EPCON     -- Tolerance to test for convergence of the Newton</span></div><div class="line"><a name="l06089"></a><span class="lineno"> 6089</span>&#160;<span class="comment">C                  iteration.</span></div><div class="line"><a name="l06090"></a><span class="lineno"> 6090</span>&#160;<span class="comment">C     S         -- Used for error convergence tests.</span></div><div class="line"><a name="l06091"></a><span class="lineno"> 6091</span>&#160;<span class="comment">C                  In the Newton iteration: S = RATE/(1.D0-RATE),</span></div><div class="line"><a name="l06092"></a><span class="lineno"> 6092</span>&#160;<span class="comment">C                  where RATE is the estimated rate of convergence</span></div><div class="line"><a name="l06093"></a><span class="lineno"> 6093</span>&#160;<span class="comment">C                  of the Newton iteration.</span></div><div class="line"><a name="l06094"></a><span class="lineno"> 6094</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06095"></a><span class="lineno"> 6095</span>&#160;<span class="comment">C                  The closer RATE is to 0., the faster the Newton</span></div><div class="line"><a name="l06096"></a><span class="lineno"> 6096</span>&#160;<span class="comment">C                  iteration is converging; the closer RATE is to 1.,</span></div><div class="line"><a name="l06097"></a><span class="lineno"> 6097</span>&#160;<span class="comment">C                  the slower the Newton iteration is converging.</span></div><div class="line"><a name="l06098"></a><span class="lineno"> 6098</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06099"></a><span class="lineno"> 6099</span>&#160;<span class="comment">C                  The calling routine sends the initial value</span></div><div class="line"><a name="l06100"></a><span class="lineno"> 6100</span>&#160;<span class="comment">C                  of S to the Newton iteration.</span></div><div class="line"><a name="l06101"></a><span class="lineno"> 6101</span>&#160;<span class="comment">C     CONFAC    -- A residual scale factor to improve convergence.</span></div><div class="line"><a name="l06102"></a><span class="lineno"> 6102</span>&#160;<span class="comment">C     TOLNEW    -- Tolerance on the norm of Newton correction in</span></div><div class="line"><a name="l06103"></a><span class="lineno"> 6103</span>&#160;<span class="comment">C                  alternative Newton convergence test.</span></div><div class="line"><a name="l06104"></a><span class="lineno"> 6104</span>&#160;<span class="comment">C     MULDEL    -- A flag indicating whether or not to multiply</span></div><div class="line"><a name="l06105"></a><span class="lineno"> 6105</span>&#160;<span class="comment">C                  DELTA by CONFAC.</span></div><div class="line"><a name="l06106"></a><span class="lineno"> 6106</span>&#160;<span class="comment">C                  0  ==&gt; do not scale DELTA by CONFAC.</span></div><div class="line"><a name="l06107"></a><span class="lineno"> 6107</span>&#160;<span class="comment">C                  1  ==&gt; scale DELTA by CONFAC.</span></div><div class="line"><a name="l06108"></a><span class="lineno"> 6108</span>&#160;<span class="comment">C     MAXIT     -- Maximum allowed number of Newton iterations.</span></div><div class="line"><a name="l06109"></a><span class="lineno"> 6109</span>&#160;<span class="comment">C     IRES      -- Error flag returned from RES.  See RES description</span></div><div class="line"><a name="l06110"></a><span class="lineno"> 6110</span>&#160;<span class="comment">C                  in DDASPK prologue.  If IRES = -1, then IERNEW</span></div><div class="line"><a name="l06111"></a><span class="lineno"> 6111</span>&#160;<span class="comment">C                  will be set to 1.</span></div><div class="line"><a name="l06112"></a><span class="lineno"> 6112</span>&#160;<span class="comment">C                  If IRES &lt; -1, then IERNEW will be set to -1.</span></div><div class="line"><a name="l06113"></a><span class="lineno"> 6113</span>&#160;<span class="comment">C     IERSL     -- Error flag for linear system solver.</span></div><div class="line"><a name="l06114"></a><span class="lineno"> 6114</span>&#160;<span class="comment">C                  See IERSL description in subroutine DSLVK.</span></div><div class="line"><a name="l06115"></a><span class="lineno"> 6115</span>&#160;<span class="comment">C                  If IERSL = 1, then IERNEW will be set to 1.</span></div><div class="line"><a name="l06116"></a><span class="lineno"> 6116</span>&#160;<span class="comment">C                  If IERSL &lt; 0, then IERNEW will be set to -1.</span></div><div class="line"><a name="l06117"></a><span class="lineno"> 6117</span>&#160;<span class="comment">C     IERNEW    -- Error flag for Newton iteration.</span></div><div class="line"><a name="l06118"></a><span class="lineno"> 6118</span>&#160;<span class="comment">C                   0  ==&gt; Newton iteration converged.</span></div><div class="line"><a name="l06119"></a><span class="lineno"> 6119</span>&#160;<span class="comment">C                   1  ==&gt; recoverable error inside Newton iteration.</span></div><div class="line"><a name="l06120"></a><span class="lineno"> 6120</span>&#160;<span class="comment">C                  -1  ==&gt; unrecoverable error inside Newton iteration.</span></div><div class="line"><a name="l06121"></a><span class="lineno"> 6121</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06122"></a><span class="lineno"> 6122</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06123"></a><span class="lineno"> 6123</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l06124"></a><span class="lineno"> 6124</span>&#160;<span class="comment">C   RES, DSLVK, DDWNRM</span></div><div class="line"><a name="l06125"></a><span class="lineno"> 6125</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06126"></a><span class="lineno"> 6126</span>&#160;<span class="comment">C***END PROLOGUE  DNSK</span></div><div class="line"><a name="l06127"></a><span class="lineno"> 6127</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06128"></a><span class="lineno"> 6128</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06129"></a><span class="lineno"> 6129</span>&#160;      <span class="keywordtype">IMPLICIT DOUBLE PRECISION</span>(<a class="code" href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a>-h,o-z)</div><div class="line"><a name="l06130"></a><span class="lineno"> 6130</span>&#160;      dimension <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(*),yprime(*),wt(*),delta(*),<a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(*),savr(*)</div><div class="line"><a name="l06131"></a><span class="lineno"> 6131</span>&#160;      dimension wm(*),iwm(*), rpar(*),ipar(*)</div><div class="line"><a name="l06132"></a><span class="lineno"> 6132</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, psol</div><div class="line"><a name="l06133"></a><span class="lineno"> 6133</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06134"></a><span class="lineno"> 6134</span>&#160;      parameter(lnni=19, lnre=12)</div><div class="line"><a name="l06135"></a><span class="lineno"> 6135</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06136"></a><span class="lineno"> 6136</span>&#160;<span class="comment">C     Initialize Newton counter M and accumulation vector E.</span></div><div class="line"><a name="l06137"></a><span class="lineno"> 6137</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06138"></a><span class="lineno"> 6138</span>&#160;      <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> = 0</div><div class="line"><a name="l06139"></a><span class="lineno"> 6139</span>&#160;      <span class="keywordflow">DO</span> 100 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l06140"></a><span class="lineno"> 6140</span>&#160;100     <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = 0.0d0</div><div class="line"><a name="l06141"></a><span class="lineno"> 6141</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06142"></a><span class="lineno"> 6142</span>&#160;<span class="comment">C     Corrector loop.</span></div><div class="line"><a name="l06143"></a><span class="lineno"> 6143</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06144"></a><span class="lineno"> 6144</span>&#160;300   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06145"></a><span class="lineno"> 6145</span>&#160;      iwm(lnni) = iwm(lnni) + 1</div><div class="line"><a name="l06146"></a><span class="lineno"> 6146</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06147"></a><span class="lineno"> 6147</span>&#160;<span class="comment">C     If necessary, multiply residual by convergence factor.</span></div><div class="line"><a name="l06148"></a><span class="lineno"> 6148</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06149"></a><span class="lineno"> 6149</span>&#160;      <span class="keywordflow">IF</span> (muldel .EQ. 1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06150"></a><span class="lineno"> 6150</span>&#160;        <span class="keywordflow">DO</span> 320 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l06151"></a><span class="lineno"> 6151</span>&#160;320       delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) * confac</div><div class="line"><a name="l06152"></a><span class="lineno"> 6152</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l06153"></a><span class="lineno"> 6153</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06154"></a><span class="lineno"> 6154</span>&#160;<span class="comment">C     Save residual in SAVR.</span></div><div class="line"><a name="l06155"></a><span class="lineno"> 6155</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06156"></a><span class="lineno"> 6156</span>&#160;      <span class="keywordflow">DO</span> 340 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l06157"></a><span class="lineno"> 6157</span>&#160;340     savr(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l06158"></a><span class="lineno"> 6158</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06159"></a><span class="lineno"> 6159</span>&#160;<span class="comment">C     Compute a new iterate.  Store the correction in DELTA.</span></div><div class="line"><a name="l06160"></a><span class="lineno"> 6160</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06161"></a><span class="lineno"> 6161</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a802f3562fe48073d5b35370a79347a6c">dslvk</a> (neq, <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>, <a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>, yprime, savr, delta, wt, wm, iwm,</div><div class="line"><a name="l06162"></a><span class="lineno"> 6162</span>&#160;     *   res, ires, psol, iersl, cj, eplin, sqrtn, rsqrtn, rhok,</div><div class="line"><a name="l06163"></a><span class="lineno"> 6163</span>&#160;     *   rpar, ipar)</div><div class="line"><a name="l06164"></a><span class="lineno"> 6164</span>&#160;      <span class="keywordflow">IF</span> (ires .NE. 0 .OR. iersl .NE. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l06165"></a><span class="lineno"> 6165</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06166"></a><span class="lineno"> 6166</span>&#160;<span class="comment">C     Update Y, E, and YPRIME.</span></div><div class="line"><a name="l06167"></a><span class="lineno"> 6167</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06168"></a><span class="lineno"> 6168</span>&#160;      <span class="keywordflow">DO</span> 360 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=1,neq</div><div class="line"><a name="l06169"></a><span class="lineno"> 6169</span>&#160;         <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) - delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l06170"></a><span class="lineno"> 6170</span>&#160;         <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = <a class="code" href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a>(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) - delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l06171"></a><span class="lineno"> 6171</span>&#160;360      yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = yprime(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) - cj*delta(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>)</div><div class="line"><a name="l06172"></a><span class="lineno"> 6172</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06173"></a><span class="lineno"> 6173</span>&#160;<span class="comment">C     Test for convergence of the iteration.</span></div><div class="line"><a name="l06174"></a><span class="lineno"> 6174</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06175"></a><span class="lineno"> 6175</span>&#160;      delnrm = <a class="code" href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a>(neq,delta,wt,rpar,ipar)</div><div class="line"><a name="l06176"></a><span class="lineno"> 6176</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06177"></a><span class="lineno"> 6177</span>&#160;        oldnrm = delnrm</div><div class="line"><a name="l06178"></a><span class="lineno"> 6178</span>&#160;        <span class="keywordflow">IF</span> (delnrm .LE. tolnew) <span class="keywordflow">GO TO</span> 370</div><div class="line"><a name="l06179"></a><span class="lineno"> 6179</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l06180"></a><span class="lineno"> 6180</span>&#160;        rate = (delnrm/oldnrm)**(1.0d0/<a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a>)</div><div class="line"><a name="l06181"></a><span class="lineno"> 6181</span>&#160;        <span class="keywordflow">IF</span> (rate .GT. 0.9d0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l06182"></a><span class="lineno"> 6182</span>&#160;        <a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a> = rate/(1.0d0 - rate)</div><div class="line"><a name="l06183"></a><span class="lineno"> 6183</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l06184"></a><span class="lineno"> 6184</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a>*delnrm .LE. epcon) <span class="keywordflow">GO TO</span> 370</div><div class="line"><a name="l06185"></a><span class="lineno"> 6185</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06186"></a><span class="lineno"> 6186</span>&#160;<span class="comment">C     The corrector has not yet converged.  Update M and test whether</span></div><div class="line"><a name="l06187"></a><span class="lineno"> 6187</span>&#160;<span class="comment">C     the maximum number of iterations have been tried.</span></div><div class="line"><a name="l06188"></a><span class="lineno"> 6188</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06189"></a><span class="lineno"> 6189</span>&#160;      <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> = <a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> + 1</div><div class="line"><a name="l06190"></a><span class="lineno"> 6190</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a> .GE. maxit) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l06191"></a><span class="lineno"> 6191</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06192"></a><span class="lineno"> 6192</span>&#160;<span class="comment">C     Evaluate the residual, and go back to do another iteration.</span></div><div class="line"><a name="l06193"></a><span class="lineno"> 6193</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06194"></a><span class="lineno"> 6194</span>&#160;      iwm(lnre) = iwm(lnre) + 1</div><div class="line"><a name="l06195"></a><span class="lineno"> 6195</span>&#160;      <span class="keyword">CALL </span>res(<a class="code" href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a>,<a class="code" href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a>,yprime,cj,delta,ires,rpar,ipar)</div><div class="line"><a name="l06196"></a><span class="lineno"> 6196</span>&#160;      <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">GO TO</span> 380</div><div class="line"><a name="l06197"></a><span class="lineno"> 6197</span>&#160;      <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l06198"></a><span class="lineno"> 6198</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06199"></a><span class="lineno"> 6199</span>&#160;<span class="comment">C     The iteration has converged.</span></div><div class="line"><a name="l06200"></a><span class="lineno"> 6200</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06201"></a><span class="lineno"> 6201</span>&#160;370    <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06202"></a><span class="lineno"> 6202</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06203"></a><span class="lineno"> 6203</span>&#160;<span class="comment">C     The iteration has not converged.  Set IERNEW appropriately.</span></div><div class="line"><a name="l06204"></a><span class="lineno"> 6204</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06205"></a><span class="lineno"> 6205</span>&#160;380   <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06206"></a><span class="lineno"> 6206</span>&#160;      <span class="keywordflow">IF</span> (ires .LE. -2 .OR. iersl .LT. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06207"></a><span class="lineno"> 6207</span>&#160;         iernew = -1</div><div class="line"><a name="l06208"></a><span class="lineno"> 6208</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l06209"></a><span class="lineno"> 6209</span>&#160;         iernew = 1</div><div class="line"><a name="l06210"></a><span class="lineno"> 6210</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l06211"></a><span class="lineno"> 6211</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06212"></a><span class="lineno"> 6212</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06213"></a><span class="lineno"> 6213</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06214"></a><span class="lineno"> 6214</span>&#160;<span class="comment">C------END OF SUBROUTINE DNSK-------------------------------------------</span></div><div class="line"><a name="l06215"></a><span class="lineno"> 6215</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l06216"></a><span class="lineno"> 6216</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a802f3562fe48073d5b35370a79347a6c">dslvk</a> (NEQ, Y, TN, YPRIME, SAVR, X, EWT, WM, IWM,</div><div class="line"><a name="l06217"></a><span class="lineno"> 6217</span>&#160;     *   RES, IRES, PSOL, IERSL, CJ, EPLIN, SQRTN, RSQRTN, RHOK,</div><div class="line"><a name="l06218"></a><span class="lineno"> 6218</span>&#160;     *   RPAR, IPAR)</div><div class="line"><a name="l06219"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a802f3562fe48073d5b35370a79347a6c"> 6219</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06220"></a><span class="lineno"> 6220</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DSLVK</span></div><div class="line"><a name="l06221"></a><span class="lineno"> 6221</span>&#160;<span class="comment">C***REFER TO  DDASPK</span></div><div class="line"><a name="l06222"></a><span class="lineno"> 6222</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l06223"></a><span class="lineno"> 6223</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l06224"></a><span class="lineno"> 6224</span>&#160;<span class="comment">C***REVISION DATE  940928   Removed MNEWT and added RHOK in call list.</span></div><div class="line"><a name="l06225"></a><span class="lineno"> 6225</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06226"></a><span class="lineno"> 6226</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06227"></a><span class="lineno"> 6227</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06228"></a><span class="lineno"> 6228</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l06229"></a><span class="lineno"> 6229</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06230"></a><span class="lineno"> 6230</span>&#160;<span class="comment">C DSLVK uses a restart algorithm and interfaces to DSPIGM for</span></div><div class="line"><a name="l06231"></a><span class="lineno"> 6231</span>&#160;<span class="comment">C the solution of the linear system arising from a Newton iteration.</span></div><div class="line"><a name="l06232"></a><span class="lineno"> 6232</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06233"></a><span class="lineno"> 6233</span>&#160;<span class="comment">C In addition to variables described elsewhere,</span></div><div class="line"><a name="l06234"></a><span class="lineno"> 6234</span>&#160;<span class="comment">C communication with DSLVK uses the following variables..</span></div><div class="line"><a name="l06235"></a><span class="lineno"> 6235</span>&#160;<span class="comment">C WM    = Real work space containing data for the algorithm</span></div><div class="line"><a name="l06236"></a><span class="lineno"> 6236</span>&#160;<span class="comment">C         (Krylov basis vectors, Hessenberg matrix, etc.).</span></div><div class="line"><a name="l06237"></a><span class="lineno"> 6237</span>&#160;<span class="comment">C IWM   = Integer work space containing data for the algorithm.</span></div><div class="line"><a name="l06238"></a><span class="lineno"> 6238</span>&#160;<span class="comment">C X     = The right-hand side vector on input, and the solution vector</span></div><div class="line"><a name="l06239"></a><span class="lineno"> 6239</span>&#160;<span class="comment">C         on output, of length NEQ.</span></div><div class="line"><a name="l06240"></a><span class="lineno"> 6240</span>&#160;<span class="comment">C IRES  = Error flag from RES.</span></div><div class="line"><a name="l06241"></a><span class="lineno"> 6241</span>&#160;<span class="comment">C IERSL = Output flag ..</span></div><div class="line"><a name="l06242"></a><span class="lineno"> 6242</span>&#160;<span class="comment">C         IERSL =  0 means no trouble occurred (or user RES routine</span></div><div class="line"><a name="l06243"></a><span class="lineno"> 6243</span>&#160;<span class="comment">C                    returned IRES &lt; 0)</span></div><div class="line"><a name="l06244"></a><span class="lineno"> 6244</span>&#160;<span class="comment">C         IERSL =  1 means the iterative method failed to converge</span></div><div class="line"><a name="l06245"></a><span class="lineno"> 6245</span>&#160;<span class="comment">C                    (DSPIGM returned IFLAG &gt; 0.)</span></div><div class="line"><a name="l06246"></a><span class="lineno"> 6246</span>&#160;<span class="comment">C         IERSL = -1 means there was a nonrecoverable error in the</span></div><div class="line"><a name="l06247"></a><span class="lineno"> 6247</span>&#160;<span class="comment">C                    iterative solver, and an error exit will occur.</span></div><div class="line"><a name="l06248"></a><span class="lineno"> 6248</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06249"></a><span class="lineno"> 6249</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l06250"></a><span class="lineno"> 6250</span>&#160;<span class="comment">C   DSCAL, DCOPY, DSPIGM</span></div><div class="line"><a name="l06251"></a><span class="lineno"> 6251</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06252"></a><span class="lineno"> 6252</span>&#160;<span class="comment">C***END PROLOGUE  DSLVK</span></div><div class="line"><a name="l06253"></a><span class="lineno"> 6253</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06254"></a><span class="lineno"> 6254</span>&#160;      <span class="keywordtype">INTEGER</span> NEQ, IWM, IRES, IERSL, IPAR</div><div class="line"><a name="l06255"></a><span class="lineno"> 6255</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> Y, TN, YPRIME, SAVR, X, EWT, WM, CJ, EPLIN,</div><div class="line"><a name="l06256"></a><span class="lineno"> 6256</span>&#160;     1   sqrtn, rsqrtn, rhok, rpar</div><div class="line"><a name="l06257"></a><span class="lineno"> 6257</span>&#160;      dimension y(*), yprime(*), savr(*), x(*), ewt(*), </div><div class="line"><a name="l06258"></a><span class="lineno"> 6258</span>&#160;     1  wm(*), iwm(*), rpar(*), ipar(*)</div><div class="line"><a name="l06259"></a><span class="lineno"> 6259</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06260"></a><span class="lineno"> 6260</span>&#160;      <span class="keywordtype">INTEGER</span> IFLAG, IRST, NRSTS, NRMAX, LR, LDL, LHES, LGMR, LQ, LV,</div><div class="line"><a name="l06261"></a><span class="lineno"> 6261</span>&#160;     1        lwk, lz, maxlp1, npsl</div><div class="line"><a name="l06262"></a><span class="lineno"> 6262</span>&#160;      <span class="keywordtype">INTEGER</span> NLI, NPS, NCFL, NRE, MAXL, KMP, MITER</div><div class="line"><a name="l06263"></a><span class="lineno"> 6263</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, psol</div><div class="line"><a name="l06264"></a><span class="lineno"> 6264</span>&#160;<span class="comment">C    </span></div><div class="line"><a name="l06265"></a><span class="lineno"> 6265</span>&#160;      parameter(lnre=12, lncfl=16, lnli=20, lnps=21) </div><div class="line"><a name="l06266"></a><span class="lineno"> 6266</span>&#160;      parameter(llocwp=29, llciwp=30)</div><div class="line"><a name="l06267"></a><span class="lineno"> 6267</span>&#160;      parameter(lmiter=23, lmaxl=24, lkmp=25, lnrmax=26)</div><div class="line"><a name="l06268"></a><span class="lineno"> 6268</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06269"></a><span class="lineno"> 6269</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06270"></a><span class="lineno"> 6270</span>&#160;<span class="comment">C IRST is set to 1, to indicate restarting is in effect.</span></div><div class="line"><a name="l06271"></a><span class="lineno"> 6271</span>&#160;<span class="comment">C NRMAX is the maximum number of restarts.</span></div><div class="line"><a name="l06272"></a><span class="lineno"> 6272</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06273"></a><span class="lineno"> 6273</span>&#160;      <span class="keyword">DATA</span> irst/1/</div><div class="line"><a name="l06274"></a><span class="lineno"> 6274</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06275"></a><span class="lineno"> 6275</span>&#160;      liwp = iwm(llciwp)</div><div class="line"><a name="l06276"></a><span class="lineno"> 6276</span>&#160;      nli = iwm(lnli)</div><div class="line"><a name="l06277"></a><span class="lineno"> 6277</span>&#160;      nps = iwm(lnps)</div><div class="line"><a name="l06278"></a><span class="lineno"> 6278</span>&#160;      ncfl = iwm(lncfl)</div><div class="line"><a name="l06279"></a><span class="lineno"> 6279</span>&#160;      nre = iwm(lnre)</div><div class="line"><a name="l06280"></a><span class="lineno"> 6280</span>&#160;      lwp = iwm(llocwp)</div><div class="line"><a name="l06281"></a><span class="lineno"> 6281</span>&#160;      maxl = iwm(lmaxl) </div><div class="line"><a name="l06282"></a><span class="lineno"> 6282</span>&#160;      kmp = iwm(lkmp)</div><div class="line"><a name="l06283"></a><span class="lineno"> 6283</span>&#160;      nrmax = iwm(lnrmax) </div><div class="line"><a name="l06284"></a><span class="lineno"> 6284</span>&#160;      miter = iwm(lmiter)</div><div class="line"><a name="l06285"></a><span class="lineno"> 6285</span>&#160;      iersl = 0</div><div class="line"><a name="l06286"></a><span class="lineno"> 6286</span>&#160;      ires = 0</div><div class="line"><a name="l06287"></a><span class="lineno"> 6287</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06288"></a><span class="lineno"> 6288</span>&#160;<span class="comment">C Use a restarting strategy to solve the linear system</span></div><div class="line"><a name="l06289"></a><span class="lineno"> 6289</span>&#160;<span class="comment">C P*X = -F.  Parse the work vector, and perform initializations.</span></div><div class="line"><a name="l06290"></a><span class="lineno"> 6290</span>&#160;<span class="comment">C Note that zero is the initial guess for X.</span></div><div class="line"><a name="l06291"></a><span class="lineno"> 6291</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06292"></a><span class="lineno"> 6292</span>&#160;      maxlp1 = maxl + 1</div><div class="line"><a name="l06293"></a><span class="lineno"> 6293</span>&#160;      lv = 1</div><div class="line"><a name="l06294"></a><span class="lineno"> 6294</span>&#160;      lr = lv + neq*maxl</div><div class="line"><a name="l06295"></a><span class="lineno"> 6295</span>&#160;      lhes = lr + neq + 1</div><div class="line"><a name="l06296"></a><span class="lineno"> 6296</span>&#160;      lq = lhes + maxl*maxlp1</div><div class="line"><a name="l06297"></a><span class="lineno"> 6297</span>&#160;      lwk = lq + 2*maxl</div><div class="line"><a name="l06298"></a><span class="lineno"> 6298</span>&#160;      ldl = lwk + min0(1,maxl-kmp)*neq</div><div class="line"><a name="l06299"></a><span class="lineno"> 6299</span>&#160;      lz = ldl + neq</div><div class="line"><a name="l06300"></a><span class="lineno"> 6300</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a0590f8db475e11dc2c9137bb13887acf">dscal</a> (neq, rsqrtn, ewt, 1)</div><div class="line"><a name="l06301"></a><span class="lineno"> 6301</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, x, 1, wm(lr), 1)</div><div class="line"><a name="l06302"></a><span class="lineno"> 6302</span>&#160;      <span class="keywordflow">DO</span> 110 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l06303"></a><span class="lineno"> 6303</span>&#160; 110     x(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = 0.d0</div><div class="line"><a name="l06304"></a><span class="lineno"> 6304</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06305"></a><span class="lineno"> 6305</span>&#160;<span class="comment">C Top of loop for the restart algorithm.  Initial pass approximates</span></div><div class="line"><a name="l06306"></a><span class="lineno"> 6306</span>&#160;<span class="comment">C X and sets up a transformed system to perform subsequent restarts</span></div><div class="line"><a name="l06307"></a><span class="lineno"> 6307</span>&#160;<span class="comment">C to update X.  NRSTS is initialized to -1, because restarting</span></div><div class="line"><a name="l06308"></a><span class="lineno"> 6308</span>&#160;<span class="comment">C does not occur until after the first pass.</span></div><div class="line"><a name="l06309"></a><span class="lineno"> 6309</span>&#160;<span class="comment">C Update NRSTS; conditionally copy DL to R; call the DSPIGM</span></div><div class="line"><a name="l06310"></a><span class="lineno"> 6310</span>&#160;<span class="comment">C algorithm to solve A*Z = R;  updated counters;  update X with</span></div><div class="line"><a name="l06311"></a><span class="lineno"> 6311</span>&#160;<span class="comment">C the residual solution.</span></div><div class="line"><a name="l06312"></a><span class="lineno"> 6312</span>&#160;<span class="comment">C Note:  if convergence is not achieved after NRMAX restarts,</span></div><div class="line"><a name="l06313"></a><span class="lineno"> 6313</span>&#160;<span class="comment">C then the linear solver is considered to have failed.</span></div><div class="line"><a name="l06314"></a><span class="lineno"> 6314</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06315"></a><span class="lineno"> 6315</span>&#160;      nrsts = -1</div><div class="line"><a name="l06316"></a><span class="lineno"> 6316</span>&#160; 115  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06317"></a><span class="lineno"> 6317</span>&#160;      nrsts = nrsts + 1</div><div class="line"><a name="l06318"></a><span class="lineno"> 6318</span>&#160;      <span class="keywordflow">IF</span> (nrsts .GT. 0) <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, wm(ldl), 1, wm(lr),1)</div><div class="line"><a name="l06319"></a><span class="lineno"> 6319</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a96c6b13349fc497b399975cc823a6373">dspigm</a> (neq, tn, y, yprime, savr, wm(lr), ewt, maxl, maxlp1,</div><div class="line"><a name="l06320"></a><span class="lineno"> 6320</span>&#160;     1   kmp, eplin, cj, res, ires, nres, psol, npsl, wm(lz), wm(lv),</div><div class="line"><a name="l06321"></a><span class="lineno"> 6321</span>&#160;     2   wm(lhes), wm(lq), lgmr, wm(lwp), iwm(liwp), wm(lwk),</div><div class="line"><a name="l06322"></a><span class="lineno"> 6322</span>&#160;     3   wm(ldl), rhok, iflag, irst, nrsts, rpar, ipar)</div><div class="line"><a name="l06323"></a><span class="lineno"> 6323</span>&#160;      nli = nli + lgmr</div><div class="line"><a name="l06324"></a><span class="lineno"> 6324</span>&#160;      nps = nps + npsl</div><div class="line"><a name="l06325"></a><span class="lineno"> 6325</span>&#160;      nre = nre + nres</div><div class="line"><a name="l06326"></a><span class="lineno"> 6326</span>&#160;      <span class="keywordflow">DO</span> 120 <a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1,neq</div><div class="line"><a name="l06327"></a><span class="lineno"> 6327</span>&#160; 120     x(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) = x(<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>) + wm(lz+<a class="code" href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>-1) </div><div class="line"><a name="l06328"></a><span class="lineno"> 6328</span>&#160;      <span class="keywordflow">IF</span> ((iflag .EQ. 1) .AND. (nrsts .LT. nrmax) .AND. (ires .EQ. 0))</div><div class="line"><a name="l06329"></a><span class="lineno"> 6329</span>&#160;     1   <span class="keywordflow">GO TO</span> 115</div><div class="line"><a name="l06330"></a><span class="lineno"> 6330</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06331"></a><span class="lineno"> 6331</span>&#160;<span class="comment">C The restart scheme is finished.  Test IRES and IFLAG to see if</span></div><div class="line"><a name="l06332"></a><span class="lineno"> 6332</span>&#160;<span class="comment">C convergence was not achieved, and set flags accordingly.</span></div><div class="line"><a name="l06333"></a><span class="lineno"> 6333</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06334"></a><span class="lineno"> 6334</span>&#160;      <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06335"></a><span class="lineno"> 6335</span>&#160;         ncfl = ncfl + 1</div><div class="line"><a name="l06336"></a><span class="lineno"> 6336</span>&#160;      <span class="keywordflow">ELSE</span> <span class="keywordflow">IF</span> (iflag .NE. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06337"></a><span class="lineno"> 6337</span>&#160;         ncfl = ncfl + 1</div><div class="line"><a name="l06338"></a><span class="lineno"> 6338</span>&#160;         <span class="keywordflow">IF</span> (iflag .GT. 0) iersl = 1 </div><div class="line"><a name="l06339"></a><span class="lineno"> 6339</span>&#160;         <span class="keywordflow">IF</span> (iflag .LT. 0) iersl = -1 </div><div class="line"><a name="l06340"></a><span class="lineno"> 6340</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l06341"></a><span class="lineno"> 6341</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06342"></a><span class="lineno"> 6342</span>&#160;<span class="comment">C Update IWM with counters, rescale EWT, and return.</span></div><div class="line"><a name="l06343"></a><span class="lineno"> 6343</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06344"></a><span class="lineno"> 6344</span>&#160;      iwm(lnli)  = nli</div><div class="line"><a name="l06345"></a><span class="lineno"> 6345</span>&#160;      iwm(lnps)  = nps</div><div class="line"><a name="l06346"></a><span class="lineno"> 6346</span>&#160;      iwm(lncfl) = ncfl</div><div class="line"><a name="l06347"></a><span class="lineno"> 6347</span>&#160;      iwm(lnre)  = nre</div><div class="line"><a name="l06348"></a><span class="lineno"> 6348</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a0590f8db475e11dc2c9137bb13887acf">dscal</a> (neq, sqrtn, ewt, 1)</div><div class="line"><a name="l06349"></a><span class="lineno"> 6349</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06350"></a><span class="lineno"> 6350</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06351"></a><span class="lineno"> 6351</span>&#160;<span class="comment">C------END OF SUBROUTINE DSLVK------------------------------------------</span></div><div class="line"><a name="l06352"></a><span class="lineno"> 6352</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l06353"></a><span class="lineno"> 6353</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a96c6b13349fc497b399975cc823a6373">dspigm</a> (NEQ, TN, Y, YPRIME, SAVR, R, WGHT, MAXL,</div><div class="line"><a name="l06354"></a><span class="lineno"> 6354</span>&#160;     *   MAXLP1, KMP, EPLIN, CJ, RES, IRES, NRE, PSOL, NPSL, Z, V,</div><div class="line"><a name="l06355"></a><span class="lineno"> 6355</span>&#160;     *   HES, Q, LGMR, WP, IWP, WK, DL, RHOK, IFLAG, IRST, NRSTS,</div><div class="line"><a name="l06356"></a><span class="lineno"> 6356</span>&#160;     *   RPAR, IPAR)</div><div class="line"><a name="l06357"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a96c6b13349fc497b399975cc823a6373"> 6357</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06358"></a><span class="lineno"> 6358</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DSPIGM</span></div><div class="line"><a name="l06359"></a><span class="lineno"> 6359</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l06360"></a><span class="lineno"> 6360</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l06361"></a><span class="lineno"> 6361</span>&#160;<span class="comment">C***REVISION DATE  940927   Removed MNEWT and added RHOK in call list.</span></div><div class="line"><a name="l06362"></a><span class="lineno"> 6362</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06363"></a><span class="lineno"> 6363</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06364"></a><span class="lineno"> 6364</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06365"></a><span class="lineno"> 6365</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l06366"></a><span class="lineno"> 6366</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06367"></a><span class="lineno"> 6367</span>&#160;<span class="comment">C This routine solves the linear system A * Z = R using a scaled</span></div><div class="line"><a name="l06368"></a><span class="lineno"> 6368</span>&#160;<span class="comment">C preconditioned version of the generalized minimum residual method.</span></div><div class="line"><a name="l06369"></a><span class="lineno"> 6369</span>&#160;<span class="comment">C An initial guess of Z = 0 is assumed.</span></div><div class="line"><a name="l06370"></a><span class="lineno"> 6370</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06371"></a><span class="lineno"> 6371</span>&#160;<span class="comment">C      On entry</span></div><div class="line"><a name="l06372"></a><span class="lineno"> 6372</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06373"></a><span class="lineno"> 6373</span>&#160;<span class="comment">C          NEQ = Problem size, passed to PSOL.</span></div><div class="line"><a name="l06374"></a><span class="lineno"> 6374</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06375"></a><span class="lineno"> 6375</span>&#160;<span class="comment">C           TN = Current Value of T.</span></div><div class="line"><a name="l06376"></a><span class="lineno"> 6376</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06377"></a><span class="lineno"> 6377</span>&#160;<span class="comment">C            Y = Array Containing current dependent variable vector.</span></div><div class="line"><a name="l06378"></a><span class="lineno"> 6378</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06379"></a><span class="lineno"> 6379</span>&#160;<span class="comment">C       YPRIME = Array Containing current first derivative of Y.</span></div><div class="line"><a name="l06380"></a><span class="lineno"> 6380</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06381"></a><span class="lineno"> 6381</span>&#160;<span class="comment">C         SAVR = Array containing current value of G(T,Y,YPRIME).</span></div><div class="line"><a name="l06382"></a><span class="lineno"> 6382</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06383"></a><span class="lineno"> 6383</span>&#160;<span class="comment">C            R = The right hand side of the system A*Z = R.</span></div><div class="line"><a name="l06384"></a><span class="lineno"> 6384</span>&#160;<span class="comment">C                R is also used as work space when computing</span></div><div class="line"><a name="l06385"></a><span class="lineno"> 6385</span>&#160;<span class="comment">C                the final approximation and will therefore be</span></div><div class="line"><a name="l06386"></a><span class="lineno"> 6386</span>&#160;<span class="comment">C                destroyed.</span></div><div class="line"><a name="l06387"></a><span class="lineno"> 6387</span>&#160;<span class="comment">C                (R is the same as V(*,MAXL+1) in the call to DSPIGM.)</span></div><div class="line"><a name="l06388"></a><span class="lineno"> 6388</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06389"></a><span class="lineno"> 6389</span>&#160;<span class="comment">C         WGHT = The vector of length NEQ containing the nonzero</span></div><div class="line"><a name="l06390"></a><span class="lineno"> 6390</span>&#160;<span class="comment">C                elements of the diagonal scaling matrix.</span></div><div class="line"><a name="l06391"></a><span class="lineno"> 6391</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06392"></a><span class="lineno"> 6392</span>&#160;<span class="comment">C         MAXL = The maximum allowable order of the matrix H.</span></div><div class="line"><a name="l06393"></a><span class="lineno"> 6393</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06394"></a><span class="lineno"> 6394</span>&#160;<span class="comment">C       MAXLP1 = MAXL + 1, used for dynamic dimensioning of HES.</span></div><div class="line"><a name="l06395"></a><span class="lineno"> 6395</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06396"></a><span class="lineno"> 6396</span>&#160;<span class="comment">C          KMP = The number of previous vectors the new vector, VNEW,</span></div><div class="line"><a name="l06397"></a><span class="lineno"> 6397</span>&#160;<span class="comment">C                must be made orthogonal to.  (KMP .LE. MAXL.)</span></div><div class="line"><a name="l06398"></a><span class="lineno"> 6398</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06399"></a><span class="lineno"> 6399</span>&#160;<span class="comment">C        EPLIN = Tolerance on residuals R-A*Z in weighted rms norm.</span></div><div class="line"><a name="l06400"></a><span class="lineno"> 6400</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06401"></a><span class="lineno"> 6401</span>&#160;<span class="comment">C           CJ = Scalar proportional to current value of </span></div><div class="line"><a name="l06402"></a><span class="lineno"> 6402</span>&#160;<span class="comment">C                1/(step size H).</span></div><div class="line"><a name="l06403"></a><span class="lineno"> 6403</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06404"></a><span class="lineno"> 6404</span>&#160;<span class="comment">C           WK = Real work array used by routine DATV and PSOL.</span></div><div class="line"><a name="l06405"></a><span class="lineno"> 6405</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06406"></a><span class="lineno"> 6406</span>&#160;<span class="comment">C           DL = Real work array used for calculation of the residual</span></div><div class="line"><a name="l06407"></a><span class="lineno"> 6407</span>&#160;<span class="comment">C                norm RHO when the method is incomplete (KMP.LT.MAXL)</span></div><div class="line"><a name="l06408"></a><span class="lineno"> 6408</span>&#160;<span class="comment">C                and/or when using restarting.</span></div><div class="line"><a name="l06409"></a><span class="lineno"> 6409</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06410"></a><span class="lineno"> 6410</span>&#160;<span class="comment">C           WP = Real work array used by preconditioner PSOL.</span></div><div class="line"><a name="l06411"></a><span class="lineno"> 6411</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06412"></a><span class="lineno"> 6412</span>&#160;<span class="comment">C          IWP = Integer work array used by preconditioner PSOL.</span></div><div class="line"><a name="l06413"></a><span class="lineno"> 6413</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06414"></a><span class="lineno"> 6414</span>&#160;<span class="comment">C         IRST = Method flag indicating if restarting is being</span></div><div class="line"><a name="l06415"></a><span class="lineno"> 6415</span>&#160;<span class="comment">C                performed.  IRST .GT. 0 means restarting is active,</span></div><div class="line"><a name="l06416"></a><span class="lineno"> 6416</span>&#160;<span class="comment">C                while IRST = 0 means restarting is not being used.</span></div><div class="line"><a name="l06417"></a><span class="lineno"> 6417</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06418"></a><span class="lineno"> 6418</span>&#160;<span class="comment">C        NRSTS = Counter for the number of restarts on the current</span></div><div class="line"><a name="l06419"></a><span class="lineno"> 6419</span>&#160;<span class="comment">C                call to DSPIGM.  If NRSTS .GT. 0, then the residual</span></div><div class="line"><a name="l06420"></a><span class="lineno"> 6420</span>&#160;<span class="comment">C                R is already scaled, and so scaling of R is not</span></div><div class="line"><a name="l06421"></a><span class="lineno"> 6421</span>&#160;<span class="comment">C                necessary.</span></div><div class="line"><a name="l06422"></a><span class="lineno"> 6422</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06423"></a><span class="lineno"> 6423</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06424"></a><span class="lineno"> 6424</span>&#160;<span class="comment">C      On Return</span></div><div class="line"><a name="l06425"></a><span class="lineno"> 6425</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06426"></a><span class="lineno"> 6426</span>&#160;<span class="comment">C         Z    = The final computed approximation to the solution</span></div><div class="line"><a name="l06427"></a><span class="lineno"> 6427</span>&#160;<span class="comment">C                of the system A*Z = R.</span></div><div class="line"><a name="l06428"></a><span class="lineno"> 6428</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06429"></a><span class="lineno"> 6429</span>&#160;<span class="comment">C         LGMR = The number of iterations performed and</span></div><div class="line"><a name="l06430"></a><span class="lineno"> 6430</span>&#160;<span class="comment">C                the current order of the upper Hessenberg</span></div><div class="line"><a name="l06431"></a><span class="lineno"> 6431</span>&#160;<span class="comment">C                matrix HES.</span></div><div class="line"><a name="l06432"></a><span class="lineno"> 6432</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06433"></a><span class="lineno"> 6433</span>&#160;<span class="comment">C         NRE  = The number of calls to RES (i.e. DATV)</span></div><div class="line"><a name="l06434"></a><span class="lineno"> 6434</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06435"></a><span class="lineno"> 6435</span>&#160;<span class="comment">C         NPSL = The number of calls to PSOL.</span></div><div class="line"><a name="l06436"></a><span class="lineno"> 6436</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06437"></a><span class="lineno"> 6437</span>&#160;<span class="comment">C         V    = The neq by (LGMR+1) array containing the LGMR</span></div><div class="line"><a name="l06438"></a><span class="lineno"> 6438</span>&#160;<span class="comment">C                orthogonal vectors V(*,1) to V(*,LGMR).</span></div><div class="line"><a name="l06439"></a><span class="lineno"> 6439</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06440"></a><span class="lineno"> 6440</span>&#160;<span class="comment">C         HES  = The upper triangular factor of the QR decomposition</span></div><div class="line"><a name="l06441"></a><span class="lineno"> 6441</span>&#160;<span class="comment">C                of the (LGMR+1) by LGMR upper Hessenberg matrix whose</span></div><div class="line"><a name="l06442"></a><span class="lineno"> 6442</span>&#160;<span class="comment">C                entries are the scaled inner-products of A*V(*,I)</span></div><div class="line"><a name="l06443"></a><span class="lineno"> 6443</span>&#160;<span class="comment">C                and V(*,K).</span></div><div class="line"><a name="l06444"></a><span class="lineno"> 6444</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06445"></a><span class="lineno"> 6445</span>&#160;<span class="comment">C         Q    = Real array of length 2*MAXL containing the components</span></div><div class="line"><a name="l06446"></a><span class="lineno"> 6446</span>&#160;<span class="comment">C                of the givens rotations used in the QR decomposition</span></div><div class="line"><a name="l06447"></a><span class="lineno"> 6447</span>&#160;<span class="comment">C                of HES.  It is loaded in DHEQR and used in DHELS.</span></div><div class="line"><a name="l06448"></a><span class="lineno"> 6448</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06449"></a><span class="lineno"> 6449</span>&#160;<span class="comment">C         IRES = Error flag from RES.</span></div><div class="line"><a name="l06450"></a><span class="lineno"> 6450</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06451"></a><span class="lineno"> 6451</span>&#160;<span class="comment">C           DL = Scaled preconditioned residual, </span></div><div class="line"><a name="l06452"></a><span class="lineno"> 6452</span>&#160;<span class="comment">C                (D-inverse)*(P-inverse)*(R-A*Z). Only loaded when</span></div><div class="line"><a name="l06453"></a><span class="lineno"> 6453</span>&#160;<span class="comment">C                performing restarts of the Krylov iteration.</span></div><div class="line"><a name="l06454"></a><span class="lineno"> 6454</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06455"></a><span class="lineno"> 6455</span>&#160;<span class="comment">C         RHOK = Weighted norm of final preconditioned residual.</span></div><div class="line"><a name="l06456"></a><span class="lineno"> 6456</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06457"></a><span class="lineno"> 6457</span>&#160;<span class="comment">C        IFLAG = Integer error flag..</span></div><div class="line"><a name="l06458"></a><span class="lineno"> 6458</span>&#160;<span class="comment">C                0 Means convergence in LGMR iterations, LGMR.LE.MAXL.</span></div><div class="line"><a name="l06459"></a><span class="lineno"> 6459</span>&#160;<span class="comment">C                1 Means the convergence test did not pass in MAXL</span></div><div class="line"><a name="l06460"></a><span class="lineno"> 6460</span>&#160;<span class="comment">C                  iterations, but the new residual norm (RHO) is</span></div><div class="line"><a name="l06461"></a><span class="lineno"> 6461</span>&#160;<span class="comment">C                  .LT. the old residual norm (RNRM), and so Z is</span></div><div class="line"><a name="l06462"></a><span class="lineno"> 6462</span>&#160;<span class="comment">C                  computed.</span></div><div class="line"><a name="l06463"></a><span class="lineno"> 6463</span>&#160;<span class="comment">C                2 Means the convergence test did not pass in MAXL</span></div><div class="line"><a name="l06464"></a><span class="lineno"> 6464</span>&#160;<span class="comment">C                  iterations, new residual norm (RHO) .GE. old residual</span></div><div class="line"><a name="l06465"></a><span class="lineno"> 6465</span>&#160;<span class="comment">C                  norm (RNRM), and the initial guess, Z = 0, is</span></div><div class="line"><a name="l06466"></a><span class="lineno"> 6466</span>&#160;<span class="comment">C                  returned.</span></div><div class="line"><a name="l06467"></a><span class="lineno"> 6467</span>&#160;<span class="comment">C                3 Means there was a recoverable error in PSOL</span></div><div class="line"><a name="l06468"></a><span class="lineno"> 6468</span>&#160;<span class="comment">C                  caused by the preconditioner being out of date.</span></div><div class="line"><a name="l06469"></a><span class="lineno"> 6469</span>&#160;<span class="comment">C               -1 Means there was an unrecoverable error in PSOL.</span></div><div class="line"><a name="l06470"></a><span class="lineno"> 6470</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06471"></a><span class="lineno"> 6471</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06472"></a><span class="lineno"> 6472</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l06473"></a><span class="lineno"> 6473</span>&#160;<span class="comment">C   PSOL, DNRM2, DSCAL, DATV, DORTH, DHEQR, DCOPY, DHELS, DAXPY</span></div><div class="line"><a name="l06474"></a><span class="lineno"> 6474</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06475"></a><span class="lineno"> 6475</span>&#160;<span class="comment">C***END PROLOGUE  DSPIGM</span></div><div class="line"><a name="l06476"></a><span class="lineno"> 6476</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06477"></a><span class="lineno"> 6477</span>&#160;      <span class="keywordtype">INTEGER</span> NEQ,MAXL,MAXLP1,KMP,IRES,NRE,NPSL,LGMR,IWP,</div><div class="line"><a name="l06478"></a><span class="lineno"> 6478</span>&#160;     1   iflag,irst,nrsts,ipar</div><div class="line"><a name="l06479"></a><span class="lineno"> 6479</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> TN,Y,YPRIME,SAVR,R,WGHT,EPLIN,CJ,Z,V,HES,Q,WP,WK,</div><div class="line"><a name="l06480"></a><span class="lineno"> 6480</span>&#160;     1   dl,rhok,rpar</div><div class="line"><a name="l06481"></a><span class="lineno"> 6481</span>&#160;      dimension y(*), yprime(*), savr(*), r(*), wght(*), z(*),</div><div class="line"><a name="l06482"></a><span class="lineno"> 6482</span>&#160;     1   v(neq,*), hes(maxlp1,*), q(*), wp(*), iwp(*), wk(*), dl(*),</div><div class="line"><a name="l06483"></a><span class="lineno"> 6483</span>&#160;     2   rpar(*), ipar(*)</div><div class="line"><a name="l06484"></a><span class="lineno"> 6484</span>&#160;      <span class="keywordtype">INTEGER</span> I, IER, INFO, IP1, I2, J, K, LL, LLP1</div><div class="line"><a name="l06485"></a><span class="lineno"> 6485</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> RNRM,C,DLNRM,PROD,RHO,S,SNORMW,DNRM2,TEM</div><div class="line"><a name="l06486"></a><span class="lineno"> 6486</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, psol</div><div class="line"><a name="l06487"></a><span class="lineno"> 6487</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06488"></a><span class="lineno"> 6488</span>&#160;      ier = 0</div><div class="line"><a name="l06489"></a><span class="lineno"> 6489</span>&#160;      iflag = 0</div><div class="line"><a name="l06490"></a><span class="lineno"> 6490</span>&#160;      lgmr = 0</div><div class="line"><a name="l06491"></a><span class="lineno"> 6491</span>&#160;      npsl = 0</div><div class="line"><a name="l06492"></a><span class="lineno"> 6492</span>&#160;      nre = 0</div><div class="line"><a name="l06493"></a><span class="lineno"> 6493</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06494"></a><span class="lineno"> 6494</span>&#160;<span class="comment">C The initial guess for Z is 0.  The initial residual is therefore</span></div><div class="line"><a name="l06495"></a><span class="lineno"> 6495</span>&#160;<span class="comment">C the vector R.  Initialize Z to 0.</span></div><div class="line"><a name="l06496"></a><span class="lineno"> 6496</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06497"></a><span class="lineno"> 6497</span>&#160;      <span class="keywordflow">DO</span> 10 i = 1,neq</div><div class="line"><a name="l06498"></a><span class="lineno"> 6498</span>&#160; 10     z(i) = 0.0d0</div><div class="line"><a name="l06499"></a><span class="lineno"> 6499</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06500"></a><span class="lineno"> 6500</span>&#160;<span class="comment">C Apply inverse of left preconditioner to vector R if NRSTS .EQ. 0.</span></div><div class="line"><a name="l06501"></a><span class="lineno"> 6501</span>&#160;<span class="comment">C Form V(*,1), the scaled preconditioned right hand side.</span></div><div class="line"><a name="l06502"></a><span class="lineno"> 6502</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06503"></a><span class="lineno"> 6503</span>&#160;      <span class="keywordflow">IF</span> (nrsts .EQ. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06504"></a><span class="lineno"> 6504</span>&#160;         <span class="keyword">CALL </span>psol (neq, tn, y, yprime, savr, wk, cj, wght, wp, iwp,</div><div class="line"><a name="l06505"></a><span class="lineno"> 6505</span>&#160;     1      r, eplin, ier, rpar, ipar)</div><div class="line"><a name="l06506"></a><span class="lineno"> 6506</span>&#160;         npsl = 1</div><div class="line"><a name="l06507"></a><span class="lineno"> 6507</span>&#160;         <span class="keywordflow">IF</span> (ier .NE. 0) <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l06508"></a><span class="lineno"> 6508</span>&#160;         <span class="keywordflow">DO</span> 30 i = 1,neq</div><div class="line"><a name="l06509"></a><span class="lineno"> 6509</span>&#160; 30         v(i,1) = r(i)*wght(i)</div><div class="line"><a name="l06510"></a><span class="lineno"> 6510</span>&#160;      <span class="keywordflow">ELSE</span></div><div class="line"><a name="l06511"></a><span class="lineno"> 6511</span>&#160;         <span class="keywordflow">DO</span> 35 i = 1,neq</div><div class="line"><a name="l06512"></a><span class="lineno"> 6512</span>&#160; 35         v(i,1) = r(i)</div><div class="line"><a name="l06513"></a><span class="lineno"> 6513</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l06514"></a><span class="lineno"> 6514</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06515"></a><span class="lineno"> 6515</span>&#160;<span class="comment">C Calculate norm of scaled vector V(*,1) and normalize it</span></div><div class="line"><a name="l06516"></a><span class="lineno"> 6516</span>&#160;<span class="comment">C If, however, the norm of V(*,1) (i.e. the norm of the preconditioned</span></div><div class="line"><a name="l06517"></a><span class="lineno"> 6517</span>&#160;<span class="comment">C residual) is .le. EPLIN, then return with Z=0.</span></div><div class="line"><a name="l06518"></a><span class="lineno"> 6518</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06519"></a><span class="lineno"> 6519</span>&#160;      rnrm = dnrm2(neq, v, 1)</div><div class="line"><a name="l06520"></a><span class="lineno"> 6520</span>&#160;      <span class="keywordflow">IF</span> (rnrm .LE. eplin) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06521"></a><span class="lineno"> 6521</span>&#160;        rhok = rnrm</div><div class="line"><a name="l06522"></a><span class="lineno"> 6522</span>&#160;        <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06523"></a><span class="lineno"> 6523</span>&#160;<span class="keywordflow">        ENDIF</span></div><div class="line"><a name="l06524"></a><span class="lineno"> 6524</span>&#160;      tem = 1.0d0/rnrm</div><div class="line"><a name="l06525"></a><span class="lineno"> 6525</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a0590f8db475e11dc2c9137bb13887acf">dscal</a> (neq, tem, v(1,1), 1)</div><div class="line"><a name="l06526"></a><span class="lineno"> 6526</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06527"></a><span class="lineno"> 6527</span>&#160;<span class="comment">C Zero out the HES array.</span></div><div class="line"><a name="l06528"></a><span class="lineno"> 6528</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06529"></a><span class="lineno"> 6529</span>&#160;      <span class="keywordflow">DO</span> 65 j = 1,maxl</div><div class="line"><a name="l06530"></a><span class="lineno"> 6530</span>&#160;        <span class="keywordflow">DO</span> 60 i = 1,maxlp1</div><div class="line"><a name="l06531"></a><span class="lineno"> 6531</span>&#160; 60       hes(i,j) = 0.0d0</div><div class="line"><a name="l06532"></a><span class="lineno"> 6532</span>&#160; 65     <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06533"></a><span class="lineno"> 6533</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06534"></a><span class="lineno"> 6534</span>&#160;<span class="comment">C Main loop to compute the vectors V(*,2) to V(*,MAXL).</span></div><div class="line"><a name="l06535"></a><span class="lineno"> 6535</span>&#160;<span class="comment">C The running product PROD is needed for the convergence test.</span></div><div class="line"><a name="l06536"></a><span class="lineno"> 6536</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06537"></a><span class="lineno"> 6537</span>&#160;      prod = 1.0d0</div><div class="line"><a name="l06538"></a><span class="lineno"> 6538</span>&#160;      <span class="keywordflow">DO</span> 90 ll = 1,maxl</div><div class="line"><a name="l06539"></a><span class="lineno"> 6539</span>&#160;        lgmr = ll</div><div class="line"><a name="l06540"></a><span class="lineno"> 6540</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06541"></a><span class="lineno"> 6541</span>&#160;<span class="comment">C Call routine DATV to compute VNEW = ABAR*V(LL), where ABAR is</span></div><div class="line"><a name="l06542"></a><span class="lineno"> 6542</span>&#160;<span class="comment">C the matrix A with scaling and inverse preconditioner factors applied.</span></div><div class="line"><a name="l06543"></a><span class="lineno"> 6543</span>&#160;<span class="comment">C Call routine DORTH to orthogonalize the new vector VNEW = V(*,LL+1).</span></div><div class="line"><a name="l06544"></a><span class="lineno"> 6544</span>&#160;<span class="comment">C call routine DHEQR to update the factors of HES.</span></div><div class="line"><a name="l06545"></a><span class="lineno"> 6545</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06546"></a><span class="lineno"> 6546</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ab0bfbcd159ed7be7b6ff62d32efa2f3c">datv</a> (neq, y, tn, yprime, savr, v(1,ll), wght, z,</div><div class="line"><a name="l06547"></a><span class="lineno"> 6547</span>&#160;     1     res, ires, psol, v(1,ll+1), wk, wp, iwp, cj, eplin,</div><div class="line"><a name="l06548"></a><span class="lineno"> 6548</span>&#160;     1     ier, nre, npsl, rpar, ipar)</div><div class="line"><a name="l06549"></a><span class="lineno"> 6549</span>&#160;        <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06550"></a><span class="lineno"> 6550</span>&#160;        <span class="keywordflow">IF</span> (ier .NE. 0) <span class="keywordflow">GO TO</span> 300</div><div class="line"><a name="l06551"></a><span class="lineno"> 6551</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a24778d95221e878d2df4a54cb3af6d80">dorth</a> (v(1,ll+1), v, hes, neq, ll, maxlp1, kmp, snormw)</div><div class="line"><a name="l06552"></a><span class="lineno"> 6552</span>&#160;        hes(ll+1,ll) = snormw</div><div class="line"><a name="l06553"></a><span class="lineno"> 6553</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ab4330c24bb8f25167a9066561bb10ada">dheqr</a> (hes, maxlp1, ll, q, info, ll)</div><div class="line"><a name="l06554"></a><span class="lineno"> 6554</span>&#160;        <span class="keywordflow">IF</span> (info .EQ. ll) <span class="keywordflow">GO TO</span> 120</div><div class="line"><a name="l06555"></a><span class="lineno"> 6555</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06556"></a><span class="lineno"> 6556</span>&#160;<span class="comment">C Update RHO, the estimate of the norm of the residual R - A*ZL.</span></div><div class="line"><a name="l06557"></a><span class="lineno"> 6557</span>&#160;<span class="comment">C If KMP .LT. MAXL, then the vectors V(*,1),...,V(*,LL+1) are not</span></div><div class="line"><a name="l06558"></a><span class="lineno"> 6558</span>&#160;<span class="comment">C necessarily orthogonal for LL .GT. KMP.  The vector DL must then</span></div><div class="line"><a name="l06559"></a><span class="lineno"> 6559</span>&#160;<span class="comment">C be computed, and its norm used in the calculation of RHO.</span></div><div class="line"><a name="l06560"></a><span class="lineno"> 6560</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06561"></a><span class="lineno"> 6561</span>&#160;        prod = prod*q(2*ll)</div><div class="line"><a name="l06562"></a><span class="lineno"> 6562</span>&#160;        rho = abs(prod*rnrm)</div><div class="line"><a name="l06563"></a><span class="lineno"> 6563</span>&#160;        <span class="keywordflow">IF</span> ((ll.GT.kmp) .AND. (kmp.LT.maxl)) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06564"></a><span class="lineno"> 6564</span>&#160;          <span class="keywordflow">IF</span> (ll .EQ. kmp+1) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06565"></a><span class="lineno"> 6565</span>&#160;            <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, v(1,1), 1, dl, 1)</div><div class="line"><a name="l06566"></a><span class="lineno"> 6566</span>&#160;            <span class="keywordflow">DO</span> 75 i = 1,kmp</div><div class="line"><a name="l06567"></a><span class="lineno"> 6567</span>&#160;              ip1 = i + 1</div><div class="line"><a name="l06568"></a><span class="lineno"> 6568</span>&#160;              i2 = i*2</div><div class="line"><a name="l06569"></a><span class="lineno"> 6569</span>&#160;              s = q(i2)</div><div class="line"><a name="l06570"></a><span class="lineno"> 6570</span>&#160;              c = q(i2-1)</div><div class="line"><a name="l06571"></a><span class="lineno"> 6571</span>&#160;              <span class="keywordflow">DO</span> 70 k = 1,neq</div><div class="line"><a name="l06572"></a><span class="lineno"> 6572</span>&#160; 70             dl(k) = s*dl(k) + c*v(k,ip1)</div><div class="line"><a name="l06573"></a><span class="lineno"> 6573</span>&#160; 75           <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06574"></a><span class="lineno"> 6574</span>&#160;<span class="keywordflow">            ENDIF</span></div><div class="line"><a name="l06575"></a><span class="lineno"> 6575</span>&#160;          s = q(2*ll)</div><div class="line"><a name="l06576"></a><span class="lineno"> 6576</span>&#160;          c = q(2*ll-1)/snormw</div><div class="line"><a name="l06577"></a><span class="lineno"> 6577</span>&#160;          llp1 = ll + 1</div><div class="line"><a name="l06578"></a><span class="lineno"> 6578</span>&#160;          <span class="keywordflow">DO</span> 80 k = 1,neq</div><div class="line"><a name="l06579"></a><span class="lineno"> 6579</span>&#160; 80         dl(k) = s*dl(k) + c*v(k,llp1)</div><div class="line"><a name="l06580"></a><span class="lineno"> 6580</span>&#160;          dlnrm = dnrm2(neq, dl, 1)</div><div class="line"><a name="l06581"></a><span class="lineno"> 6581</span>&#160;          rho = rho*dlnrm</div><div class="line"><a name="l06582"></a><span class="lineno"> 6582</span>&#160;<span class="keywordflow">          ENDIF</span></div><div class="line"><a name="l06583"></a><span class="lineno"> 6583</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06584"></a><span class="lineno"> 6584</span>&#160;<span class="comment">C Test for convergence.  If passed, compute approximation ZL.</span></div><div class="line"><a name="l06585"></a><span class="lineno"> 6585</span>&#160;<span class="comment">C If failed and LL .LT. MAXL, then continue iterating.</span></div><div class="line"><a name="l06586"></a><span class="lineno"> 6586</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06587"></a><span class="lineno"> 6587</span>&#160;        <span class="keywordflow">IF</span> (rho .LE. eplin) <span class="keywordflow">GO TO</span> 200</div><div class="line"><a name="l06588"></a><span class="lineno"> 6588</span>&#160;        <span class="keywordflow">IF</span> (ll .EQ. maxl) <span class="keywordflow">GO TO</span> 100</div><div class="line"><a name="l06589"></a><span class="lineno"> 6589</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06590"></a><span class="lineno"> 6590</span>&#160;<span class="comment">C Rescale so that the norm of V(1,LL+1) is one.</span></div><div class="line"><a name="l06591"></a><span class="lineno"> 6591</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06592"></a><span class="lineno"> 6592</span>&#160;        tem = 1.0d0/snormw</div><div class="line"><a name="l06593"></a><span class="lineno"> 6593</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a0590f8db475e11dc2c9137bb13887acf">dscal</a> (neq, tem, v(1,ll+1), 1)</div><div class="line"><a name="l06594"></a><span class="lineno"> 6594</span>&#160; 90     <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06595"></a><span class="lineno"> 6595</span>&#160; 100  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06596"></a><span class="lineno"> 6596</span>&#160;      <span class="keywordflow">IF</span> (rho .LT. rnrm) <span class="keywordflow">GO TO</span> 150</div><div class="line"><a name="l06597"></a><span class="lineno"> 6597</span>&#160; 120  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06598"></a><span class="lineno"> 6598</span>&#160;      iflag = 2</div><div class="line"><a name="l06599"></a><span class="lineno"> 6599</span>&#160;      <span class="keywordflow">DO</span> 130 i = 1,neq</div><div class="line"><a name="l06600"></a><span class="lineno"> 6600</span>&#160; 130     z(i) = 0.d0</div><div class="line"><a name="l06601"></a><span class="lineno"> 6601</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06602"></a><span class="lineno"> 6602</span>&#160; 150  iflag = 1</div><div class="line"><a name="l06603"></a><span class="lineno"> 6603</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06604"></a><span class="lineno"> 6604</span>&#160;<span class="comment">C The tolerance was not met, but the residual norm was reduced.</span></div><div class="line"><a name="l06605"></a><span class="lineno"> 6605</span>&#160;<span class="comment">C If performing restarting (IRST .gt. 0) calculate the residual vector</span></div><div class="line"><a name="l06606"></a><span class="lineno"> 6606</span>&#160;<span class="comment">C RL and store it in the DL array.  If the incomplete version is </span></div><div class="line"><a name="l06607"></a><span class="lineno"> 6607</span>&#160;<span class="comment">C being used (KMP .lt. MAXL) then DL has already been calculated.</span></div><div class="line"><a name="l06608"></a><span class="lineno"> 6608</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06609"></a><span class="lineno"> 6609</span>&#160;      <span class="keywordflow">IF</span> (irst .GT. 0) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06610"></a><span class="lineno"> 6610</span>&#160;         <span class="keywordflow">IF</span> (kmp .EQ. maxl) <span class="keywordflow">THEN</span></div><div class="line"><a name="l06611"></a><span class="lineno"> 6611</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06612"></a><span class="lineno"> 6612</span>&#160;<span class="comment">C           Calculate DL from the V(I)&#39;s.</span></div><div class="line"><a name="l06613"></a><span class="lineno"> 6613</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06614"></a><span class="lineno"> 6614</span>&#160;            <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a> (neq, v(1,1), 1, dl, 1)</div><div class="line"><a name="l06615"></a><span class="lineno"> 6615</span>&#160;            maxlm1 = maxl - 1</div><div class="line"><a name="l06616"></a><span class="lineno"> 6616</span>&#160;            <span class="keywordflow">DO</span> 175 i = 1,maxlm1</div><div class="line"><a name="l06617"></a><span class="lineno"> 6617</span>&#160;               ip1 = i + 1</div><div class="line"><a name="l06618"></a><span class="lineno"> 6618</span>&#160;               i2 = i*2</div><div class="line"><a name="l06619"></a><span class="lineno"> 6619</span>&#160;               s = q(i2)</div><div class="line"><a name="l06620"></a><span class="lineno"> 6620</span>&#160;               c = q(i2-1)</div><div class="line"><a name="l06621"></a><span class="lineno"> 6621</span>&#160;               <span class="keywordflow">DO</span> 170 k = 1,neq</div><div class="line"><a name="l06622"></a><span class="lineno"> 6622</span>&#160; 170              dl(k) = s*dl(k) + c*v(k,ip1)</div><div class="line"><a name="l06623"></a><span class="lineno"> 6623</span>&#160; 175        <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06624"></a><span class="lineno"> 6624</span>&#160;            s = q(2*maxl)</div><div class="line"><a name="l06625"></a><span class="lineno"> 6625</span>&#160;            c = q(2*maxl-1)/snormw</div><div class="line"><a name="l06626"></a><span class="lineno"> 6626</span>&#160;            <span class="keywordflow">DO</span> 180 k = 1,neq</div><div class="line"><a name="l06627"></a><span class="lineno"> 6627</span>&#160; 180           dl(k) = s*dl(k) + c*v(k,maxlp1)</div><div class="line"><a name="l06628"></a><span class="lineno"> 6628</span>&#160;<span class="keywordflow">         ENDIF</span></div><div class="line"><a name="l06629"></a><span class="lineno"> 6629</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06630"></a><span class="lineno"> 6630</span>&#160;<span class="comment">C        Scale DL by RNRM*PROD to obtain the residual RL.</span></div><div class="line"><a name="l06631"></a><span class="lineno"> 6631</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06632"></a><span class="lineno"> 6632</span>&#160;         tem = rnrm*prod</div><div class="line"><a name="l06633"></a><span class="lineno"> 6633</span>&#160;         <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#a0590f8db475e11dc2c9137bb13887acf">dscal</a>(neq, tem, dl, 1)</div><div class="line"><a name="l06634"></a><span class="lineno"> 6634</span>&#160;<span class="keywordflow">      ENDIF</span></div><div class="line"><a name="l06635"></a><span class="lineno"> 6635</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06636"></a><span class="lineno"> 6636</span>&#160;<span class="comment">C Compute the approximation ZL to the solution.</span></div><div class="line"><a name="l06637"></a><span class="lineno"> 6637</span>&#160;<span class="comment">C Since the vector Z was used as work space, and the initial guess</span></div><div class="line"><a name="l06638"></a><span class="lineno"> 6638</span>&#160;<span class="comment">C of the Newton correction is zero, Z must be reset to zero.</span></div><div class="line"><a name="l06639"></a><span class="lineno"> 6639</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06640"></a><span class="lineno"> 6640</span>&#160; 200  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06641"></a><span class="lineno"> 6641</span>&#160;      ll = lgmr</div><div class="line"><a name="l06642"></a><span class="lineno"> 6642</span>&#160;      llp1 = ll + 1</div><div class="line"><a name="l06643"></a><span class="lineno"> 6643</span>&#160;      <span class="keywordflow">DO</span> 210 k = 1,llp1</div><div class="line"><a name="l06644"></a><span class="lineno"> 6644</span>&#160; 210    r(k) = 0.0d0</div><div class="line"><a name="l06645"></a><span class="lineno"> 6645</span>&#160;      r(1) = rnrm</div><div class="line"><a name="l06646"></a><span class="lineno"> 6646</span>&#160;      <span class="keyword">CALL </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a96d6ea4d2053a20e9d76a8a0fc1f5af4">dhels</a> (hes, maxlp1, ll, q, r)</div><div class="line"><a name="l06647"></a><span class="lineno"> 6647</span>&#160;      <span class="keywordflow">DO</span> 220 k = 1,neq</div><div class="line"><a name="l06648"></a><span class="lineno"> 6648</span>&#160; 220    z(k) = 0.0d0</div><div class="line"><a name="l06649"></a><span class="lineno"> 6649</span>&#160;      <span class="keywordflow">DO</span> 230 i = 1,ll</div><div class="line"><a name="l06650"></a><span class="lineno"> 6650</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#adb136e14634fe4b772a0b034f52f3939">daxpy</a> (neq, r(i), v(1,i), 1, z, 1)</div><div class="line"><a name="l06651"></a><span class="lineno"> 6651</span>&#160; 230    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06652"></a><span class="lineno"> 6652</span>&#160;      <span class="keywordflow">DO</span> 240 i = 1,neq</div><div class="line"><a name="l06653"></a><span class="lineno"> 6653</span>&#160; 240    z(i) = z(i)/wght(i)</div><div class="line"><a name="l06654"></a><span class="lineno"> 6654</span>&#160;<span class="comment">C Load RHO into RHOK.</span></div><div class="line"><a name="l06655"></a><span class="lineno"> 6655</span>&#160;      rhok = rho</div><div class="line"><a name="l06656"></a><span class="lineno"> 6656</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06657"></a><span class="lineno"> 6657</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06658"></a><span class="lineno"> 6658</span>&#160;<span class="comment">C This block handles error returns forced by routine PSOL.</span></div><div class="line"><a name="l06659"></a><span class="lineno"> 6659</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06660"></a><span class="lineno"> 6660</span>&#160; 300  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06661"></a><span class="lineno"> 6661</span>&#160;      <span class="keywordflow">IF</span> (ier .LT. 0) iflag = -1</div><div class="line"><a name="l06662"></a><span class="lineno"> 6662</span>&#160;      <span class="keywordflow">IF</span> (ier .GT. 0) iflag = 3</div><div class="line"><a name="l06663"></a><span class="lineno"> 6663</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06664"></a><span class="lineno"> 6664</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06665"></a><span class="lineno"> 6665</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06666"></a><span class="lineno"> 6666</span>&#160;<span class="comment">C------END OF SUBROUTINE DSPIGM-----------------------------------------</span></div><div class="line"><a name="l06667"></a><span class="lineno"> 6667</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l06668"></a><span class="lineno"> 6668</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ab0bfbcd159ed7be7b6ff62d32efa2f3c">datv</a> (NEQ, Y, TN, YPRIME, SAVR, V, WGHT, YPTEM, RES,</div><div class="line"><a name="l06669"></a><span class="lineno"> 6669</span>&#160;     *   IRES, PSOL, Z, VTEM, WP, IWP, CJ, EPLIN, IER, NRE, NPSL,</div><div class="line"><a name="l06670"></a><span class="lineno"> 6670</span>&#160;     *   RPAR,IPAR)</div><div class="line"><a name="l06671"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#ab0bfbcd159ed7be7b6ff62d32efa2f3c"> 6671</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06672"></a><span class="lineno"> 6672</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DATV</span></div><div class="line"><a name="l06673"></a><span class="lineno"> 6673</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l06674"></a><span class="lineno"> 6674</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l06675"></a><span class="lineno"> 6675</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06676"></a><span class="lineno"> 6676</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06677"></a><span class="lineno"> 6677</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06678"></a><span class="lineno"> 6678</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l06679"></a><span class="lineno"> 6679</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06680"></a><span class="lineno"> 6680</span>&#160;<span class="comment">C This routine computes the product</span></div><div class="line"><a name="l06681"></a><span class="lineno"> 6681</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06682"></a><span class="lineno"> 6682</span>&#160;<span class="comment">C   Z = (D-inverse)*(P-inverse)*(dF/dY)*(D*V),</span></div><div class="line"><a name="l06683"></a><span class="lineno"> 6683</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06684"></a><span class="lineno"> 6684</span>&#160;<span class="comment">C where F(Y) = G(T, Y, CJ*(Y-A)), CJ is a scalar proportional to 1/H,</span></div><div class="line"><a name="l06685"></a><span class="lineno"> 6685</span>&#160;<span class="comment">C and A involves the past history of Y.  The quantity CJ*(Y-A) is</span></div><div class="line"><a name="l06686"></a><span class="lineno"> 6686</span>&#160;<span class="comment">C an approximation to the first derivative of Y and is stored</span></div><div class="line"><a name="l06687"></a><span class="lineno"> 6687</span>&#160;<span class="comment">C in the array YPRIME.  Note that dF/dY = dG/dY + CJ*dG/dYPRIME.</span></div><div class="line"><a name="l06688"></a><span class="lineno"> 6688</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06689"></a><span class="lineno"> 6689</span>&#160;<span class="comment">C D is a diagonal scaling matrix, and P is the left preconditioning</span></div><div class="line"><a name="l06690"></a><span class="lineno"> 6690</span>&#160;<span class="comment">C matrix.  V is assumed to have L2 norm equal to 1.</span></div><div class="line"><a name="l06691"></a><span class="lineno"> 6691</span>&#160;<span class="comment">C The product is stored in Z and is computed by means of a</span></div><div class="line"><a name="l06692"></a><span class="lineno"> 6692</span>&#160;<span class="comment">C difference quotient, a call to RES, and one call to PSOL.</span></div><div class="line"><a name="l06693"></a><span class="lineno"> 6693</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06694"></a><span class="lineno"> 6694</span>&#160;<span class="comment">C      On entry</span></div><div class="line"><a name="l06695"></a><span class="lineno"> 6695</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06696"></a><span class="lineno"> 6696</span>&#160;<span class="comment">C          NEQ = Problem size, passed to RES and PSOL.</span></div><div class="line"><a name="l06697"></a><span class="lineno"> 6697</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06698"></a><span class="lineno"> 6698</span>&#160;<span class="comment">C            Y = Array containing current dependent variable vector.</span></div><div class="line"><a name="l06699"></a><span class="lineno"> 6699</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06700"></a><span class="lineno"> 6700</span>&#160;<span class="comment">C       YPRIME = Array containing current first derivative of y.</span></div><div class="line"><a name="l06701"></a><span class="lineno"> 6701</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06702"></a><span class="lineno"> 6702</span>&#160;<span class="comment">C         SAVR = Array containing current value of G(T,Y,YPRIME).</span></div><div class="line"><a name="l06703"></a><span class="lineno"> 6703</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06704"></a><span class="lineno"> 6704</span>&#160;<span class="comment">C            V = Real array of length NEQ (can be the same array as Z).</span></div><div class="line"><a name="l06705"></a><span class="lineno"> 6705</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06706"></a><span class="lineno"> 6706</span>&#160;<span class="comment">C         WGHT = Array of length NEQ containing scale factors.</span></div><div class="line"><a name="l06707"></a><span class="lineno"> 6707</span>&#160;<span class="comment">C                1/WGHT(I) are the diagonal elements of the matrix D.</span></div><div class="line"><a name="l06708"></a><span class="lineno"> 6708</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06709"></a><span class="lineno"> 6709</span>&#160;<span class="comment">C        YPTEM = Work array of length NEQ.</span></div><div class="line"><a name="l06710"></a><span class="lineno"> 6710</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06711"></a><span class="lineno"> 6711</span>&#160;<span class="comment">C         VTEM = Work array of length NEQ used to store the</span></div><div class="line"><a name="l06712"></a><span class="lineno"> 6712</span>&#160;<span class="comment">C                unscaled version of V.</span></div><div class="line"><a name="l06713"></a><span class="lineno"> 6713</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06714"></a><span class="lineno"> 6714</span>&#160;<span class="comment">C         WP = Real work array used by preconditioner PSOL.</span></div><div class="line"><a name="l06715"></a><span class="lineno"> 6715</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06716"></a><span class="lineno"> 6716</span>&#160;<span class="comment">C         IWP = Integer work array used by preconditioner PSOL.</span></div><div class="line"><a name="l06717"></a><span class="lineno"> 6717</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06718"></a><span class="lineno"> 6718</span>&#160;<span class="comment">C           CJ = Scalar proportional to current value of </span></div><div class="line"><a name="l06719"></a><span class="lineno"> 6719</span>&#160;<span class="comment">C                1/(step size H).</span></div><div class="line"><a name="l06720"></a><span class="lineno"> 6720</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06721"></a><span class="lineno"> 6721</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06722"></a><span class="lineno"> 6722</span>&#160;<span class="comment">C      On return</span></div><div class="line"><a name="l06723"></a><span class="lineno"> 6723</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06724"></a><span class="lineno"> 6724</span>&#160;<span class="comment">C            Z = Array of length NEQ containing desired scaled</span></div><div class="line"><a name="l06725"></a><span class="lineno"> 6725</span>&#160;<span class="comment">C                matrix-vector product.</span></div><div class="line"><a name="l06726"></a><span class="lineno"> 6726</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06727"></a><span class="lineno"> 6727</span>&#160;<span class="comment">C         IRES = Error flag from RES.</span></div><div class="line"><a name="l06728"></a><span class="lineno"> 6728</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06729"></a><span class="lineno"> 6729</span>&#160;<span class="comment">C          IER = Error flag from PSOL.</span></div><div class="line"><a name="l06730"></a><span class="lineno"> 6730</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06731"></a><span class="lineno"> 6731</span>&#160;<span class="comment">C         NRE  = The number of calls to RES.</span></div><div class="line"><a name="l06732"></a><span class="lineno"> 6732</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06733"></a><span class="lineno"> 6733</span>&#160;<span class="comment">C         NPSL = The number of calls to PSOL.</span></div><div class="line"><a name="l06734"></a><span class="lineno"> 6734</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06735"></a><span class="lineno"> 6735</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06736"></a><span class="lineno"> 6736</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l06737"></a><span class="lineno"> 6737</span>&#160;<span class="comment">C   RES, PSOL</span></div><div class="line"><a name="l06738"></a><span class="lineno"> 6738</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06739"></a><span class="lineno"> 6739</span>&#160;<span class="comment">C***END PROLOGUE  DATV</span></div><div class="line"><a name="l06740"></a><span class="lineno"> 6740</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06741"></a><span class="lineno"> 6741</span>&#160;      <span class="keywordtype">INTEGER</span> NEQ, IRES, IWP, IER, NRE, NPSL, IPAR</div><div class="line"><a name="l06742"></a><span class="lineno"> 6742</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> Y, TN, YPRIME, SAVR, V, WGHT, YPTEM, Z, VTEM,</div><div class="line"><a name="l06743"></a><span class="lineno"> 6743</span>&#160;     1   wp, cj, rpar</div><div class="line"><a name="l06744"></a><span class="lineno"> 6744</span>&#160;      dimension y(*), yprime(*), savr(*), v(*), wght(*), yptem(*),</div><div class="line"><a name="l06745"></a><span class="lineno"> 6745</span>&#160;     1   z(*), vtem(*), wp(*), iwp(*), rpar(*), ipar(*)</div><div class="line"><a name="l06746"></a><span class="lineno"> 6746</span>&#160;      <span class="keywordtype">INTEGER</span> I</div><div class="line"><a name="l06747"></a><span class="lineno"> 6747</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> EPLIN</div><div class="line"><a name="l06748"></a><span class="lineno"> 6748</span>&#160;      <span class="keywordtype">EXTERNAL</span>  res, psol</div><div class="line"><a name="l06749"></a><span class="lineno"> 6749</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06750"></a><span class="lineno"> 6750</span>&#160;      ires = 0</div><div class="line"><a name="l06751"></a><span class="lineno"> 6751</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06752"></a><span class="lineno"> 6752</span>&#160;<span class="comment">C Set VTEM = D * V.</span></div><div class="line"><a name="l06753"></a><span class="lineno"> 6753</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06754"></a><span class="lineno"> 6754</span>&#160;      <span class="keywordflow">DO</span> 10 i = 1,neq</div><div class="line"><a name="l06755"></a><span class="lineno"> 6755</span>&#160; 10     vtem(i) = v(i)/wght(i)</div><div class="line"><a name="l06756"></a><span class="lineno"> 6756</span>&#160;      ier = 0</div><div class="line"><a name="l06757"></a><span class="lineno"> 6757</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06758"></a><span class="lineno"> 6758</span>&#160;<span class="comment">C Store Y in Z and increment Z by VTEM.</span></div><div class="line"><a name="l06759"></a><span class="lineno"> 6759</span>&#160;<span class="comment">C Store YPRIME in YPTEM and increment YPTEM by VTEM*CJ.</span></div><div class="line"><a name="l06760"></a><span class="lineno"> 6760</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06761"></a><span class="lineno"> 6761</span>&#160;      <span class="keywordflow">DO</span> 20 i = 1,neq</div><div class="line"><a name="l06762"></a><span class="lineno"> 6762</span>&#160;        yptem(i) = yprime(i) + vtem(i)*cj</div><div class="line"><a name="l06763"></a><span class="lineno"> 6763</span>&#160; 20     z(i) = y(i) + vtem(i)</div><div class="line"><a name="l06764"></a><span class="lineno"> 6764</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06765"></a><span class="lineno"> 6765</span>&#160;<span class="comment">C Call RES with incremented Y, YPRIME arguments</span></div><div class="line"><a name="l06766"></a><span class="lineno"> 6766</span>&#160;<span class="comment">C stored in Z, YPTEM.  VTEM is overwritten with new residual.</span></div><div class="line"><a name="l06767"></a><span class="lineno"> 6767</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06768"></a><span class="lineno"> 6768</span>&#160;      <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06769"></a><span class="lineno"> 6769</span>&#160;      <span class="keyword">CALL </span>res(tn,z,yptem,cj,vtem,ires,rpar,ipar)</div><div class="line"><a name="l06770"></a><span class="lineno"> 6770</span>&#160;      nre = nre + 1</div><div class="line"><a name="l06771"></a><span class="lineno"> 6771</span>&#160;      <span class="keywordflow">IF</span> (ires .LT. 0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06772"></a><span class="lineno"> 6772</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06773"></a><span class="lineno"> 6773</span>&#160;<span class="comment">C Set Z = (dF/dY) * VBAR using difference quotient.</span></div><div class="line"><a name="l06774"></a><span class="lineno"> 6774</span>&#160;<span class="comment">C (VBAR is old value of VTEM before calling RES)</span></div><div class="line"><a name="l06775"></a><span class="lineno"> 6775</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06776"></a><span class="lineno"> 6776</span>&#160;      <span class="keywordflow">DO</span> 70 i = 1,neq</div><div class="line"><a name="l06777"></a><span class="lineno"> 6777</span>&#160; 70     z(i) = vtem(i) - savr(i)</div><div class="line"><a name="l06778"></a><span class="lineno"> 6778</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06779"></a><span class="lineno"> 6779</span>&#160;<span class="comment">C Apply inverse of left preconditioner to Z.</span></div><div class="line"><a name="l06780"></a><span class="lineno"> 6780</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06781"></a><span class="lineno"> 6781</span>&#160;      <span class="keyword">CALL </span>psol (neq, tn, y, yprime, savr, yptem, cj, wght, wp, iwp,</div><div class="line"><a name="l06782"></a><span class="lineno"> 6782</span>&#160;     1   z, eplin, ier, rpar, ipar)</div><div class="line"><a name="l06783"></a><span class="lineno"> 6783</span>&#160;      npsl = npsl + 1</div><div class="line"><a name="l06784"></a><span class="lineno"> 6784</span>&#160;      <span class="keywordflow">IF</span> (ier .NE. 0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06785"></a><span class="lineno"> 6785</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06786"></a><span class="lineno"> 6786</span>&#160;<span class="comment">C Apply D-inverse to Z and return.</span></div><div class="line"><a name="l06787"></a><span class="lineno"> 6787</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06788"></a><span class="lineno"> 6788</span>&#160;      <span class="keywordflow">DO</span> 90 i = 1,neq</div><div class="line"><a name="l06789"></a><span class="lineno"> 6789</span>&#160; 90     z(i) = z(i)*wght(i)</div><div class="line"><a name="l06790"></a><span class="lineno"> 6790</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06791"></a><span class="lineno"> 6791</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06792"></a><span class="lineno"> 6792</span>&#160;<span class="comment">C------END OF SUBROUTINE DATV-------------------------------------------</span></div><div class="line"><a name="l06793"></a><span class="lineno"> 6793</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l06794"></a><span class="lineno"> 6794</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a24778d95221e878d2df4a54cb3af6d80">dorth</a> (VNEW, V, HES, N, LL, LDHES, KMP, SNORMW)</div><div class="line"><a name="l06795"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a24778d95221e878d2df4a54cb3af6d80"> 6795</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06796"></a><span class="lineno"> 6796</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DORTH</span></div><div class="line"><a name="l06797"></a><span class="lineno"> 6797</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l06798"></a><span class="lineno"> 6798</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l06799"></a><span class="lineno"> 6799</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06800"></a><span class="lineno"> 6800</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06801"></a><span class="lineno"> 6801</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06802"></a><span class="lineno"> 6802</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l06803"></a><span class="lineno"> 6803</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06804"></a><span class="lineno"> 6804</span>&#160;<span class="comment">C This routine orthogonalizes the vector VNEW against the previous</span></div><div class="line"><a name="l06805"></a><span class="lineno"> 6805</span>&#160;<span class="comment">C KMP vectors in the V array.  It uses a modified Gram-Schmidt</span></div><div class="line"><a name="l06806"></a><span class="lineno"> 6806</span>&#160;<span class="comment">C orthogonalization procedure with conditional reorthogonalization.</span></div><div class="line"><a name="l06807"></a><span class="lineno"> 6807</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06808"></a><span class="lineno"> 6808</span>&#160;<span class="comment">C      On entry</span></div><div class="line"><a name="l06809"></a><span class="lineno"> 6809</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06810"></a><span class="lineno"> 6810</span>&#160;<span class="comment">C         VNEW = The vector of length N containing a scaled product</span></div><div class="line"><a name="l06811"></a><span class="lineno"> 6811</span>&#160;<span class="comment">C                OF The Jacobian and the vector V(*,LL).</span></div><div class="line"><a name="l06812"></a><span class="lineno"> 6812</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06813"></a><span class="lineno"> 6813</span>&#160;<span class="comment">C         V    = The N x LL array containing the previous LL</span></div><div class="line"><a name="l06814"></a><span class="lineno"> 6814</span>&#160;<span class="comment">C                orthogonal vectors V(*,1) to V(*,LL).</span></div><div class="line"><a name="l06815"></a><span class="lineno"> 6815</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06816"></a><span class="lineno"> 6816</span>&#160;<span class="comment">C         HES  = An LL x LL upper Hessenberg matrix containing,</span></div><div class="line"><a name="l06817"></a><span class="lineno"> 6817</span>&#160;<span class="comment">C                in HES(I,K), K.LT.LL, scaled inner products of</span></div><div class="line"><a name="l06818"></a><span class="lineno"> 6818</span>&#160;<span class="comment">C                A*V(*,K) and V(*,I).</span></div><div class="line"><a name="l06819"></a><span class="lineno"> 6819</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06820"></a><span class="lineno"> 6820</span>&#160;<span class="comment">C        LDHES = The leading dimension of the HES array.</span></div><div class="line"><a name="l06821"></a><span class="lineno"> 6821</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06822"></a><span class="lineno"> 6822</span>&#160;<span class="comment">C         N    = The order of the matrix A, and the length of VNEW.</span></div><div class="line"><a name="l06823"></a><span class="lineno"> 6823</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06824"></a><span class="lineno"> 6824</span>&#160;<span class="comment">C         LL   = The current order of the matrix HES.</span></div><div class="line"><a name="l06825"></a><span class="lineno"> 6825</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06826"></a><span class="lineno"> 6826</span>&#160;<span class="comment">C          KMP = The number of previous vectors the new vector VNEW</span></div><div class="line"><a name="l06827"></a><span class="lineno"> 6827</span>&#160;<span class="comment">C                must be made orthogonal to (KMP .LE. MAXL).</span></div><div class="line"><a name="l06828"></a><span class="lineno"> 6828</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06829"></a><span class="lineno"> 6829</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06830"></a><span class="lineno"> 6830</span>&#160;<span class="comment">C      On return</span></div><div class="line"><a name="l06831"></a><span class="lineno"> 6831</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06832"></a><span class="lineno"> 6832</span>&#160;<span class="comment">C         VNEW = The new vector orthogonal to V(*,I0),</span></div><div class="line"><a name="l06833"></a><span class="lineno"> 6833</span>&#160;<span class="comment">C                where I0 = MAX(1, LL-KMP+1).</span></div><div class="line"><a name="l06834"></a><span class="lineno"> 6834</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06835"></a><span class="lineno"> 6835</span>&#160;<span class="comment">C         HES  = Upper Hessenberg matrix with column LL filled in with</span></div><div class="line"><a name="l06836"></a><span class="lineno"> 6836</span>&#160;<span class="comment">C                scaled inner products of A*V(*,LL) and V(*,I).</span></div><div class="line"><a name="l06837"></a><span class="lineno"> 6837</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06838"></a><span class="lineno"> 6838</span>&#160;<span class="comment">C       SNORMW = L-2 norm of VNEW.</span></div><div class="line"><a name="l06839"></a><span class="lineno"> 6839</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06840"></a><span class="lineno"> 6840</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06841"></a><span class="lineno"> 6841</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l06842"></a><span class="lineno"> 6842</span>&#160;<span class="comment">C   DDOT, DNRM2, DAXPY </span></div><div class="line"><a name="l06843"></a><span class="lineno"> 6843</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06844"></a><span class="lineno"> 6844</span>&#160;<span class="comment">C***END PROLOGUE  DORTH</span></div><div class="line"><a name="l06845"></a><span class="lineno"> 6845</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06846"></a><span class="lineno"> 6846</span>&#160;      <span class="keywordtype">INTEGER</span> N, LL, LDHES, KMP</div><div class="line"><a name="l06847"></a><span class="lineno"> 6847</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> VNEW, V, HES, SNORMW</div><div class="line"><a name="l06848"></a><span class="lineno"> 6848</span>&#160;      dimension vnew(*), v(n,*), hes(ldhes,*)</div><div class="line"><a name="l06849"></a><span class="lineno"> 6849</span>&#160;      <span class="keywordtype">INTEGER</span> I, I0</div><div class="line"><a name="l06850"></a><span class="lineno"> 6850</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> ARG, DDOT, DNRM2, SUMDSQ, TEM, VNRM</div><div class="line"><a name="l06851"></a><span class="lineno"> 6851</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06852"></a><span class="lineno"> 6852</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06853"></a><span class="lineno"> 6853</span>&#160;<span class="comment">C Get norm of unaltered VNEW for later use.</span></div><div class="line"><a name="l06854"></a><span class="lineno"> 6854</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06855"></a><span class="lineno"> 6855</span>&#160;      vnrm = dnrm2(n, vnew, 1)</div><div class="line"><a name="l06856"></a><span class="lineno"> 6856</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06857"></a><span class="lineno"> 6857</span>&#160;<span class="comment">C Do Modified Gram-Schmidt on VNEW = A*V(LL).</span></div><div class="line"><a name="l06858"></a><span class="lineno"> 6858</span>&#160;<span class="comment">C Scaled inner products give new column of HES.</span></div><div class="line"><a name="l06859"></a><span class="lineno"> 6859</span>&#160;<span class="comment">C Projections of earlier vectors are subtracted from VNEW.</span></div><div class="line"><a name="l06860"></a><span class="lineno"> 6860</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06861"></a><span class="lineno"> 6861</span>&#160;      i0 = max0(1,ll-kmp+1)</div><div class="line"><a name="l06862"></a><span class="lineno"> 6862</span>&#160;      <span class="keywordflow">DO</span> 10 i = i0,ll</div><div class="line"><a name="l06863"></a><span class="lineno"> 6863</span>&#160;        hes(i,ll) = ddot(n, v(1,i), 1, vnew, 1)</div><div class="line"><a name="l06864"></a><span class="lineno"> 6864</span>&#160;        tem = -hes(i,ll)</div><div class="line"><a name="l06865"></a><span class="lineno"> 6865</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#adb136e14634fe4b772a0b034f52f3939">daxpy</a> (n, tem, v(1,i), 1, vnew, 1)</div><div class="line"><a name="l06866"></a><span class="lineno"> 6866</span>&#160; 10     <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06867"></a><span class="lineno"> 6867</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06868"></a><span class="lineno"> 6868</span>&#160;<span class="comment">C Compute SNORMW = norm of VNEW.</span></div><div class="line"><a name="l06869"></a><span class="lineno"> 6869</span>&#160;<span class="comment">C If VNEW is small compared to its input value (in norm), then</span></div><div class="line"><a name="l06870"></a><span class="lineno"> 6870</span>&#160;<span class="comment">C Reorthogonalize VNEW to V(*,1) through V(*,LL).</span></div><div class="line"><a name="l06871"></a><span class="lineno"> 6871</span>&#160;<span class="comment">C Correct if relative correction exceeds 1000*(unit roundoff).</span></div><div class="line"><a name="l06872"></a><span class="lineno"> 6872</span>&#160;<span class="comment">C Finally, correct SNORMW using the dot products involved.</span></div><div class="line"><a name="l06873"></a><span class="lineno"> 6873</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06874"></a><span class="lineno"> 6874</span>&#160;      snormw = dnrm2(n, vnew, 1)</div><div class="line"><a name="l06875"></a><span class="lineno"> 6875</span>&#160;      <span class="keywordflow">IF</span> (vnrm + 0.001d0*snormw .NE. vnrm) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06876"></a><span class="lineno"> 6876</span>&#160;      sumdsq = 0.0d0</div><div class="line"><a name="l06877"></a><span class="lineno"> 6877</span>&#160;      <span class="keywordflow">DO</span> 30 i = i0,ll</div><div class="line"><a name="l06878"></a><span class="lineno"> 6878</span>&#160;        tem = -ddot(n, v(1,i), 1, vnew, 1)</div><div class="line"><a name="l06879"></a><span class="lineno"> 6879</span>&#160;        <span class="keywordflow">IF</span> (hes(i,ll) + 0.001d0*tem .EQ. hes(i,ll)) <span class="keywordflow">GO TO</span> 30</div><div class="line"><a name="l06880"></a><span class="lineno"> 6880</span>&#160;        hes(i,ll) = hes(i,ll) - tem</div><div class="line"><a name="l06881"></a><span class="lineno"> 6881</span>&#160;        <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#adb136e14634fe4b772a0b034f52f3939">daxpy</a> (n, tem, v(1,i), 1, vnew, 1)</div><div class="line"><a name="l06882"></a><span class="lineno"> 6882</span>&#160;        sumdsq = sumdsq + tem**2</div><div class="line"><a name="l06883"></a><span class="lineno"> 6883</span>&#160; 30     <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06884"></a><span class="lineno"> 6884</span>&#160;      <span class="keywordflow">IF</span> (sumdsq .EQ. 0.0d0) <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06885"></a><span class="lineno"> 6885</span>&#160;      arg = <a class="code" href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a>(0.0d0,snormw**2 - sumdsq)</div><div class="line"><a name="l06886"></a><span class="lineno"> 6886</span>&#160;      snormw = sqrt(arg)</div><div class="line"><a name="l06887"></a><span class="lineno"> 6887</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l06888"></a><span class="lineno"> 6888</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06889"></a><span class="lineno"> 6889</span>&#160;<span class="comment">C------END OF SUBROUTINE DORTH------------------------------------------</span></div><div class="line"><a name="l06890"></a><span class="lineno"> 6890</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l06891"></a><span class="lineno"> 6891</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#ab4330c24bb8f25167a9066561bb10ada">dheqr</a> (A, LDA, N, Q, INFO, IJOB)</div><div class="line"><a name="l06892"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#ab4330c24bb8f25167a9066561bb10ada"> 6892</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06893"></a><span class="lineno"> 6893</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DHEQR</span></div><div class="line"><a name="l06894"></a><span class="lineno"> 6894</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l06895"></a><span class="lineno"> 6895</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l06896"></a><span class="lineno"> 6896</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06897"></a><span class="lineno"> 6897</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06898"></a><span class="lineno"> 6898</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l06899"></a><span class="lineno"> 6899</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06900"></a><span class="lineno"> 6900</span>&#160;<span class="comment">C     This routine performs a QR decomposition of an upper</span></div><div class="line"><a name="l06901"></a><span class="lineno"> 6901</span>&#160;<span class="comment">C     Hessenberg matrix A.  There are two options available:</span></div><div class="line"><a name="l06902"></a><span class="lineno"> 6902</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06903"></a><span class="lineno"> 6903</span>&#160;<span class="comment">C          (1)  performing a fresh decomposition</span></div><div class="line"><a name="l06904"></a><span class="lineno"> 6904</span>&#160;<span class="comment">C          (2)  updating the QR factors by adding a row and A</span></div><div class="line"><a name="l06905"></a><span class="lineno"> 6905</span>&#160;<span class="comment">C               column to the matrix A.</span></div><div class="line"><a name="l06906"></a><span class="lineno"> 6906</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06907"></a><span class="lineno"> 6907</span>&#160;<span class="comment">C     DHEQR decomposes an upper Hessenberg matrix by using Givens</span></div><div class="line"><a name="l06908"></a><span class="lineno"> 6908</span>&#160;<span class="comment">C     rotations.</span></div><div class="line"><a name="l06909"></a><span class="lineno"> 6909</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06910"></a><span class="lineno"> 6910</span>&#160;<span class="comment">C     On entry</span></div><div class="line"><a name="l06911"></a><span class="lineno"> 6911</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06912"></a><span class="lineno"> 6912</span>&#160;<span class="comment">C        A       DOUBLE PRECISION(LDA, N)</span></div><div class="line"><a name="l06913"></a><span class="lineno"> 6913</span>&#160;<span class="comment">C                The matrix to be decomposed.</span></div><div class="line"><a name="l06914"></a><span class="lineno"> 6914</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06915"></a><span class="lineno"> 6915</span>&#160;<span class="comment">C        LDA     INTEGER</span></div><div class="line"><a name="l06916"></a><span class="lineno"> 6916</span>&#160;<span class="comment">C                The leading dimension of the array A.</span></div><div class="line"><a name="l06917"></a><span class="lineno"> 6917</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06918"></a><span class="lineno"> 6918</span>&#160;<span class="comment">C        N       INTEGER</span></div><div class="line"><a name="l06919"></a><span class="lineno"> 6919</span>&#160;<span class="comment">C                A is an (N+1) by N Hessenberg matrix.</span></div><div class="line"><a name="l06920"></a><span class="lineno"> 6920</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06921"></a><span class="lineno"> 6921</span>&#160;<span class="comment">C        IJOB    INTEGER</span></div><div class="line"><a name="l06922"></a><span class="lineno"> 6922</span>&#160;<span class="comment">C                = 1     Means that a fresh decomposition of the</span></div><div class="line"><a name="l06923"></a><span class="lineno"> 6923</span>&#160;<span class="comment">C                        matrix A is desired.</span></div><div class="line"><a name="l06924"></a><span class="lineno"> 6924</span>&#160;<span class="comment">C                .GE. 2  Means that the current decomposition of A</span></div><div class="line"><a name="l06925"></a><span class="lineno"> 6925</span>&#160;<span class="comment">C                        will be updated by the addition of a row</span></div><div class="line"><a name="l06926"></a><span class="lineno"> 6926</span>&#160;<span class="comment">C                        and a column.</span></div><div class="line"><a name="l06927"></a><span class="lineno"> 6927</span>&#160;<span class="comment">C     On return</span></div><div class="line"><a name="l06928"></a><span class="lineno"> 6928</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06929"></a><span class="lineno"> 6929</span>&#160;<span class="comment">C        A       The upper triangular matrix R.</span></div><div class="line"><a name="l06930"></a><span class="lineno"> 6930</span>&#160;<span class="comment">C                The factorization can be written Q*A = R, where</span></div><div class="line"><a name="l06931"></a><span class="lineno"> 6931</span>&#160;<span class="comment">C                Q is a product of Givens rotations and R is upper</span></div><div class="line"><a name="l06932"></a><span class="lineno"> 6932</span>&#160;<span class="comment">C                triangular.</span></div><div class="line"><a name="l06933"></a><span class="lineno"> 6933</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06934"></a><span class="lineno"> 6934</span>&#160;<span class="comment">C        Q       DOUBLE PRECISION(2*N)</span></div><div class="line"><a name="l06935"></a><span class="lineno"> 6935</span>&#160;<span class="comment">C                The factors C and S of each Givens rotation used</span></div><div class="line"><a name="l06936"></a><span class="lineno"> 6936</span>&#160;<span class="comment">C                in decomposing A.</span></div><div class="line"><a name="l06937"></a><span class="lineno"> 6937</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06938"></a><span class="lineno"> 6938</span>&#160;<span class="comment">C        INFO    INTEGER</span></div><div class="line"><a name="l06939"></a><span class="lineno"> 6939</span>&#160;<span class="comment">C                = 0  normal value.</span></div><div class="line"><a name="l06940"></a><span class="lineno"> 6940</span>&#160;<span class="comment">C                = K  If  A(K,K) .EQ. 0.0.  This is not an error</span></div><div class="line"><a name="l06941"></a><span class="lineno"> 6941</span>&#160;<span class="comment">C                     condition for this subroutine, but it does</span></div><div class="line"><a name="l06942"></a><span class="lineno"> 6942</span>&#160;<span class="comment">C                     indicate that DHELS will divide by zero</span></div><div class="line"><a name="l06943"></a><span class="lineno"> 6943</span>&#160;<span class="comment">C                     if called.</span></div><div class="line"><a name="l06944"></a><span class="lineno"> 6944</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06945"></a><span class="lineno"> 6945</span>&#160;<span class="comment">C     Modification of LINPACK.</span></div><div class="line"><a name="l06946"></a><span class="lineno"> 6946</span>&#160;<span class="comment">C     Peter Brown, Lawrence Livermore Natl. Lab.</span></div><div class="line"><a name="l06947"></a><span class="lineno"> 6947</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06948"></a><span class="lineno"> 6948</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06949"></a><span class="lineno"> 6949</span>&#160;<span class="comment">C***ROUTINES CALLED (NONE)</span></div><div class="line"><a name="l06950"></a><span class="lineno"> 6950</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06951"></a><span class="lineno"> 6951</span>&#160;<span class="comment">C***END PROLOGUE  DHEQR</span></div><div class="line"><a name="l06952"></a><span class="lineno"> 6952</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06953"></a><span class="lineno"> 6953</span>&#160;      <span class="keywordtype">INTEGER</span> LDA, N, INFO, IJOB</div><div class="line"><a name="l06954"></a><span class="lineno"> 6954</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> A(lda,*), Q(*)</div><div class="line"><a name="l06955"></a><span class="lineno"> 6955</span>&#160;      <span class="keywordtype">INTEGER</span> I, IQ, J, K, KM1, KP1, NM1</div><div class="line"><a name="l06956"></a><span class="lineno"> 6956</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> C, S, T, T1, T2</div><div class="line"><a name="l06957"></a><span class="lineno"> 6957</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06958"></a><span class="lineno"> 6958</span>&#160;      <span class="keywordflow">IF</span> (ijob .GT. 1) <span class="keywordflow">GO TO</span> 70</div><div class="line"><a name="l06959"></a><span class="lineno"> 6959</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06960"></a><span class="lineno"> 6960</span>&#160;<span class="comment">C A new factorization is desired.</span></div><div class="line"><a name="l06961"></a><span class="lineno"> 6961</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l06962"></a><span class="lineno"> 6962</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06963"></a><span class="lineno"> 6963</span>&#160;<span class="comment">C     QR decomposition without pivoting.</span></div><div class="line"><a name="l06964"></a><span class="lineno"> 6964</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06965"></a><span class="lineno"> 6965</span>&#160;      info = 0</div><div class="line"><a name="l06966"></a><span class="lineno"> 6966</span>&#160;      <span class="keywordflow">DO</span> 60 k = 1, n</div><div class="line"><a name="l06967"></a><span class="lineno"> 6967</span>&#160;         km1 = k - 1</div><div class="line"><a name="l06968"></a><span class="lineno"> 6968</span>&#160;         kp1 = k + 1</div><div class="line"><a name="l06969"></a><span class="lineno"> 6969</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06970"></a><span class="lineno"> 6970</span>&#160;<span class="comment">C           Compute Kth column of R.</span></div><div class="line"><a name="l06971"></a><span class="lineno"> 6971</span>&#160;<span class="comment">C           First, multiply the Kth column of A by the previous</span></div><div class="line"><a name="l06972"></a><span class="lineno"> 6972</span>&#160;<span class="comment">C           K-1 Givens rotations.</span></div><div class="line"><a name="l06973"></a><span class="lineno"> 6973</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06974"></a><span class="lineno"> 6974</span>&#160;            <span class="keywordflow">IF</span> (km1 .LT. 1) <span class="keywordflow">GO TO</span> 20</div><div class="line"><a name="l06975"></a><span class="lineno"> 6975</span>&#160;            <span class="keywordflow">DO</span> 10 j = 1, km1</div><div class="line"><a name="l06976"></a><span class="lineno"> 6976</span>&#160;              i = 2*(j-1) + 1</div><div class="line"><a name="l06977"></a><span class="lineno"> 6977</span>&#160;              t1 = a(j,k)</div><div class="line"><a name="l06978"></a><span class="lineno"> 6978</span>&#160;              t2 = a(j+1,k)</div><div class="line"><a name="l06979"></a><span class="lineno"> 6979</span>&#160;              c = q(i)</div><div class="line"><a name="l06980"></a><span class="lineno"> 6980</span>&#160;              s = q(i+1)</div><div class="line"><a name="l06981"></a><span class="lineno"> 6981</span>&#160;              a(j,k) = c*t1 - s*t2</div><div class="line"><a name="l06982"></a><span class="lineno"> 6982</span>&#160;              a(j+1,k) = s*t1 + c*t2</div><div class="line"><a name="l06983"></a><span class="lineno"> 6983</span>&#160;   10         <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06984"></a><span class="lineno"> 6984</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06985"></a><span class="lineno"> 6985</span>&#160;<span class="comment">C           Compute Givens components C and S.</span></div><div class="line"><a name="l06986"></a><span class="lineno"> 6986</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l06987"></a><span class="lineno"> 6987</span>&#160;   20       <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06988"></a><span class="lineno"> 6988</span>&#160;            iq = 2*km1 + 1</div><div class="line"><a name="l06989"></a><span class="lineno"> 6989</span>&#160;            t1 = a(k,k)</div><div class="line"><a name="l06990"></a><span class="lineno"> 6990</span>&#160;            t2 = a(kp1,k)</div><div class="line"><a name="l06991"></a><span class="lineno"> 6991</span>&#160;            <span class="keywordflow">IF</span> (t2 .NE. 0.0d0) <span class="keywordflow">GO TO</span> 30</div><div class="line"><a name="l06992"></a><span class="lineno"> 6992</span>&#160;              c = 1.0d0</div><div class="line"><a name="l06993"></a><span class="lineno"> 6993</span>&#160;              s = 0.0d0</div><div class="line"><a name="l06994"></a><span class="lineno"> 6994</span>&#160;              <span class="keywordflow">GO TO</span> 50</div><div class="line"><a name="l06995"></a><span class="lineno"> 6995</span>&#160;   30       <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l06996"></a><span class="lineno"> 6996</span>&#160;            <span class="keywordflow">IF</span> (abs(t2) .LT. abs(t1)) <span class="keywordflow">GO TO</span> 40</div><div class="line"><a name="l06997"></a><span class="lineno"> 6997</span>&#160;              t = t1/t2</div><div class="line"><a name="l06998"></a><span class="lineno"> 6998</span>&#160;              s = -1.0d0/sqrt(1.0d0+t*t)</div><div class="line"><a name="l06999"></a><span class="lineno"> 6999</span>&#160;              c = -s*t</div><div class="line"><a name="l07000"></a><span class="lineno"> 7000</span>&#160;              <span class="keywordflow">GO TO</span> 50</div><div class="line"><a name="l07001"></a><span class="lineno"> 7001</span>&#160;   40       <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l07002"></a><span class="lineno"> 7002</span>&#160;              t = t2/t1</div><div class="line"><a name="l07003"></a><span class="lineno"> 7003</span>&#160;              c = 1.0d0/sqrt(1.0d0+t*t)</div><div class="line"><a name="l07004"></a><span class="lineno"> 7004</span>&#160;              s = -c*t</div><div class="line"><a name="l07005"></a><span class="lineno"> 7005</span>&#160;   50       <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l07006"></a><span class="lineno"> 7006</span>&#160;            q(iq) = c</div><div class="line"><a name="l07007"></a><span class="lineno"> 7007</span>&#160;            q(iq+1) = s</div><div class="line"><a name="l07008"></a><span class="lineno"> 7008</span>&#160;            a(k,k) = c*t1 - s*t2</div><div class="line"><a name="l07009"></a><span class="lineno"> 7009</span>&#160;            <span class="keywordflow">IF</span> (a(k,k) .EQ. 0.0d0) info = k</div><div class="line"><a name="l07010"></a><span class="lineno"> 7010</span>&#160;   60 <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l07011"></a><span class="lineno"> 7011</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l07012"></a><span class="lineno"> 7012</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l07013"></a><span class="lineno"> 7013</span>&#160;<span class="comment">C The old factorization of A will be updated.  A row and a column</span></div><div class="line"><a name="l07014"></a><span class="lineno"> 7014</span>&#160;<span class="comment">C has been added to the matrix A.</span></div><div class="line"><a name="l07015"></a><span class="lineno"> 7015</span>&#160;<span class="comment">C N by N-1 is now the old size of the matrix.</span></div><div class="line"><a name="l07016"></a><span class="lineno"> 7016</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l07017"></a><span class="lineno"> 7017</span>&#160;  70  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l07018"></a><span class="lineno"> 7018</span>&#160;      nm1 = n - 1</div><div class="line"><a name="l07019"></a><span class="lineno"> 7019</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l07020"></a><span class="lineno"> 7020</span>&#160;<span class="comment">C Multiply the new column by the N previous Givens rotations.</span></div><div class="line"><a name="l07021"></a><span class="lineno"> 7021</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l07022"></a><span class="lineno"> 7022</span>&#160;      <span class="keywordflow">DO</span> 100 k = 1,nm1</div><div class="line"><a name="l07023"></a><span class="lineno"> 7023</span>&#160;        i = 2*(k-1) + 1</div><div class="line"><a name="l07024"></a><span class="lineno"> 7024</span>&#160;        t1 = a(k,n)</div><div class="line"><a name="l07025"></a><span class="lineno"> 7025</span>&#160;        t2 = a(k+1,n)</div><div class="line"><a name="l07026"></a><span class="lineno"> 7026</span>&#160;        c = q(i)</div><div class="line"><a name="l07027"></a><span class="lineno"> 7027</span>&#160;        s = q(i+1)</div><div class="line"><a name="l07028"></a><span class="lineno"> 7028</span>&#160;        a(k,n) = c*t1 - s*t2</div><div class="line"><a name="l07029"></a><span class="lineno"> 7029</span>&#160;        a(k+1,n) = s*t1 + c*t2</div><div class="line"><a name="l07030"></a><span class="lineno"> 7030</span>&#160; 100    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l07031"></a><span class="lineno"> 7031</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l07032"></a><span class="lineno"> 7032</span>&#160;<span class="comment">C Complete update of decomposition by forming last Givens rotation,</span></div><div class="line"><a name="l07033"></a><span class="lineno"> 7033</span>&#160;<span class="comment">C and multiplying it times the column vector (A(N,N),A(NP1,N)).</span></div><div class="line"><a name="l07034"></a><span class="lineno"> 7034</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l07035"></a><span class="lineno"> 7035</span>&#160;      info = 0</div><div class="line"><a name="l07036"></a><span class="lineno"> 7036</span>&#160;      t1 = a(n,n)</div><div class="line"><a name="l07037"></a><span class="lineno"> 7037</span>&#160;      t2 = a(n+1,n)</div><div class="line"><a name="l07038"></a><span class="lineno"> 7038</span>&#160;      <span class="keywordflow">IF</span> (t2 .NE. 0.0d0) <span class="keywordflow">GO TO</span> 110</div><div class="line"><a name="l07039"></a><span class="lineno"> 7039</span>&#160;        c = 1.0d0</div><div class="line"><a name="l07040"></a><span class="lineno"> 7040</span>&#160;        s = 0.0d0</div><div class="line"><a name="l07041"></a><span class="lineno"> 7041</span>&#160;        <span class="keywordflow">GO TO</span> 130</div><div class="line"><a name="l07042"></a><span class="lineno"> 7042</span>&#160; 110  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l07043"></a><span class="lineno"> 7043</span>&#160;      <span class="keywordflow">IF</span> (abs(t2) .LT. abs(t1)) <span class="keywordflow">GO TO</span> 120</div><div class="line"><a name="l07044"></a><span class="lineno"> 7044</span>&#160;        t = t1/t2</div><div class="line"><a name="l07045"></a><span class="lineno"> 7045</span>&#160;        s = -1.0d0/sqrt(1.0d0+t*t)</div><div class="line"><a name="l07046"></a><span class="lineno"> 7046</span>&#160;        c = -s*t</div><div class="line"><a name="l07047"></a><span class="lineno"> 7047</span>&#160;        <span class="keywordflow">GO TO</span> 130</div><div class="line"><a name="l07048"></a><span class="lineno"> 7048</span>&#160; 120  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l07049"></a><span class="lineno"> 7049</span>&#160;        t = t2/t1</div><div class="line"><a name="l07050"></a><span class="lineno"> 7050</span>&#160;        c = 1.0d0/sqrt(1.0d0+t*t)</div><div class="line"><a name="l07051"></a><span class="lineno"> 7051</span>&#160;        s = -c*t</div><div class="line"><a name="l07052"></a><span class="lineno"> 7052</span>&#160; 130  <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l07053"></a><span class="lineno"> 7053</span>&#160;      iq = 2*n - 1</div><div class="line"><a name="l07054"></a><span class="lineno"> 7054</span>&#160;      q(iq) = c</div><div class="line"><a name="l07055"></a><span class="lineno"> 7055</span>&#160;      q(iq+1) = s</div><div class="line"><a name="l07056"></a><span class="lineno"> 7056</span>&#160;      a(n,n) = c*t1 - s*t2</div><div class="line"><a name="l07057"></a><span class="lineno"> 7057</span>&#160;      <span class="keywordflow">IF</span> (a(n,n) .EQ. 0.0d0) info = n</div><div class="line"><a name="l07058"></a><span class="lineno"> 7058</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l07059"></a><span class="lineno"> 7059</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07060"></a><span class="lineno"> 7060</span>&#160;<span class="comment">C------END OF SUBROUTINE DHEQR------------------------------------------</span></div><div class="line"><a name="l07061"></a><span class="lineno"> 7061</span>&#160;<span class="keyword">      END</span></div><div class="line"><a name="l07062"></a><span class="lineno"> 7062</span>&#160;<span class="keyword">      SUBROUTINE </span><a class="code" href="../../d2/dd0/ddaskr_8f.html#a96d6ea4d2053a20e9d76a8a0fc1f5af4">dhels</a> (A, LDA, N, Q, B)</div><div class="line"><a name="l07063"></a><span class="lineno"><a class="line" href="../../d2/dd0/ddaskr_8f.html#a96d6ea4d2053a20e9d76a8a0fc1f5af4"> 7063</a></span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07064"></a><span class="lineno"> 7064</span>&#160;<span class="comment">C***BEGIN PROLOGUE  DHELS</span></div><div class="line"><a name="l07065"></a><span class="lineno"> 7065</span>&#160;<span class="comment">C***DATE WRITTEN   890101   (YYMMDD)</span></div><div class="line"><a name="l07066"></a><span class="lineno"> 7066</span>&#160;<span class="comment">C***REVISION DATE  900926   (YYMMDD)</span></div><div class="line"><a name="l07067"></a><span class="lineno"> 7067</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07068"></a><span class="lineno"> 7068</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07069"></a><span class="lineno"> 7069</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l07070"></a><span class="lineno"> 7070</span>&#160;<span class="comment">C***DESCRIPTION</span></div><div class="line"><a name="l07071"></a><span class="lineno"> 7071</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07072"></a><span class="lineno"> 7072</span>&#160;<span class="comment">C This is similar to the LINPACK routine DGESL except that</span></div><div class="line"><a name="l07073"></a><span class="lineno"> 7073</span>&#160;<span class="comment">C A is an upper Hessenberg matrix.</span></div><div class="line"><a name="l07074"></a><span class="lineno"> 7074</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07075"></a><span class="lineno"> 7075</span>&#160;<span class="comment">C     DHELS solves the least squares problem</span></div><div class="line"><a name="l07076"></a><span class="lineno"> 7076</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07077"></a><span class="lineno"> 7077</span>&#160;<span class="comment">C           MIN (B-A*X,B-A*X)</span></div><div class="line"><a name="l07078"></a><span class="lineno"> 7078</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07079"></a><span class="lineno"> 7079</span>&#160;<span class="comment">C     using the factors computed by DHEQR.</span></div><div class="line"><a name="l07080"></a><span class="lineno"> 7080</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07081"></a><span class="lineno"> 7081</span>&#160;<span class="comment">C     On entry</span></div><div class="line"><a name="l07082"></a><span class="lineno"> 7082</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07083"></a><span class="lineno"> 7083</span>&#160;<span class="comment">C        A       DOUBLE PRECISION (LDA, N)</span></div><div class="line"><a name="l07084"></a><span class="lineno"> 7084</span>&#160;<span class="comment">C                The output from DHEQR which contains the upper</span></div><div class="line"><a name="l07085"></a><span class="lineno"> 7085</span>&#160;<span class="comment">C                triangular factor R in the QR decomposition of A.</span></div><div class="line"><a name="l07086"></a><span class="lineno"> 7086</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07087"></a><span class="lineno"> 7087</span>&#160;<span class="comment">C        LDA     INTEGER</span></div><div class="line"><a name="l07088"></a><span class="lineno"> 7088</span>&#160;<span class="comment">C                The leading dimension of the array  A .</span></div><div class="line"><a name="l07089"></a><span class="lineno"> 7089</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07090"></a><span class="lineno"> 7090</span>&#160;<span class="comment">C        N       INTEGER</span></div><div class="line"><a name="l07091"></a><span class="lineno"> 7091</span>&#160;<span class="comment">C                A is originally an (N+1) by N matrix.</span></div><div class="line"><a name="l07092"></a><span class="lineno"> 7092</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07093"></a><span class="lineno"> 7093</span>&#160;<span class="comment">C        Q       DOUBLE PRECISION(2*N)</span></div><div class="line"><a name="l07094"></a><span class="lineno"> 7094</span>&#160;<span class="comment">C                The coefficients of the N givens rotations</span></div><div class="line"><a name="l07095"></a><span class="lineno"> 7095</span>&#160;<span class="comment">C                used in the QR factorization of A.</span></div><div class="line"><a name="l07096"></a><span class="lineno"> 7096</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07097"></a><span class="lineno"> 7097</span>&#160;<span class="comment">C        B       DOUBLE PRECISION(N+1)</span></div><div class="line"><a name="l07098"></a><span class="lineno"> 7098</span>&#160;<span class="comment">C                The right hand side vector.</span></div><div class="line"><a name="l07099"></a><span class="lineno"> 7099</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07100"></a><span class="lineno"> 7100</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07101"></a><span class="lineno"> 7101</span>&#160;<span class="comment">C     On return</span></div><div class="line"><a name="l07102"></a><span class="lineno"> 7102</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07103"></a><span class="lineno"> 7103</span>&#160;<span class="comment">C        B       The solution vector X.</span></div><div class="line"><a name="l07104"></a><span class="lineno"> 7104</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07105"></a><span class="lineno"> 7105</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07106"></a><span class="lineno"> 7106</span>&#160;<span class="comment">C     Modification of LINPACK.</span></div><div class="line"><a name="l07107"></a><span class="lineno"> 7107</span>&#160;<span class="comment">C     Peter Brown, Lawrence Livermore Natl. Lab.</span></div><div class="line"><a name="l07108"></a><span class="lineno"> 7108</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07109"></a><span class="lineno"> 7109</span>&#160;<span class="comment">C-----------------------------------------------------------------------</span></div><div class="line"><a name="l07110"></a><span class="lineno"> 7110</span>&#160;<span class="comment">C***ROUTINES CALLED</span></div><div class="line"><a name="l07111"></a><span class="lineno"> 7111</span>&#160;<span class="comment">C   DAXPY </span></div><div class="line"><a name="l07112"></a><span class="lineno"> 7112</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07113"></a><span class="lineno"> 7113</span>&#160;<span class="comment">C***END PROLOGUE  DHELS</span></div><div class="line"><a name="l07114"></a><span class="lineno"> 7114</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07115"></a><span class="lineno"> 7115</span>&#160;      <span class="keywordtype">INTEGER</span> LDA, N</div><div class="line"><a name="l07116"></a><span class="lineno"> 7116</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> A(lda,*), B(*), Q(*)</div><div class="line"><a name="l07117"></a><span class="lineno"> 7117</span>&#160;      <span class="keywordtype">INTEGER</span> IQ, K, KB, KP1</div><div class="line"><a name="l07118"></a><span class="lineno"> 7118</span>&#160;      <span class="keywordtype">DOUBLE PRECISION</span> C, S, T, T1, T2</div><div class="line"><a name="l07119"></a><span class="lineno"> 7119</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07120"></a><span class="lineno"> 7120</span>&#160;<span class="comment">C        Minimize (B-A*X,B-A*X).</span></div><div class="line"><a name="l07121"></a><span class="lineno"> 7121</span>&#160;<span class="comment">C        First form Q*B.</span></div><div class="line"><a name="l07122"></a><span class="lineno"> 7122</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07123"></a><span class="lineno"> 7123</span>&#160;         <span class="keywordflow">DO</span> 20 k = 1, n</div><div class="line"><a name="l07124"></a><span class="lineno"> 7124</span>&#160;            kp1 = k + 1</div><div class="line"><a name="l07125"></a><span class="lineno"> 7125</span>&#160;            iq = 2*(k-1) + 1</div><div class="line"><a name="l07126"></a><span class="lineno"> 7126</span>&#160;            c = q(iq)</div><div class="line"><a name="l07127"></a><span class="lineno"> 7127</span>&#160;            s = q(iq+1)</div><div class="line"><a name="l07128"></a><span class="lineno"> 7128</span>&#160;            t1 = b(k)</div><div class="line"><a name="l07129"></a><span class="lineno"> 7129</span>&#160;            t2 = b(kp1)</div><div class="line"><a name="l07130"></a><span class="lineno"> 7130</span>&#160;            b(k) = c*t1 - s*t2</div><div class="line"><a name="l07131"></a><span class="lineno"> 7131</span>&#160;            b(kp1) = s*t1 + c*t2</div><div class="line"><a name="l07132"></a><span class="lineno"> 7132</span>&#160;   20    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l07133"></a><span class="lineno"> 7133</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07134"></a><span class="lineno"> 7134</span>&#160;<span class="comment">C        Now solve R*X = Q*B.</span></div><div class="line"><a name="l07135"></a><span class="lineno"> 7135</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07136"></a><span class="lineno"> 7136</span>&#160;         <span class="keywordflow">DO</span> 40 kb = 1, n</div><div class="line"><a name="l07137"></a><span class="lineno"> 7137</span>&#160;            k = n + 1 - kb</div><div class="line"><a name="l07138"></a><span class="lineno"> 7138</span>&#160;            b(k) = b(k)/a(k,k)</div><div class="line"><a name="l07139"></a><span class="lineno"> 7139</span>&#160;            t = -b(k)</div><div class="line"><a name="l07140"></a><span class="lineno"> 7140</span>&#160;            <span class="keyword">CALL </span><a class="code" href="../../d6/dcf/dlinpk_8f.html#adb136e14634fe4b772a0b034f52f3939">daxpy</a> (k-1, t, a(1,k), 1, b(1), 1)</div><div class="line"><a name="l07141"></a><span class="lineno"> 7141</span>&#160;   40    <span class="keywordflow">CONTINUE</span></div><div class="line"><a name="l07142"></a><span class="lineno"> 7142</span>&#160;      <span class="keywordflow">RETURN</span></div><div class="line"><a name="l07143"></a><span class="lineno"> 7143</span>&#160;<span class="comment">C</span></div><div class="line"><a name="l07144"></a><span class="lineno"> 7144</span>&#160;<span class="comment">C------END OF SUBROUTINE DHELS------------------------------------------</span></div><div class="line"><a name="l07145"></a><span class="lineno"> 7145</span>&#160;<span class="keyword">      END</span></div><div class="ttc" id="ddaskr_8f_html_a53eb4de7fba5741a189673be61dbde02"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a53eb4de7fba5741a189673be61dbde02">ddasic</a></div><div class="ttdeci">subroutine ddasic(X, Y, YPRIME, NEQ, ICOPT, ID, RES, JAC, PSOL, H, TSCALE, WT, NIC, IDID, RPAR, IPAR, PHI, SAVR, DELTA, E, YIC, YPIC, PWK, WM, IWM, UROUND, EPLI, SQRTN, RSQRTN, EPCONI, STPTOL, JFLG, ICNFLG, ICNSTR, NLSIC)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l02915">ddaskr.f:2915</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a01211e37451eb96acbc775a4f8050656"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a01211e37451eb96acbc775a4f8050656">dnsid</a></div><div class="ttdeci">subroutine dnsid(X, Y, YPRIME, NEQ, ICOPT, ID, RES, WT, RPAR, IPAR, DELTA, R, YIC, YPIC, WM, IWM, CJ, TSCALE, EPCON, RATEMX, MAXIT, STPTOL, ICNFLG, ICNSTR, IERNEW)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l04103">ddaskr.f:4103</a></div></div>
<div class="ttc" id="dlinpk_8f_html_a5beaa6edffd752720aa1f5282016a5aa"><div class="ttname"><a href="../../d6/dcf/dlinpk_8f.html#a5beaa6edffd752720aa1f5282016a5aa">dgbsl</a></div><div class="ttdeci">subroutine dgbsl(abd, lda, n, ml, mu, ipvt, b, job)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dcf/dlinpk_8f_source.html#l00396">dlinpk.f:396</a></div></div>
<div class="ttc" id="dlinpk_8f_html_ab8d049e06a29c4a273874f5780fe95bc"><div class="ttname"><a href="../../d6/dcf/dlinpk_8f.html#ab8d049e06a29c4a273874f5780fe95bc">dgbfa</a></div><div class="ttdeci">subroutine dgbfa(abd, lda, n, ml, mu, ipvt, info)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dcf/dlinpk_8f_source.html#l00222">dlinpk.f:222</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a5886c909d03a151adbd71cd4ad2b6acc"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a5886c909d03a151adbd71cd4ad2b6acc">dmatd</a></div><div class="ttdeci">subroutine dmatd(NEQ, X, Y, YPRIME, DELTA, CJ, H, IER, EWT, E, WM, IWM, RES, IRES, UROUND, JACD, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l04923">ddaskr.f:4923</a></div></div>
<div class="ttc" id="netstream-main_8cpp_html_aed138f72d7301a9034a719a95c4903da"><div class="ttname"><a href="../../d3/d1b/netstream-main_8cpp.html#aed138f72d7301a9034a719a95c4903da">e</a></div><div class="ttdeci">void e()</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d1b/netstream-main_8cpp_source.html#l00039">netstream-main.cpp:39</a></div></div>
<div class="ttc" id="daux_8f_html_abae2eceb4fee72a1f198f1c08c56d9b7"><div class="ttname"><a href="../../d1/d98/daux_8f.html#abae2eceb4fee72a1f198f1c08c56d9b7">d1mach</a></div><div class="ttdeci">double precision function d1mach(IDUMMY)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d98/daux_8f_source.html#l00003">daux.f:3</a></div></div>
<div class="ttc" id="bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h_html_a77043c76af71613bf831e39fe9295af4"><div class="ttname"><a href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h.html#a77043c76af71613bf831e39fe9295af4">x</a></div><div class="ttdeci">REAL * x</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d70/bfp_2bfp___l_u_s_o_l_2_l_u_s_o_l_2myblas_8h_source.html#l00059">myblas.h:59</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a187e8c4e1cbbc063d8ba76ccef7bb89a"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a187e8c4e1cbbc063d8ba76ccef7bb89a">dyypnw</a></div><div class="ttdeci">subroutine dyypnw(NEQ, Y, YPRIME, CJ, RL, P, ICOPT, ID, YNEW, YPNEW)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l03080">ddaskr.f:3080</a></div></div>
<div class="ttc" id="_ip_blas_8cpp_html_ae22de2514b92a4fcff7ffcba44aa629e"><div class="ttname"><a href="../../d2/d14/_ip_blas_8cpp.html#ae22de2514b92a4fcff7ffcba44aa629e">alpha</a></div><div class="ttdeci">void const double * alpha</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d14/_ip_blas_8cpp_source.html#l00030">IpBlas.cpp:30</a></div></div>
<div class="ttc" id="ddaskr_8f_html_adc50f97b82ff1c8ce2a6a9e1ec1d1987"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#adc50f97b82ff1c8ce2a6a9e1ec1d1987">dfnrmk</a></div><div class="ttdeci">subroutine dfnrmk(NEQ, Y, T, YPRIME, SAVR, R, CJ, TSCALE, WT, SQRTN, RSQRTN, RES, IRES, PSOL, IRIN, IER, FNORM, EPLIN, WP, IWP, PWK, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l05703">ddaskr.f:5703</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a98c2f20040ea3d5b63ce4e3e7d0e8aba"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a98c2f20040ea3d5b63ce4e3e7d0e8aba">dnedd</a></div><div class="ttdeci">subroutine dnedd(X, Y, YPRIME, NEQ, RES, JACD, PDUM, H, WT, JSTART, IDID, RPAR, IPAR, PHI, GAMMA, DUMSVR, DELTA, E, WM, IWM, CJ, CJOLD, CJLAST, S, UROUND, DUME, DUMS, DUMR, EPCON, JCALC, JFDUM, KP1, NONNEG, NTYPE, IERNLS)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l04494">ddaskr.f:4494</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a4b3830d1e4be0d1908b1fef21358fea0"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a4b3830d1e4be0d1908b1fef21358fea0">dinvwt</a></div><div class="ttdeci">subroutine dinvwt(NEQ, WT, IER)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l03816">ddaskr.f:3816</a></div></div>
<div class="ttc" id="ddaskr_8f_html_adfcd029d0eaeb0052be0007163ce1989"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#adfcd029d0eaeb0052be0007163ce1989">ddasik</a></div><div class="ttdeci">subroutine ddasik(X, Y, YPRIME, NEQ, ICOPT, ID, RES, JACK, PSOL, H, TSCALE, WT, JSKIP, RPAR, IPAR, SAVR, DELTA, R, YIC, YPIC, PWK, WM, IWM, CJ, UROUND, EPLI, SQRTN, RSQRTN, EPCON, RATEMX, STPTOL, JFLG, ICNFLG, ICNSTR, IERNLS)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l05154">ddaskr.f:5154</a></div></div>
<div class="ttc" id="ddaskr_8f_html_ad9040cc861842aba0f0355141036751a"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#ad9040cc861842aba0f0355141036751a">ddawts</a></div><div class="ttdeci">subroutine ddawts(NEQ, IWT, RTOL, ATOL, Y, WT, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l03785">ddaskr.f:3785</a></div></div>
<div class="ttc" id="structle_html"><div class="ttname"><a href="../../de/d45/structle.html">le</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d9/da8/test__stack_8c_source.html#l00082">test_stack.c:82</a></div></div>
<div class="ttc" id="ddaskr_8f_html_af28f4b41dfa398d7f73b1b5a6e68519c"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#af28f4b41dfa398d7f73b1b5a6e68519c">dlinsk</a></div><div class="ttdeci">subroutine dlinsk(NEQ, Y, T, YPRIME, SAVR, CJ, TSCALE, P, PNRM, WT, SQRTN, RSQRTN, LSOFF, STPTOL, IRET, RES, IRES, PSOL, WM, IWM, RHOK, FNRM, ICOPT, ID, WP, IWP, R, EPLIN, YNEW, YPNEW, PWK, ICNFLG, ICNSTR, RLX, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l05518">ddaskr.f:5518</a></div></div>
<div class="ttc" id="ddaskr_8f_html_aefa344c4f35de4a557c969a6700d4846"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#aefa344c4f35de4a557c969a6700d4846">dnsd</a></div><div class="ttdeci">subroutine dnsd(X, Y, YPRIME, NEQ, RES, PDUM, WT, RPAR, IPAR, DUMSVR, DELTA, E, WM, IWM, CJ, DUMS, DUMR, DUME, EPCON, S, CONFAC, TOLNEW, MULDEL, MAXIT, IRES, IDUM, IERNEW)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l04759">ddaskr.f:4759</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a25f46ebdca7779b4d378ecfe457426a0"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a25f46ebdca7779b4d378ecfe457426a0">ddaskr</a></div><div class="ttdeci">subroutine ddaskr(RES, NEQ, T, Y, YPRIME, TOUT, INFO, RTOL, ATOL, IDID, RWORK, LRW, IWORK, LIW, RPAR, IPAR, JAC, PSOL, RT, NRT, JROOT)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l00004">ddaskr.f:4</a></div></div>
<div class="ttc" id="include_2coin_2_ip_std_c_interface_8h_html_ae5f6806ad241f69d103ef6c3ba4e2afc"><div class="ttname"><a href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h.html#ae5f6806ad241f69d103ef6c3ba4e2afc">m</a></div><div class="ttdeci">Number Number Index m</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d58/include_2coin_2_ip_std_c_interface_8h_source.html#l00137">IpStdCInterface.h:137</a></div></div>
<div class="ttc" id="3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h_html_a06b53c1efb3823879093de05b4e0b46b"><div class="ttname"><a href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a06b53c1efb3823879093de05b4e0b46b">j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h_source.html#l01070">lp_lib.h:1070</a></div></div>
<div class="ttc" id="3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h_html_a60b2821a17c65ef291c44a789b51ded9"><div class="ttname"><a href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a60b2821a17c65ef291c44a789b51ded9">info</a></div><div class="ttdeci">char char * info</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h_source.html#l00968">lp_lib.h:968</a></div></div>
<div class="ttc" id="group__jm__vector_html_ga8603782009ff58be0587ea58013b3e52"><div class="ttname"><a href="../../da/d6c/group__jm__vector.html#ga8603782009ff58be0587ea58013b3e52">v</a></div><div class="ttdeci">return v</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d12/3rd_party_2_f_m_i_l_2install_2include_2_j_m_2jm__vector__template_8h_source.html#l00063">jm_vector_template.h:63</a></div></div>
<div class="ttc" id="3rd_party_2_c_minpack_2cminpack_8h_html_af0f4a5d2ead0ea85020f82295079d579"><div class="ttname"><a href="../../d2/de0/3rd_party_2_c_minpack_2cminpack_8h.html#af0f4a5d2ead0ea85020f82295079d579">enorm</a></div><div class="ttdeci">__cminpack_attr__ __cminpack_real__ CMINPACK_EXPORT __cminpack_func__() enorm(int n, const __cminpack_real__ *x)</div></div>
<div class="ttc" id="dlinpk_8f_html_a8945bed1d0150e1818e5b164815f79ec"><div class="ttname"><a href="../../d6/dcf/dlinpk_8f.html#a8945bed1d0150e1818e5b164815f79ec">dcopy</a></div><div class="ttdeci">subroutine dcopy(n, sx, incx, sy, incy)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dcf/dlinpk_8f_source.html#l00578">dlinpk.f:578</a></div></div>
<div class="ttc" id="3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h_html_a1499949ec4dbbc5290ece2ac210bba35"><div class="ttname"><a href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#a1499949ec4dbbc5290ece2ac210bba35">index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h_source.html#l00915">lp_lib.h:915</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a15273861b3a047737c5033b7e78607ba"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a15273861b3a047737c5033b7e78607ba">dnsik</a></div><div class="ttdeci">subroutine dnsik(X, Y, YPRIME, NEQ, ICOPT, ID, RES, PSOL, WT, RPAR, IPAR, SAVR, DELTA, R, YIC, YPIC, PWK, WM, IWM, CJ, TSCALE, SQRTN, RSQRTN, EPLIN, EPCON, RATEMX, MAXIT, STPTOL, ICNFLG, ICNSTR, IERNEW)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l05327">ddaskr.f:5327</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a513832cd8f21174b668fe46521948305"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a513832cd8f21174b668fe46521948305">droots</a></div><div class="ttdeci">subroutine droots(NRT, HMIN, JFLAG, X0, X1, R0, R1, RX, X, JROOT)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l02677">ddaskr.f:2677</a></div></div>
<div class="ttc" id="_ip_blas_8cpp_html_a9edd5afd4f7114434c4d8f01c7874633"><div class="ttname"><a href="../../d2/d14/_ip_blas_8cpp.html#a9edd5afd4f7114434c4d8f01c7874633">y</a></div><div class="ttdeci">double const double ipfint const double * y</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d14/_ip_blas_8cpp_source.html#l00018">IpBlas.cpp:18</a></div></div>
<div class="ttc" id="ddaskr_8f_html_aae25a5609da387e4f1d6b45800ad6a36"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#aae25a5609da387e4f1d6b45800ad6a36">dcnstr</a></div><div class="ttdeci">subroutine dcnstr(NEQ, Y, YNEW, ICNSTR, TAU, RLX, IRET, IVAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l03594">ddaskr.f:3594</a></div></div>
<div class="ttc" id="ddaskr_8f_html_ad184a6189ad51773ff6944b1ac015d06"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#ad184a6189ad51773ff6944b1ac015d06">dlinsd</a></div><div class="ttdeci">subroutine dlinsd(NEQ, Y, T, YPRIME, CJ, TSCALE, P, PNRM, WT, LSOFF, STPTOL, IRET, RES, IRES, WM, IWM, FNRM, ICOPT, ID, R, YNEW, YPNEW, ICNFLG, ICNSTR, RLX, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l04260">ddaskr.f:4260</a></div></div>
<div class="ttc" id="3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h_html_abaeee19978fba9bef44df7d3a4cc6448"><div class="ttname"><a href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h.html#abaeee19978fba9bef44df7d3a4cc6448">rh</a></div><div class="ttdeci">REAL int REAL rh</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/de4/3rd_party_2lpsolve_2build_2include_2lpsolve_2lp__lib_8h_source.html#l00820">lp_lib.h:820</a></div></div>
<div class="ttc" id="ddaskr_8f_html_aecac7c4590bc02e577bdce5e6a4b5e01"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#aecac7c4590bc02e577bdce5e6a4b5e01">dcnst0</a></div><div class="ttdeci">subroutine dcnst0(NEQ, Y, ICNSTR, IRET)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l03714">ddaskr.f:3714</a></div></div>
<div class="ttc" id="dlinpk_8f_html_ac2065ce90ead2dc7b03cd7e641f93ef0"><div class="ttname"><a href="../../d6/dcf/dlinpk_8f.html#ac2065ce90ead2dc7b03cd7e641f93ef0">dgefa</a></div><div class="ttdeci">subroutine dgefa(a, lda, n, ipvt, info)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dcf/dlinpk_8f_source.html#l00002">dlinpk.f:2</a></div></div>
<div class="ttc" id="dweb_8c_html_a81689d6e457169ce846aa4f4d2e3f335"><div class="ttname"><a href="../../df/d24/dweb_8c.html#a81689d6e457169ce846aa4f4d2e3f335">beta</a></div><div class="ttdeci">real_number beta</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d24/dweb_8c_source.html#l00019">dweb.c:19</a></div></div>
<div class="ttc" id="enough_8c_html_a3f41d878a34048480562aba063c70c92"><div class="ttname"><a href="../../db/da1/enough_8c.html#a3f41d878a34048480562aba063c70c92">max</a></div><div class="ttdeci">local int max</div><div class="ttdef"><b>Definition:</b> <a href="../../db/da1/enough_8c_source.html#l00167">enough.c:167</a></div></div>
<div class="ttc" id="ddaskr_8f_html_ab4330c24bb8f25167a9066561bb10ada"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#ab4330c24bb8f25167a9066561bb10ada">dheqr</a></div><div class="ttdeci">subroutine dheqr(A, LDA, N, Q, INFO, IJOB)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l06892">ddaskr.f:6892</a></div></div>
<div class="ttc" id="_ip_blas_8cpp_html_a5c5cca23a276104eda39f10efd39ca20"><div class="ttname"><a href="../../d2/d14/_ip_blas_8cpp.html#a5c5cca23a276104eda39f10efd39ca20">k</a></div><div class="ttdeci">void char ipfint ipfint ipfint * k</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d14/_ip_blas_8cpp_source.html#l00044">IpBlas.cpp:44</a></div></div>
<div class="ttc" id="3rd_party_2gc_2tests_2test_8c_html_ab297cac0471ba396dd3f55b6c7665343"><div class="ttname"><a href="../../d4/d12/3rd_party_2gc_2tests_2test_8c.html#ab297cac0471ba396dd3f55b6c7665343">tn</a></div><div class="ttdeci">struct treenode tn</div></div>
<div class="ttc" id="dlinpk_8f_html_a9449fc686f17b88af5f5472b4880c3d3"><div class="ttname"><a href="../../d6/dcf/dlinpk_8f.html#a9449fc686f17b88af5f5472b4880c3d3">dgesl</a></div><div class="ttdeci">subroutine dgesl(a, lda, n, ipvt, b, job)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dcf/dlinpk_8f_source.html#l00105">dlinpk.f:105</a></div></div>
<div class="ttc" id="daux_8f_html_a55c951826f974ddfea5216e6c9575ed5"><div class="ttname"><a href="../../d1/d98/daux_8f.html#a55c951826f974ddfea5216e6c9575ed5">xerrwd</a></div><div class="ttdeci">subroutine xerrwd(MSG, NMES, NERR, LEVEL, NI, I1, I2, NR, R1, R2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d98/daux_8f_source.html#l00049">daux.f:49</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a4dcdd9a7ce2b4ea61f28f5ca27374266"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a4dcdd9a7ce2b4ea61f28f5ca27374266">ddstp</a></div><div class="ttdeci">subroutine ddstp(X, Y, YPRIME, NEQ, RES, JAC, PSOL, H, WT, VT, JSTART, IDID, RPAR, IPAR, PHI, SAVR, DELTA, E, WM, IWM, ALPHA, BETA, GAMMA, PSI, SIGMA, CJ, CJOLD, HOLD, S, HMIN, UROUND, EPLI, SQRTN, RSQRTN, EPCON, IPHASE, JCALC, JFLG, K, KOLD, NS, NONNEG, NTYPE, NLS)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l03137">ddaskr.f:3137</a></div></div>
<div class="ttc" id="dweb_8c_html_a22f866797c0b4e7d4cb3546b06fb4d2a"><div class="ttname"><a href="../../df/d24/dweb_8c.html#a22f866797c0b4e7d4cb3546b06fb4d2a">ns</a></div><div class="ttdeci">integer ns</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d24/dweb_8c_source.html#l00018">dweb.c:18</a></div></div>
<div class="ttc" id="_ip_ma57_t_solver_interface_8cpp_html_acbde4f2d407a446c2a3573918bac9b42"><div class="ttname"><a href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#acbde4f2d407a446c2a3573918bac9b42">n</a></div><div class="ttdeci">void ma57int * n</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp_source.html#l00094">IpMa57TSolverInterface.cpp:94</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a7e4bd991dc7c86fd462dc77472174b56"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a7e4bd991dc7c86fd462dc77472174b56">dfnrmd</a></div><div class="ttdeci">subroutine dfnrmd(NEQ, Y, T, YPRIME, R, CJ, TSCALE, WT, RES, IRES, FNORM, WM, IWM, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l04436">ddaskr.f:4436</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a96c6b13349fc497b399975cc823a6373"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a96c6b13349fc497b399975cc823a6373">dspigm</a></div><div class="ttdeci">subroutine dspigm(NEQ, TN, Y, YPRIME, SAVR, R, WGHT, MAXL, MAXLP1, KMP, EPLIN, CJ, RES, IRES, NRE, PSOL, NPSL, Z, V, HES, Q, LGMR, WP, IWP, WK, DL, RHOK, IFLAG, IRST, NRSTS, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l06357">ddaskr.f:6357</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a1bd09d68f4c05a0667b0b5ac0cf55bff"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a1bd09d68f4c05a0667b0b5ac0cf55bff">ddwnrm</a></div><div class="ttdeci">double precision function ddwnrm(NEQ, V, RWT, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l03902">ddaskr.f:3902</a></div></div>
<div class="ttc" id="3rd_party_2flex-2_85_835_2parse_8c_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c_source.html#l00193">parse.c:193</a></div></div>
<div class="ttc" id="setjmp__t_8c_html_abe646b6ed5a1b16baedfffa1cf1f21d3"><div class="ttname"><a href="../../d9/d85/setjmp__t_8c.html#abe646b6ed5a1b16baedfffa1cf1f21d3">a</a></div><div class="ttdeci">struct a_s a</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d14/_ip_blas_8cpp_source.html#l00040">IpBlas.cpp:40</a></div></div>
<div class="ttc" id="g_09_09malloc_8c_html_ac1c97f6ef29e7c4e0014267d82e8a677"><div class="ttname"><a href="../../d4/d98/g_09_09malloc_8c.html#ac1c97f6ef29e7c4e0014267d82e8a677">p</a></div><div class="ttdeci">mchunkptr p</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d98/g_09_09malloc_8c_source.html#l01207">g++malloc.c:1207</a></div></div>
<div class="ttc" id="_ip_ma57_t_solver_interface_8cpp_html_a9996e8b215a61178099fb791f471c95d"><div class="ttname"><a href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp.html#a9996e8b215a61178099fb791f471c95d">iwork</a></div><div class="ttdeci">void ma57int const ma57int const ma57int ma57int ma57int ma57int * iwork</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df7/_ip_ma57_t_solver_interface_8cpp_source.html#l00048">IpMa57TSolverInterface.cpp:48</a></div></div>
<div class="ttc" id="ddaskr_8f_html_aa301ce2fb688da345656de7ea981695e"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#aa301ce2fb688da345656de7ea981695e">dnsk</a></div><div class="ttdeci">subroutine dnsk(X, Y, YPRIME, NEQ, RES, PSOL, WT, RPAR, IPAR, SAVR, DELTA, E, WM, IWM, CJ, SQRTN, RSQRTN, EPLIN, EPCON, S, CONFAC, TOLNEW, MULDEL, MAXIT, IRES, IERSL, IERNEW)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l06043">ddaskr.f:6043</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a802f3562fe48073d5b35370a79347a6c"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a802f3562fe48073d5b35370a79347a6c">dslvk</a></div><div class="ttdeci">subroutine dslvk(NEQ, Y, TN, YPRIME, SAVR, X, EWT, WM, IWM, RES, IRES, PSOL, IERSL, CJ, EPLIN, SQRTN, RSQRTN, RHOK, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l06219">ddaskr.f:6219</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a38468e6725b8b823437ef7bd24f68562"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a38468e6725b8b823437ef7bd24f68562">dslvd</a></div><div class="ttdeci">subroutine dslvd(NEQ, DELTA, WM, IWM)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l05098">ddaskr.f:5098</a></div></div>
<div class="ttc" id="ddaskr_8f_html_ab02b6e2207645c9bc72492d45e3a4f0b"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#ab02b6e2207645c9bc72492d45e3a4f0b">ddasid</a></div><div class="ttdeci">subroutine ddasid(X, Y, YPRIME, NEQ, ICOPT, ID, RES, JACD, PDUM, H, TSCALE, WT, JSDUM, RPAR, IPAR, DUMSVR, DELTA, R, YIC, YPIC, DUMPWK, WM, IWM, CJ, UROUND, DUME, DUMS, DUMR, EPCON, RATEMX, STPTOL, JFDUM, ICNFLG, ICNSTR, IERNLS)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l03938">ddaskr.f:3938</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a96d6ea4d2053a20e9d76a8a0fc1f5af4"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a96d6ea4d2053a20e9d76a8a0fc1f5af4">dhels</a></div><div class="ttdeci">subroutine dhels(A, LDA, N, Q, B)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l07063">ddaskr.f:7063</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a85856bdb5c050759a3609e2ec8ebe7b0"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a85856bdb5c050759a3609e2ec8ebe7b0">dnedk</a></div><div class="ttdeci">subroutine dnedk(X, Y, YPRIME, NEQ, RES, JACK, PSOL, H, WT, JSTART, IDID, RPAR, IPAR, PHI, GAMMA, SAVR, DELTA, E, WM, IWM, CJ, CJOLD, CJLAST, S, UROUND, EPLI, SQRTN, RSQRTN, EPCON, JCALC, JFLG, KP1, NONNEG, NTYPE, IERNLS)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l05773">ddaskr.f:5773</a></div></div>
<div class="ttc" id="ddaskr_8f_html_aaead83d5896fc4b6b7d26450a2c3c557"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#aaead83d5896fc4b6b7d26450a2c3c557">drchek</a></div><div class="ttdeci">subroutine drchek(JOB, RT, NRT, NEQ, TN, TOUT, Y, YP, PHI, PSI, KOLD, R0, R1, RX, JROOT, IRT, UROUND, INFO3, RWORK, IWORK, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l02497">ddaskr.f:2497</a></div></div>
<div class="ttc" id="dlinpk_8f_html_adb136e14634fe4b772a0b034f52f3939"><div class="ttname"><a href="../../d6/dcf/dlinpk_8f.html#adb136e14634fe4b772a0b034f52f3939">daxpy</a></div><div class="ttdeci">subroutine daxpy(n, da, dx, incx, dy, incy)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dcf/dlinpk_8f_source.html#l00531">dlinpk.f:531</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a24778d95221e878d2df4a54cb3af6d80"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a24778d95221e878d2df4a54cb3af6d80">dorth</a></div><div class="ttdeci">subroutine dorth(VNEW, V, HES, N, LL, LDHES, KMP, SNORMW)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l06795">ddaskr.f:6795</a></div></div>
<div class="ttc" id="gkregex_8c_html_af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c"><div class="ttname"><a href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1ae9de385ef6fe9bf3360d1038396b884c">false</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8d/gkregex_8c_source.html#l00113">gkregex.c:113</a></div></div>
<div class="ttc" id="group__jm__vector_html_ga176bdff3633e513abe39f23d6539eb9a"><div class="ttname"><a href="../../da/d6c/group__jm__vector.html#ga176bdff3633e513abe39f23d6539eb9a">c</a></div><div class="ttdeci">size_t jm_callbacks * c</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d12/3rd_party_2_f_m_i_l_2install_2include_2_j_m_2jm__vector__template_8h_source.html#l00037">jm_vector_template.h:37</a></div></div>
<div class="ttc" id="gkregex_8c_html_af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b"><div class="ttname"><a href="../../d8/d8d/gkregex_8c.html#af6a258d8f3ee5206d682d799316314b1a08f175a5505a10b9ed657defeb050e4b">true</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d8d/gkregex_8c_source.html#l00113">gkregex.c:113</a></div></div>
<div class="ttc" id="3rd_party_2flex-2_85_835_2parse_8c_html_a1aabac6d068eef6a7bad3fdf50a05cc8"><div class="ttname"><a href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c.html#a1aabac6d068eef6a7bad3fdf50a05cc8">d</a></div><div class="ttdeci">d</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/ddc/3rd_party_2flex-2_85_835_2parse_8c_source.html#l00870">parse.c:870</a></div></div>
<div class="ttc" id="dlinpk_8f_html_a0590f8db475e11dc2c9137bb13887acf"><div class="ttname"><a href="../../d6/dcf/dlinpk_8f.html#a0590f8db475e11dc2c9137bb13887acf">dscal</a></div><div class="ttdeci">subroutine dscal(n, da, dx, incx)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dcf/dlinpk_8f_source.html#l00627">dlinpk.f:627</a></div></div>
<div class="ttc" id="ddaskr_8f_html_ab0bfbcd159ed7be7b6ff62d32efa2f3c"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#ab0bfbcd159ed7be7b6ff62d32efa2f3c">datv</a></div><div class="ttdeci">subroutine datv(NEQ, Y, TN, YPRIME, SAVR, V, WGHT, YPTEM, RES, IRES, PSOL, Z, VTEM, WP, IWP, CJ, EPLIN, IER, NRE, NPSL, RPAR, IPAR)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l06671">ddaskr.f:6671</a></div></div>
<div class="ttc" id="ddaskr_8f_html_a872cbfe7aaf8c2842999bdf43a8b59b1"><div class="ttname"><a href="../../d2/dd0/ddaskr_8f.html#a872cbfe7aaf8c2842999bdf43a8b59b1">ddatrp</a></div><div class="ttdeci">subroutine ddatrp(X, XOUT, YOUT, YPOUT, NEQ, KOLD, PHI, PSI)</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dd0/ddaskr_8f_source.html#l03848">ddaskr.f:3848</a></div></div>
<div class="ttc" id="build_2_expat_ex_2install_2include_2expat_8h_html_ab87f55bd0280d90925050a4188c14ab5"><div class="ttname"><a href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h.html#ab87f55bd0280d90925050a4188c14ab5">s</a></div><div class="ttdeci">const char * s</div><div class="ttdef"><b>Definition:</b> <a href="../../de/dca/build_2_expat_ex_2install_2include_2expat_8h_source.html#l00778">expat.h:778</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
